{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":"Busca cómo se implementó el modal de consumo de créditos IA en /vacantes/create. Necesito ver:\n1. Cómo se incluye el modal \"modal-consumo-creditos-ia\"\n2. Cómo se configura la cantidad de créditos a descontar\n3. Cómo se conecta con la función de IA que se ejecuta al continuar\n\nBusca en resources/views/vacantes/create.blade.php y archivos relacionados."},"uuid":"d02d0462-0449-4080-abfa-b55a5db84dda","timestamp":"2026-01-29T16:20:26.633Z"}
{"parentUuid":"d02d0462-0449-4080-abfa-b55a5db84dda","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_016kWD11ixUQAK7SpwnSmHSF","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a buscar la implementación del modal de consumo de créditos IA en el archivo de vacantes y archivos relacionados."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20583,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20583},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXbyU83RjZKB3mZQtRpmQ","type":"assistant","uuid":"43c07372-ee1f-4886-88f2-95ad4eadfc7d","timestamp":"2026-01-29T16:20:28.721Z"}
{"parentUuid":"43c07372-ee1f-4886-88f2-95ad4eadfc7d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_016kWD11ixUQAK7SpwnSmHSF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NmaBU9YfCDd5M4rKzwTTGD","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\create.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20583,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20583},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXbyU83RjZKB3mZQtRpmQ","type":"assistant","uuid":"c019ca7e-a213-4b7e-b6c4-88fbb4a57c9b","timestamp":"2026-01-29T16:20:29.250Z"}
{"parentUuid":"c019ca7e-a213-4b7e-b6c4-88fbb4a57c9b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_016kWD11ixUQAK7SpwnSmHSF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CT9WrsTJrwL9vAaAgAm2yw","name":"Glob","input":{"pattern":"**/*modal*consumo*creditos*.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20583,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20583},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXbyU83RjZKB3mZQtRpmQ","type":"assistant","uuid":"d49b544e-0d72-46a5-90c1-8a4f52f5101f","timestamp":"2026-01-29T16:20:31.915Z"}
{"parentUuid":"d49b544e-0d72-46a5-90c1-8a4f52f5101f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_016kWD11ixUQAK7SpwnSmHSF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019Wiu5GbBmuE4JjFo4ELL2z","name":"Glob","input":{"pattern":"resources/views/**/*modal*.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20583,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20583},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXbyU83RjZKB3mZQtRpmQ","type":"assistant","uuid":"0776a53e-76a9-4c68-8506-d1f721a5bb29","timestamp":"2026-01-29T16:20:31.982Z"}
{"parentUuid":"c019ca7e-a213-4b7e-b6c4-88fbb4a57c9b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01NmaBU9YfCDd5M4rKzwTTGD"}]},"uuid":"76a494eb-2593-4343-acb1-47248e39531d","timestamp":"2026-01-29T16:20:32.162Z","toolUseResult":"Error: File does not exist.","sourceToolAssistantUUID":"c019ca7e-a213-4b7e-b6c4-88fbb4a57c9b"}
{"parentUuid":"0776a53e-76a9-4c68-8506-d1f721a5bb29","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019Wiu5GbBmuE4JjFo4ELL2z","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\componentes\\componentes\\modal.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\componentes\\modal-eliminar.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\consumos\\modal-consumos-empresa-plan.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-consumos.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresas\\secciones\\modal-generar-enlace.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-agendamiento-masivo.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-agregar-participantes.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-comparar-candidatos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-compartir-acceso.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-compartir-proceso.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-detalle-participante.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-duplicar.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-eliminar.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-historial-acciones.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-historial-compartido.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-mover-proceso.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-reagendar.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-respuesta-candidatos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\procesos\\modales\\modal-videograbaciones.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\perfiles\\componentes\\modal-crear-perfil.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-agregar-seccion-texto-descriptivo.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-creacion-reactivos.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-crear-grupo-opcion.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-editar-dimension.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-editar-factor.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-editar-nombre-seccion.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\pruebas\\crear-editar\\modals\\modal-reactivos-disc.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\detalle\\modales\\modal-candidatos-descartados.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-pruebas-psicometricas.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\detalle\\modales\\modal-detalle-resultados.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\modales\\modal-respuesta-candidatos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-revision-hv.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\detalle\\modales\\modal-competencias-mejorar.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\mis-pruebas\\aplicantes\\modales\\modal-aplicacion-documentos-solicitados.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\mis-pruebas\\aplicantes\\modales\\modal-aplicacion-prueba-tecnica.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\mis-pruebas\\aplicantes\\modales\\modal-aplicacion-revision-hv.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\perfiles\\componentes\\modal-resumen-perfil.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\detalle\\modales\\modal-asignar-candidato-otra-vacante.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-documentos-contratacion.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-preguntas-prefiltro.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-prueba-tecnica.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-video-entrevista.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-cargar-archivo.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-entrevista.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-consumo-creditos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-solicitar-mas-creditos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-agregar-candidatos.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-consumos-creditos.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-recompras.blade.php"}]},"uuid":"92c6be58-1e21-48e7-996d-eb6b257e4f2e","timestamp":"2026-01-29T16:20:37.893Z","sourceToolAssistantUUID":"0776a53e-76a9-4c68-8506-d1f721a5bb29"}
{"parentUuid":"d49b544e-0d72-46a5-90c1-8a4f52f5101f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CT9WrsTJrwL9vAaAgAm2yw","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-consumo-creditos-ia.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-consumos-creditos.blade.php"}]},"uuid":"c26e46ec-5184-4dc4-b6fb-8a9c2ab6279b","timestamp":"2026-01-29T16:20:37.905Z","sourceToolAssistantUUID":"d49b544e-0d72-46a5-90c1-8a4f52f5101f"}
{"parentUuid":"c26e46ec-5184-4dc4-b6fb-8a9c2ab6279b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_019Wiu5GbBmuE4JjFo4ELL2z","toolUseID":"toolu_019Wiu5GbBmuE4JjFo4ELL2z","timestamp":"2026-01-29T16:20:37.895Z","uuid":"575c2764-e838-4f94-8f36-1622136e6b56"}
{"parentUuid":"575c2764-e838-4f94-8f36-1622136e6b56","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_01CT9WrsTJrwL9vAaAgAm2yw","toolUseID":"toolu_01CT9WrsTJrwL9vAaAgAm2yw","timestamp":"2026-01-29T16:20:37.907Z","uuid":"a276809f-b95e-430b-a1b6-447636f07682"}
{"parentUuid":"a276809f-b95e-430b-a1b6-447636f07682","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HC7sLSpT7zrnPbPYUvVYDX","type":"message","role":"assistant","content":[{"type":"text","text":"Excelente, encontré el modal. Ahora voy a buscar el archivo create.blade.php en el directorio correcto y leer el modal:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2209,"cache_creation_input_tokens":644,"cache_read_input_tokens":20583,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":644},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyUyF89susiqE1rebHQ","type":"assistant","uuid":"5265241c-02a7-402e-91f5-4e2fab36e85b","timestamp":"2026-01-29T16:20:39.851Z"}
{"parentUuid":"5265241c-02a7-402e-91f5-4e2fab36e85b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HC7sLSpT7zrnPbPYUvVYDX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01N9KqQ6DvqsQrD6ekB8QnUz","name":"Bash","input":{"command":"find \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\" -name \"create.blade.php\" -type f"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2209,"cache_creation_input_tokens":644,"cache_read_input_tokens":20583,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":644},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyUyF89susiqE1rebHQ","type":"assistant","uuid":"334c5b84-792f-468c-92d2-46250e52ac72","timestamp":"2026-01-29T16:20:40.162Z"}
{"parentUuid":"334c5b84-792f-468c-92d2-46250e52ac72","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HC7sLSpT7zrnPbPYUvVYDX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SuzV5h8u67327o1xRbQttn","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-consumo-creditos-ia.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2209,"cache_creation_input_tokens":644,"cache_read_input_tokens":20583,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":644},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyUyF89susiqE1rebHQ","type":"assistant","uuid":"d8bb4971-5282-430a-907f-112d79804054","timestamp":"2026-01-29T16:20:40.552Z"}
{"parentUuid":"d8bb4971-5282-430a-907f-112d79804054","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HC7sLSpT7zrnPbPYUvVYDX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AdzeZeXR728o8ZZd6A1pPb","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-solicitar-mas-creditos-ia.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2209,"cache_creation_input_tokens":644,"cache_read_input_tokens":20583,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":644},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyUyF89susiqE1rebHQ","type":"assistant","uuid":"d8122969-1425-466e-89de-7dfcf8c9e675","timestamp":"2026-01-29T16:20:42.580Z"}
{"parentUuid":"d8bb4971-5282-430a-907f-112d79804054","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SuzV5h8u67327o1xRbQttn","type":"tool_result","content":"     1→${crearModal({\n     2→    id: 'modal-consumo-creditos-ia',\n     3→    dialog_class: 'modal-md modal-dialog-centered',\n     4→    adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n     5→    titulo_header: 'Consumo de créditos',\n     6→    subtitulo_header: `Esta acción hará uso de la IA y descontará <span id=\"cantidad-creditos-descontar-modal\"></span> crédito(s) de tu saldo disponible.`,\n     7→    header_class: 'pb-0',\n     8→    modal_body_class: 'p-0 mb-6',\n     9→    boton_footer1: {\n    10→        type: 'button',\n    11→        texto: 'Cancelar',\n    12→        class: 'btn-outline-primary',\n    13→        cerrar_modal: true,\n    14→    },\n    15→    boton_footer2: {\n    16→        type: 'submit',\n    17→        texto: 'Continuar',\n    18→        class: 'btn-primary',\n    19→        cerrar_modal: false,\n    20→        onclick: `continuarEjecucionIA();`\n    21→    },\n    22→    modal_body: `\n    23→        <div class=\"col-12 text-body-2 fw-semibold\">\n    24→            ¿Deseas continuar?\n    25→        </div>\n    26→    `\n    27→})}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b2380541-25bd-4947-8490-b8a4ef6fd9c5","timestamp":"2026-01-29T16:20:44.393Z","sourceToolAssistantUUID":"d8bb4971-5282-430a-907f-112d79804054"}
{"parentUuid":"d8122969-1425-466e-89de-7dfcf8c9e675","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AdzeZeXR728o8ZZd6A1pPb","type":"tool_result","content":"     1→${crearModal({\n     2→    id: 'modal-solicitar-mas-creditos-ia',\n     3→    dialog_class: 'modal-md modal-dialog-centered',\n     4→    adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n     5→    titulo_header: 'Solicitar más créditos',\n     6→    subtitulo_header: `Tu saldo está por debajo del <span id=\"porcentaje-creditos-disponibles-modal\"></span>% de créditos disponibles.<br>Solicita más créditos ahora para evitar interrupciones en tus acciones.`,\n     7→    modal_body_class: 'p-0',\n     8→    boton_footer1: {\n     9→        type: 'button',\n    10→        texto: 'Cancelar',\n    11→        class: 'btn-outline-primary',\n    12→        cerrar_modal: true,\n    13→    },\n    14→    boton_footer2: {\n    15→        type: 'submit',\n    16→        texto: 'Solicitar más créditos',\n    17→        class: 'btn-primary',\n    18→        cerrar_modal: false,\n    19→        onclick: `solicitarMasCreditosIA();`\n    20→    },\n    21→    modal_body: ``\n    22→})}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"96149a98-59b6-4ba2-a951-7fcc5a24b821","timestamp":"2026-01-29T16:20:44.394Z","sourceToolAssistantUUID":"d8122969-1425-466e-89de-7dfcf8c9e675"}
{"parentUuid":"96149a98-59b6-4ba2-a951-7fcc5a24b821","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01SuzV5h8u67327o1xRbQttn","toolUseID":"toolu_01SuzV5h8u67327o1xRbQttn","timestamp":"2026-01-29T16:20:44.407Z","uuid":"578030cf-7a58-411f-88ae-f8aa5667c777"}
{"parentUuid":"578030cf-7a58-411f-88ae-f8aa5667c777","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01AdzeZeXR728o8ZZd6A1pPb","toolUseID":"toolu_01AdzeZeXR728o8ZZd6A1pPb","timestamp":"2026-01-29T16:20:44.408Z","uuid":"584f7fb8-06e9-4f97-8cd6-f1a5ff9f65b1"}
{"parentUuid":"334c5b84-792f-468c-92d2-46250e52ac72","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01N9KqQ6DvqsQrD6ekB8QnUz","type":"tool_result","content":"","is_error":false}]},"uuid":"6a61c61a-3757-4c45-a7e3-80988cc6c8e6","timestamp":"2026-01-29T16:20:49.859Z","sourceToolAssistantUUID":"334c5b84-792f-468c-92d2-46250e52ac72"}
{"parentUuid":"6a61c61a-3757-4c45-a7e3-80988cc6c8e6","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01E4MqQftzpbuttH3FM1NJiK","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora busco dónde está el archivo create.blade.php y cómo se incluye este modal:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":972,"cache_creation_input_tokens":2563,"cache_read_input_tokens":21227,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2563},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyVs4L94TFQEgaua1QZ","type":"assistant","uuid":"4c5efc90-81c8-4869-9267-48b9e2d46e9d","timestamp":"2026-01-29T16:20:52.058Z"}
{"parentUuid":"4c5efc90-81c8-4869-9267-48b9e2d46e9d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01E4MqQftzpbuttH3FM1NJiK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GWsvtXmdkHdrBfdEKcHTYV","name":"Bash","input":{"command":"find \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\" -name \"*.blade.php\" -type f | grep -i create"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":972,"cache_creation_input_tokens":2563,"cache_read_input_tokens":21227,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2563},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyVs4L94TFQEgaua1QZ","type":"assistant","uuid":"073bb107-6839-4f85-9116-a7218c3b69d3","timestamp":"2026-01-29T16:20:52.738Z"}
{"parentUuid":"073bb107-6839-4f85-9116-a7218c3b69d3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01E4MqQftzpbuttH3FM1NJiK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MfTPdq283XuHanAxQSBaCb","name":"Grep","input":{"pattern":"modal-consumo-creditos-ia","path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes","type":"php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":972,"cache_creation_input_tokens":2563,"cache_read_input_tokens":21227,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2563},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyVs4L94TFQEgaua1QZ","type":"assistant","uuid":"c2fc081d-c035-4027-96e3-c893bd8ccc16","timestamp":"2026-01-29T16:20:54.243Z"}
{"parentUuid":"073bb107-6839-4f85-9116-a7218c3b69d3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GWsvtXmdkHdrBfdEKcHTYV","type":"tool_result","content":"","is_error":false}]},"uuid":"b35422a8-cfc9-4e81-801d-8ce609043b6b","timestamp":"2026-01-29T16:20:59.434Z","sourceToolAssistantUUID":"073bb107-6839-4f85-9116-a7218c3b69d3"}
{"parentUuid":"c2fc081d-c035-4027-96e3-c893bd8ccc16","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MfTPdq283XuHanAxQSBaCb","type":"tool_result","content":"Found 4 files\nresources\\views\\vacantes\\paginas\\detalle\\detalle.blade.php\nresources\\views\\vacantes\\paginas\\index.blade.php\nresources\\views\\vacantes\\paginas\\modales\\modal-consumo-creditos-ia.blade.php\nresources\\views\\vacantes\\paginas\\crear.blade.php"}]},"uuid":"5e9c0f5a-b26c-466b-b08c-f58632341bac","timestamp":"2026-01-29T16:20:59.464Z","sourceToolAssistantUUID":"c2fc081d-c035-4027-96e3-c893bd8ccc16"}
{"parentUuid":"5e9c0f5a-b26c-466b-b08c-f58632341bac","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01MfTPdq283XuHanAxQSBaCb","toolUseID":"toolu_01MfTPdq283XuHanAxQSBaCb","timestamp":"2026-01-29T16:20:59.466Z","uuid":"4b986d8e-ca3f-4e7c-b16a-979e84bdbf66"}
{"parentUuid":"4b986d8e-ca3f-4e7c-b16a-979e84bdbf66","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013T2xDKg8McJLwEy8NB6ziB","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora voy a leer el archivo crear.blade.php:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":1728,"cache_read_input_tokens":23790,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1728},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWYrjLALV8vkAAeX1y","type":"assistant","uuid":"6f7875c4-2908-456f-8921-0c754a7f2d7d","timestamp":"2026-01-29T16:21:00.801Z"}
{"parentUuid":"6f7875c4-2908-456f-8921-0c754a7f2d7d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013T2xDKg8McJLwEy8NB6ziB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015wmKMecgCmHrqXyuNgeDqB","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\crear.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":1728,"cache_read_input_tokens":23790,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1728},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWYrjLALV8vkAAeX1y","type":"assistant","uuid":"ccf5acd1-4288-49da-86e0-ba9fc61b2de4","timestamp":"2026-01-29T16:21:00.983Z"}
{"parentUuid":"ccf5acd1-4288-49da-86e0-ba9fc61b2de4","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015wmKMecgCmHrqXyuNgeDqB","type":"tool_result","content":"     1→@extends('layouts.app')\n     2→\n     3→@section('titulo', 'Vacantes')\n     4→\n     5→@section('estilos')\n     6→    <link href=\"{{ asset('css/vacantes/vacantes.css') }}\" rel=\"stylesheet\">\n     7→    <link href=\"{{ asset('css/perfiles/perfiles.css') }}\" rel=\"stylesheet\">\n     8→@endsection\n     9→\n    10→@section('contenido')\n    11→    <div class=\"col-12 ps-14 pb-4\">\n    12→        @php\n    13→            $tipo_formulario = !empty($vacante) ? 'Editar' : 'Crear';\n    14→            $migas_pan       = [\n    15→                ['nombre' => 'Producto selección', 'url' => '/procesos'],\n    16→                ['nombre' => 'Vacantes', 'url' => '/vacantes'],\n    17→                ['nombre' => $tipo_formulario . ' vacante', 'url' => '', 'active' => true]\n    18→            ];\n    19→        @endphp\n    20→\n    21→        ${crearMigaDePan({migas:@json($migas_pan), volver:true})}\n    22→    </div>\n    23→\n    24→    <div class=\"row justify-content-center bg-light-gray py-5 px-5\">\n    25→        <div class=\"col-12 col-lg-11 col-xl-9 py-5 px-0 bg-white rounded-3 shadow-1\">\n    26→            <div class=\"container-fluid\">\n    27→                <div class=\"row\">\n    28→                    <div class=\"col-12\">\n    29→                        ${crearSeccionPasos({\n    30→                            id: 'vacantes',\n    31→                            tab_content_class: 'mt-10 border-top row',\n    32→                            tabs: [\n    33→                                {\n    34→                                    id: 'paso-1',\n    35→                                    titulo: `1`,\n    36→                                    subtitulo: `Información`,\n    37→                                    contenido: `\n    38→                                        @include('vacantes.paginas.formularios.formulario-informacion')\n    39→                                    `,\n    40→                                    activo: true\n    41→                                },\n    42→                                {\n    43→                                    id: 'paso-2',\n    44→                                    titulo: `2`,\n    45→                                    subtitulo: `Etapas`,\n    46→                                    contenido: `\n    47→                                        @include('vacantes.paginas.formularios.formulario-etapas')\n    48→                                    `,\n    49→                                    disabled: true,\n    50→                                    activo: false,\n    51→                                    onclick: `$('#formulario-vacantes-paso-1').submit();`\n    52→                                },\n    53→                            ]\n    54→                        })}\n    55→                    </div>\n    56→                </div>\n    57→            </div>\n    58→        </div>\n    59→    </div>\n    60→@endsection\n    61→\n    62→@section('modals')\n    63→    ${crearModal({\n    64→        id: 'modal-editar-plantilla-etapa',\n    65→        dialog_class: 'modal-lg modal-dialog-centered',\n    66→        titulo_header: 'Configurar notificación',\n    67→        boton_footer1: {\n    68→            type: 'button',\n    69→            texto: 'Cancelar',\n    70→            class: 'btn-outline-primary',\n    71→            cerrar_modal: false,\n    72→            id: 'btn-cancelar-plantilla-etapa',\n    73→        },\n    74→        boton_footer2: {\n    75→            type: 'submit',\n    76→            texto: 'Guardar',\n    77→            class: 'btn-primary',\n    78→            cerrar_modal: false,\n    79→            form: 'form-editar-plantilla-etapa'\n    80→        },\n    81→        modal_body: `\n    82→            <form class=\"w-100\" id=\"form-editar-plantilla-etapa\" action=\"/plantillas-correos\">\n    83→                @csrf\n    84→                <input type=\"hidden\" id=\"id\" name=\"id\">\n    85→                <input type=\"hidden\" id=\"etapa_id\" name=\"etapa_id\" class=\"input-dinamico\">\n    86→                <input type=\"hidden\" id=\"grupo_id\" name=\"grupo_id\" value=\"2\">\n    87→                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\">\n    88→                <input type=\"hidden\" id=\"plantilla_correo_id\" name=\"plantilla_correo_id\">\n    89→                <input type=\"hidden\" id=\"contenido\" name=\"contenido\">\n    90→                <input type=\"hidden\" id=\"con_logo_empresa\" name=\"con_logo_empresa\">\n    91→                <input type=\"hidden\" id=\"notificar_fin_proceso\" name=\"notificar_fin_proceso\">\n    92→\n    93→                <div class=\"row\">\n    94→                    <div class=\"col-6 text-body-2 my-auto\">\n    95→                        <i class=\"bi bi-card-checklist\"></i>\n    96→                        <span class=\"text-gray-10\">Plantilla:</span>\n    97→                        <span class=\"text-gray-30 text-body-2\" id=\"titulo-plantilla-modal\"></span>\n    98→                    </div>\n    99→                    <div class=\"col-6 text-end\">\n   100→                        ${crearBoton({\n   101→                            id: 'restablecer_texto',\n   102→                            clases: 'btn-outline-primary',\n   103→                            texto: `\n   104→                                <i class=\"bi bi-arrow-repeat me-2\"></i>Restablecer texto\n   105→                            `,\n   106→                            type: 'button',\n   107→                        })}\n   108→                    </div>\n   109→                </div>\n   110→                <div class=\"row mt-4\">\n   111→                    <div class=\"col-12\">\n   112→                        ${crearInput({\n   113→                            id: 'titulo_mensaje_plantilla',\n   114→                            label: 'Titulo o asunto del mensaje',\n   115→                            name: 'titulo',\n   116→                            required: true,\n   117→                            type: 'text',\n   118→                        })}\n   119→                    </div>\n   120→                    <div class=\"col-12\">\n   121→                        <h1 class=\"text-body-2\">Descripción del mensaje</h1>\n   122→                    </div>\n   123→                    <div class=\"col-12\" id=\"contenedor_editor_texto\"></div>\n   124→\n   125→                    <div class=\"col-12\">\n   126→                        ${crearCheckbox({\n   127→                            id: 'con_logo',\n   128→                            class: 'input-dinamico',\n   129→                            label: 'Agregar logo de empresa',\n   130→                        })}\n   131→                    </div>\n   132→                    <div class=\"col-12\" id=\"contenedor_check_enviar_al_finalizar\"></div>\n   133→                </div>\n   134→            </form>\n   135→        `\n   136→    })}\n   137→    ${crearModal({\n   138→        id: 'modal-vacante-ia',\n   139→        dialog_class: 'modal-md modal-dialog-centered',\n   140→        titulo_header: 'Generar mediante IA',\n   141→        boton_footer1: {\n   142→            type: 'button',\n   143→            texto: 'Cancelar',\n   144→            class: 'btn-outline-primary',\n   145→            cerrar_modal: true,\n   146→        },\n   147→        boton_footer2: {\n   148→            type: 'button',\n   149→            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar vacante',\n   150→            class: 'btn-yellow',\n   151→            cerrar_modal: false,\n   152→            onclick: `generarVacanteIA()`\n   153→        },\n   154→        modal_body: `\n   155→            <div class=\"col-12\">\n   156→                <div class=\"row\">\n   157→                    <div class=\"col-12 mb-4 text-body-3 text-gray-30\">\n   158→                        Detalla el perfil que buscas, incluyendo habilidades, experiencia y nivel educativo. Entre más detalles incluyas, más precisa será la vacante generada.\n   159→                    </div>\n   160→                    <div class=\"col-12\">\n   161→                        ${crearTextarea({\n   162→                            id: 'descripcion_vacante_ia',\n   163→                            name: 'descripcion_vacante_ia',\n   164→                            class: 'py-3',\n   165→                            placeholder: '',\n   166→                            value: ``,\n   167→                            label: 'Descripción de la vacante',\n   168→                        })}\n   169→                    </div>\n   170→                </div>\n   171→            </div>\n   172→        `\n   173→    })}\n   174→    ${crearModal({\n   175→        id: 'modal-generando-ia',\n   176→        dialog_class: 'modal-md modal-dialog-centered',\n   177→        adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n   178→        header_cerrar: 'd-none',\n   179→        titulo_header: 'Generando...',\n   180→        modal_body: `\n   181→            <div class=\"col-12\">\n   182→                <div class=\"row justify-content-center\">\n   183→                    <div class=\"col-4\">\n   184→                        <img class=\"w-100\" src=\"{{ asset('/imagenes/gifs/cargue-ia.gif') }}\">\n   185→                    </div>\n   186→                </div>\n   187→            </div>\n   188→        `\n   189→    })}\n   190→    @include('vacantes.paginas.formularios.modals-movimientos.modal-revision-hv')\n   191→    @include('vacantes.paginas.formularios.modals-movimientos.modal-preguntas-prefiltro')\n   192→    @include('vacantes.paginas.formularios.modals-movimientos/modal-pruebas-psicometricas')\n   193→    @include('vacantes.paginas.formularios.modals-movimientos.modal-prueba-tecnica')\n   194→    @include('vacantes.paginas.formularios.modals-movimientos.modal-video-entrevista')\n   195→    @include('vacantes.paginas.formularios.modals-movimientos.modal-entrevista')\n   196→    @include('vacantes.paginas.formularios.modals-movimientos.modal-documentos-contratacion')\n   197→\n   198→    {{-- Modal de previsualización de imágenes --}}\n   199→    ${crearModal({\n   200→        id: 'modal-previsualizacion-imagen',\n   201→        dialog_class: 'modal-lg modal-dialog-centered',\n   202→        titulo_header: 'Previsualización',\n   203→        modal_body: `\n   204→            <div class=\"col-12 p-0 overflow-hidden border rounded-3\">\n   205→                <img class=\"w-100\" id=\"imagen-previsualizacion\" src=\"\" alt=\"Imagen ampliada\">\n   206→            </div>\n   207→            <div class=\"col-12 mt-4\">\n   208→                <div class=\"row align-items-center\">\n   209→                    <div class=\"col-auto\">\n   210→                        <i class=\"h4 mb-0 bi bi-dash-circle pointer text-blue-20\" id=\"zoom-out\"></i>\n   211→                    </div>\n   212→                    <div class=\"col\">\n   213→                        <i class=\"h4 mb-0 bi bi-plus-circle pointer text-blue-20\" id=\"zoom-in\"></i>\n   214→                    </div>\n   215→                    <div class=\"col-auto pe-0\">\n   216→                        ${crearBoton({ clases: 'btn-primary', texto: 'Descargar imagen', id: 'descargar-imagen' })}\n   217→                    </div>\n   218→                </div>\n   219→            </div>\n   220→        `\n   221→    })}\n   222→\n   223→    @include('perfiles.componentes.modal-crear-perfil')\n   224→    @include('perfiles.componentes.modal-resumen-perfil')\n   225→    @include('vacantes.paginas.modales.modal-consumo-creditos-ia')\n   226→@endsection\n   227→\n   228→@section('scripts')\n   229→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/crear-editar-vacantes.js') }}\"></script>\n   230→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-funciones.js') }}\"></script>\n   231→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-1.js') }}\"></script>\n   232→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-2.js') }}\"></script>\n   233→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/funciones-modals-movimientos.js') }}\"></script>\n   234→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-pruebas-psicometricas.js') }}\"></script>\n   235→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-revision-hv.js') }}\"></script>\n   236→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-preguntas-prefiltro.js') }}\"></script>\n   237→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-prueba-tecnica.js') }}\"></script>\n   238→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-video-entrevista.js') }}\"></script>\n   239→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-entrevista.js') }}\"></script>\n   240→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-documentos.js') }}\"></script>\n   241→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-ia.js') }}\"></script>\n   242→    <script type=\"text/javascript\" src=\"{{ asset('js/seleccion/perfiles-pruebas/perfiles-pruebas.js') }}\"></script>\n   243→    <script type=\"text/javascript\" src=\"{{ asset('js/seleccion/perfiles-pruebas/generar-pruebas-ia.js') }}\"></script>\n   244→    <script type=\"text/javascript\">\n   245→        let empresa = @json($empresa);\n   246→        const EMPRESA_ID = @json(\\Auth::user()->empresa->id);\n   247→        let etapas_vacante = [];\n   248→        let modalidades_trabajos = @json($modalidades_trabajos);\n   249→    </script>\n   250→@endsection\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1a7ba5f9-b2c2-4b7b-a708-6b6bb381fcdb","timestamp":"2026-01-29T16:21:01.994Z","sourceToolAssistantUUID":"ccf5acd1-4288-49da-86e0-ba9fc61b2de4"}
{"parentUuid":"1a7ba5f9-b2c2-4b7b-a708-6b6bb381fcdb","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015wmKMecgCmHrqXyuNgeDqB","toolUseID":"toolu_015wmKMecgCmHrqXyuNgeDqB","timestamp":"2026-01-29T16:21:01.995Z","uuid":"6184d846-dd96-4896-986b-a22f34ef8e35"}
{"parentUuid":"6184d846-dd96-4896-986b-a22f34ef8e35","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017XAjHLePG5PZXJatysn6QB","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora voy a buscar los archivos JavaScript que manejan la lógica de los créditos IA:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4375,"cache_read_input_tokens":25518,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4375},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWjyxUNYsrbRZhNeCR","type":"assistant","uuid":"bfb0823e-10a2-4914-b06f-03bad9d8d667","timestamp":"2026-01-29T16:21:06.592Z"}
{"parentUuid":"bfb0823e-10a2-4914-b06f-03bad9d8d667","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017XAjHLePG5PZXJatysn6QB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016v4jB2kJw7f5fygJvt4Tcw","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4375,"cache_read_input_tokens":25518,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4375},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWjyxUNYsrbRZhNeCR","type":"assistant","uuid":"8d4842f6-5ac1-4980-bb82-3a8603f31ce3","timestamp":"2026-01-29T16:21:06.671Z"}
{"parentUuid":"8d4842f6-5ac1-4980-bb82-3a8603f31ce3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017XAjHLePG5PZXJatysn6QB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VZ8Cn4n3jCxEcomizAWHbs","name":"Bash","input":{"command":"grep -r \"cantidad-creditos-descontar-modal\\|continuarEjecucionIA\\|cantidad_creditos\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\vacantes\" --include=\"*.js\""}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4375,"cache_read_input_tokens":25518,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4375},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWjyxUNYsrbRZhNeCR","type":"assistant","uuid":"e1c3e336-417b-4333-8eb6-a9e6ff0dac1f","timestamp":"2026-01-29T16:21:06.733Z"}
{"parentUuid":"e1c3e336-417b-4333-8eb6-a9e6ff0dac1f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017XAjHLePG5PZXJatysn6QB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018vVBTpCuYXLmLHywX4j2z9","name":"Bash","input":{"command":"grep -r \"modal-consumo-creditos-ia\\|continuarEjecucionIA\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\" --include=\"*.js\" -l"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4375,"cache_read_input_tokens":25518,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4375},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyWjyxUNYsrbRZhNeCR","type":"assistant","uuid":"5b1cd6da-bbe0-4073-8c0b-312d6a29d47f","timestamp":"2026-01-29T16:21:06.785Z"}
{"parentUuid":"8d4842f6-5ac1-4980-bb82-3a8603f31ce3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016v4jB2kJw7f5fygJvt4Tcw","type":"tool_result","content":"     1→var preguntas_generadas = [];\n     2→\n     3→/**\n     4→ * Generar vacante con IA.\n     5→ *\n     6→ * @returns {void}\n     7→ * @author José Manuel Jiménez\n     8→ * @author Andres Morales\n     9→ * @author Andres Gonzalez\n    10→ */\n    11→function generarVacanteIA() {\n    12→    let descripcion_vacante_ia = $('#descripcion_vacante_ia').val().trim();\n    13→    if (descripcion_vacante_ia.length >= 5) {\n    14→        if (!mostro_modal_creditos_ia) {\n    15→            funcion_ejecucion_ia = () => generarVacanteIAConsumida(descripcion_vacante_ia);\n    16→            let servicio_ia_id = 6;\n    17→            mostrarModalCreditosIA(servicio_ia_id);\n    18→            return;\n    19→        }\n    20→    } else {\n    21→        mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n    22→    }\n    23→}\n    24→\n    25→/**\n    26→ * consumir la vacante.\n    27→ *\n    28→ * @returns {void}\n    29→ * @author Jair Carvajal\n    30→ */\n    31→function generarVacanteIAConsumida(descripcion_vacante_ia) {\n    32→    $('#modal-vacante-ia').modal('hide');\n    33→    $('#modal-generando-ia').modal('show');\n    34→    $.ajax({\n    35→        type: 'POST',\n    36→        url : '/generar-vacante',\n    37→        data: {\n    38→            _token: $('input[name=\"_token\"]').val(),\n    39→            descripcion: descripcion_vacante_ia,\n    40→        },\n    41→        success: function(respuesta) {\n    42→            if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n    43→                return;\n    44→            }\n    45→            let vacante_ia = respuesta.data || {};\n    46→            // Llenar el nombre de la vacante\n    47→            if (vacante_ia.nombre_vacante) {\n    48→                $('#nombre_vacante').val(vacante_ia.nombre_vacante);\n    49→            }\n    50→            if (vacante_ia.salario.fijo) {\n    51→                $('#salario_especifico').prop('checked', true).trigger('change');\n    52→                $('#salario_cantidad').val(numeroCleave(vacante_ia.salario.fijo));\n    53→            } else {\n    54→                $('#salario_a_convenir').prop('checked', true).trigger('change');\n    55→                $('#salario_desde').val(numeroCleave(vacante_ia.salario.minimo));\n    56→                $('#salario_hasta').val(numeroCleave(vacante_ia.salario.maximo));\n    57→            }\n    58→            $('#habilidades').val([]);\n    59→            let habilidades = vacante_ia.habilidades.map(item => item.trim());\n    60→            for (let i = 0; i < habilidades.length; i++) {\n    61→                if (habilidades[i]) {\n    62→                    $('#habilidades').append(new Option(habilidades[i], habilidades[i], false, true));\n    63→                }\n    64→            }\n    65→            $('#herramientas_tecnologicas').val([]);\n    66→            let herramientas_tecnologicas = vacante_ia.herramientas_tecnologicas.map(item => item.trim());\n    67→            for (let i = 0; i < herramientas_tecnologicas.length; i++) {\n    68→                if (herramientas_tecnologicas[i]) {\n    69→                    $('#herramientas_tecnologicas').append(new Option(herramientas_tecnologicas[i], herramientas_tecnologicas[i], false, true));\n    70→                }\n    71→            }\n    72→            $('#experiencia_laboral').val(vacante_ia.experiencia_laboral).trigger('change.select2');\n    73→            $('#nivel_educativo_vacante').val(vacante_ia.nivel_educativo).trigger('change.select2');\n    74→\n    75→            $('#idiomas_seleccionados').val([]);\n    76→            $('#idiomas_seleccionados').multiselect(\"refresh\");\n    77→            $('#contenedor-idiomas').empty();\n    78→\n    79→            if (vacante_ia.idiomas && vacante_ia.idiomas.length > 0) {\n    80→                let ids_idiomas = vacante_ia.idiomas.map(function(item) {\n    81→                    let idioma = idiomas.find(function(idioma) {\n    82→                        return idioma.nombre === item.idioma;\n    83→                    });\n    84→                    return idioma.id;\n    85→                });\n    86→\n    87→                $('#idiomas_seleccionados').val(ids_idiomas);\n    88→                $('#idiomas_seleccionados').multiselect(\"refresh\");\n    89→                $('#idiomas_seleccionados').trigger('change');\n    90→\n    91→                $.each(ids_idiomas, function(index, id_idioma) {\n    92→                    $(`#nivel_idioma_${id_idioma}`).val(vacante_ia.idiomas[index].nivel).trigger('change.select2');\n    93→                });\n    94→            }\n    95→            let modalidad_trabajo = modalidades_trabajos.find(item => item.nombre.toLowerCase() === vacante_ia.modalidad_trabajo.toLowerCase());\n    96→            if (modalidad_trabajo) {\n    97→                $(`#modalidad_trabajo_id_${modalidad_trabajo.id}`).prop('checked', true).trigger('change');\n    98→            }\n    99→            $('#funciones').val(vacante_ia.funciones || '').trigger('input');\n   100→            $('#modal-generando-ia').modal('hide');\n   101→            mostrarToast('success', 'Información generada exitosamente');\n   102→        }, error: function(error) {\n   103→            $('#modal-generando-ia').modal('hide');\n   104→            mostrarToast('danger', 'Ocurrió un error al generar la vacante, respuesta de la IA: ' + error.responseJSON.errors);\n   105→        }\n   106→    });\n   107→}\n   108→/**\n   109→ * Generar preguntas de prefiltro con IA.\n   110→ *\n   111→ * @returns {void}\n   112→ * @author José Manuel Jiménez\n   113→ * @author Daniel Beltrán\n   114→ * @author Andres Morales\n   115→ */\n   116→function generarPreguntasPrefiltroIA() {\n   117→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   118→    let habilidades = $('#habilidades').val() || [];\n   119→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   120→    let experiencia_laboral = $('#experiencia_laboral').val();\n   121→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   122→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   123→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   124→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   125→        $('#modal-generando-ia').modal('show');\n   126→        let url_ia = '/generar-preguntas-prefiltro';\n   127→        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n   128→        if (modal_movimiento_id_seleccionado == 10) {\n   129→            url_ia = '/generar-preguntas-videoentrevista';\n   130→            tipo_preguntas = ['abierta'];\n   131→        }\n   132→        $.ajax({\n   133→            type: 'POST',\n   134→            url : url_ia,\n   135→            data: {\n   136→                _token: $('input[name=\"_token\"]').val(),\n   137→                vacante_id: vacante_id,\n   138→                nombre_vacante: nombre_vacante,\n   139→                habilidades: habilidades,\n   140→                herramientas_tecnologicas: herramientas_tecnologicas,\n   141→                experiencia_laboral: experiencia_laboral,\n   142→                nivel_educativo: nivel_educativo,\n   143→                numero_preguntas: 5,\n   144→                tipo_preguntas: tipo_preguntas\n   145→            },\n   146→            success: function(respuesta) {\n   147→                $(`#contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`).html('');\n   148→\n   149→                if (modal_movimiento_id_seleccionado == 4) {\n   150→                    contador_preguntas_prefiltro = 0;\n   151→                } else if (modal_movimiento_id_seleccionado == 10) {\n   152→                    contador_preguntas_video_entrevista = 0;\n   153→                }\n   154→                contador_respuestas = 0;\n   155→\n   156→                // Contar cuántas preguntas abiertas se generarán\n   157→                var limite_preguntas_abiertas = 2;\n   158→                var contador_preguntas_abiertas_generadas = 0;\n   159→\n   160→                respuesta.data.preguntas.forEach((pregunta) => {\n   161→                    // Validar límite de preguntas abiertas para prefiltro\n   162→                    if (modal_movimiento_id_seleccionado == 4 && pregunta.tipo === 'abierta') {\n   163→                        contador_preguntas_abiertas_generadas++;\n   164→                        if (contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n   165→                            return; // Saltar esta pregunta si excede el límite\n   166→                        }\n   167→                    }\n   168→                    preguntas_generadas.push(pregunta.texto);\n   169→\n   170→                    let contador_actual = modal_movimiento_id_seleccionado == 4\n   171→                        ? contador_preguntas_prefiltro\n   172→                        : contador_preguntas_video_entrevista;\n   173→\n   174→                    if (pregunta.tipo === 'abierta') {\n   175→                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   176→\n   177→                        contador_actual = modal_movimiento_id_seleccionado == 4\n   178→                            ? contador_preguntas_prefiltro\n   179→                            : contador_preguntas_video_entrevista;\n   180→\n   181→                        $(`#pregunta_abierta_${contador_actual}`).val(pregunta.texto);\n   182→                        if (pregunta.tiempo_segundos) {\n   183→                            $(`#tiempo_respuesta_${contador_actual}`).val(pregunta.tiempo_segundos / 60);\n   184→                        }\n   185→                    } else {\n   186→                        if (pregunta.tipo === 'seleccion_unica') {\n   187→                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   188→                        } else {\n   189→                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   190→                        }\n   191→\n   192→                        contador_actual = modal_movimiento_id_seleccionado == 4\n   193→                            ? contador_preguntas_prefiltro\n   194→                            : contador_preguntas_video_entrevista;\n   195→\n   196→                        $(`#pregunta_seleccion_unica_${contador_actual}`).val(pregunta.texto);\n   197→                        pregunta.opciones.forEach((opcion) => {\n   198→                            let checked = false;\n   199→                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n   200→                                checked = true;\n   201→                            }\n   202→                            if (pregunta.tipo === 'seleccion_unica') {\n   203→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'única', checked);\n   204→                            } else {\n   205→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'múltiple', checked);\n   206→                            }\n   207→                            $(`#contenedor-respuestas-${contador_actual} #respuesta_${contador_respuestas}`).val(opcion);\n   208→                        });\n   209→                    }\n   210→                });\n   211→\n   212→                $('#modal-generando-ia').modal('hide');\n   213→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   214→\n   215→                // Mostrar alerta si se omitieron preguntas abiertas por el límite\n   216→                if (modal_movimiento_id_seleccionado == 4 && contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n   217→                    var preguntas_omitidas = contador_preguntas_abiertas_generadas - limite_preguntas_abiertas;\n   218→                    mostrarToast('info', `Se generaron solo ${limite_preguntas_abiertas} preguntas abiertas debido al límite establecido. ${preguntas_omitidas} pregunta(s) abierta(s) fueron omitidas.`);\n   219→                }\n   220→            }, error: function(error) {\n   221→                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n   222→                $('#modal-generando-ia').modal('hide');\n   223→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   224→            }\n   225→        });\n   226→    } else {\n   227→        if (nombre_vacante.length < 5) {\n   228→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   229→        } else if (habilidades.length == 0) {\n   230→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   231→        } else if (herramientas_tecnologicas.length == 0) {\n   232→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   233→        } else if (!experiencia_laboral) {\n   234→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   235→        } else if (!nivel_educativo) {\n   236→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   237→        }\n   238→    }\n   239→    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n   240→}\n   241→\n   242→/**\n   243→ * Generar una pregunta de prefiltro con IA.\n   244→ *\n   245→ * @param {number} contador_pregunta Número de la pregunta a generar\n   246→ * @param {string|null} tipo_pregunta Tipo de pregunta a generar (opcional).\n   247→ * @returns {void}\n   248→ * @author José Manuel Jiménez\n   249→ * @author Daniel Beltrán\n   250→ * @author Andres Morales\n   251→ */\n   252→function generarUnaPreguntaPrefiltroIA(contador_pregunta, tipo_pregunta = null) {\n   253→    if (!mostro_modal_creditos_ia) {\n   254→        funcion_ejecucion_ia = () => generarUnaPreguntaPrefiltroIA(contador_pregunta, tipo_pregunta);\n   255→        let servicio_ia_id = 3; // Generar preguntas prefiltro con IA\n   256→        if (modal_movimiento_id_seleccionado == 10) {\n   257→            servicio_ia_id = 4; // Generar preguntas video entrevista con IA\n   258→        }\n   259→        mostrarModalCreditosIA(servicio_ia_id);\n   260→        return;\n   261→    }\n   262→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   263→    let habilidades = $('#habilidades').val() || [];\n   264→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   265→    let experiencia_laboral = $('#experiencia_laboral').val();\n   266→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   267→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   268→\n   269→    // Validar límite de preguntas abiertas antes de generar con IA\n   270→    if (modal_movimiento_id_seleccionado == 4 && tipo_pregunta === 'abierta') {\n   271→        var limite_preguntas_abiertas = 2;\n   272→        var cantidad_abiertas_actuales = contarPreguntasAbiertas();\n   273→\n   274→        if (contador_pregunta) {\n   275→            var pregunta_actual = $(`#pregunta-${contador_pregunta}`);\n   276→            var es_abierta_actualmente = pregunta_actual.find('.tipo-pregunta').val() === 'abierta';\n   277→\n   278→            if (es_abierta_actualmente) {\n   279→                cantidad_abiertas_actuales--;\n   280→            }\n   281→        }\n   282→\n   283→        if (cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n   284→            mostrarAlertaLimitePreguntasAbiertas();\n   285→            return;\n   286→        }\n   287→    }\n   288→\n   289→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   290→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   291→        $('#modal-generando-ia').modal('show');\n   292→        let url_ia = '/generar-preguntas-prefiltro';\n   293→        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n   294→        if (modal_movimiento_id_seleccionado == 10) {\n   295→            url_ia = '/generar-preguntas-videoentrevista';\n   296→            tipo_preguntas = ['abierta'];\n   297→        }\n   298→        if (tipo_pregunta) {\n   299→            tipo_preguntas = [tipo_pregunta];\n   300→        }\n   301→\n   302→        let datos = {\n   303→            _token                   : $('input[name=\"_token\"]').val(),\n   304→            vacante_id               : vacante_id,\n   305→            nombre_vacante           : nombre_vacante,\n   306→            habilidades              : habilidades,\n   307→            herramientas_tecnologicas: herramientas_tecnologicas,\n   308→            experiencia_laboral      : experiencia_laboral,\n   309→            nivel_educativo          : nivel_educativo,\n   310→            numero_preguntas         : 1,\n   311→            tipo_preguntas           : tipo_preguntas\n   312→        };\n   313→\n   314→        if (preguntas_generadas.length > 0) {\n   315→            datos.preguntas_existentes = JSON.stringify(preguntas_generadas);\n   316→        }\n   317→\n   318→        $.ajax({\n   319→            type: 'POST',\n   320→            url : url_ia,\n   321→            data: datos,\n   322→            success: function(respuesta) {\n   323→                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n   324→                    return;\n   325→                }\n   326→                $(`#pregunta-${contador_pregunta}`).empty();\n   327→\n   328→                respuesta.data.preguntas.forEach((pregunta) => {\n   329→                    preguntas_generadas.push(pregunta.texto);\n   330→\n   331→                    if (pregunta.tipo === 'abierta') {\n   332→                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   333→                        $(`#pregunta_abierta_${contador_pregunta}`).val(pregunta.texto);\n   334→                        if (pregunta.tiempo_segundos) {\n   335→                            $(`#tiempo_respuesta_${contador_pregunta}`).val(pregunta.tiempo_segundos / 60);\n   336→                        }\n   337→                    } else {\n   338→                        if (pregunta.tipo === 'seleccion_unica') {\n   339→                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   340→                        } else {\n   341→                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   342→                        }\n   343→                        $(`#pregunta_seleccion_unica_${contador_pregunta}`).val(pregunta.texto);\n   344→                        pregunta.opciones.forEach((opcion) => {\n   345→                            let checked = false;\n   346→                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n   347→                                checked = true;\n   348→                            }\n   349→                            if (pregunta.tipo === 'seleccion_unica') {\n   350→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'única', checked);\n   351→                            } else {\n   352→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'múltiple', checked);\n   353→                            }\n   354→                            $(`#contenedor-respuestas-${contador_pregunta} #respuesta_${contador_respuestas}`).val(opcion);\n   355→                        });\n   356→                    }\n   357→                });\n   358→                $('#modal-generando-ia').modal('hide');\n   359→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   360→            }, error: function(error) {\n   361→                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n   362→                $('#modal-generando-ia').modal('hide');\n   363→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   364→            }\n   365→        });\n   366→    } else {\n   367→        if (nombre_vacante.length < 5) {\n   368→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   369→        } else if (habilidades.length == 0) {\n   370→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   371→        } else if (herramientas_tecnologicas.length == 0) {\n   372→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   373→        } else if (!experiencia_laboral) {\n   374→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   375→        } else if (!nivel_educativo) {\n   376→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   377→        }\n   378→    }\n   379→    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n   380→}\n   381→\n   382→/**\n   383→ * Generar pruebas psicométricas con IA.\n   384→ *\n   385→ * @returns {void}\n   386→ * @author José Manuel Jiménez\n   387→ * @author Andres Morales\n   388→ */\n   389→function generarPruebasPsicometricasIA() {\n   390→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   391→    let habilidades = $('#habilidades').val() || [];\n   392→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   393→    let experiencia_laboral = $('#experiencia_laboral').val();\n   394→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   395→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   396→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   397→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   398→        $('#modal-generando-ia').modal('show');\n   399→        $.ajax({\n   400→            type: 'POST',\n   401→            url : '/generar-pruebas-psicometricas',\n   402→            data: {\n   403→                _token: $('input[name=\"_token\"]').val(),\n   404→                vacante_id: vacante_id,\n   405→                nombre_vacante: nombre_vacante,\n   406→                habilidades: habilidades,\n   407→                herramientas_tecnologicas: herramientas_tecnologicas,\n   408→                experiencia_laboral: experiencia_laboral,\n   409→                nivel_educativo: nivel_educativo\n   410→            },\n   411→            success: function(respuesta) {\n   412→                $('#modal-generando-ia').modal('hide');\n   413→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   414→                // Limpiar selección previa\n   415→                $('.prueba-checkbox').prop('checked', false).trigger('change');\n   416→\n   417→                let pruebas_generadas = respuesta.data.pruebas || [];\n   418→\n   419→                // Helpers para seleccionar perfil cuando el select se llene\n   420→                const esperarYSeleccionarPerfil = (selector, valor, intentos = 10) => {\n   421→                    if (!valor || intentos <= 0) return;\n   422→                    const $select = $(selector);\n   423→                    if ($select.length === 0) return;\n   424→                    if ($select.find(`option[value=\"${valor}\"]`).length > 0) {\n   425→                        $select.val(valor).trigger('change.select2');\n   426→                        return;\n   427→                    }\n   428→                    setTimeout(() => esperarYSeleccionarPerfil(selector, valor, intentos - 1), 300);\n   429→                };\n   430→                const esperarYSeleccionarPerfilPorTexto = (selector, texto, intentos = 10) => {\n   431→                    if (!texto || intentos <= 0) return;\n   432→                    const $select = $(selector);\n   433→                    if ($select.length === 0) return;\n   434→                    const opcion = $select.find('option').filter(function() {\n   435→                        return ($(this).text() || '').trim().toLowerCase() === texto.trim().toLowerCase();\n   436→                    }).first();\n   437→                    if (opcion.length) {\n   438→                        const valor = opcion.val();\n   439→                        if (valor) {\n   440→                            $select.val(valor).trigger('change.select2');\n   441→                            return;\n   442→                        }\n   443→                    }\n   444→                    setTimeout(() => esperarYSeleccionarPerfilPorTexto(selector, texto, intentos - 1), 300);\n   445→                };\n   446→\n   447→                pruebas_generadas.forEach((prueba_generada) => {\n   448→                    // Buscar la prueba en el catálogo cargado en el modal por nombre\n   449→                    let prueba_catalogo = (pruebas_empresa_vacantes || []).find(p =>\n   450→                        (p.nombre || '').trim().toLowerCase() === (prueba_generada.nombre || '').trim().toLowerCase()\n   451→                    );\n   452→\n   453→                    if (!prueba_catalogo) {\n   454→                        return;\n   455→                    }\n   456→\n   457→                    // Marcar checkbox de la prueba encontrada\n   458→                    $(`.prueba-checkbox[value=\"${prueba_catalogo.id}\"]`).prop('checked', true).trigger('change');\n   459→\n   460→                    // Intentar resolver el perfil por nombre\n   461→                    const perfil_nombre_objetivo = (prueba_generada.perfil || '').trim();\n   462→                    let perfil_id = null;\n   463→                    if (perfil_nombre_objetivo) {\n   464→                        let perfil_catalogo = (prueba_catalogo.perfiles || []).find(perfil =>\n   465→                            (perfil.nombre || '').trim().toLowerCase() === perfil_nombre_objetivo.toLowerCase()\n   466→                        );\n   467→                        if (perfil_catalogo) {\n   468→                            perfil_id = perfil_catalogo.id;\n   469→                        }\n   470→                    }\n   471→\n   472→                    // Completar select y porcentaje\n   473→                    setTimeout(() => {\n   474→                        if (prueba_generada.porcentaje) {\n   475→                            $(`input[name=\"porcentaje_prueba_${prueba_catalogo.id}\"]`).val(prueba_generada.porcentaje).trigger('keyup');\n   476→                        }\n   477→                        const selectorPerfil = `select[name=\"perfil_id_${prueba_catalogo.id}\"]`;\n   478→                        // esperar a que cargarPerfilesPrueba (llamado al marcar) termine de poblar opciones\n   479→                        if (perfil_id) {\n   480→                            esperarYSeleccionarPerfil(selectorPerfil, perfil_id);\n   481→                        } else if (perfil_nombre_objetivo) {\n   482→                            esperarYSeleccionarPerfilPorTexto(selectorPerfil, perfil_nombre_objetivo);\n   483→                        }\n   484→                    }, 500);\n   485→                });\n   486→            }, error: function(error) {\n   487→                mostrarToast('danger', 'Ocurrió un error al generar las pruebas psicométricas, respuesta de la IA: ' + error.responseJSON.errors);\n   488→                $('#modal-generando-ia').modal('hide');\n   489→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   490→            }\n   491→        });\n   492→    } else {\n   493→        if (nombre_vacante.length < 5) {\n   494→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   495→        } else if (habilidades.length == 0) {\n   496→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   497→        } else if (herramientas_tecnologicas.length == 0) {\n   498→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   499→        } else if (!experiencia_laboral) {\n   500→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   501→        } else if (!nivel_educativo) {\n   502→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   503→        }\n   504→    }\n   505→}\n   506→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ba981f0f-d18e-45c9-8c6f-88905cfd5900","timestamp":"2026-01-29T16:21:09.145Z","sourceToolAssistantUUID":"8d4842f6-5ac1-4980-bb82-3a8603f31ce3"}
{"parentUuid":"e1c3e336-417b-4333-8eb6-a9e6ff0dac1f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VZ8Cn4n3jCxEcomizAWHbs","type":"tool_result","content":"","is_error":false}]},"uuid":"80b0671c-bdbe-465a-b696-26e4ea8bc8ef","timestamp":"2026-01-29T16:21:09.174Z","sourceToolAssistantUUID":"e1c3e336-417b-4333-8eb6-a9e6ff0dac1f"}
{"parentUuid":"5b1cd6da-bbe0-4073-8c0b-312d6a29d47f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018vVBTpCuYXLmLHywX4j2z9","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js/globales.js","is_error":false}]},"uuid":"d1dcce5d-3e23-43f9-9e8e-32f58af3256c","timestamp":"2026-01-29T16:21:09.187Z","sourceToolAssistantUUID":"5b1cd6da-bbe0-4073-8c0b-312d6a29d47f"}
{"parentUuid":"d1dcce5d-3e23-43f9-9e8e-32f58af3256c","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_016v4jB2kJw7f5fygJvt4Tcw","toolUseID":"toolu_016v4jB2kJw7f5fygJvt4Tcw","timestamp":"2026-01-29T16:21:09.147Z","uuid":"be7221fe-3c48-4fcc-b869-2cab7c892d41"}
{"parentUuid":"be7221fe-3c48-4fcc-b869-2cab7c892d41","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017gw1Ldmjw5h6RWC7ozbBtc","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, encontré que la lógica está en globales.js. Voy a leer ese archivo:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":9744,"cache_read_input_tokens":29893,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9744},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyXH5Ehm76Pgi6wHMpz","type":"assistant","uuid":"569f44ff-5a65-49ab-860a-dfe519120448","timestamp":"2026-01-29T16:21:11.648Z"}
{"parentUuid":"569f44ff-5a65-49ab-860a-dfe519120448","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_017gw1Ldmjw5h6RWC7ozbBtc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LUNFd5VYVsTfuscd5Y8qjG","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\globales.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":9744,"cache_read_input_tokens":29893,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9744},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyXH5Ehm76Pgi6wHMpz","type":"assistant","uuid":"88c064e5-9f84-45a6-9a57-0005d82c57ac","timestamp":"2026-01-29T16:21:11.888Z"}
{"parentUuid":"88c064e5-9f84-45a6-9a57-0005d82c57ac","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LUNFd5VYVsTfuscd5Y8qjG","type":"tool_result","content":"     1→// Mensajes en español para el plugin Select2\n     2→const mensajes_select2 = {\n     3→    'noResults'              : () => { return 'No hay resultados para la búsqueda.'; },\n     4→    'searching'              : () => { return 'Buscando...'; },\n     5→    'Loading'                : () => { return 'Cargando...'; },\n     6→    'loadingMore'            : () => { return 'Cargando más resultados...'; },\n     7→    'dropdownFooter'         : (texto) => { return `Mostrando ${texto} resultados`; },\n     8→    'emptyOptions'           : () => { return 'No hay opciones disponibles.'; },\n     9→    'appendItems'            : (items) => { return `Agregando ${items.length} elementos.`; },\n    10→    'maximumSelectionReached': () => { return 'Se ha alcanzado el número máximo de selecciones.'; },\n    11→    'selectOnClose'          : () => { return 'Seleccione una opción al cerrar el menú.'; },\n    12→    'escapeKeyUp'            : () => { return 'Presione \\'Escape\\' para cerrar el menú.'; },\n    13→    'errorLoading'           : () => { return 'Error al cargar datos. Inténtalo de nuevo más tarde.'; },\n    14→    'inputTooShort'          : (elemento) => { return `Ingresa al menos ${elemento.minimum} caracteres para iniciar una búsqueda.`; },\n    15→    'noMatches'              : () => { return 'No se encontraron coincidencias para tu búsqueda.'; },\n    16→    'allowClear'             : () => { return 'Borrar selección'; },\n    17→    'SelectionTooLong'       : (conteo, maximo) => { return `Solo puedes seleccionar ${maximo} opciones.`; },\n    18→    'loadMore'               : () => { return 'Cargando más resultados...'; },\n    19→    'removing'               : (seleccion) => { return 'Eliminando...'; },\n    20→    'matches'                : (coincidencias, total) => {\n    21→        if (coincidencias === 0) {\n    22→            return 'No hay coincidencias.';\n    23→        } else if (coincidencias === 1) {\n    24→            return 'Se encontró 1 coincidencia.';\n    25→        } else {\n    26→            return `Se encontraron ${coincidencias} coincidencias entre ${total}.`;\n    27→        }\n    28→    }\n    29→};\n    30→\n    31→// audios\n    32→var audio_notificacion = new Audio('/audios/notificacion.mp3');\n    33→\n    34→let mostro_modal_creditos_ia = false;\n    35→let funcion_ejecucion_ia = null;\n    36→let modals_abiertos_ia = null;\n    37→\n    38→let funcionalidades_disponibles_empresa = [];\n    39→\n    40→// Umbrales para mostrar el modal de advertencia de créditos (en porcentaje)\n    41→const UMBRALES_ADVERTENCIA_CREDITOS = [20, 10, 5, 0];\n    42→\n    43→/**\n    44→ * Mostrar modal de créditos IA\n    45→ *\n    46→ * @return void\n    47→ * @author José Manuel Jiménez\n    48→ */\n    49→function mostrarModalCreditosIA(servicio_ia_id) {\n    50→    $.ajax({\n    51→        url: `/empresas/${$('#empresa_sesion_id').val()}/creditos`,\n    52→        method: 'GET',\n    53→        dataType: 'json',\n    54→        success: function(respuesta_empresa) {\n    55→            if (respuesta_empresa?.data?.creditos_disponibles > 0) {\n    56→                $.ajax({\n    57→                    url: `/servicios-ia/${servicio_ia_id}/creditos`,\n    58→                    method: 'GET',\n    59→                    dataType: 'json',\n    60→                    success: function(respuesta) {\n    61→                        if (respuesta?.data?.consume_creditos && respuesta?.data?.consume_creditos <= respuesta_empresa.data.creditos_disponibles) {\n    62→                            $('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);\n    63→                            $('#modal-consumo-creditos-ia').modal('show');\n    64→                            mostro_modal_creditos_ia = true;\n    65→                            modals_abiertos_ia = $('.modal.show').not('#modal-consumo-creditos-ia').not('#modal-generando-ia');\n    66→                            $(modals_abiertos_ia).addClass('d-none');\n    67→                        } else {\n    68→                            mostrarToastSolicitarCreditosIA();\n    69→                        }\n    70→                    }\n    71→                });\n    72→            } else {\n    73→                mostrarToastSolicitarCreditosIA();\n    74→            }\n    75→        }\n    76→    });\n    77→}\n    78→\n    79→/**\n    80→ * Mostrar toast para solicitar créditos IA\n    81→ *\n    82→ * @return void\n    83→ * @author José Manuel Jiménez\n    84→ */\n    85→function mostrarToastSolicitarCreditosIA() {\n    86→    $.ajax({\n    87→        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n    88→        method: 'GET',\n    89→        dataType: 'json',\n    90→        success: function(respuesta) {\n    91→            let adicional_toast = '';\n    92→            if (respuesta?.data?.ejecutivo?.telefono) {\n    93→                adicional_toast = `<a href=\"https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.\" target=\"_blank\">\n    94→                    <p class=\"text-label-1 text-white no-visited text-decoration-none mb-0\">Solicitar</p>\n    95→                </a>`;\n    96→            }\n    97→            setTimeout(() => {\n    98→                $('#modal-generando-ia').modal('hide');\n    99→                $('#modal-cargue-ia').modal('hide');\n   100→                mostrarToast('danger', 'No cuentas con créditos. Solicita créditos adicionales.', '', adicional_toast);\n   101→            }, 300);\n   102→        }\n   103→    });\n   104→}\n   105→\n   106→/**\n   107→ * Continuar ejecución IA luego del modal de créditos\n   108→ *\n   109→ * @return void\n   110→ * @author José Manuel Jiménez\n   111→ */\n   112→function continuarEjecucionIA() {\n   113→    if (funcion_ejecucion_ia) {\n   114→        funcion_ejecucion_ia();\n   115→        funcion_ejecucion_ia = null;\n   116→    }\n   117→    mostro_modal_creditos_ia = false;\n   118→    $('#modal-consumo-creditos-ia').modal('hide');\n   119→}\n   120→\n   121→/**\n   122→ * Solicitar más créditos IA\n   123→ *\n   124→ * @return void\n   125→ * @author José Manuel Jiménez\n   126→ */\n   127→function solicitarMasCreditosIA() {\n   128→    $.ajax({\n   129→        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n   130→        method: 'GET',\n   131→        dataType: 'json',\n   132→        success: function(respuesta) {\n   133→            if (respuesta?.data?.ejecutivo?.telefono) {\n   134→                window.open(`https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.`, '_blank');\n   135→            } else {\n   136→                mostrarToast('danger', 'No se encontró un ejecutivo asignado a la empresa. Por favor, comunícate con soporte para recargar créditos.');\n   137→            }\n   138→            $('#modal-solicitar-mas-creditos-ia').modal('hide');\n   139→        }\n   140→    });\n   141→}\n   142→\n   143→/**\n   144→ * Validar respuesta de créditos IA\n   145→ *\n   146→ * @return void\n   147→ * @author José Manuel Jiménez\n   148→ */\n   149→function validarRespuestaCreditosIA(error_ia) {\n   150→    if (error_ia == 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.') {\n   151→        mostrarToastSolicitarCreditosIA();\n   152→        return true;\n   153→    }\n   154→    return false;\n   155→}\n   156→\n   157→/**\n   158→ * Ajustar el ancho de los elementos select2 asincrono multiple.\n   159→ *\n   160→ * @returns {void}\n   161→ * @author Andres Morales\n   162→ */\n   163→$(document).ready(function () {\n   164→    cargarNotificiacionesHeader();\n   165→    if (window.configuracion_reverbg && window.configuracion_reverbg.activar_websocket) {\n   166→        configurarWebSocketNotificaciones();\n   167→    }\n   168→    setTimeout(() => {\n   169→        $(\".input-container\").each(function () {\n   170→            let $container = $(this);\n   171→            let $select = $container.find(\"select[multiple]\");\n   172→            let $icon = $container.find(\".input-icono1\");\n   173→            if ($select.length && $icon.length) {\n   174→                $(this).find('.select2-selection--multiple').addClass('ps-5')\n   175→            }\n   176→        });\n   177→    }, 1000);\n   178→    $('#modal-consumo-creditos-ia').on('hidden.bs.modal', function () {\n   179→        if (mostro_modal_creditos_ia) {\n   180→            $(modals_abiertos_ia).removeClass('d-none');\n   181→        }\n   182→        mostro_modal_creditos_ia = false;\n   183→    });\n   184→\n   185→    // Cargar créditos disponibles si existe el contenedor y el ID de empresa\n   186→    if ($('#contenedor-tag-creditos').length && $('#empresa_sesion_id').length) {\n   187→        // Verificar si estamos en la ruta /procesos para mostrar el modal de advertencia\n   188→        let verificar_modal = window.location.pathname === '/procesos';\n   189→        obtenerCreditosDisponiblesEmpresa($('#empresa_sesion_id').val(), 'contenedor-tag-creditos', verificar_modal);\n   190→    }\n   191→});\n   192→\n   193→/**\n   194→ * Convertir fecha de formato YYYY-MM-DD a DD-MM-YYYY.\n   195→ *\n   196→ * @param {string} fecha Fecha en formato ISO (YYYY-MM-DD).\n   197→ * @returns {string} Fecha convertida a formato DD-MM-YYYY.\n   198→ * @author Andres Morales\n   199→ * @author Sergio Vargas\n   200→ */\n   201→const convertirFecha = fecha => {\n   202→    if (!fecha) return '';\n   203→    fecha = String(fecha).substring(0, 10);\n   204→    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : 'Formato incorrecto';\n   205→};\n   206→\n   207→/**\n   208→ * Formatear fecha a formato dd/mm/yyyy - hh:mm AM/PM.  Ejemplo: 01/Feb/2022 - 12:00 PM\n   209→ *\n   210→ * @param {string} fecha_entrada fecha en formato ISO\n   211→ * @returns {string} fecha y hora formateada\n   212→ * @author Andres Morales\n   213→ */\n   214→function formatearFecha(fecha_entrada) {\n   215→    var fecha = new Date(fecha_entrada);\n   216→    var dia = fecha.getDate();\n   217→    var mes = fecha.toLocaleString('es-ES', { month: 'short' });\n   218→    var anio = fecha.getFullYear();\n   219→    let hora = fecha.getHours();\n   220→    let minuto = fecha.getMinutes();\n   221→    let ampm = hora >= 12 ? 'PM' : 'AM';\n   222→    hora = hora % 12 || 12;\n   223→    minuto = minuto.toString().padStart(2, '0');\n   224→    return `${dia}/${mes}/${anio} - ${hora}:${minuto} ${ampm}`;\n   225→}\n   226→\n   227→function formatearFecha2(fecha_entrada) {\n   228→    let partes = fecha_entrada.split(' ');\n   229→    let fecha = partes[0].split('-');\n   230→    let hora = partes[1];\n   231→    let fechaISO = `${fecha[2]}-${fecha[1]}-${fecha[0]}T${hora}`;\n   232→\n   233→    let date = new Date(fechaISO);\n   234→\n   235→    if (isNaN(date.getTime())) {\n   236→        return 'Fecha inválida';\n   237→    }\n   238→\n   239→    let dia = date.getDate();\n   240→    let mes = date.toLocaleString('eu-EU', { month: 'short' });\n   241→    let anio = date.getFullYear();\n   242→    return `${dia}/${mes}/${anio}`;\n   243→}\n   244→\n   245→/**\n   246→ * Opción para contraer o agrandar el menú principal\n   247→ *\n   248→ * @returns {void}\n   249→ * @author José Manuel Jiménez\n   250→ * @author Andres Morales\n   251→ */\n   252→function contraerMenu() {\n   253→    if ($('.sidebar-menu').hasClass('close')) {\n   254→        $('.sidebar-menu').removeClass('d-none');\n   255→        localStorage.setItem('opcion_menu_storage', 'abierto');\n   256→        $('#btn-collapse').attr('data-bs-original-title', 'Contraer');\n   257→        $('#btn-collapse').attr('data-bs-title', 'Contraer');\n   258→        $(\".menu-bar\").each(function() {\n   259→            $(this).removeClass(\"px-2\").addClass(\"px-5\");\n   260→        });\n   261→        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n   262→        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n   263→            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n   264→            if (tooltip_instancia) {\n   265→                tooltip_instancia.dispose();\n   266→            }\n   267→        });\n   268→    } else {\n   269→        $('.sidebar-menu').addClass('d-none');\n   270→        localStorage.setItem('opcion_menu_storage', 'cerrado');\n   271→        $('#btn-collapse').attr('data-bs-original-title', 'Expandir');\n   272→        $('#btn-collapse').attr('data-bs-title', 'Expandir');\n   273→        $(\".menu-bar\").each(function() {\n   274→            $(this).removeClass(\"px-5\").addClass(\"px-2\");\n   275→        });\n   276→        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n   277→    }\n   278→    $('.tooltip.bs-tooltip-auto').remove();\n   279→    $('.sidebar-menu').toggleClass('close');\n   280→    $('.contenedor-vista').toggleClass('close');\n   281→    $('#btn-collapse').toggleClass('close');\n   282→    $('.nombre-usuario-empresa').toggle();\n   283→    $('.menu-bar .text-menu').toggle();\n   284→}\n   285→\n   286→/**\n   287→ * Opción para abrir o cerrar el menu segun la elección guardada\n   288→ *\n   289→ * @returns {void}\n   290→ * @author José Manuel Jiménez\n   291→ * @author Andres Morales\n   292→ */\n   293→function mostrarMenuStorage() {\n   294→    $(document).ready(function() {\n   295→        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n   296→            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n   297→            if (tooltip_instancia) {\n   298→                tooltip_instancia.dispose();\n   299→            }\n   300→        });\n   301→\n   302→        if (window.innerWidth < 768) {\n   303→            localStorage.setItem('opcion_menu_storage', 'cerrado');\n   304→        }\n   305→\n   306→        if (localStorage.getItem('opcion_menu_storage') === 'cerrado') {\n   307→            contraerMenu();\n   308→        }\n   309→        let $active = $('.menu-bar .active');\n   310→\n   311→        if ($active.length) {\n   312→            $('.menu-bar').scrollTop($active.position().top);\n   313→        }\n   314→    });\n   315→}\n   316→mostrarMenuStorage();\n   317→\n   318→/**\n   319→ * Funcion para hacer el slug de un texto desde jquery.\n   320→ *\n   321→ * @returns {void}\n   322→ * @author Andres Morales\n   323→ */\n   324→function slugify(text) {\n   325→    return $.trim(text)\n   326→        .toLowerCase()\n   327→        .normalize(\"NFD\")\n   328→        .replace(/[\\u0300-\\u036f]/g, \"\")\n   329→        .replace(/[^a-z0-9 -]/g, \"\")\n   330→        .replace(/\\s+/g, \"-\")\n   331→        .replace(/-+/g, \"-\");\n   332→}\n   333→\n   334→/**\n   335→ * Función generica para mostrar mensajes de respuesta\n   336→ *\n   337→ * @param {string} tipo_alerta define el color de la alerta segun alerts de botstrap.\n   338→ * @param {string} texto_1 Texto que mostrara la alerta.\n   339→ * @param {string} texto_2 Texto secundario en la alerta.\n   340→ * @param {string} accion Acción adicional(por definir).\n   341→ * @returns {void}\n   342→ * @author José Manuel Jiménez\n   343→ * @author Andres Gonzalez\n   344→ */\n   345→function mostrarToast(tipo_alerta, texto_1, texto_2 = '', accion = '', icono2 = '') {\n   346→    let icono = '';\n   347→    let texto_color = 'text-white';\n   348→    if (accion != '') {\n   349→        accion = `<div class=\"col-auto p-0 text-label-1\">${accion}</div>`;\n   350→    }\n   351→\n   352→    if (tipo_alerta == 'success') {\n   353→        icono = 'bi bi-check-circle';\n   354→    }\n   355→\n   356→    if (tipo_alerta == 'neutral') {\n   357→        icono = 'bi bi-info-circle';\n   358→    }\n   359→\n   360→    if (tipo_alerta == 'warning') {\n   361→        icono = 'bi bi-info-circle';\n   362→        texto_color = \"text-red-letras\";\n   363→    }\n   364→\n   365→    if (tipo_alerta == 'danger') {\n   366→        icono = 'bi bi-x-circle';\n   367→    }\n   368→\n   369→    if (icono2 != '') {\n   370→        icono = icono2;\n   371→    }\n   372→\n   373→    if (texto_2 != '') {\n   374→        texto_2 = `<div class=\"col-12 p-0 text-label-1 ${texto_color}\">${texto_2}</div>`;\n   375→    }\n   376→\n   377→    let alert_toast = $(`\n   378→        <div class=\"alert toast-${tipo_alerta} alert-dismissible fade show d-flex align-items-center pe-3 py-3 me-3\" role=\"alert\" style=\"display:none\">\n   379→            <div class=\"col-auto\">\n   380→                <span class=\"${icono} ${texto_color}\"></span>\n   381→            </div>\n   382→            <div class=\"col px-3\">\n   383→                <div class=\"row m-0 ${texto_color}\">\n   384→                    <div class=\"col-12 p-0 text-label-1 ${texto_color}\">\n   385→                        ${texto_1}\n   386→                    </div>\n   387→                    ${texto_2}\n   388→                </div>\n   389→            </div>\n   390→            ${accion}\n   391→            <div class=\"col-auto ms-3 pointer\" data-bs-dismiss=\"alert\">\n   392→                <span class=\"bi bi-x ${texto_color}\"></span>\n   393→            </div>\n   394→        </div>\n   395→    `);\n   396→    $('#contenedor-alert-toast').append(alert_toast);\n   397→    alert_toast.fadeIn();\n   398→    setTimeout(function() {\n   399→        alert_toast.fadeOut();\n   400→        alert_toast.alert('close');\n   401→    }, 5000);\n   402→}\n   403→\n   404→/**\n   405→ * Formatear número.\n   406→ *\n   407→ * @param {number} numero número a formatear\n   408→ * @author Andres Morales\n   409→ */\n   410→function formatearNumero(numero) {\n   411→    return parseInt(numero).toLocaleString('es-ES');\n   412→}\n   413→\n   414→/**\n   415→ * Formatear fecha.\n   416→ *\n   417→ * @param {*} fecha Fecha a formatear.\n   418→ * @param {boolean} incluir_segundos Indica si se debe incluir los segundos en la hora.\n   419→ * @param {string} formato Formato en el que se retornará la fecha.\n   420→ * @param {string} separador Símbolo que se usará para separar días, meses y años.\n   421→ * @returns {Object} Objeto con la fecha y hora formateada.\n   422→ * @author Daniel Beltrán\n   423→ */\n   424→function formatearFechaConceptual(fecha, incluir_segundos = false, formato = 'Ymd', separador = '-') {\n   425→    const NUEVA_FECHA = new Date(fecha);\n   426→    const ANO         = NUEVA_FECHA.getFullYear();\n   427→    const MES         = String(NUEVA_FECHA.getMonth() + 1).padStart(2, '0');\n   428→    const DIA         = String(NUEVA_FECHA.getDate()).padStart(2, '0');\n   429→    const HORAS       = String(NUEVA_FECHA.getHours()).padStart(2, '0');\n   430→    const MINUTOS     = String(NUEVA_FECHA.getMinutes()).padStart(2, '0');\n   431→    const SEGUNDOS    = String(NUEVA_FECHA.getSeconds()).padStart(2, '0');\n   432→\n   433→    let fecha_formateada = `${ANO}${separador}${MES}${separador}${DIA}`;\n   434→\n   435→    if (formato === 'dmY') {\n   436→        fecha_formateada = `${DIA}${separador}${MES}${separador}${ANO}`;\n   437→    }\n   438→\n   439→    return {\n   440→        fecha: fecha_formateada,\n   441→        hora : incluir_segundos ? `${HORAS}:${MINUTOS}:${SEGUNDOS}` : `${HORAS}:${MINUTOS}`\n   442→    };\n   443→}\n   444→\n   445→/**\n   446→ * Formatear fecha a May. 2023.\n   447→ *\n   448→ * @param {string} fechaISO Fecha a formatear.\n   449→ * @returns {string} Objeto con la fecha y hora formateada.\n   450→ * @author Andres Morales\n   451→ */\n   452→function formatearFechaAnioMes(fechaISO) {\n   453→    const fecha = new Date(fechaISO);\n   454→    const opciones = { month: 'short', year: 'numeric' };\n   455→    let fecha_formateada = fecha.toLocaleDateString('es-ES', opciones);\n   456→\n   457→    fecha_formateada = fecha_formateada.replace(\n   458→        /^([a-zñ]+)(\\s\\d{4})$/,\n   459→        (_, mes, anio) => `${mes.charAt(0).toUpperCase() + mes.slice(1)}. ${anio.trim()}`\n   460→    );\n   461→\n   462→    return fecha_formateada;\n   463→}\n   464→\n   465→/**\n   466→ * Formatear un numero a moneda.\n   467→ *\n   468→ * @param {string} valor Numero.\n   469→ * @returns {string} Numero formateado.\n   470→ * @author Andres Morales\n   471→ */\n   472→function formatearMonedaCOP(valor) {\n   473→    return new Intl.NumberFormat('es-CO', {\n   474→        style: 'currency',\n   475→        currency: 'COP',\n   476→        minimumFractionDigits: 0,\n   477→        maximumFractionDigits: 0\n   478→    }).format(valor);\n   479→}\n   480→\n   481→/**\n   482→ * Formatear fecha a un formato d/m/Y hh:mm:ss entendible para el usuario.\n   483→ *\n   484→ * @param {*} fecha_inicial Fecha a formatear.\n   485→ * @returns {String} String con la fecha y hora formateada.\n   486→ * @author José Manuel Jiménez\n   487→ */\n   488→function fechaMostrar(fecha_inicial) {\n   489→    if (!fecha_inicial) {\n   490→        return \"\";\n   491→    }\n   492→    const fecha = new Date(fecha_inicial);\n   493→    if (isNaN(fecha.getTime())) {\n   494→        return \"\";\n   495→    }\n   496→    const dia = String(fecha.getUTCDate()).padStart(2, '0');\n   497→    const mes = String(fecha.getUTCMonth() + 1).padStart(2, '0');\n   498→    const anio = fecha.getUTCFullYear();\n   499→    // Verificar si el string incluye información de hora (espacio, T, o dos puntos)\n   500→    if (!fecha_inicial.includes(\" \") && !fecha_inicial.includes(\"T\") && !fecha_inicial.includes(\":\")) {\n   501→        return `${dia}/${mes}/${anio}`;\n   502→    }\n   503→    const horas = String(fecha.getUTCHours()).padStart(2, '0');\n   504→    const minutos = String(fecha.getUTCMinutes()).padStart(2, '0');\n   505→    const segundos = String(fecha.getUTCSeconds()).padStart(2, '0');\n   506→    return `${dia}/${mes}/${anio} ${horas}:${minutos}:${segundos}`;\n   507→}\n   508→\n   509→/**\n   510→ * Descargar Excel.\n   511→ *\n   512→ * @param {string} ruta Ruta desde donde se descarga el archivo.\n   513→ * @param {string} nombre_archivo Nombre del archivo descargado.\n   514→ * @param {boolean} marca_tiempo Indica si el nombre del archivo debe llevar marca de tiempo.\n   515→ * @param {Object} parametros Parámetros a enviar en la petición.\n   516→ * @returns {void}\n   517→ * @author Daniel Beltrán\n   518→ */\n   519→async function descargarExcel(ruta, nombre_archivo, marca_tiempo = true, parametros = {}) {\n   520→    parametros._token = $('meta[name=\"csrf-token\"]').attr('content');\n   521→\n   522→    await $.ajax({\n   523→        type     : 'POST',\n   524→        url      : `/${ruta}`,\n   525→        data     : parametros,\n   526→        xhrFields: {\n   527→            responseType: 'blob'\n   528→        },\n   529→        success: function (respuesta) {\n   530→            // Crear una URL para el Blob\n   531→            let url = window.URL.createObjectURL(respuesta); // 'respuesta' es el Blob\n   532→            let a   = document.createElement('a'); // Crea un nuevo elemento <a> para iniciar la descarga\n   533→            a.href  = url;\n   534→            const fecha_actual     = new Date();\n   535→            const dia              = fecha_actual.getDate();\n   536→            const mes              = fecha_actual.getMonth() + 1;\n   537→            const ano              = fecha_actual.getFullYear();\n   538→            const hora             = fecha_actual.getHours();\n   539→            const minutos          = fecha_actual.getMinutes();\n   540→            const segundos         = fecha_actual.getSeconds();\n   541→            const fecha_formateada = `${dia}${mes}${ano}${hora}${minutos}${segundos}`;\n   542→\n   543→            a.download = marca_tiempo ? `${nombre_archivo}-${fecha_formateada}.xlsx` : `${nombre_archivo}.xlsx`;\n   544→            document.body.appendChild(a);\n   545→            a.click();\n   546→            window.URL.revokeObjectURL(url);\n   547→            document.body.removeChild(a);\n   548→        }\n   549→    }).then(() => {\n   550→        mostrarToast('success', 'Archivo descargado correctamente.');\n   551→    }).catch((error) => {\n   552→        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n   553→    });\n   554→}\n   555→\n   556→/**\n   557→ * Convierte un string a slug.\n   558→ *\n   559→ * @param {string} str\n   560→ * @returns {string}\n   561→ * @author Fahibram Cárcamo\n   562→ */\n   563→function slug(str) {\n   564→\n   565→    // Quita espacios en blanco\n   566→    str = str.replace(/^\\s+|\\s+$/g, \"\")\n   567→\n   568→    // Convierte el string a minusculas\n   569→    str = str.toLowerCase()\n   570→\n   571→    // Quita los caracteres no alfanuméricos\n   572→    str = str.replace(/[^a-z0-9 -]/g, \"\")\n   573→\n   574→    // Reemplaza los espacio con guiones\n   575→    str = str.replace(/\\s+/g, \"-\")\n   576→\n   577→    // Remueve los guiones consecutivos\n   578→    str = str.replace(/-+/g, \"-\")\n   579→\n   580→    return str\n   581→}\n   582→\n   583→/**\n   584→ * Compara los elementos de dos arreglos y retorna `true` si son iguales y `false` en caso contrario\n   585→ * (Este función está pensada para comparar arreglos unidimensionales).\n   586→ *\n   587→ * @param {array} primer_arreglo\n   588→ * @param {array} segundo_arreglo\n   589→ * @param {boolean} comparar_orden\n   590→ * @return {boolean}\n   591→ * @author Fahibram Cárcamo\n   592→ */\n   593→function sonArreglosIguales(primer_arreglo, segundo_arreglo, comparar_orden = false) {\n   594→\n   595→    if (!comparar_orden) {\n   596→        primer_arreglo.sort()\n   597→        segundo_arreglo.sort()\n   598→    }\n   599→\n   600→    if (primer_arreglo.length !== segundo_arreglo.length) return false\n   601→\n   602→    for (let i = 0; i < primer_arreglo.length; i++) {\n   603→        if (primer_arreglo[i] !== segundo_arreglo[i]) return false\n   604→    }\n   605→\n   606→    return true\n   607→}\n   608→\n   609→/**\n   610→ * Función para cambiar de empresa.\n   611→ *\n   612→ * @param {number} empresa_id ID de la empresa a la que se va a cambiar.\n   613→ * @returns {void}\n   614→ * @author José Manuel Jiménez\n   615→ * @author Daniel Beltrán\n   616→ */\n   617→function cambiarEmpresa(empresa_id) {\n   618→    $.ajax({\n   619→        type: 'POST',\n   620→        url: '/suplantar-rol-admin-general',\n   621→        data: {\n   622→            _token    : $('meta[name=\"csrf-token\"]').attr('content'),\n   623→            empresa_id: empresa_id\n   624→        },\n   625→        success: function (respuesta) {\n   626→            localStorage.setItem('notificacionToast', JSON.stringify({\n   627→                tipo_alerta: 'success',\n   628→                texto_1    : 'Cambio de empresa exitoso'\n   629→            }));\n   630→\n   631→            window.location.reload();\n   632→        },\n   633→        error: function (error) {\n   634→            mostrarToast('danger', 'Ocurrió un error al cambiar de empresa');\n   635→        }\n   636→    });\n   637→}\n   638→\n   639→/**\n   640→ * Enviar la solucitud de suplantación de rol y empresa al Back-end.\n   641→ *\n   642→ * @param {function|null} callback_exito Callback ejecutado en caso de éxito.\n   643→ * @param {string} url URL de suplantación.\n   644→ * @param {string} _token Token CSRF del formulario.\n   645→ * @param {number} empresa_id Id de la empresa a suplantar.\n   646→ * @param {number|null} rol_id Id del rol a suplantar.\n   647→ * @param {function|null} callback_error Callback ejecutado en caso de error.\n   648→ * @returns {void}\n   649→ * @author Fahibram Cárcamo\n   650→ */\n   651→async function enviarOrdenSuplantacionRolEmpresa (callback_exito, url, _token, empresa_id = null, rol_id = null, callback_error = null) {\n   652→\n   653→    let condicion_suplantacion = rol_id === null\n   654→        ? empresa_id === null\n   655→            ? true\n   656→            : parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id)\n   657→        : parseInt($('#rol_sesion_id').val()) !== parseInt(rol_id) && parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id);\n   658→\n   659→    if (condicion_suplantacion) {\n   660→        let data = { _token };\n   661→        if (empresa_id !== null) data.empresa_id = empresa_id;\n   662→        if (rol_id !== null) data.rol_id = rol_id;\n   663→\n   664→        await $.ajax({ type: 'POST', url, data })\n   665→            .then((respuesta, status, xhr) => {\n   666→                if (xhr.status >= 200 && xhr.status < 300 && callback_exito !== null) callback_exito();\n   667→            })\n   668→            .catch(error => {\n   669→                let swal_titulo, swal_texto;\n   670→\n   671→                if (error.status === 404) {\n   672→                    if (error.responseJSON.mensaje) {\n   673→                        swal_titulo = 'Algo salió mal';\n   674→                        if (error.responseJSON.mensaje === 'no existe rol_suplantar') {\n   675→                            swal_texto = 'El rol no existe.';\n   676→                        } else if (error.responseJSON.mensaje === 'no existe empresa_suplantar') {\n   677→                            swal_texto = 'La empresa no existe.';\n   678→                        } else if (error.responseJSON.mensaje === 'no existe usuario_suplantar') {\n   679→                            swal_texto = 'El usuario no existe.';\n   680→                        } else {\n   681→                            swal_texto = '';\n   682→                        }\n   683→                    } else if (error.responseJSON.empresa && error.responseJSON.rol) {\n   684→                        swal_titulo = 'No fué posible cambiar de empresa';\n   685→                        swal_texto = error.responseJSON.rol === 'Administrador general' || error.responseJSON.rol === 'Propietario'\n   686→                            ? `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol Administrador general o Propietario.`\n   687→                            : `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol ${error.responseJSON.rol}.`;\n   688→                    } else {\n   689→                        swal_titulo = 'Algo salió mal';\n   690→                        swal_texto = error.responseJSON.errors;\n   691→                    }\n   692→                } else {\n   693→                    swal_titulo = 'Algo salió mal';\n   694→                    swal_texto = '';\n   695→                }\n   696→\n   697→                if (callback_error !== null) callback_error();\n   698→\n   699→                Swal.fire({\n   700→                    title: swal_titulo,\n   701→                    text: swal_texto,\n   702→                    icon: \"error\",\n   703→                    confirmButtonText: \"Aceptar\"\n   704→                });\n   705→            });\n   706→    }\n   707→}\n   708→\n   709→/**\n   710→ * Mostrar tooltip según el div que lo contenga.\n   711→ *\n   712→ * @param {div} div Elemento en donde se va a mostrar el tooltip.\n   713→ * @returns {void}\n   714→ * @author Sol Espitia\n   715→ */\n   716→function mostrarTooltip(div) {\n   717→    const TOOLTIP         = div.querySelector('.tooltip-x');\n   718→    TOOLTIP.style.display = 'block';\n   719→}\n   720→\n   721→/**\n   722→ * Ocultar tooltip según el div que lo contenga.\n   723→ *\n   724→ * @param {div} div Elemento en donde se va a mostrar el tooltip.\n   725→ * @returns {void}\n   726→ * @author Sol Espitia\n   727→ */\n   728→function ocultarTooltip(div) {\n   729→    const TOOLTIP         = div.querySelector('.tooltip-x');\n   730→    TOOLTIP.style.display = 'none';\n   731→}\n   732→\n   733→/**\n   734→ * Retornar la diferencia en días de dos fechas dadas.\n   735→ *\n   736→ * @param {string} fecha_inicial Fecha inicial\n   737→ * @param {string} fecha_final Fecha final\n   738→ * @param {bool} valor_absoluto Retorna la diferencia en valor absoluto\n   739→ * @returns {number}\n   740→ * @author Fahibram Cárcamo\n   741→ * @author Andres Morales\n   742→ */\n   743→function diferenciaFechasDias(fecha_inicial, fecha_final, valor_absoluto = false, sumar_dia = true) {\n   744→    let fecha1 = new Date(fecha_inicial);\n   745→    let fecha2 = new Date(fecha_final);\n   746→\n   747→    fecha1.setHours(0, 0, 0, 0);\n   748→    fecha2.setHours(0, 0, 0, 0);\n   749→\n   750→    let diferencia_milisegundos = fecha2.getTime() - fecha1.getTime();\n   751→\n   752→    let diferencia_dias = diferencia_milisegundos / (1000 * 60 * 60 * 24);\n   753→    let resultado = diferencia_dias;\n   754→    if (sumar_dia) {\n   755→        resultado = diferencia_dias + 1;\n   756→    }\n   757→\n   758→    return valor_absoluto ? Math.abs(resultado) : resultado;\n   759→}\n   760→\n   761→/**\n   762→ * Retornar `true` si una fecha dada está dentro de un rango de fechas dadas, `false` en otro caso.\n   763→ *\n   764→ * @param {string} fecha Fecha dada\n   765→ * @param {string} fecha_desde Fecha inicial del rango\n   766→ * @param {string} fecha_hasta Fecha final del rango\n   767→ * @returns {boolean}\n   768→ * @author Fahibram Cárcamo\n   769→ */\n   770→function fechaDentroDelRango(fecha, fecha_desde, fecha_hasta) {\n   771→    fecha = new Date(fecha);\n   772→    fecha_desde = new Date(fecha_desde);\n   773→    fecha_hasta = new Date(fecha_hasta);\n   774→\n   775→    if (isNaN(fecha) || isNaN(fecha_desde) || isNaN(fecha_hasta)) {\n   776→        throw new Error('Una o más fechas no son válidas.');\n   777→    }\n   778→\n   779→    return fecha >= fecha_desde && fecha <= fecha_hasta;\n   780→}\n   781→\n   782→/**\n   783→ * Descuenta el tiempo para las respuestas.\n   784→ *\n   785→ * @param id - ID del elemento HTML donde mostrar el tiempo\n   786→ * @param tiempo - Tiempo inicial en segundos\n   787→ * @author Jair Carvajal\n   788→ */\n   789→var tiempos_usados = {};\n   790→\n   791→function descuentoTiempo(id, tiempo, callback, onTick) {\n   792→    var $elemento = $('#' + id);\n   793→    if ($elemento.length === 0) {\n   794→        console.error('Elemento con id \"' + id + '\" no encontrado.');\n   795→        return;\n   796→    }\n   797→    if (tiempos_usados[id]) {\n   798→        clearInterval(tiempos_usados[id]);\n   799→    }\n   800→    let tiempoTotal = tiempo;\n   801→    tiempos_usados[id] = setInterval(function() {\n   802→        if (tiempo <= 0) {\n   803→            clearInterval(tiempos_usados[id]);\n   804→            delete tiempos_usados[id];\n   805→            $elemento.text('Tiempo finalizado');\n   806→            if (window.tiempoFinalizado()) {\n   807→                tiempoFinalizado();\n   808→            }\n   809→            if (typeof callback === 'function') {\n   810→                callback();\n   811→            }\n   812→            return;\n   813→        }\n   814→\n   815→        var minutos = Math.floor(tiempo / 60);\n   816→        var segundos = tiempo % 60;\n   817→\n   818→        var textoTiempo = minutos + ':' + (segundos < 10 ? '0' : '') + segundos + '<i class=\"bi bi-alarm ms-2\"></i>';\n   819→\n   820→        if (tiempo <= 15) {\n   821→            $elemento.addClass('text-state-red');\n   822→            $elemento.removeClass('text-state-green');\n   823→        } else {\n   824→            $elemento.addClass('text-state-green');\n   825→            $elemento.removeClass('text-state-red');\n   826→        }\n   827→\n   828→        $elemento.html(textoTiempo);\n   829→\n   830→        var tiempoUsado = tiempoTotal - tiempo;\n   831→\n   832→        if (typeof onTick === 'function') {\n   833→            onTick((tiempoUsado % 5));\n   834→        }\n   835→        tiempo--;\n   836→    }, 1000);\n   837→}\n   838→\n   839→/**\n   840→ * Detengo el tiempo para las respuestas.\n   841→ *\n   842→ * @param id - ID del elemento HTML donde mostrar el tiempo\n   843→ * @param tiempo - Tiempo inicial en segundos\n   844→ * @author Jair Carvajal\n   845→ */\n   846→function detenerDescuentoTiempo(id) {\n   847→    if (tiempos_usados[id]) {\n   848→        clearInterval(tiempos_usados[id]);\n   849→        delete tiempos_usados[id];\n   850→    }\n   851→}\n   852→\n   853→/**\n   854→ * Genera un SVG de la imagen de usuario.\n   855→ *\n   856→ * @param id ID del usuario.\n   857→ * @param nombres Nombres del usuario.\n   858→ * @param apellidos Apellidos del usuario.\n   859→ * @return image\n   860→ * @author Andres Morales\n   861→ */\n   862→function crearImagenUsuarioLetras(id, nombres, apellidos) {\n   863→    var tamano = 200;\n   864→    var iniciales = (nombres[0] + apellidos[0]).toUpperCase();\n   865→    var hash = md5(id);\n   866→\n   867→    var r = parseInt(hash.substring(0, 2), 16);\n   868→    var g = parseInt(hash.substring(2, 4), 16);\n   869→    var b = parseInt(hash.substring(4, 6), 16);\n   870→    var colorFondo = `rgb(${r},${g},${b})`;\n   871→\n   872→    var luminancia = 0.299 * r + 0.587 * g + 0.114 * b;\n   873→    var colorTexto = luminancia > 150 ? \"#000000\" : \"#FFFFFF\";\n   874→\n   875→    // SVG como texto\n   876→    var svg = `\n   877→    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${tamano}\" height=\"${tamano}\">\n   878→        <rect width=\"100%\" height=\"100%\" fill=\"${colorFondo}\" />\n   879→        <text x=\"50%\" y=\"50%\" dy=\".35em\"\n   880→            text-anchor=\"middle\"\n   881→            font-family=\"Lato, sans-serif\"\n   882→            font-size=\"${tamano * 0.4}\"\n   883→            fill=\"${colorTexto}\">\n   884→            ${iniciales}\n   885→        </text>\n   886→    </svg>`;\n   887→    var svgEncoded = encodeURIComponent(svg)\n   888→        .replace(/'/g, \"%27\")\n   889→        .replace(/\"/g, \"%22\");\n   890→\n   891→    var dataUri = `data:image/svg+xml,${svgEncoded}`;\n   892→    return dataUri;\n   893→}\n   894→\n   895→/**\n   896→ * Carga las notificaciones\n   897→ *\n   898→ * @return void\n   899→ * @author Andres Morales\n   900→ * @author Andres Gonzalez\n   901→ * @author Esperanza Olivo\n   902→ * @author Jair Carvajal\n   903→ */\n   904→function cargarNotificiacionesHeader() {\n   905→    $.ajax({\n   906→        url: '/usuario-notificaciones',\n   907→        type: 'GET',\n   908→        dataType: 'json',\n   909→        success: function(respuesta) {\n   910→            let datos = respuesta.data;\n   911→            let notificaciones_noleidas = datos?.unread_notifications?.length ?? 0;\n   912→\n   913→            // Siempre remover el badge existente\n   914→            $('#dropdownNotificaciones #badge-notificaciones').remove();\n   915→\n   916→            // Solo agregar el badge si hay notificaciones no leídas\n   917→            if (notificaciones_noleidas > 0) {\n   918→                $('#dropdownNotificaciones').append(`<span id=\"badge-notificaciones\" class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-state-red border border-white\">${notificaciones_noleidas}</span>`);\n   919→                $('#contador-notificaciones-abierto').append(`<span id=\"badge-notificaciones\" class=\"badge rounded-pill bg-state-red border border-white\">${notificaciones_noleidas}</span>`);\n   920→\n   921→                $('#contenedor-boton-marcar-todas').html(`\n   922→                    <button class=\"btn btn-link text-primary w-100 d-flex justify-content-center\" onclick=\"marcarNotificacionesLeidas('all')\">\n   923→                        Marcar todo como leído\n   924→                    </button>\n   925→                `);\n   926→            }\n   927→\n   928→            const NO_LEIDOS_IDS = new Set(Array.isArray(datos?.unread_notifications) ? datos.unread_notifications.map(notificacion => notificacion.id) : []);\n   929→\n   930→            if (Array.isArray(datos?.notifications) && datos.notifications.length > 0) {\n   931→                $('#notificacion-sinnotificaciones').hide();\n   932→                $('.notificaciones-listado').remove();\n   933→                datos.notifications.forEach(notificacion => {\n   934→                    const { id, data, updated_at } = notificacion;\n   935→\n   936→                    const NO_LEIDO = NO_LEIDOS_IDS.has(id);\n   937→                    const MENSAJE = (data?.mensaje || '').slice(0, 120) + '...';\n   938→                    const HORA = new Date(updated_at).toLocaleTimeString('es-CO', {\n   939→                        hour: '2-digit',\n   940→                        minute: '2-digit',\n   941→                        hour12: false\n   942→                    });\n   943→\n   944→                    const notificaciones = `\n   945→                        <li class=\"${NO_LEIDO ? '' : 'bg-gray-90'} notificaciones-listado py-0\" id=\"notificacion-${id}\">\n   946→                            <a class=\"dropdown-item text-gray-10 text-decoration-none border-top pt-0 pb-1\" href=\"javascript:void(0)\" onclick=\"marcarNotificacionesLeidas('${id}','${data?.ruta}')\">\n   947→                                <div class=\"d-flex justify-content-between\">\n   948→                                    <div class=\"w-auto flex-grow-1 pe-3\">\n   949→                                        <p class=\"mt-1 mb-0 text-headline-6 text-gray-10\">${data?.titulo}</p>\n   950→                                        <p class=\"mb-0 text-body-3 text-gray-30 notificacion-mensaje\">${MENSAJE}</p>\n   951→                                    </div>\n   952→                                    <div class=\"w-auto my-auto ${NO_LEIDO ? 'text-cta-azul' : 'text-gray-10'} text-label-2 flex-shrink-0\">\n   953→                                        ${HORA}${NO_LEIDO ? `<i class=\"bi bi-circle-fill text-cta-azul my-auto texto-notificacion-icono ms-3\"></i>` : ''}\n   954→                                    </div>\n   955→                                </div>\n   956→                            </a>\n   957→                        </li>\n   958→                    `;\n   959→\n   960→                    $(notificaciones).insertBefore('#contenedor-boton-marcar-todas');\n   961→                });\n   962→\n   963→            } else {\n   964→                $('#notificacion-sinnotificaciones').hide();\n   965→                $('.notificaciones-listado').remove();\n   966→            }\n   967→\n   968→        },\n   969→        error: function(xhr, status, error) {\n   970→            console.error('Error al cargar notificaciones:', error);\n   971→        }\n   972→    });\n   973→}\n   974→\n   975→/**\n   976→ * Marcar las notificaciones leídas.\n   977→ *\n   978→ * @param {array} notificaciones_ids ids de las notificaciones\n   979→ * @param {string} ruta_destino ruta donde se va ha actualizar la pagina\n   980→ * @returns {void}\n   981→ * @author Andres Gonzalez\n   982→ * @author Esperanza Olivo\n   983→ */\n   984→function marcarNotificacionesLeidas(notificaciones_ids = null, ruta_destino = null, soporte_id = null) {\n   985→\n   986→    let data = {\n   987→        _token: $('meta[name=\"csrf-token\"]').attr('content')\n   988→    };\n   989→\n   990→    if (notificaciones_ids === 'all') {\n   991→        data.marcar_todo = true;\n   992→    } else if (soporte_id) {\n   993→        data.soporte_id = soporte_id;\n   994→    } else if (notificaciones_ids) {\n   995→        data.notificaciones_ids = Array.isArray(notificaciones_ids)\n   996→            ? notificaciones_ids\n   997→            : [notificaciones_ids];\n   998→    }\n   999→\n  1000→    $.ajax({\n  1001→        url: '/usuario-marcar-notificaciones-leidas',\n  1002→        type: 'POST',\n  1003→        data: data,\n  1004→        success: function(respuesta) {\n  1005→            cargarNotificiacionesHeader();\n  1006→\n  1007→            if (notificaciones_ids && notificaciones_ids !== 'all' && ruta_destino) {\n  1008→                window.location.href = \"/\" + ruta_destino;\n  1009→            }\n  1010→\n  1011→            if (notificaciones_ids === 'all') {\n  1012→                $('#badge-notificaciones').remove();\n  1013→                $('#contenedor-boton-marcar-todas').empty();\n  1014→                $('.notificaciones-listado').addClass('bg-gray-90');\n  1015→                $('.bi-circle-fill').remove();\n  1016→            }\n  1017→        },\n  1018→        error: function(xhr, estatus, error) {\n  1019→            console.error('Error al cargar notificaciones:', error);\n  1020→        }\n  1021→    });\n  1022→}\n  1023→\n  1024→/**\n  1025→ * Configurar WebSocket para notificaciones en tiempo real\n  1026→ *\n  1027→ * @return void\n  1028→ * @author Andres Gonzalez\n  1029→ */\n  1030→function configurarWebSocketNotificaciones() {\n  1031→    try {\n  1032→        if (!window.configuracion_reverbg) {\n  1033→            return;\n  1034→        }\n  1035→\n  1036→        const PUSHER = new Pusher(window.configuracion_reverbg.appKey, {\n  1037→            wsHost: window.configuracion_reverbg.host,\n  1038→            wsPort: window.configuracion_reverbg.port,\n  1039→            wssPort: window.configuracion_reverbg.port,\n  1040→            cluster: 'mt1',\n  1041→            forceTLS: false,\n  1042→            enabledTransports: ['ws', 'wss'],\n  1043→            authEndpoint: '/broadcasting-auth',\n  1044→            auth: {\n  1045→                headers: {\n  1046→                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n  1047→                }\n  1048→            }\n  1049→        });\n  1050→\n  1051→        PUSHER.connection.bind('failed', function() {\n  1052→            console.error('❌ Conexión WebSocket falló');\n  1053→        });\n  1054→\n  1055→        PUSHER.connection.bind('error', function(error) {\n  1056→            console.error('❌ Error de WebSocket:', error);\n  1057→        });\n  1058→\n  1059→        let usuario_id = window.configuracion_reverbg.usuario_id;\n  1060→\n  1061→        if (!usuario_id) {\n  1062→            return;\n  1063→        }\n  1064→\n  1065→        const NOMBRE_CANAL = `private-App.Models.Usuarios.User.${usuario_id}`;\n  1066→        const CANAL = PUSHER.subscribe(NOMBRE_CANAL);\n  1067→\n  1068→        CANAL.bind('pusher:subscription_error', function(error) {\n  1069→            console.error('❌ Error al suscribirse al canal:', error);\n  1070→        });\n  1071→\n  1072→        // Escuchar eventos específicos de notificaciones\n  1073→        CANAL.bind('Illuminate\\\\Notifications\\\\Events\\\\BroadcastNotificationCreated', function(data) {\n  1074→            if (data.tipo === 'nueva_notificacion') {\n  1075→                audio_notificacion.play();\n  1076→                cargarNotificiacionesHeader();\n  1077→            }\n  1078→\n  1079→            if (data.tipo === 'nuevo_mensaje') {\n  1080→                if (($('#soporte-guardado-id').val() == data.soporte_id) || ($('#soporte_empresa_id').val() == data.soporte_id)) {\n  1081→                    audio_notificacion.play();\n  1082→                    consultarChat(data.soporte_id);\n  1083→                }\n  1084→            }\n  1085→        });\n  1086→    } catch (error) {\n  1087→        console.error('💥 Error en configurarWebSocketNotificaciones:', error);\n  1088→        console.error('Stack trace:', error.stack);\n  1089→    }\n  1090→}\n  1091→\n  1092→/**\n  1093→ * Retornar el string entrante en formato title case.\n  1094→ *\n  1095→ * @param {string} texto\n  1096→ * @returns {string}\n  1097→ * @author Fahibram Cárcamo\n  1098→ */\n  1099→function titleCase(texto) {\n  1100→    return texto.toLowerCase().replace(/\\b\\w/g, caracter => caracter.toUpperCase());\n  1101→}\n  1102→\n  1103→/**\n  1104→ * Número de horas que durará el almacenamiento de la variable `ulitmas_empresas` en el\n  1105→ * almacenamiento local **LocalStorage**.\n  1106→ *\n  1107→ * @var {number}\n  1108→ * @author Fahibram Cárcamo\n  1109→ */\n  1110→const CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE = 6;\n  1111→\n  1112→/**\n  1113→ * Validar si ya debe removerse la variable `ultimas_empresas` del alamacenamiento local\n  1114→ * **LocalStorage**, si no es tiempo de eliminarla entonces se reinicia el tiempo de vigencia de la\n  1115→ * variable.\n  1116→ *\n  1117→ * @returns {void}\n  1118→ * @author Fahibram Cárcamo\n  1119→ */\n  1120→function validarYActualizarUltimasEmpresasLocalStorage() {\n  1121→    let fecha_hora_actuales = moment();\n  1122→    let fecha_hora_vencimiento_ultimas_empresas = fecha_hora_actuales.clone().add(CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE, 'hours');\n  1123→    let fecha_hora_vencimiento_ultimas_empresas_localstorage = localStorage.getItem('vencimiento_ultimas_empresas');\n  1124→    let ultimas_empresas = localStorage.getItem('ultimas_empresas');\n  1125→\n  1126→    if (\n  1127→        ultimas_empresas != null &&\n  1128→        fecha_hora_vencimiento_ultimas_empresas_localstorage != null &&\n  1129→        fecha_hora_actuales.clone().isBefore(moment(fecha_hora_vencimiento_ultimas_empresas_localstorage).clone())\n  1130→    ) {\n  1131→        localStorage.setItem('vencimiento_ultimas_empresas', fecha_hora_vencimiento_ultimas_empresas.format('YYYY-MM-DD HH:mm:ss'));\n  1132→        return;\n  1133→    }\n  1134→\n  1135→    localStorage.removeItem('vencimiento_ultimas_empresas');\n  1136→    localStorage.removeItem('ultimas_empresas');\n  1137→}\n  1138→\n  1139→/**\n  1140→ * Obtener la edad actual de un usuario según su fecha de nacimiento.\n  1141→ *\n  1142→ * @param {string} fecha_nacimiento\n  1143→ * @returns {string}\n  1144→ * @author José Manuel Jiménez\n  1145→ * @author Fahibram Cárcamo\n  1146→ * @author Andres Morales\n  1147→ */\n  1148→function obtenerEdad(fecha_nacimiento) {\n  1149→    if (!fecha_nacimiento) return \"N/A\";\n  1150→    let hoy = new Date();\n  1151→    let nacimiento = new Date(fecha_nacimiento);\n  1152→    let edad = hoy.getFullYear() - nacimiento.getFullYear();\n  1153→    let mes = hoy.getMonth() - nacimiento.getMonth();\n  1154→    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) edad--;\n  1155→    return edad + \" años\";\n  1156→}\n  1157→\n  1158→/**\n  1159→ * Restablecer un input de tipo file.\n  1160→ *\n  1161→ * @param {html} elemento_input_html Elemento input html.\n  1162→ * @param {html} label_elemento_input_html Label del elemento input html.\n  1163→ * @param {html} boton_eliminar_elemento_input_html Botón para eliminar archivo del elemento input html.\n  1164→ * @author Fahibram Cárcamo\n  1165→ */\n  1166→function reiniciarCampoArchivo(elemento_input_html, label_elemento_input_html, boton_eliminar_elemento_input_html) {\n  1167→    elemento_input_html.val('');\n  1168→    elemento_input_html.removeAttr('data-base64');\n  1169→    label_elemento_input_html.text('Ningún archivo seleccionado');\n  1170→    boton_eliminar_elemento_input_html.hide();\n  1171→\n  1172→    if (elemento_input_html.data('imagen')) {\n  1173→        $('#' + elemento_input_html.data('imagen')).val('');\n  1174→        $('#' + elemento_input_html.data('imagen') + '_previsualizacion').attr('src', '');\n  1175→        $('#' + elemento_input_html.data('imagen') + '_fondo_previsualizacion').removeClass('d-none');\n  1176→    }\n  1177→}\n  1178→\n  1179→/**\n  1180→ * Definir un campo destinado a recibir un número de teléfono celular.\n  1181→ *\n  1182→ * Esta función debe llamarse en el evento ready del objeto global document:\n  1183→ * `$(document).ready(...)`. Ademas debe incluirse un pequeño fragmento de código en la función\n  1184→ * `validacionAdicional` para que se agregué el código del número de celular al valor de campo\n  1185→ * cuando se envíe el formulario donde se encutra el campo.\n  1186→ *\n  1187→ * ```\n  1188→ * if (\n  1189→ *   $('#input_celular_id').length &&\n  1190→ *   $('#input_celular_id').val() !== '' &&\n  1191→ *   input_celular.getNumber() !== ''\n  1192→ * ) {\n  1193→ *   $('#input_celular_id').val(input_celular.getNumber().slice(1));\n  1194→ * }\n  1195→ * ```\n  1196→ *\n  1197→ * Donde `input_celular` es el objeto retornado por esta función.\n  1198→ *\n  1199→ * @param {string} input_celular_id Id del campo.\n  1200→ * @param {string} nombre_input_celular Nombre del campo.\n  1201→ * @param {string} placeholder_input_celular Placeholder del campo.\n  1202→ * @param {boolean} obligatorio El campo es obligatorio en el formulario.\n  1203→ * @returns {object}\n  1204→ * @author Fahibram Cárcamo\n  1205→ */\n  1206→function definirInputTipoCelular(input_celular_id, nombre_input_celular, placeholder_input_celular, obligatorio = true) {\n  1207→    /**\n  1208→     * 🌎 Campo para ingresar un número de telefono con selectór de código de país con banderas.\n  1209→     * Este componente se creó con la librería International Telephone Input\n  1210→     * (https://intl-tel-input.com).\n  1211→     *\n  1212→     * La linea hiddenInput: () => ({ phone: 'celular_contacto' }) tiene como función establecer el\n  1213→     * nombre del campo, es decir, la llave del par llave-valor que se adjuntará en los datos del\n  1214→     * formulario cuando se envíe, en este caso 'celular_contacto'.\n  1215→     *\n  1216→     * Las lienas autoPlaceholder: 'aggressive' y\n  1217→     * customPlaceholder: (placeholder, country) => 'Celular*' se usan para definir el placeholder\n  1218→     * del campo.\n  1219→     *\n  1220→     * Con $('#celular_contacto').attr('required', true); se establece el campo como requerido\n  1221→     * dentro del formulario, se hace de esta forma porque la librería no admite el atributo\n  1222→     * required directamente en el componente html.\n  1223→     *\n  1224→     * @author Fahibram Cárcamo\n  1225→     */\n  1226→    if (document.querySelector(`#${input_celular_id}`)) {\n  1227→        const dropdown_dinamico = document.createElement('div');\n  1228→        document.body.appendChild(dropdown_dinamico);\n  1229→\n  1230→        let campo_celular = window.intlTelInput(document.querySelector(`#${input_celular_id}`), {\n  1231→            nationalMode: true,\n  1232→            initialCountry: 'co',\n  1233→            separateDialCode: true,\n  1234→            autoInsertDialCode: false,\n  1235→            autoPlaceholder: 'aggressive',\n  1236→            dropdownContainer: dropdown_dinamico,\n  1237→            customPlaceholder: (placeholder, country) => placeholder_input_celular,\n  1238→            loadUtils: () => import('https://cdn.jsdelivr.net/npm/intl-tel-input@25.4.2/build/js/utils.js'),\n  1239→            onlyCountries: [\n  1240→                'CO', // Colombia\n  1241→                'EC', // Ecuador\n  1242→                'AR', // Argentina\n  1243→                'CL', // Chile\n  1244→                'VE', // Venezuela\n  1245→                'PE', // Perú\n  1246→                'BO', // Bolivia\n  1247→                'UY', // Uruguay\n  1248→                'PY', // Paraguay\n  1249→                'PA', // Panamá\n  1250→                'MX', // México\n  1251→                'CR', // Costa Rica\n  1252→                // 'PR', // Puerto Rico\n  1253→                'CU', // Cuba\n  1254→                // 'DO', // República Dominicana\n  1255→                'SV', // El Salvador\n  1256→                'GT', // Guatemala\n  1257→                'HN', // Honduras\n  1258→                'NI', // Nicaragua\n  1259→                'ES', // España\n  1260→                'US', // Estados Unidos\n  1261→                'GQ'  // Guinea Ecuatorial\n  1262→            ]\n  1263→        });\n  1264→\n  1265→        if (obligatorio) $(`#${input_celular_id}`).attr('required', true);\n  1266→\n  1267→        return campo_celular;\n  1268→    }\n  1269→\n  1270→    return null;\n  1271→}\n  1272→\n  1273→/**\n  1274→ * Establece la validación adicional que se aplica a un campo de tipo celular antes de enviar sus\n  1275→ * datos en un formulario.\n  1276→ *\n  1277→ * @param {HTMLInputElement} input Elemento HTML del campo de tipo celular.\n  1278→ * @param {string} input_id Id del elemento HTML del campo de tipo celular.\n  1279→ * @author Fahibram Cárcamo\n  1280→ * @author Jair Carvajal\n  1281→ */\n  1282→function validacionAdicionalInputTipoCelular(input, input_id) {\n  1283→    let numero_completo = input.getNumber();\n  1284→    let indicativo = '+' + input.getSelectedCountryData().dialCode;\n  1285→    let codigo_iso2_pais = input.getSelectedCountryData().iso2;\n  1286→    let numero_sin_indicativo = numero_completo.replace(indicativo, '');\n  1287→    $(`#indicativo_${input_id}`).val(indicativo);\n  1288→    $(`#codigo_iso2_pais_${input_id}`).val(codigo_iso2_pais);\n  1289→    $(`#${input_id}`).val(numero_sin_indicativo);\n  1290→}\n  1291→\n  1292→/**\n  1293→ * Rellenar un input de tipo celular.\n  1294→ *\n  1295→ * @param {string} indicativo_celular Código del país del número de celular.\n  1296→ * @param {string} codigo_pais_iso2 Código ISO2 del país del número de celular.\n  1297→ * @param {string} numero_celular Número de celular sin código de país.\n  1298→ * @param {string} input_celular_id ID del input de tipo celular.\n  1299→ * @param {HTMLInputElement} input_celular Input de tipo celular.\n  1300→ * @returns {void}\n  1301→ * @author Daniel Beltrán\n  1302→ * @author Fahibram Cárcamo\n  1303→ */\n  1304→function rellenarInputCelular(indicativo_celular, codigo_pais_iso2, numero_celular, input_celular_id, input_celular) {\n  1305→    $(`#${input_celular_id}`).val(numero_celular);\n  1306→    if (![null, undefined].includes(codigo_pais_iso2)) input_celular.setCountry(codigo_pais_iso2);\n  1307→}\n  1308→\n  1309→/**\n  1310→ * Convierte imágenes de base64 a Blob.\n  1311→ *\n  1312→ * @param {string} cadena_base_64 Base 64 de la imagen.\n  1313→ * @returns {Promise<Array>}\n  1314→ * @author Andres Gonzalez\n  1315→ */\n  1316→function imagenBase64Blob(cadena_base_64) {\n  1317→    if (!cadena_base_64 || !cadena_base_64.startsWith('data:image')) return null;\n  1318→    let datos_base_64 = cadena_base_64.split(',')[1];\n  1319→    let tipo_mime = cadena_base_64.match(/data:(.*?);base64/)[1];\n  1320→    let caracteres_binarios = atob(datos_base_64);\n  1321→    let arreglo_bytes = new Array(caracteres_binarios.length).fill(0).map((_, i) => caracteres_binarios.charCodeAt(i));\n  1322→    let bytes_uint8 = new Uint8Array(arreglo_bytes);\n  1323→    return new Blob([bytes_uint8], { type: tipo_mime });\n  1324→}\n  1325→\n  1326→\n  1327→/**\n  1328→ * Limpiar estructuras html innecesarias en el check editor.\n  1329→ *\n  1330→ * @param {string} html - Cadena HTML generada por CKEditor a limpiar\n  1331→ * @returns {string} HTML limpio sin elementos específicos de CKEditor\n  1332→ * @author Andres Gonzalez\n  1333→ * @author Jair Carvajal\n  1334→ */\n  1335→function limpiarHTMLCKEditor(html) {\n  1336→    // Remover todos los elementos con clases de CKEditor\n  1337→    html = html.replace(/<div class=\"ck[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1338→    html = html.replace(/<span class=\"[^\"]*ck[^\"]*\"[^>]*>/gi, '<span>');\n  1339→\n  1340→    // Limpiar spans de imagen inline\n  1341→    html = html.replace(/<span class=\"image-inline[^\"]*\"[^>]*>/gi, '');\n  1342→    html = html.replace(/<\\/span>/g, '');\n  1343→\n  1344→    // Remover elementos de upload y widgets\n  1345→    html = html.replace(/<div class=\"ck-image-upload[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1346→    html = html.replace(/<div class=\"ck-fake-selection[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1347→\n  1348→    // Remover atributos innecesarios\n  1349→    html = html.replace(/contenteditable=\"[^\"]*\"/gi, '');\n  1350→    html = html.replace(/data-cke-filler=\"[^\"]*\"/gi, '');\n  1351→\n  1352→    // Limpiar párrafos vacíos con br\n  1353→    html = html.replace(/<p><br[^>]*><\\/p>/gi, '');\n  1354→    html = html.replace(/<br data-cke[^>]*>/gi, '');\n  1355→\n  1356→    // Limpiar espacios múltiples y saltos de línea\n  1357→    html = html.replace(/\\s+/g, ' ');\n  1358→    html = html.replace(/>\\s+</g, '><');\n  1359→\n  1360→    return html.trim();\n  1361→}\n  1362→\n  1363→/**\n  1364→ * Ordena estudios por fecha_inicio más reciente (de más nueva a más antigua).\n  1365→ * Preserva los índices originales para permitir edición y eliminación correcta.\n  1366→ *\n  1367→ * @param {Array} estudios - Array de objetos con estudios\n  1368→ * @returns {Array} Array de estudios ordenados con propiedad indice_original\n  1369→ * @author Jair Carvajal\n  1370→ */\n  1371→function ordenarEstudiosPorFecha(estudios) {\n  1372→    // Mapear con índice original\n  1373→    let estudios_con_indice = estudios.map((estudio, indice_original) => ({\n  1374→        ...estudio,\n  1375→        indice_original: indice_original\n  1376→    }));\n  1377→\n  1378→    // Ordenar estudios por fecha_inicio (más reciente primero)\n  1379→    let estudios_ordenados = estudios_con_indice.sort((a, b) => {\n  1380→        // Si ambos tienen fecha_inicio, ordenar por más reciente\n  1381→        if (a.fecha_inicio && b.fecha_inicio) {\n  1382→            return moment(b.fecha_inicio).diff(moment(a.fecha_inicio));\n  1383→        }\n  1384→        // Si solo uno tiene fecha_inicio, ese va primero\n  1385→        if (a.fecha_inicio && !b.fecha_inicio) return -1;\n  1386→        if (!a.fecha_inicio && b.fecha_inicio) return 1;\n  1387→        // Si ninguno tiene fecha_inicio, mantener orden original\n  1388→        return 0;\n  1389→    });\n  1390→\n  1391→    return estudios_ordenados;\n  1392→}\n  1393→\n  1394→/**\n  1395→ * Ordena experiencias laborales por fecha: primero las que está trabajando actualmente (sin fecha_fin),\n  1396→ * luego por fecha_fin más reciente.\n  1397→ * Preserva los índices originales para permitir edición y eliminación correcta.\n  1398→ *\n  1399→ * @param {Array} experiencias - Array de objetos con experiencias laborales\n  1400→ * @returns {Array} Array de experiencias ordenadas con propiedad indice_original\n  1401→ * @author Jair Carvajal\n  1402→ */\n  1403→function ordenarExperienciasPorFecha(experiencias) {\n  1404→    // Mapear con índice original\n  1405→    let experiencias_con_indice = experiencias.map((experiencia, indice_original) => ({\n  1406→        ...experiencia,\n  1407→        indice_original: indice_original\n  1408→    }));\n  1409→\n  1410→    // Ordenar experiencias\n  1411→    let experiencias_ordenadas = experiencias_con_indice.sort((a, b) => {\n  1412→        // Si 'a' no tiene fecha_fin (trabaja actualmente), va primero\n  1413→        if (!a.fecha_fin && b.fecha_fin) return -1;\n  1414→        // Si 'b' no tiene fecha_fin (trabaja actualmente), va primero\n  1415→        if (a.fecha_fin && !b.fecha_fin) return 1;\n  1416→        // Si ambos están trabajando actualmente (sin fecha_fin), mantener el orden actual\n  1417→        if (!a.fecha_fin && !b.fecha_fin) return 0;\n  1418→        // Si ambos tienen fecha_fin, ordenar por fecha más reciente primero (descendente)\n  1419→        return moment(b.fecha_fin).diff(moment(a.fecha_fin));\n  1420→    });\n  1421→\n  1422→    return experiencias_ordenadas;\n  1423→}\n  1424→\n  1425→/**\n  1426→ * Obtener créditos disponibles de la empresa y actualizar el tag.\n  1427→ * - Si tiene créditos >= 20% del plan: tag azul\n  1428→ * - Si tiene créditos < 20% del plan: tag amarillo\n  1429→ * - Si no tiene créditos: tag gris \"Sin créditos\"\n  1430→ *\n  1431→ * @param {number} empresa_id ID de la empresa\n  1432→ * @param {string} contenedor_id ID del contenedor donde se mostrará el tag\n  1433→ * @param {boolean} verificar_modal Si se debe verificar si mostrar el modal de advertencia\n  1434→ * @returns {void}\n  1435→ * @author Andres Gonzalez\n  1436→ * @author Daniel Beltrán\n  1437→ */\n  1438→function obtenerCreditosDisponiblesEmpresa(empresa_id, contenedor_id = 'contenedor-tag-creditos', verificar_modal = false) {\n  1439→    if (!empresa_id || !$(`#${contenedor_id}`).length) {\n  1440→        return;\n  1441→    }\n  1442→\n  1443→    $.ajax({\n  1444→        url: `/empresas/${empresa_id}/creditos`,\n  1445→        method: 'GET',\n  1446→        dataType: 'json',\n  1447→        success: function (respuesta) {\n  1448→            if (respuesta?.data) {\n  1449→                let creditos_disponibles = respuesta?.data?.creditos_disponibles ?? 0;\n  1450→                let creditos_plan = respuesta?.data?.creditos_plan ?? 0;\n  1451→                let plan_credito = respuesta?.data?.plan_credito;\n  1452→                let porcentaje_disponible = creditos_plan > 0 ? (creditos_disponibles / creditos_plan) * 100 : 0;\n  1453→\n  1454→                let texto_tag = '';\n  1455→                let clase_tag = '';\n  1456→                let icono_final = '';\n  1457→\n  1458→                if (creditos_disponibles <= 0 || plan_credito === null) {\n  1459→                    texto_tag = 'Sin créditos';\n  1460→                    clase_tag = 'tag-tonal-gray';\n  1461→                    icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.' })}></i>`;\n  1462→                } else if (porcentaje_disponible < 20) {\n  1463→                    texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n  1464→                    clase_tag = 'tag-filled-yellow';\n  1465→                    icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'Estás cerca de agotar tus créditos. Te queda menos del 20% del total disponible. Considera recargar o revisar tu consumo para evitar interrupciones.' })}></i>`;\n  1466→                } else {\n  1467→                    texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n  1468→                    clase_tag = 'tag-tonal-blue';\n  1469→                }\n  1470→\n  1471→                $(`#${contenedor_id}`).html(crearTag({\n  1472→                    texto: texto_tag,\n  1473→                    class: clase_tag,\n  1474→                    icono_final: icono_final,\n  1475→                }));\n  1476→\n  1477→                // Verificar si se debe mostrar el modal de advertencia\n  1478→                if (verificar_modal && plan_credito !== null) {\n  1479→                    verificarYMostrarModalAdvertenciaCreditosDisponibles(porcentaje_disponible, empresa_id);\n  1480→                }\n  1481→            } else {\n  1482→                $(`#${contenedor_id}`).html(crearTag({\n  1483→                    texto: 'No tienes plan de créditos',\n  1484→                    class: 'tag-tonal-gray'\n  1485→                }));\n  1486→            }\n  1487→\n  1488→            inicializarTooltips();\n  1489→        },\n  1490→        error: function () {\n  1491→            $(`#${contenedor_id}`).html(crearTag({\n  1492→                texto: 'Error al cargar créditos',\n  1493→                class: 'tag-tonal-gray'\n  1494→            }));\n  1495→        }\n  1496→    });\n  1497→}\n  1498→\n  1499→/**\n  1500→ * Verificar si se debe mostrar el modal de advertencia de créditos disponibles.\n  1501→ * Los umbrales son: 20%, 10%, 5% y 0%.\n  1502→ * El modal solo se muestra una vez por día para cada umbral alcanzado.\n  1503→ * Si baja a un umbral más bajo, se muestra ese nuevo umbral aunque ya se haya mostrado otro ese día.\n  1504→ *\n  1505→ * @param {number} porcentaje_disponible Porcentaje de créditos disponibles\n  1506→ * @param {number} empresa_id ID de la empresa\n  1507→ * @returns {void}\n  1508→ * @author Sergio Vargas\n  1509→ */\n  1510→function verificarYMostrarModalAdvertenciaCreditosDisponibles(porcentaje_disponible, empresa_id) {\n  1511→    // Determinar el umbral actual alcanzado (el más bajo que aplica)\n  1512→    let umbral_actual = null;\n  1513→\n  1514→    for (let umbral of UMBRALES_ADVERTENCIA_CREDITOS) {\n  1515→        if (porcentaje_disponible <= umbral) {\n  1516→            umbral_actual = umbral;\n  1517→        } else {\n  1518→            break;\n  1519→        }\n  1520→    }\n  1521→\n  1522→    // Si no se alcanzó ningún umbral, no mostrar el modal\n  1523→    if (umbral_actual === null) {\n  1524→        return;\n  1525→    }\n  1526→\n  1527→    // Obtener la fecha actual en formato YYYY-MM-DD\n  1528→    let fecha_hoy = new Date().toISOString().split('T')[0];\n  1529→    let llave_storage = `modal_creditos_${empresa_id}`;\n  1530→\n  1531→    // Obtener los datos guardados en localStorage\n  1532→    let datos_guardados = localStorage.getItem(llave_storage);\n  1533→    let umbrales_mostrados_hoy = {};\n  1534→\n  1535→    if (datos_guardados) {\n  1536→        try {\n  1537→            let datos = JSON.parse(datos_guardados);\n  1538→            // Si la fecha guardada es de hoy, usar los umbrales guardados\n  1539→            if (datos.fecha === fecha_hoy) {\n  1540→                umbrales_mostrados_hoy = datos.umbrales || {};\n  1541→            }\n  1542→            // Si es de otro día, se resetean los umbrales (objeto vacío)\n  1543→        } catch (e) {\n  1544→            // Si hay error al parsear, se resetea\n  1545→            umbrales_mostrados_hoy = {};\n  1546→        }\n  1547→    }\n  1548→\n  1549→    // Verificar si ya se mostró el modal para este umbral hoy\n  1550→    if (umbrales_mostrados_hoy[umbral_actual]) {\n  1551→        return;\n  1552→    }\n  1553→\n  1554→    // Marcar este umbral como mostrado hoy\n  1555→    umbrales_mostrados_hoy[umbral_actual] = true;\n  1556→\n  1557→    // Guardar en localStorage\n  1558→    localStorage.setItem(llave_storage, JSON.stringify({\n  1559→        fecha: fecha_hoy,\n  1560→        umbrales: umbrales_mostrados_hoy\n  1561→    }));\n  1562→\n  1563→    // Mostrar el modal\n  1564→    mostrarModalAdvertenciaCreditosDisponibles(umbral_actual, empresa_id);\n  1565→}\n  1566→\n  1567→/**\n  1568→ * Mostrar el modal de advertencia de créditos disponibles.\n  1569→ *\n  1570→ * @param {number} umbral Umbral de porcentaje alcanzado (20, 10, 5 o 0)\n  1571→ * @param {number} empresa_id ID de la empresa\n  1572→ * @returns {void}\n  1573→ * @author Sergio Vargas\n  1574→ */\n  1575→function mostrarModalAdvertenciaCreditosDisponibles(umbral, empresa_id) {\n  1576→    let mensaje_descripcion = umbral === 0\n  1577→        ? 'Tu saldo de créditos se ha agotado. Solicita más créditos ahora para evitar interrupciones en tus acciones.'\n  1578→        : `Tu saldo está por debajo del ${umbral}% de créditos disponibles. Solicita más créditos ahora para evitar interrupciones en tus acciones.`;\n  1579→\n  1580→    Swal.fire({\n  1581→        showCloseButton: true,\n  1582→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n  1583→        showConfirmButton: false,\n  1584→        showDenyButton: false,\n  1585→        showCancelButton: false,\n  1586→        html: `\n  1587→            <div class=\"row w-100 mx-0 mt-2\">\n  1588→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Solicita más créditos</div>\n  1589→                <div class=\"col-12 mt-4 text-start text-body-2 fw-normal text-gray-30\">${mensaje_descripcion}</div>\n  1590→                <div class=\"col-6 mt-5 mb-2\">\n  1591→                    ${crearBoton({\n  1592→                        clases: 'btn-outline-primary w-100 justify-content-center',\n  1593→                        texto: 'Cancelar',\n  1594→                        onclick: `Swal.close();`\n  1595→                    })}\n  1596→                </div>\n  1597→                <div class=\"col-6 mt-5 mb-2\">\n  1598→                    ${crearBoton({\n  1599→                        clases: 'btn-primary w-100 justify-content-center',\n  1600→                        texto: 'Solicitar más créditos',\n  1601→                        onclick: `solicitarMasCreditosDesdeModal(${empresa_id});`\n  1602→                    })}\n  1603→                </div>\n  1604→            </div>\n  1605→        `,\n  1606→    });\n  1607→}\n  1608→\n  1609→/**\n  1610→ * Solicitar más créditos desde el modal de advertencia.\n  1611→ * Contacta al ejecutivo de la empresa via WhatsApp.\n  1612→ *\n  1613→ * @param {number} empresa_id ID de la empresa\n  1614→ * @returns {void}\n  1615→ * @author Sergio Vargas\n  1616→ */\n  1617→function solicitarMasCreditosDesdeModal(empresa_id) {\n  1618→    $.ajax({\n  1619→        url: `/empresas/${empresa_id}`,\n  1620→        method: 'GET',\n  1621→        dataType: 'json',\n  1622→        success: function(respuesta) {\n  1623→            if (respuesta?.data?.ejecutivo?.telefono) {\n  1624→                window.open(`https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.`, '_blank');\n  1625→            } else {\n  1626→                mostrarToast('danger', 'No se encontró un ejecutivo asignado a la empresa. Por favor, comunícate con soporte para recargar créditos.');\n  1627→            }\n  1628→            Swal.close();\n  1629→        },\n  1630→        error: function() {\n  1631→            mostrarToast('danger', 'Ocurrió un error al obtener la información del ejecutivo.');\n  1632→            Swal.close();\n  1633→        }\n  1634→    });\n  1635→}\n  1636→\n  1637→/**\n  1638→ * Obtiene las funcionalidades activas del plan vigente de la empresa del usuario actual.\n  1639→ *\n  1640→ * @param {number|null} tipo_prueba_id ID del tipo de prueba (opcional).\n  1641→ * @returns {Promise} Promesa que se resuelve con las funcionalidades activas.\n  1642→ * @author Andres Gonzalez\n  1643→ */\n  1644→function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n  1645→    let parametros = {};\n  1646→\n  1647→    if (tipo_prueba_id !== null) {\n  1648→        parametros.tipo_prueba_id = tipo_prueba_id;\n  1649→    }\n  1650→\n  1651→    return $.ajax({\n  1652→        url: '/funcionalidades-activas-plan',\n  1653→        method: 'GET',\n  1654→        dataType: 'json',\n  1655→        data: parametros,\n  1656→        success: function(respuesta) {\n  1657→            funcionalidades_disponibles_empresa = respuesta?.data ?? [];\n  1658→        }\n  1659→    });\n  1660→}\n  1661→\n  1662→/**\n  1663→ * Muestra Modal para informar que no cuenta con la funcionalidad\n  1664→ *.\n  1665→ * @returns {void}\n  1666→ * @author Andres Gonzalez\n  1667→ */\n  1668→function modalFuncionalidadInactiva() {\n  1669→    Swal.fire({\n  1670→        showCloseButton: true,\n  1671→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n  1672→        showConfirmButton: false,\n  1673→        showDenyButton: false,\n  1674→        showCancelButton: false,\n  1675→        html: `\n  1676→            <div class=\"row w-100 mx-0 mt-2\">\n  1677→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Adquiere esta funcionalidad</div>\n  1678→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">No tienes esta funcionalidad activa. Por favor, contacta a tu asesor.</div>\n  1679→                <div class=\"col-6 mt-5 mb-2\">\n  1680→                    ${crearBoton({\n  1681→                        clases: 'btn-outline-primary w-100 justify-content-center',\n  1682→                        texto: 'Cancelar',\n  1683→                        onclick: `Swal.clickDeny();`\n  1684→                    })}\n  1685→                </div>\n  1686→                <div class=\"col-6 mt-5 mb-2\">\n  1687→                    ${crearBoton({\n  1688→                        clases: 'btn-primary w-100 justify-content-center',\n  1689→                        texto: 'Entiendo',\n  1690→                        onclick: `Swal.clickConfirm();`\n  1691→                    })}\n  1692→                </div>\n  1693→            </div>\n  1694→        `,\n  1695→    }).then(async (resultado) => {\n  1696→        //\n  1697→    });\n  1698→}\n  1699→\n  1700→/**\n  1701→ * Busca una funcionalidad por su llave.\n  1702→ *\n  1703→ * @param {string} llave Llave de la funcionalidad a buscar.\n  1704→ * @param {Array|null} funcionalidades funcionalidades.\n  1705→ * @returns {boolean}\n  1706→ * @author Andres Gonzalez\n  1707→ */\n  1708→function buscarFuncionalidad(llave, funcionalidades = null) {\n  1709→    let datos = funcionalidades ?? funcionalidades_disponibles_empresa;\n  1710→\n  1711→    if (!Array.isArray(datos) || datos.length === 0) {\n  1712→        return false;\n  1713→    }\n  1714→\n  1715→    return datos.some(item => item?.funcionalidad?.llave === llave);\n  1716→}\n  1717→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ef9d6859-bae6-4095-88cb-53ba884dc421","timestamp":"2026-01-29T16:21:16.165Z","sourceToolAssistantUUID":"88c064e5-9f84-45a6-9a57-0005d82c57ac"}
{"parentUuid":"ef9d6859-bae6-4095-88cb-53ba884dc421","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01LUNFd5VYVsTfuscd5Y8qjG","toolUseID":"toolu_01LUNFd5VYVsTfuscd5Y8qjG","timestamp":"2026-01-29T16:21:16.168Z","uuid":"0082ae6e-30b4-4f0f-baf6-0df982aad410"}
{"parentUuid":"0082ae6e-30b4-4f0f-baf6-0df982aad410","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HFDeWpY67X5MG3GseU4h5t","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora voy a buscar también información sobre cómo se obtienen los servicios IA y sus créditos:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":26610,"cache_read_input_tokens":39637,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":26610},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyXoKAGJVHtLkBRbE56","type":"assistant","uuid":"41f4cc91-8311-495a-ae5a-63bbdea66a8f","timestamp":"2026-01-29T16:21:19.360Z"}
{"parentUuid":"41f4cc91-8311-495a-ae5a-63bbdea66a8f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HFDeWpY67X5MG3GseU4h5t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0163v8DFZK4GLyErVeLrFA23","name":"Bash","input":{"command":"grep -r \"obtenerCreditosDisponiblesEmpresa\\|servicios-ia\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\" --include=\"*.php\" | head -20"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":26610,"cache_read_input_tokens":39637,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":26610},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyXoKAGJVHtLkBRbE56","type":"assistant","uuid":"310b5159-4776-4a1e-ae15-c70995876c6b","timestamp":"2026-01-29T16:21:20.280Z"}
{"parentUuid":"310b5159-4776-4a1e-ae15-c70995876c6b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01HFDeWpY67X5MG3GseU4h5t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019J8N9AZ9yfbB3jH3ihZMJd","name":"Bash","input":{"command":"find \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\" -name \"*Credito*\" -o -name \"*IA*\" | head -10"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":26610,"cache_read_input_tokens":39637,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":26610},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyXoKAGJVHtLkBRbE56","type":"assistant","uuid":"8a807926-ffc4-490e-a86c-b196154b4535","timestamp":"2026-01-29T16:21:22.869Z"}
{"parentUuid":"310b5159-4776-4a1e-ae15-c70995876c6b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0163v8DFZK4GLyErVeLrFA23","type":"tool_result","content":"","is_error":false}]},"uuid":"1165ba26-5a49-4ee7-af82-c4a0ccd3442d","timestamp":"2026-01-29T16:21:24.995Z","sourceToolAssistantUUID":"310b5159-4776-4a1e-ae15-c70995876c6b"}
{"parentUuid":"8a807926-ffc4-490e-a86c-b196154b4535","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019J8N9AZ9yfbB3jH3ihZMJd","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers/IA\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers/IA/CategoriaServicioIAController.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers/IA/ServicioIAController.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers/Planes/PlanCreditoController.php","is_error":false}]},"uuid":"c30e8224-b582-4dac-84de-a30449b828fa","timestamp":"2026-01-29T16:21:25.013Z","sourceToolAssistantUUID":"8a807926-ffc4-490e-a86c-b196154b4535"}
{"parentUuid":"c30e8224-b582-4dac-84de-a30449b828fa","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01FEdWgAgB6LThJv8rPCPrx2","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a revisar los controladores de IA:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":819,"cache_read_input_tokens":66247,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":819},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXbyYRosYVpaZYfncFL54","type":"assistant","uuid":"5bec1733-bba7-4b5c-a744-9613bdef34ef","timestamp":"2026-01-29T16:21:30.434Z"}
{"parentUuid":"5bec1733-bba7-4b5c-a744-9613bdef34ef","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01FEdWgAgB6LThJv8rPCPrx2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TngF2CiX8u5DVzV2qLDj58","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA\\ServicioIAController.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":819,"cache_read_input_tokens":66247,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":819},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXbyYRosYVpaZYfncFL54","type":"assistant","uuid":"c0fd6db9-ed15-4888-9283-6bb3af5cfc1f","timestamp":"2026-01-29T16:21:30.483Z"}
{"parentUuid":"c0fd6db9-ed15-4888-9283-6bb3af5cfc1f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01FEdWgAgB6LThJv8rPCPrx2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011KxyDfckidALWgyhn1t3Jv","name":"Bash","input":{"command":"grep -r \"creditos\\|consume_creditos\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA\" -A 3 -B 3"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":819,"cache_read_input_tokens":66247,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":819},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXbyYRosYVpaZYfncFL54","type":"assistant","uuid":"aa783328-aa64-44cc-81b5-532b9deca894","timestamp":"2026-01-29T16:21:30.550Z"}
{"parentUuid":"c0fd6db9-ed15-4888-9283-6bb3af5cfc1f","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TngF2CiX8u5DVzV2qLDj58","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Http\\Controllers\\IA;\n     4→\n     5→use Exception;\n     6→use Illuminate\\Http\\Request;\n     7→use Illuminate\\Http\\JsonResponse;\n     8→use Illuminate\\Support\\Facades\\DB;\n     9→use App\\Http\\Controllers\\Controller;\n    10→use App\\Http\\Repositories\\IA\\ServicioIARepository;\n    11→\n    12→class ServicioIAController extends Controller\n    13→{\n    14→    /**\n    15→     * Constructor.\n    16→     *\n    17→     * @param ServicioIARepository $repositorio Repositorio de servicios de IA.\n    18→     * @return void\n    19→     * @author Sergio Vargas\n    20→     * @author Daniel Beltrán\n    21→     */\n    22→    public function __construct(private ServicioIARepository $repositorio) {}\n    23→\n    24→    /**\n    25→     * Obtener listado de servicios de IA.\n    26→     *\n    27→     * @param Request $request Contenido de la petición.\n    28→     * @return JsonResponse\n    29→     * @author Sergio Vargas\n    30→     * @author Daniel Beltrán\n    31→     */\n    32→    public function index(Request $request): JsonResponse {\n    33→        return new JsonResponse([\n    34→            'data' => $this->repositorio->getTodo($request),\n    35→        ], JsonResponse::HTTP_OK);\n    36→    }\n    37→\n    38→    /**\n    39→     * Crear servicio de IA.\n    40→     *\n    41→     * @param Request $request Contenido de la petición.\n    42→     * @return JsonResponse\n    43→     * @author Sergio Vargas\n    44→     * @author Daniel Beltrán\n    45→     */\n    46→    public function store(Request $request): JsonResponse {\n    47→        $codigo    = JsonResponse::HTTP_CREATED;\n    48→        $respuesta = ['message' => 'Servicio de IA creado correctamente'];\n    49→\n    50→        try {\n    51→            DB::beginTransaction();\n    52→            $this->repositorio->crear($request->except(['_token', '_method', 'id']));\n    53→            DB::commit();\n    54→        } catch (Exception $error) {\n    55→            DB::rollBack();\n    56→            $codigo    = JsonResponse::HTTP_BAD_REQUEST;\n    57→            $respuesta = [\n    58→                'message' => 'Ocurrio un error',\n    59→                'errors'  => $error->getMessage(),\n    60→            ];\n    61→        }\n    62→\n    63→        return new JsonResponse($respuesta, $codigo);\n    64→    }\n    65→\n    66→    /**\n    67→     * Actualizar servicio de IA.\n    68→     *\n    69→     * @param int $id ID del servicio de IA.\n    70→     * @param Request $request Contenido de la petición.\n    71→     * @return JsonResponse\n    72→     * @author Sergio Vargas\n    73→     * @author Daniel Beltrán\n    74→     */\n    75→    public function update(int $id, Request $request): JsonResponse {\n    76→        $codigo    = JsonResponse::HTTP_OK;\n    77→        $respuesta = ['message' => 'Servicio de IA actualizado correctamente'];\n    78→\n    79→        try {\n    80→            DB::beginTransaction();\n    81→            $this->repositorio->actualizar($id, $request->except(['_token', '_method', 'id']));\n    82→            DB::commit();\n    83→        } catch (Exception $error) {\n    84→            DB::rollBack();\n    85→            $codigo    = JsonResponse::HTTP_BAD_REQUEST;\n    86→            $respuesta = [\n    87→                'message' => 'Ocurrio un error',\n    88→                'errors'  => $error->getMessage(),\n    89→            ];\n    90→        }\n    91→\n    92→        return new JsonResponse($respuesta, $codigo);\n    93→    }\n    94→\n    95→    /**\n    96→     * Obtener creditos de un servicio de IA.\n    97→     *\n    98→     * @param int $id ID del servicio de IA.\n    99→     * @return JsonResponse\n   100→     * @author Sergio Vargas\n   101→     * @author Daniel Beltrán\n   102→     */\n   103→    public function creditos(int $id): JsonResponse {\n   104→        $servicio = $this->repositorio->getUno($id);\n   105→\n   106→        if (!$servicio) {\n   107→            return new JsonResponse([\n   108→                'message' => 'Servicio de IA no encontrado'\n   109→            ], JsonResponse::HTTP_NOT_FOUND);\n   110→        }\n   111→\n   112→        return new JsonResponse([\n   113→            'data' => [\n   114→                'id'               => $servicio->id,\n   115→                'consume_creditos' => $servicio->consume_creditos\n   116→            ]\n   117→        ], JsonResponse::HTTP_OK);\n   118→    }\n   119→\n   120→    /**\n   121→     * Activar servicio de IA.\n   122→     *\n   123→     * @param int $id ID del servicio de IA.\n   124→     * @return JsonResponse\n   125→     * @author Sergio Vargas\n   126→     * @author Daniel Beltrán\n   127→     */\n   128→    public function activar(int $id): JsonResponse {\n   129→        return $this->cambiarEstado($id, true, 'Servicio IA activado correctamente');\n   130→    }\n   131→\n   132→    /**\n   133→     * Desactivar servicio de IA.\n   134→     *\n   135→     * @param int $id ID del servicio de IA.\n   136→     * @return JsonResponse\n   137→     * @author Sergio Vargas\n   138→     * @author Daniel Beltrán\n   139→     */\n   140→    public function desactivar(int $id): JsonResponse {\n   141→        return $this->cambiarEstado($id, false, 'Servicio IA desactivado correctamente');\n   142→    }\n   143→\n   144→    /**\n   145→     * Cambiar estado activo del servicio de IA.\n   146→     *\n   147→     * @param int $id ID del servicio de IA.\n   148→     * @param bool $activo Estado del servicio.\n   149→     * @param string $mensaje Mensaje de respuesta.\n   150→     * @return JsonResponse\n   151→     * @author Sergio Vargas\n   152→     * @author Daniel Beltrán\n   153→     */\n   154→    private function cambiarEstado(int $id, bool $activo, string $mensaje): JsonResponse {\n   155→        $codigo    = JsonResponse::HTTP_OK;\n   156→        $respuesta = ['message' => $mensaje];\n   157→\n   158→        try {\n   159→            DB::beginTransaction();\n   160→            $this->repositorio->actualizar($id, ['activo' => $activo]);\n   161→            DB::commit();\n   162→        } catch (Exception $error) {\n   163→            DB::rollBack();\n   164→            $codigo    = JsonResponse::HTTP_BAD_REQUEST;\n   165→            $respuesta = [\n   166→                'message' => 'Ocurrió un error',\n   167→                'errors'  => $error->getMessage(),\n   168→            ];\n   169→        }\n   170→\n   171→        return new JsonResponse($respuesta, $codigo);\n   172→    }\n   173→}\n   174→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"27ff4353-aa35-4eeb-8840-d22b9d803ed3","timestamp":"2026-01-29T16:21:31.826Z","sourceToolAssistantUUID":"c0fd6db9-ed15-4888-9283-6bb3af5cfc1f"}
{"parentUuid":"27ff4353-aa35-4eeb-8840-d22b9d803ed3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01TngF2CiX8u5DVzV2qLDj58","toolUseID":"toolu_01TngF2CiX8u5DVzV2qLDj58","timestamp":"2026-01-29T16:21:31.828Z","uuid":"3d9c2399-6b9f-4c7d-9d4b-5db7addb845b"}
{"parentUuid":"aa783328-aa64-44cc-81b5-532b9deca894","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011KxyDfckidALWgyhn1t3Jv","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-    }\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-    /**\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php:     * Obtener creditos de un servicio de IA.\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     *\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     * @param int $id ID del servicio de IA.\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     * @return JsonResponse\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     * @author Sergio Vargas\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     * @author Daniel Beltrán\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-     */\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php:    public function creditos(int $id): JsonResponse {\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-        $servicio = $this->repositorio->getUno($id);\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-        if (!$servicio) {\n--\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-        return new JsonResponse([\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-            'data' => [\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-                'id'               => $servicio->id,\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php:                'consume_creditos' => $servicio->consume_creditos\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-            ]\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-        ], JsonResponse::HTTP_OK);\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA/ServicioIAController.php-    }","is_error":false}]},"uuid":"dbdc36d7-562d-4025-9fec-1383e27b8665","timestamp":"2026-01-29T16:21:32.465Z","sourceToolAssistantUUID":"aa783328-aa64-44cc-81b5-532b9deca894"}
{"parentUuid":"dbdc36d7-562d-4025-9fec-1383e27b8665","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01BK9HrpbY8PdSmZHha3nzsr","type":"message","role":"assistant","content":[{"type":"text","text":"Excelente. Ahora voy a ver las rutas para entender mejor cómo se conecta todo:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":3368,"cache_read_input_tokens":67066,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3368},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyYz18CnXa3Brz4pqpd","type":"assistant","uuid":"ed92e4c6-af26-4cd0-9a7c-1f7a80657f3a","timestamp":"2026-01-29T16:21:35.532Z"}
{"parentUuid":"ed92e4c6-af26-4cd0-9a7c-1f7a80657f3a","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01BK9HrpbY8PdSmZHha3nzsr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BfwyUDkgMt6rFpaJCVMTHA","name":"Bash","input":{"command":"grep -r \"servicios-ia\\|creditos\\|generar-vacante\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\" --include=\"*.php\" | head -30"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":3368,"cache_read_input_tokens":67066,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3368},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyYz18CnXa3Brz4pqpd","type":"assistant","uuid":"d4a2dd8a-e5fb-4b02-a78e-9da90e73e4e7","timestamp":"2026-01-29T16:21:38.648Z"}
{"parentUuid":"d4a2dd8a-e5fb-4b02-a78e-9da90e73e4e7","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BfwyUDkgMt6rFpaJCVMTHA","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->resource('planes-creditos', 'Planes\\PlanCreditoController');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->resource('servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->get('servicios-ia/{id}/creditos', 'IA\\ServicioIAController@creditos');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->post('servicios-ia/{id}/activar', 'IA\\ServicioIAController@activar');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->post('servicios-ia/{id}/desactivar', 'IA\\ServicioIAController@desactivar');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->get('empresas/{empresa_id}/creditos', 'Empresas\\EmpresaPlanController@creditosDisponiblesEmpresa');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->resource('categorias-servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:            $ruta->get('planes-historial-recompras-creditos/{empresa_id}', 'Empresas\\EmpresaPlanController@historialComprasCreditos');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:            $ruta->post('planes-historial-creditos-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelHistorialCreditos');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:            $ruta->post('consumos-creditos-ia-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelConsumosCreditosIA');\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes/web.php:        $ruta->post('generar-vacante', 'Vacantes\\VacanteController@generarConIA');","is_error":false}]},"uuid":"064543e9-69bf-4f27-b205-b176784345fb","timestamp":"2026-01-29T16:21:39.906Z","sourceToolAssistantUUID":"d4a2dd8a-e5fb-4b02-a78e-9da90e73e4e7"}
{"parentUuid":"064543e9-69bf-4f27-b205-b176784345fb","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"2233ba48-966e-4b0b-b727-997d4d16afa4","version":"2.1.23","gitBranch":"pre-main","agentId":"a473d49","slug":"recursive-greeting-snail","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01MMfLJv6ttt83aVeasSfcLd","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora tengo toda la información que necesito. Voy a preparar un resumen completo basado en mis hallazgos:\n\n## REPORTE: Implementación del Modal de Consumo de Créditos IA en /vacantes/create\n\nHe encontrado y analizado completamente la implementación del modal de consumo de créditos IA. Aquí está cómo funciona:\n\n---\n\n### 1. INCLUSIÓN DEL MODAL EN LA VISTA\n\n**Archivo**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\crear.blade.php`\n\n**Línea 225**:\n```blade\n@include('vacantes.paginas.modales.modal-consumo-creditos-ia')\n```\n\nEl modal se incluye en la sección `@section('modals')` al final de la vista, permitiendo reutilizar el mismo modal en múltiples páginas.\n\n---\n\n### 2. CONFIGURACIÓN DEL MODAL\n\n**Archivo**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\vacantes\\paginas\\modales\\modal-consumo-creditos-ia.blade.php`\n\n```javascript\n${crearModal({\n    id: 'modal-consumo-creditos-ia',\n    dialog_class: 'modal-md modal-dialog-centered',\n    adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n    titulo_header: 'Consumo de créditos',\n    subtitulo_header: `Esta acción hará uso de la IA y descontará <span id=\"cantidad-creditos-descontar-modal\"></span> crédito(s) de tu saldo disponible.`,\n    header_class: 'pb-0',\n    modal_body_class: 'p-0 mb-6',\n    boton_footer1: {\n        type: 'button',\n        texto: 'Cancelar',\n        class: 'btn-outline-primary',\n        cerrar_modal: true,\n    },\n    boton_footer2: {\n        type: 'submit',\n        texto: 'Continuar',\n        class: 'btn-primary',\n        cerrar_modal: false,\n        onclick: `continuarEjecucionIA();`\n    },\n    modal_body: `\n        <div class=\"col-12 text-body-2 fw-semibold\">\n            ¿Deseas continuar?\n        </div>\n    `\n})}\n```\n\n**Características clave**:\n- **ID**: `modal-consumo-creditos-ia` para identificar el modal\n- **Backdrop**: `data-bs-backdrop=\"static\"` previene cerrar haciendo clic afuera\n- **Cantidad dinámica**: El span `#cantidad-creditos-descontar-modal` se llena dinámicamente\n- **Botón principal**: El botón \"Continuar\" ejecuta `continuarEjecucionIA()`\n\n---\n\n### 3. FLUJO DE GENERACIÓN DE VACANTE CON IA\n\n**Archivo**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js`\n\n#### Paso 1: Iniciación (líneas 11-23)\n```javascript\nfunction generarVacanteIA() {\n    let descripcion_vacante_ia = $('#descripcion_vacante_ia').val().trim();\n    if (descripcion_vacante_ia.length >= 5) {\n        if (!mostro_modal_creditos_ia) {\n            funcion_ejecucion_ia = () => generarVacanteIAConsumida(descripcion_vacante_ia);\n            let servicio_ia_id = 6;\n            mostrarModalCreditosIA(servicio_ia_id);\n            return;\n        }\n    } else {\n        mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n    }\n}\n```\n\n**Variables globales** (`C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\globales.js`, líneas 34-36):\n```javascript\nlet mostro_modal_creditos_ia = false;\nlet funcion_ejecucion_ia = null;\nlet modals_abiertos_ia = null;\n```\n\n---\n\n### 4. OBTENCIÓN DE CRÉDITOS A DESCONTAR\n\n**Archivo**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\globales.js`\n\n**Función `mostrarModalCreditosIA()` (líneas 49-77)**:\n```javascript\nfunction mostrarModalCreditosIA(servicio_ia_id) {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}/creditos`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta_empresa) {\n            if (respuesta_empresa?.data?.creditos_disponibles > 0) {\n                $.ajax({\n                    url: `/servicios-ia/${servicio_ia_id}/creditos`,\n                    method: 'GET',\n                    dataType: 'json',\n                    success: function(respuesta) {\n                        if (respuesta?.data?.consume_creditos && \n                            respuesta?.data?.consume_creditos <= respuesta_empresa.data.creditos_disponibles) {\n                            \n                            // AQUÍ SE CONFIGURA LA CANTIDAD EN EL MODAL\n                            $('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);\n                            $('#modal-consumo-creditos-ia').modal('show');\n                            mostro_modal_creditos_ia = true;\n                            modals_abiertos_ia = $('.modal.show').not('#modal-consumo-creditos-ia').not('#modal-generando-ia');\n                            $(modals_abiertos_ia).addClass('d-none');\n                        } else {\n                            mostrarToastSolicitarCreditosIA();\n                        }\n                    }\n                });\n            } else {\n                mostrarToastSolicitarCreditosIA();\n            }\n        }\n    });\n}\n```\n\n**Flujo de obtención de créditos**:\n1. **Obtiene créditos disponibles de la empresa**:\n   - Endpoint: `GET /empresas/{empresa_id}/creditos`\n   - Verifica que haya créditos disponibles\n\n2. **Obtiene créditos a consumir del servicio IA**:\n   - Endpoint: `GET /servicios-ia/{servicio_ia_id}/creditos`\n   - El `servicio_ia_id` = 6 para \"Generar vacante\"\n   - Retorna: `consume_creditos` (cantidad de créditos a descontar)\n\n3. **Valida disponibilidad**:\n   - Verifica que `consume_creditos <= creditos_disponibles`\n\n4. **Actualiza el modal**:\n   - `$('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);`\n   - Llena el span en el título del modal\n\n---\n\n### 5. EJECUCIÓN DE LA FUNCIÓN IA\n\n**Función `continuarEjecucionIA()` (líneas 112-119 de globales.js)**:\n```javascript\nfunction continuarEjecucionIA() {\n    if (funcion_ejecucion_ia) {\n        funcion_ejecucion_ia();  // EJECUTA LA FUNCIÓN ALMACENADA\n        funcion_ejecucion_ia = null;\n    }\n    mostro_modal_creditos_ia = false;\n    $('#modal-consumo-creditos-ia').modal('hide');\n}\n```\n\nEsta función ejecuta la función almacenada en la variable `funcion_ejecucion_ia`, que en este caso es:\n```javascript\nfuncion_ejecucion_ia = () => generarVacanteIAConsumida(descripcion_vacante_ia);\n```\n\n---\n\n### 6. GENERACIÓN DE VACANTE CONSUMIDA\n\n**Función `generarVacanteIAConsumida()` (líneas 31-107 de vacantes-ia.js)**:\n```javascript\nfunction generarVacanteIAConsumida(descripcion_vacante_ia) {\n    $('#modal-vacante-ia').modal('hide');\n    $('#modal-generando-ia').modal('show');\n    $.ajax({\n        type: 'POST',\n        url : '/generar-vacante',\n        data: {\n            _token: $('input[name=\"_token\"]').val(),\n            descripcion: descripcion_vacante_ia,\n        },\n        success: function(respuesta) {\n            if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                return;\n            }\n            // Procesa la respuesta y llena los campos de la vacante...\n        }, \n        error: function(error) {\n            mostrarToast('danger', 'Ocurrió un error al generar la vacante');\n        }\n    });\n}\n```\n\n**Ruta backend**:\n```\nPOST /generar-vacante\n```\n\n---\n\n### 7. SERVICIOS IA CONFIGURADOS\n\n**Archivo**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\IA\\ServicioIAController.php`\n\n**Endpoint para obtener créditos** (líneas 103-118):\n```php\npublic function creditos(int $id): JsonResponse {\n    $servicio = $this->repositorio->getUno($id);\n\n    if (!$servicio) {\n        return new JsonResponse([\n            'message' => 'Servicio de IA no encontrado'\n        ], JsonResponse::HTTP_NOT_FOUND);\n    }\n\n    return new JsonResponse([\n        'data' => [\n            'id'               => $servicio->id,\n            'consume_creditos' => $servicio->consume_creditos\n        ]\n    ], JsonResponse::HTTP_OK);\n}\n```\n\n**Servicios IA disponibles**:\n- ID 6: Generar vacante\n- ID 3: Generar preguntas prefiltro\n- ID 4: Generar preguntas video entrevista\n\n---\n\n### 8. RESUMEN DEL FLUJO COMPLETO\n\n```\n1. Usuario hace clic en \"Generar vacante\" (generarVacanteIA())\n   ↓\n2. Se almacena la función a ejecutar: funcion_ejecucion_ia = () => generarVacanteIAConsumida()\n   ↓\n3. Se llama mostrarModalCreditosIA(6)\n   ↓\n4. AJAX 1: GET /empresas/{id}/creditos → Obtiene créditos disponibles\n   ↓\n5. AJAX 2: GET /servicios-ia/6/creditos → Obtiene consume_creditos\n   ↓\n6. Se valida: consume_creditos <= creditos_disponibles\n   ↓\n7. Se llena: $('#cantidad-creditos-descontar-modal').text(consume_creditos)\n   ↓\n8. Se muestra el modal: $('#modal-consumo-creditos-ia').modal('show')\n   ↓\n9. Usuario hace clic en \"Continuar\"\n   ↓\n10. Se ejecuta: continuarEjecucionIA()\n   ↓\n11. Se ejecuta: funcion_ejecucion_ia() → generarVacanteIAConsumida()\n   ↓\n12. AJAX 3: POST /generar-vacante → Consume los créditos y genera vacante\n   ↓\n13. Respuesta se valida con: validarRespuestaCreditosIA()\n   ↓\n14. Se llenan los campos de la vacante con la respuesta de IA\n```\n\n---\n\n### 9. ARCHIVOS CLAVE INVOLUCRADOS\n\n1. **Vista**: `resources/views/vacantes/paginas/crear.blade.php`\n2. **Modal**: `resources/views/vacantes/paginas/modales/modal-consumo-creditos-ia.blade.php`\n3. **Lógica IA**: `public/js/vacantes/vacantes-ia.js`\n4. **Funciones globales**: `public/js/globales.js`\n5. **Controlador**: `app/Http/Controllers/IA/ServicioIAController.php`\n6. **Rutas**: `routes/web.php`\n\nEste es un patrón reutilizable que se usa en múltiples funciones de IA en la plataforma (preguntas prefiltro, video entrevistas, etc.)."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1179,"cache_read_input_tokens":70434,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1179},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXbyZXyEMFnRzP9KqMJ4C","type":"assistant","uuid":"b71db2bc-d229-4b3a-9f70-bff190c61a8f","timestamp":"2026-01-29T16:22:03.999Z"}
