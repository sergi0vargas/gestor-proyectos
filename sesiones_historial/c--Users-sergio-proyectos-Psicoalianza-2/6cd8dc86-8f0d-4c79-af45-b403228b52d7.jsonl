{"type":"file-history-snapshot","messageId":"50f66ef9-ae3c-47be-a66c-b79ae4fc7bed","snapshot":{"messageId":"50f66ef9-ae3c-47be-a66c-b79ae4fc7bed","trackedFileBackups":{},"timestamp":"2026-02-11T12:27:24.625Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":"quiero guardar el objeto que se envia en log para la ruta (sso/wordpress) al final del archivo @routes/web.php "},"uuid":"50f66ef9-ae3c-47be-a66c-b79ae4fc7bed","timestamp":"2026-02-11T12:27:24.623Z","thinkingMetadata":{"maxThinkingTokens":31999},"todos":[],"permissionMode":"default"}
{"parentUuid":"50f66ef9-ae3c-47be-a66c-b79ae4fc7bed","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01K4RXGtjy1SGQ1HMPBjs9W4","type":"message","role":"assistant","content":[{"type":"text","text":"\n\n"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":52988,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":52988},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2HDQ37nxakohAjGg2NB","type":"assistant","uuid":"bd54073d-c6b2-47d1-8d28-55ef1fec4b3a","timestamp":"2026-02-11T12:27:27.213Z"}
{"parentUuid":"bd54073d-c6b2-47d1-8d28-55ef1fec4b3a","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01K4RXGtjy1SGQ1HMPBjs9W4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to add logging of the payload object that is sent in the SSO/WordPress route at the end of the `routes/web.php` file. Let me look at the route and add a `Log::info()` or similar to log the payload before the redirect.\n\nLet me add a log statement for the `$payload` object in the SSO route.","signature":"EtkDCkYICxgCKkC+12u6gXwN9eJk6CgPTqUxStL0R3onpz25QjgeryGe6KnKIo6dQamaBycxhfes/mgZvoLQ4ndsCOQRNe1pQKZQEgwRPQw2OHYASYifQfMaDNBB4ZvI0y1nPgf7hCIwD5/cf8YAWEWpjxLOStiHs4/dSKaPmBBXPHD3dqQ7q3vrm8DB1xvQNdDWyG73IeVqKsACZREbI2FRmEJGSdt48sjXW8SwDv2g8F0i9lYCR5Lc78nfZat3lHPO1AKF4+YK8q7mXcmLEAMCDKpBNqayrIJKMn6bVtZ17uHU9ruMVoHizbajO5J1X5g96AEdqbp+3rSLGqFTINukteO/EuPBMLnIIXhW15aJGXvfwUuaDs3kl079CnW1Rqf5Pck/7jhALjeUpzxc9Wa0PxkLQxyf+K1znh1rPg1GVx+x334GvHmCswKhx7LrwUvffz9DER+pDEvviClm419mZ6+RzMpLQBHlnl81dcBTDrPG2pKhW91Km7XJjXD88f4Adg9jeRKi454iXh1cxNmIdo5V64hUERphDVYQ4YH9YgyxF+d31x+1LKUcS8Bqk2qJEYM+4NIK23M8ZV5TOR3DnGBClpmsZ2EAy9tNL7Fin+MhO+R3K5VtyEEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":52988,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":52988},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2HDQ37nxakohAjGg2NB","type":"assistant","uuid":"ce0004b2-cf76-46e9-a43c-5d4a9745ffac","timestamp":"2026-02-11T12:27:29.371Z"}
{"type":"file-history-snapshot","messageId":"51a70888-3686-4649-8123-f062f4dd6df1","snapshot":{"messageId":"50f66ef9-ae3c-47be-a66c-b79ae4fc7bed","trackedFileBackups":{"routes\\web.php":{"backupFileName":"8d4f24f72d6f32f1@v1","version":1,"backupTime":"2026-02-11T12:27:32.518Z"}},"timestamp":"2026-02-11T12:27:24.625Z"},"isSnapshotUpdate":true}
{"parentUuid":"ce0004b2-cf76-46e9-a43c-5d4a9745ffac","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01K4RXGtjy1SGQ1HMPBjs9W4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BZCd8CergnjKSJzYRm4E5v","name":"Edit","input":{"replace_all":false,"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","old_string":"    $token    = sso_sign_token($payload, config('services.sso.secret'));","new_string":"    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":52988,"cache_read_input_tokens":0,"output_tokens":268,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":52988,"ephemeral_5m_input_tokens":0}}},"requestId":"req_011CY2HDQ37nxakohAjGg2NB","type":"assistant","uuid":"51a70888-3686-4649-8123-f062f4dd6df1","timestamp":"2026-02-11T12:27:31.841Z"}
{"parentUuid":"51a70888-3686-4649-8123-f062f4dd6df1","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01BZCd8CergnjKSJzYRm4E5v","toolUseID":"toolu_01BZCd8CergnjKSJzYRm4E5v","timestamp":"2026-02-11T12:27:32.535Z","uuid":"caeec7f3-29fb-49a5-ac0e-113e989a5b81"}
{"parentUuid":"51a70888-3686-4649-8123-f062f4dd6df1","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BZCd8CergnjKSJzYRm4E5v","type":"tool_result","content":"The file C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php has been updated successfully."}]},"uuid":"1f48044c-ece6-456b-a445-e3dcfadf61be","timestamp":"2026-02-11T12:27:32.532Z","toolUseResult":{"filePath":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","oldString":"    $token    = sso_sign_token($payload, config('services.sso.secret'));","newString":"    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));","originalFile":"<?php\n\nuse Illuminate\\Support\\Str;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\{Auth, Cache, Route};\n\nRoute::get('/', function () {\n    return redirect()->route('login');\n});\n\nAuth::routes(['register' => false]);\n\n// Rutas de acceso para aplicante.\nRoute::group([\n    'prefix'    => 'control-acceso',\n    'namespace' => 'App\\Http\\Controllers\\Auth'\n], function ($ruta) {\n    $ruta->get('/acceso-expirado', 'LoginController@accesoExpirado')->name('control-acceso.token-expirado');\n    $ruta->get('/{token}', 'LoginController@controlarAcceso')->name('control-acceso');\n    $ruta->post('/login-automatico/{token}', 'LoginController@loginAutomatico')->name('control-acceso.login-automatico');\n});\n\n// Rutas de migración de usuarios desde la base de datos antigua.\nRoute::group([\n    'prefix'    => 'migrar-usuario-app-antigua',\n    'namespace' => 'App\\Http\\Controllers\\Usuarios'\n], function ($ruta) {\n    $ruta->get('/', 'UserController@migrarUsuario')->name('migrar-usuario-app-antigua')->middleware('validar-usuario-app-antigua');\n    $ruta->get('/error', 'UserController@migrarUsuarioError')->name('migrar-usuario-app-antigua.error');\n});\n\n// Rutas protegidas por autenticación y cambio de selección de rol y empresa.\nRoute::group([\n    'prefix'     => 'rol-empresa',\n    'namespace'  => 'App\\Http\\Controllers\\Auth',\n    'middleware' => ['auth', 'auth.cambio-rol-empresa']\n], function ($ruta) {\n    $ruta->get('/', 'RolController@formularioRolEmpresa')->name('rol-empresa');\n    $ruta->post('/sesion', 'RolController@guardarRolEmpresaSesion')->name('rol-empresa.guardar-en-sesion');\n});\n\n// Rutas protegidas por autenticación y selección de rol y empresa.\nRoute::group([\n    'middleware' => ['auth', 'auth.rol-empresa'],\n    'namespace'  => 'App\\Http\\Controllers'\n], function ($ruta) {\n    $ruta->get('usuario-validar-informacion-basica', 'Usuarios\\UserController@validarInformacionBasica');\n\n    $ruta->group(['middleware' => 'can:tablero'], function ($ruta) {\n        $ruta->get('inicio', 'DashboardController@index')->middleware('validar-datos-completados-usuario')->name('inicio');\n        $ruta->get('inicio-datos-panel', 'DashboardController@obtenerDatosPanel');\n\n        $ruta->group(['middleware' => 'can:tablero.usuarios'], function ($ruta) {\n            // Usuarios\n            $ruta->resource('usuarios', 'Usuarios\\UserController')->except(['index']);\n            $ruta->patch('usuarios-actualizar-multiples', 'Usuarios\\UserController@actualizarMultiples');\n            $ruta->post('usuarios-eliminar-multiples', 'Usuarios\\UserController@eliminarMultiples');\n            $ruta->post('usuarios-generar-acceso', 'Usuarios\\UserController@generarAcceso');\n            $ruta->get('usuarios-historial-cambios/{id}', 'Usuarios\\UserController@historialCambios');\n            $ruta->post('usuarios-historial-cambios-exportar/{id}', 'Usuarios\\UserController@exportarExcelHistorialCambios');\n            $ruta->get('usuarios-listado', 'Usuarios\\UserController@listado');\n            $ruta->get('usuarios-listado-empresa', 'Usuarios\\UserController@listadoAsociadosEmpresa');\n            $ruta->get('usuario', 'Usuarios\\UserController@obtenerUsuario');\n            $ruta->get('aplicante-informacion-personal/{id}', 'Usuarios\\UserController@informacionPersonalAplicante');\n            $ruta->post('usuario-actualizar-imagen', 'Usuarios\\UserController@actualizarImagenUsuario');\n            $ruta->get('usuario-notificaciones', 'Usuarios\\UserController@notificaciones');\n            $ruta->post('usuario-marcar-notificaciones-leidas', 'Usuarios\\UserController@marcarNotificacionesLeidas');\n            $ruta->post('exportar-excel-usuarios-empresa', 'Usuarios\\UserController@exportarExcelUsuariosEmpresa');\n\n            $ruta->post('usuarios-generar-qr-google', 'Usuarios\\UserController@obtenerQrGoogle');\n            $ruta->post('usuarios-validar-codigo-otp-google', 'Usuarios\\UserController@validarCodigoOtp');\n            $ruta->delete('usuarios-eliminar-clave-secreta-google/{id}', 'Usuarios\\UserController@eliminarClaveSecreta');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:pruebas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:pruebas.pruebas'], function ($ruta) {\n            // Pruebas\n            $ruta->get('pruebas/lista', 'Pruebas\\PruebaController@lista');\n            $ruta->resource('pruebas', 'Pruebas\\PruebaController');\n            $ruta->get('pruebas-listado', 'Pruebas\\PruebaController@listado');\n            $ruta->get('pruebas/{id}/factores', 'Pruebas\\PruebaController@getFactores');\n            $ruta->get('pruebas/{id}/reactivos', 'Pruebas\\PruebaController@getReactivos');\n            $ruta->post('pruebas-exportar', 'Pruebas\\PruebaController@exportarExcel');\n            $ruta->get('pruebas-conteo/{tipo_prueba_id}', 'Pruebas\\PruebaController@contarPruebasPorTipo');\n            $ruta->put('pruebas-archivar', 'Pruebas\\PruebaController@archivar');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.carga-masiva'], function ($ruta) {\n            // Carga masiva de pruebas\n            $ruta->get('carga-masiva', 'Pruebas\\PruebaController@cargaMasiva');\n            $ruta->post('carga-masiva-exportar', 'Pruebas\\PruebaController@exportarExcelCargaMasiva');\n            $ruta->post('carga-masiva-importar', 'Pruebas\\PruebaController@importarExcelCargaMasiva');\n            $ruta->post('pruebas-completas-exportar', 'Pruebas\\PruebaController@descargarPruebasCompletas');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.baremos'], function ($ruta) {\n            // Baremos\n            $ruta->get('baremos/lista', 'Pruebas\\BaremoController@lista');\n            $ruta->resource('baremos', 'Pruebas\\BaremoController');\n            $ruta->post('baremos-exportar', 'Pruebas\\BaremoController@exportarExcel');\n            $ruta->post('baremos-calcular', 'Pruebas\\BaremoController@calcularBaremos');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.dimensiones'], function ($ruta) {\n            // Dimensiones\n            $ruta->get('dimensiones/lista', 'Pruebas\\DimensionController@lista');\n            $ruta->get('dimensiones-listado', 'Pruebas\\DimensionController@listado');\n            $ruta->resource('dimensiones', 'Pruebas\\DimensionController');\n            $ruta->get('dimensiones-prueba/{id_prueba}', 'Pruebas\\DimensionController@getDimensionesPrueba');\n            $ruta->post('dimensiones-exportar', 'Pruebas\\DimensionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.factores'], function ($ruta) {\n            // Factores\n            $ruta->get('factores/lista', 'Pruebas\\FactorController@lista');\n            $ruta->get('factores-listado', 'Pruebas\\FactorController@listado');\n            $ruta->resource('factores', 'Pruebas\\FactorController');\n            $ruta->post('factores-exportar', 'Pruebas\\FactorController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.reactivos'], function ($ruta) {\n            // Reactivos\n            $ruta->get('reactivos-listado', 'Pruebas\\ReactivoController@listado');\n            $ruta->resource('reactivos', 'Pruebas\\ReactivoController');\n            $ruta->post('reactivos-exportar', 'Pruebas\\ReactivoController@exportarExcel');\n\n            // Opciones\n            $ruta->get('opciones-reactivo/{id_reactivo}', 'Pruebas\\OpcionController@getOpcionesReactivo');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.calificaciones'], function ($ruta) {\n            // Calificaciones\n            $ruta->get('calificaciones/lista', 'Pruebas\\CalificacionController@lista');\n            $ruta->resource('calificaciones', 'Pruebas\\CalificacionController');\n            $ruta->post('calificaciones-exportar', 'Pruebas\\CalificacionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.grupos-opciones'], function ($ruta) {\n            // Grupos de opciones\n            $ruta->get('grupos-opciones/lista', 'Pruebas\\GrupoOpcionController@lista');\n            $ruta->resource('grupos-opciones', 'Pruebas\\GrupoOpcionController');\n            $ruta->post('grupos-opciones-exportar', 'Pruebas\\GrupoOpcionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.secciones-textos'], function ($ruta) {\n            // Secciones de texto\n            $ruta->get('secciones-textos/lista', 'Reportes\\SeccionTextoController@lista');\n            $ruta->resource('secciones-textos', 'Reportes\\SeccionTextoController');\n            $ruta->post('secciones-textos-exportar', 'Reportes\\SeccionTextoController@exportarExcel');\n        });\n\n        $ruta->get('resultados-proceso-prueba-usuario', 'Pruebas\\PruebaController@obtenerResultadosProcesoPruebaUsuario');\n    });\n\n    $ruta->group(['middleware' => 'can:adicional-pruebas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:adicional-pruebas.perfiles'], function ($ruta) {\n            // Perfiles\n            $ruta->get('perfiles-listado-tabla', 'Pruebas\\PerfilController@getDatatable');\n            $ruta->post('perfiles-exportar', 'Pruebas\\PerfilController@exportarExcel');\n            $ruta->get('perfiles-agrupados-por-prueba', 'Pruebas\\PerfilController@agrupadosPorPrueba');\n        });\n\n        $ruta->group(['middleware' => 'can:adicional-pruebas.modulos-preguntas'], function ($ruta) {\n            // Módulos de preguntas\n            $ruta->resource('modulos-preguntas', 'Pruebas\\ModuloPreguntaController');\n            $ruta->get('modulos-preguntas-listado-tabla', 'Pruebas\\ModuloPreguntaController@getDatatable');\n            $ruta->get('modulos-preguntas-grupos/{prueba_id}', 'Pruebas\\ModuloPreguntaController@getGruposPorPrueba');\n            $ruta->post('modulos-preguntas-exportar', 'Pruebas\\ModuloPreguntaController@exportarExcel');\n            $ruta->post('ckeditor-upload-image', 'Pruebas\\ModuloPreguntaController@uploadImageCKEditor');\n        });\n\n        $ruta->group(['middleware' => 'can:adicional-pruebas.demograficas'], function ($ruta) {\n            // Demográficas\n            $ruta->resource('demograficas', 'Pruebas\\DemograficaController');\n            $ruta->get('demograficas-listado-tabla', 'Pruebas\\DemograficaController@getDatatable');\n            $ruta->post('demograficas-exportar', 'Pruebas\\DemograficaController@exportarExcel');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:empresas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:empresas.listado-empresas'], function ($ruta) {\n            // Listado de empresas\n            $ruta->resource('empresas', 'Empresas\\EmpresaController');\n            $ruta->get('empresas-archivadas', 'Empresas\\EmpresaController@index');\n            $ruta->get('empresas-listado', 'Empresas\\EmpresaController@listado');\n            $ruta->get('empresas-listado-tabla', 'Empresas\\EmpresaController@getDatatable');\n            $ruta->get('empresas-listado-sucursales', 'Empresas\\EmpresaController@listadoSucursales');\n            $ruta->get('sucursales/create', 'Empresas\\EmpresaController@create')->name('crear.sucursal');\n            $ruta->get('sucursales/{id}/edit', 'Empresas\\EmpresaController@edit')->name('editar.sucursal');\n            $ruta->get('empresas-historial-cambios/{id}', 'Empresas\\EmpresaController@historialCambios');\n            $ruta->post('empresas-historial-cambios-exportar/{id}', 'Empresas\\EmpresaController@exportarExcelHistorialCambios');\n            $ruta->delete('empresas-eliminar-logo/{id}', 'Empresas\\EmpresaController@eliminarLogo');\n            $ruta->post('generar-enlace-creacion/{empresa_plan_id?}', 'Empresas\\EmpresaEnlaceCreacionController@generar');\n            $ruta->post('empresas-exportar', 'Empresas\\EmpresaController@exportarExcel');\n            $ruta->post('sucursales-exportar', 'Empresas\\EmpresaController@exportarExcelSucursales');\n            $ruta->get('empresas-propietario/{id}', 'Empresas\\EmpresaController@obtenerPropietario');\n            $ruta->get('sucursales', 'Empresas\\EmpresaController@sucursales');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.gestionar-empresas'], function ($ruta) {\n            // Gestionar empresas\n            $ruta->get('empresas-gestionar/{id?}/{submenu_vista?}', 'Empresas\\EmpresaController@gestionar');\n            $ruta->get('empresas-gestionar-datos/{id}', 'Empresas\\EmpresaController@datosGestionar');\n            $ruta->get('empresas-gestionar-sucursal/{id}', 'Empresas\\EmpresaController@gestionarSucursal');\n            $ruta->patch('empresas-contactos/{id}', 'Empresas\\EmpresaController@guardarContactos');\n\n            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.usuarios'], function ($ruta) {\n                // Usuarios\n                $ruta->get('usuarios-clientes', 'Usuarios\\UserController@index');\n                $ruta->get('usuarios-clientes-listado', 'Usuarios\\UserController@usuariosClientesListado');\n            });\n\n            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.planes'], function ($ruta) {\n                // Planes\n                $ruta->get('planes-clientes', 'Planes\\PlanController@planesClientes');\n                $ruta->get('listado-planes-cliente', 'Planes\\PlanController@listadoPlanesEmpresa');\n            });\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.archivo-empresas'], function ($ruta) {\n            // Archivo de empresas\n            $ruta->patch('empresas-archivos/{id}', 'Empresas\\EmpresaController@guardarArchivos');\n            $ruta->post('empresas-archivar/{id}', 'Empresas\\EmpresaController@archivar');\n            $ruta->get('empresas-detalle-archivado/{id}', 'Empresas\\EmpresaController@detalleArchivado');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.migracion-empresas'], function ($ruta) {\n            // Migración de empresas\n            $ruta->get('empresas-migracion', 'Empresas\\MigracionEmpresaController@index');\n            $ruta->post('empresas-migracion/buscar', 'Empresas\\MigracionEmpresaController@buscarEmpresa');\n            $ruta->post('empresas-migracion/validar-tamano', 'Empresas\\MigracionEmpresaController@validarTamanoEmpresa');\n            $ruta->post('empresas-migracion/iniciar', 'Empresas\\MigracionEmpresaController@iniciarMigracion');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.portales-empleo'], function ($ruta) {\n            // Portales de empleo\n            $ruta->get('portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n            $ruta->get('empresa-portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n            $ruta->post('portales-empleos', 'Empresas\\PortalEmpleoController@store')->name('portales-empleos.store');\n            $ruta->patch('portales-empleos/{id}', 'Empresas\\PortalEmpleoController@update')->name('portales-empleos.update');\n\n            // Premios destacados\n            $ruta->post('premios-destacados', 'Empresas\\PremioDestacadoController@store')->name('premios-destacados.store');\n            $ruta->delete('premios-destacados/{id}', 'Empresas\\PremioDestacadoController@destroy')->name('premios-destacados.destroy');\n\n            // Motivadores\n            $ruta->post('motivadores', 'Empresas\\MotivadorController@store');\n        });\n\n        $ruta->get('datos-empresa', 'Empresas\\EmpresaController@obtenerDatosEmpresa');\n        $ruta->get('empresa', 'DashboardController@paginaEmpresa');\n        $ruta->get('empresa-cambiar-logo', 'Empresas\\EmpresaController@paginaEmpresaCambiarImagen');\n    });\n\n    $ruta->group(['middleware' => 'can:ajustes-sistema.general.plantillas'], function ($ruta) {\n        $ruta->resource('plantillas-correos', 'Configuraciones\\PlantillaCorreoController')->except(['create', 'store', 'edit', 'destroy']);\n        $ruta->get('listado-plantillas-correos', 'Configuraciones\\PlantillaCorreoController@listado');\n        $ruta->put('plantillas-correos-restablecer/{id}', 'Configuraciones\\PlantillaCorreoController@restablecerPorDefecto');\n        $ruta->get('variables', 'Configuraciones\\VariableController@listado');\n    });\n\n    $ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n        // Planes\n        $ruta->resource('planes', 'Planes\\PlanController');\n        $ruta->get('planes-listado', 'Planes\\PlanController@listado');\n        $ruta->post('planes-exportar', 'Planes\\PlanController@exportarExcel');\n        $ruta->get('datos-empresas-planes', 'Empresas\\EmpresaPlanController@planesEmpresas');\n        $ruta->post('exportar-datos-empresas-planes', 'Empresas\\EmpresaPlanController@exportarExcelEmpresasPlanesEmpresas');\n        $ruta->get('empresas-planes-listado-tabla/{empresa_id}', 'Empresas\\EmpresaPlanController@datosTabla');\n        $ruta->resource('empresas-planes', 'Empresas\\EmpresaPlanController', ['only' => ['show', 'store', 'update', 'edit', 'destroy']]);\n        $ruta->get('asignar-plan/{empresa_id}', 'Empresas\\EmpresaPlanController@formularioAsignar');\n        $ruta->patch('empresas-planes-actualizar/{id}', 'Empresas\\EmpresaPlanController@actualizarInformacion');\n        $ruta->post('planes-clonar/{id}', 'Planes\\PlanController@clonar');\n        $ruta->get('planes-historial-cambios/{id}', 'Planes\\PlanController@historialCambios');\n        $ruta->get('funcionalidades-planes-historial-cambios/{plan_id}', 'Planes\\FuncionalidadPlanController@historialCambiosPorPlan');\n        $ruta->get('funcionalidades-listado', 'Planes\\FuncionalidadController@listado');\n        $ruta->get('empresas-planes-funcionalidades-listado', 'Empresas\\EmpresaPlanFuncionalidadController@listado');\n        $ruta->post('solicitud-renovacion-plan', 'Empresas\\EmpresaPlanController@solicitudRenovacionPlan');\n        $ruta->post('empresas-planes-descargar-factura/{archivo_id}', 'Empresas\\EmpresaPlanController@descargarFactura');\n\n        // Planes de Créditos - Vista de creación\n        $ruta->resource('planes-creditos', 'Planes\\PlanCreditoController');\n        $ruta->resource('servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n        $ruta->get('servicios-ia/{id}/creditos', 'IA\\ServicioIAController@creditos');\n        $ruta->post('servicios-ia/{id}/activar', 'IA\\ServicioIAController@activar');\n        $ruta->post('servicios-ia/{id}/desactivar', 'IA\\ServicioIAController@desactivar');\n        $ruta->get('empresas/{empresa_id}/creditos', 'Empresas\\EmpresaPlanController@obtenerPlanCreditos');\n        $ruta->get('creditos-disponibles-empresas/{id}', 'Empresas\\EmpresaPlanController@obtenerCreditosDisponiblesEmpresa');\n        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\n        $ruta->resource('categorias-servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n\n        $ruta->group(['middleware' => 'can:planes-consumo.consumo'], function ($ruta) {\n            // Consumos\n            $ruta->get('consumos', 'Empresas\\EmpresaPlanController@index');\n            $ruta->get('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@formularioFacturar');\n            $ruta->put('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@facturar');\n            $ruta->get('planes-historial-recompras/{empresa_id?}', 'Empresas\\EmpresaPlanController@historialRecompras');\n            $ruta->get('planes-historial-recompras-creditos/{empresa_id}', 'Empresas\\EmpresaPlanController@historialComprasCreditos');\n            $ruta->post('planes-historial-recompras-exportar', 'Empresas\\EmpresaPlanController@exportarExcelHistorialRecompras');\n            $ruta->post('planes-historial-creditos-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelHistorialCreditos');\n            $ruta->post('consumos-creditos-ia-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelConsumosCreditosIA');\n            $ruta->get('consumos-agendas-empresa-plan', 'Planes\\ConsumoController@consumosAgendasDeEmpresaPlan');\n            $ruta->get('consumos-ofertas-laborales-empresa-plan', 'Planes\\ConsumoController@consumosOfertasLaboralesDeEmpresaPlan');\n            $ruta->get('consumos-usuarios-empresa', 'Planes\\ConsumoController@consumosUsuariosEmpresa');\n            $ruta->post('consumos-plan-prueba-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanPrueba');\n            $ruta->post('consumos-plan-oferta-laboral-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanOfertaLaboral');\n            $ruta->post('consumos-plan-usuarios-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanUsuarios');\n        });\n\n        $ruta->group(['middleware' => 'can:planes-consumo.archivo-planes'], function ($ruta) {\n            // Archivo\n            $ruta->get('planes-archivados', 'Planes\\PlanController@index');\n            $ruta->post('planes-archivar/{id}', 'Planes\\PlanController@archivar');\n        });\n    });\n\n    // Perfiles laborales\n    $ruta->post('perfiles-laborales', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@store');\n    $ruta->post('perfiles-laborales-leer-hv-ia', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@obtenerInformacionHVConIA');\n    $ruta->get('perfiles-laborales-consultar-usuario/{usuario_id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@consultarPerfilLaboralUsuario');\n    $ruta->put('perfiles-laborales/{id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@update');\n\n    // Preguntas de ofertas laborales\n    $ruta->get('preguntas-ofertas-laborales', 'OfertasLaborales\\PreguntaOfertaLaboralController@index');\n    $ruta->get('bienvenida-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasPrefiltro');\n    $ruta->get('responder-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasPrefiltro');\n    $ruta->get('finalizacion-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasPrefiltro');\n    $ruta->post('respuestas-preguntas-ofertas-laborales', 'OfertasLaborales\\RespuestaPreguntaOfertaLaboralController@store');\n    $ruta->get('verificar-etapa-completada/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@verificarEtapaCompletada');\n\n    // Preguntas de videoentrevista\n    $ruta->get('bienvenida-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasVideoentrevista');\n    $ruta->get('responder-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasvideoentrevista');\n    $ruta->get('previsualizacion-prueba-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@previsualizacionPruebaVideoentrevista');\n    $ruta->get('finalizacion-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasVideoentrevista');\n\n    // Vacantes\n    $ruta->post('generar-adecuacion-hv/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionHV');\n    $ruta->post('generar-adecuacion-prefiltro/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPrefiltro');\n    $ruta->post('generar-adecuacion-pruebas-psicometricas/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPruebasPsicometricas');\n    $ruta->post('generar-adecuacion-videoentrevista/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionVideoentrevista');\n    $ruta->post('guardar-puntaje-adecuacion-reclutador', 'Vacantes\\EtapaVacanteUsuarioController@guardarPuntajeAdecuacionReclutador');\n    $ruta->post('guardar-puntaje-pregunta-reclutador', 'OfertasLaborales\\PuntajePreguntaOfertaLaboralController@guardarPuntajeReclutador');\n    $ruta->resource('etapas-usuarios-comentarios', 'Vacantes\\EtapaUsuarioComentarioController')->only(['index', 'store']);\n    $ruta->get('obtener-adecuacion-usuario', 'Vacantes\\EtapaVacanteUsuarioController@obtenerAdecuacionUsuario');\n    $ruta->get('obtener-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCandidatosRecomendadosIA');\n    $ruta->post('preguntar-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@preguntarSobreCandidatosRecomendados');\n    $ruta->post('vacantes-descargar-reporte-respuesta-ia', 'Vacantes\\VacanteController@descargarReporteRespuestaIA');\n    $ruta->post('vacantes-clonar-aplicante', 'Vacantes\\VacanteController@clonarAplicante');\n    $ruta->post('vacantes-exportar-archivos-aplicante/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@exportarArchivosZip');\n\n    $ruta->resource('formatos-entrevistas', 'Vacantes\\FormatoEntrevistaController')->except(['destroy']);\n\n    $ruta->patch('roles/actualizar-permisos/{rol}', 'Auth\\RolController@actualizarPermisos');\n    $ruta->patch('roles/restablecer-permisos/{rol}', 'Auth\\RolController@restablecerPermisos');\n\n    $ruta->group(['middleware' => 'can:ajustes-sistema'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:ajustes-sistema.general'], function ($ruta) {\n            // Ajustes - General\n            $ruta->get('ajustes', 'Configuraciones\\ConfiguracionController@paginaAjustesGenerales');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.roles-permisos'], function ($ruta) {\n            // Ajustes - Roles y permisos\n            $ruta->get('roles', 'Auth\\RolController@index');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.deshacer-acciones'], function ($ruta) {\n            // Ajustes - Deshacer acciones\n            $ruta->post('agendas-restablecer/{id}', 'Agendas\\AgendaController@restablecerAgenda');\n            $ruta->post('agendas-validar-exportacion', 'Configuraciones\\ConfiguracionController@validarAgendaExportacion');\n            $ruta->post('agendas-exportar-respuestas', 'Configuraciones\\ConfiguracionController@exportarRespuestasAgenda');\n            $ruta->get('deshacer-acciones', 'Configuraciones\\ConfiguracionController@deshacerAcciones');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.anuncios-novedades'], function ($ruta) {\n            // Ajustes - Ofertas y anuncios\n            $ruta->resource('anuncios', 'Configuraciones\\AnuncioController');\n            $ruta->get('anuncios-listado-tabla', 'Configuraciones\\AnuncioController@datosTabla');\n            $ruta->get('anuncios-disponibilidad-fechas', 'Configuraciones\\AnuncioController@validarDisponibilidadFechas');\n            $ruta->delete('anuncios-eliminar-varios', 'Configuraciones\\AnuncioController@eliminarVarios');\n            $ruta->put('anuncios-cambiar-estado/{id}', 'Configuraciones\\AnuncioController@cambiarEstado');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.psicoacademy'], function ($ruta) {\n            // Webinars\n            $ruta->resource('webinars', 'PsicoAcademy\\WebinarController')->except(['show']);\n            $ruta->get('webinars-listado-tabla', 'PsicoAcademy\\WebinarController@datosTabla');\n            $ruta->get('webinars-borrador/{tipo}', 'PsicoAcademy\\WebinarController@borrador');\n            $ruta->post('webinars-borrador', 'PsicoAcademy\\WebinarController@guardarBorrador');\n            $ruta->put('webinars-modificar-masivo/{tipo}', 'PsicoAcademy\\WebinarController@modificarMasivo');\n            $ruta->get('webinars-filtros', 'PsicoAcademy\\WebinarController@filtrosAplicados');\n\n            // Eventos\n            $ruta->resource('eventos', 'PsicoAcademy\\EventoController');\n            $ruta->get('eventos-listado-tabla', 'PsicoAcademy\\EventoController@datosTabla');\n            $ruta->get('eventos-borrador/{tipo}', 'PsicoAcademy\\EventoController@borrador');\n            $ruta->post('eventos-borrador', 'PsicoAcademy\\EventoController@guardarBorrador');\n            $ruta->get('eventos-filtros', 'PsicoAcademy\\EventoController@filtrosAplicados');\n            $ruta->get('eventos-listado', 'PsicoAcademy\\EventoController@listado');\n\n            // Guías\n            $ruta->resource('guias', 'PsicoAcademy\\GuiaController');\n            $ruta->get('guias-listado-tabla', 'PsicoAcademy\\GuiaController@datosTabla');\n            $ruta->get('guias-borrador/{tipo}', 'PsicoAcademy\\GuiaController@borrador');\n            $ruta->post('guias-borrador', 'PsicoAcademy\\GuiaController@guardarBorrador');\n            $ruta->delete('guias-borrar-archivo/{id}', 'PsicoAcademy\\GuiaController@borrarArchivo');\n            $ruta->get('guias-filtros', 'PsicoAcademy\\GuiaController@filtrosAplicados');\n\n            // Tutoriales\n            $ruta->resource('tutoriales', 'PsicoAcademy\\TutorialController');\n            $ruta->get('tutoriales-listado-tabla', 'PsicoAcademy\\TutorialController@datosTabla');\n            $ruta->get('tutoriales-borrador/{tipo}', 'PsicoAcademy\\TutorialController@borrador');\n            $ruta->post('tutoriales-borrador', 'PsicoAcademy\\TutorialController@guardarBorrador');\n            $ruta->get('tutoriales-filtros', 'PsicoAcademy\\TutorialController@filtrosAplicados');\n\n            // Podcast\n            $ruta->resource('podcast', 'PsicoAcademy\\PodcastController');\n            $ruta->get('podcast-listado-tabla', 'PsicoAcademy\\PodcastController@datosTabla');\n            $ruta->get('podcast-borrador/{tipo}', 'PsicoAcademy\\PodcastController@borrador');\n            $ruta->post('podcast-borrador', 'PsicoAcademy\\PodcastController@guardarBorrador');\n            $ruta->get('podcast-filtros', 'PsicoAcademy\\PodcastController@filtrosAplicados');\n\n            // Capacitación\n            $ruta->resource('capacitaciones', 'PsicoAcademy\\CapacitacionController');\n            $ruta->get('capacitaciones-listado-tabla', 'PsicoAcademy\\CapacitacionController@datosTabla');\n            $ruta->get('capacitaciones-borrador/{tipo}', 'PsicoAcademy\\CapacitacionController@borrador');\n            $ruta->post('capacitaciones-borrador', 'PsicoAcademy\\CapacitacionController@guardarBorrador');\n            $ruta->get('capacitaciones-filtros', 'PsicoAcademy\\CapacitacionController@filtrosAplicados');\n\n            // Certificación\n            $ruta->resource('certificaciones', 'PsicoAcademy\\CertificacionController');\n            $ruta->get('certificaciones-listado-tabla', 'PsicoAcademy\\CertificacionController@datosTabla');\n            $ruta->put('certificaciones-modificar-masivo/{tipo}', 'PsicoAcademy\\CertificacionController@modificarMasivo');\n            $ruta->get('certificaciones-borrador/{tipo}', 'PsicoAcademy\\CertificacionController@borrador');\n            $ruta->post('certificaciones-borrador', 'PsicoAcademy\\CertificacionController@guardarBorrador');\n            $ruta->get('certificaciones-filtros', 'PsicoAcademy\\CertificacionController@filtrosAplicados');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:soporte'], function ($ruta) {\n        // Soportes\n        $ruta->resource('soportes', 'Soportes\\SoporteController');\n        $ruta->post('soportes/subida-imagenes', 'Soportes\\SoporteController@subidaImagenes');\n        $ruta->get('soportes-listado-tabla', 'Soportes\\SoporteController@datosTabla');\n        $ruta->patch('soportes-actualizar/{id}', 'Soportes\\SoporteController@actualizarInformacion');\n        $ruta->get('soportes-contiguo/{id}', 'Soportes\\SoporteController@soporteContiguo');\n        $ruta->post('soportes-exportar', 'Soportes\\SoporteController@exportarExcel');\n        $ruta->resource('mensajes-soportes', 'Soportes\\MensajeSoporteController', ['only' => ['store', 'update', 'destroy']]);\n        $ruta->patch('mensajes-soportes-leidos/{id}', 'Soportes\\MensajeSoporteController@marcarMensajesLeidos');\n        $ruta->get('mensajes-soportes-listado-tabla', 'Soportes\\MensajeSoporteController@datosTabla');\n        $ruta->put('soportes-cambiar-estado', 'Soportes\\SoporteController@cambiarEstado');\n\n        // Manuales\n        $ruta->resource('manuales', 'Tutoriales\\ManualController');\n        $ruta->get('manuales-listado-tabla', 'Tutoriales\\ManualController@datosTabla');\n\n        $ruta->group(['middleware' => 'can:soporte.soporte-aplicantes'], function ($ruta) {\n            // Aplicantes\n            $ruta->get('soportes-aplicantes', 'Soportes\\SoporteController@index')->name('soportes.aplicantes');\n        });\n\n        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes'], function ($ruta) {\n            // Preguntas frecuentes\n            $ruta->resource('preguntas-frecuentes', 'Soportes\\PreguntaFrecuenteController');\n            $ruta->patch('preguntas-frecuentes-actualizar/{id}', 'Soportes\\PreguntaFrecuenteController@actualizarInformacion');\n            $ruta->patch('preguntas-frecuentes-ordenar/{id}/{orden}', 'Soportes\\PreguntaFrecuenteController@cambiarOrden');\n            $ruta->get('preguntas-frecuentes-listado-tabla', 'Soportes\\PreguntaFrecuenteController@listado');\n            $ruta->patch('preguntas-frecuentes-visualizaciones/{id}', 'Soportes\\PreguntaFrecuenteController@incrementarVisualizaciones');\n        });\n\n        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes.reaccionar'], function ($ruta) {\n            // Preguntas frecuentes reacciónes\n            $ruta->post('preguntas-frecuentes-reacciones', 'Soportes\\PreguntaFrecuenteReaccionController@guardarReaccion');\n        });\n    });\n\n    // Esta ruta debe ser asequible para los usuarios de todos los roles.\n    $ruta->post('configuraciones-modelos', 'Configuraciones\\ConfiguracionModeloController@store');\n    $ruta->get('configuraciones-obtener', 'Configuraciones\\ConfiguracionModeloController@obtenerConfiguracion');\n\n    $ruta->group(['middleware' => 'auth.rol-tipo-superadmin'], function ($ruta) {\n        // Módulos\n        $ruta->get('modulos/{id}', 'Planes\\ModuloController@show');\n        $ruta->get('modulos-listado', 'Planes\\ModuloController@listado');\n\n        // Auditorías\n        $ruta->get('auditorias-ultimo', 'Auditorias\\AuditController@obtenerUltimo');\n\n        // Accesos\n        $ruta->get('accesos-datos-mapa', 'Accesos\\AccesoController@datosMapa');\n\n        // Registros de actividad\n        $ruta->get('actividades-datos-mapa', 'Configuraciones\\ActividadController@datosMapa');\n\n        // Novedades\n        $ruta->resource('novedades', 'Configuraciones\\NovedadController')->except(['index', 'show', 'create', 'store', 'destroy']);\n        $ruta->post('novedades-restablecer/{id}', 'Configuraciones\\NovedadController@restablecer');\n        $ruta->post('novedades-pdf/{id}', 'Configuraciones\\NovedadController@descargarPDF');\n\n        // Países\n        $ruta->resource('paises', 'Configuraciones\\PaisController')->except(['show', 'destroy']);\n        $ruta->resource('departamentos', 'Configuraciones\\DepartamentoController')->except(['show', 'destroy']);\n        $ruta->get('departamentos-listado-tabla', 'Configuraciones\\DepartamentoController@datosTabla');\n        $ruta->resource('ciudades', 'Configuraciones\\CiudadController')->except(['show', 'destroy']);\n        $ruta->get('ciudades-listado-tabla', 'Configuraciones\\CiudadController@datosTabla');\n\n        // Reportes\n        $ruta->resource('reportes', 'Reportes\\ReporteController');\n        $ruta->resource('reportes-secciones', 'Reportes\\ReporteSeccionController')->only(['index']);\n        $ruta->resource('reportes-secciones-textos', 'Reportes\\ReporteSeccionTextoController')->only(['index']);\n\n        // Minería de datos.\n        $ruta->get('sesiones-listado', 'Auth\\SesionController@datosTabla');\n        $ruta->get('mineria-datos', 'DashboardController@indexAnaliticaMineriaDatos');\n\n        // Pruebas completas\n        $ruta->post('pruebas-completas-crear', 'Pruebas\\PruebaController@crearPruebaCompleta');\n        $ruta->get('pruebas-completas/{id}', 'Pruebas\\PruebaController@pruebaCompleta');\n        $ruta->get('pruebas-completas', 'Pruebas\\PruebaController@vistaPruebaCompleta');\n        $ruta->get('pruebas-completas-pagina-crear', 'Pruebas\\PruebaController@crearPrueba');\n        $ruta->get('pruebas-completas/{id}/editar', 'Pruebas\\PruebaController@editarPrueba');\n    });\n\n    $ruta->group(['middleware' => 'auth.rol-tipo-empresa'], function ($ruta) {\n        // Ordenes de servicio\n        // $ruta->resource('ordenes-servicio', 'OrdenesServicios\\OrdenServicioController'); // Se deja comentada temporalmente hasta que se retome ATS\n        $ruta->get('ordenes-servicio-generar-enlace-publico', 'OrdenesServicios\\OrdenServicioEnlaceCreacionController@generar');\n        $ruta->get('ordenes-servicio-listado-tabla', 'OrdenesServicios\\OrdenServicioController@datosTabla');\n\n        // Ofertas laborales\n        $ruta->get('ofertas-laborales/sin-disponibilidad', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles');\n        $ruta->get('ofertas-laborales/sin-plan-seleccion', 'OfertasLaborales\\OfertaLaboralController@sinPlanSeleccion');\n        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->only(['create', 'store'])->middleware('disponibilidad-ofertas-laborales');\n        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->except(['create', 'store']);\n        $ruta->post('exportar-excel-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@exportarExcelOfertasLaborales');\n        $ruta->get('ofertas-laborales-listado-tabla', 'OfertasLaborales\\OfertaLaboralController@datosTabla');\n        $ruta->get('ofertas-laborales-detalles/{id}', 'OfertasLaborales\\OfertaLaboralController@detalles');\n        $ruta->get('sin-disponibilidad-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles')\n        ->name('sin-disponibilidad-ofertas-laborales');\n        $ruta->put('ofertas-laborales-cambiar-tipo-publicacion', 'OfertasLaborales\\OfertaLaboralController@cambiarTipoPublicacion');\n        $ruta->post('ofertas-laborales-compartir', 'OfertasLaborales\\OfertaLaboralController@compartirPorCorreo');\n        $ruta->get('ofertas-laborales-generar-qr/{id}', 'OfertasLaborales\\OfertaLaboralController@generarQR');\n        $ruta->get('ofertas-laborales/{id}/aplicantes', 'OfertasLaborales\\OfertaLaboralController@aplicantes');\n        $ruta->get('ofertas-laborales/{id}/aplicantes/{aplicante_id}', 'OfertasLaborales\\OfertaLaboralController@detallesAplicante');\n        $ruta->post('ofertas-laborales/generar-informacion-ia', 'OfertasLaborales\\OfertaLaboralController@generarInformacionIA');\n        $ruta->post('ofertas-laborales/generar-pruebas-ia', 'OfertasLaborales\\OfertaLaboralController@generarPruebasConIA');\n\n        // Vacantes\n        $ruta->resource('vacantes', 'Vacantes\\VacanteController')->except(['show', 'edit', 'update']);\n        $ruta->get('vacantes-listado-tabla', 'Vacantes\\VacanteController@datosTabla');\n\n        $ruta->group(['middleware' => 'validar-acceso-vacante'], function ($ruta) {\n            $ruta->get('vacantes-detalle/{id}', 'Vacantes\\VacanteController@paginaDetalle');\n            $ruta->resource('vacantes', 'Vacantes\\VacanteController')->only(['show', 'edit', 'update']);\n            $ruta->post('vacantes-completar/{id}', 'Vacantes\\VacanteController@completar');\n            $ruta->put('vacantes-cambiar-estado', 'Vacantes\\VacanteController@cambiarEstado');\n            $ruta->put('vacantes-archivar', 'Vacantes\\VacanteController@archivarVacante');\n            $ruta->get('etapas-vacantes-aplicantes/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerEtapasAplicantes');\n            $ruta->get('vacantes-detalle-aplicante/{vacante_id}/{usuario_id}', 'Vacantes\\VacanteController@obtenerDetalleAplicante');\n            $ruta->get('vacantes-listado-aplicantes/{vacante_id}', 'Vacantes\\VacanteController@obtenerListadoAplicantes');\n            $ruta->get('vacantes-calcular-dias-duracion-proceso/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDiasDuracionProceso');\n        });\n\n        $ruta->get('configuraciones-etapa-movimiento/{id}', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@index');\n        $ruta->post('etapas-movimientos-vacantes-configuraciones', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@store');\n        $ruta->get('etapas-vacantes', 'Vacantes\\EtapaVacanteController@index');\n        $ruta->put('etapas-vacantes/{id}', 'Vacantes\\EtapaVacanteController@update');\n        $ruta->get('vacantes-habilidades-herramientas', 'Vacantes\\VacanteController@obtenerHabilidadesHerramientas');\n        $ruta->put('etapas-vacantes-cambiar-orden', 'Vacantes\\EtapaVacanteController@cambiarOrden');\n        $ruta->post('vacantes-postular-aplicantes', 'Vacantes\\VacanteController@postularAplicantes');\n        $ruta->resource('documentos-solicitables', 'Vacantes\\DocumentoSolicitableController');\n        $ruta->post('vacantes-preguntas', 'Vacantes\\VacanteController@guardarPreguntas');\n        $ruta->post('etapas-vacantes-adjuntar-archivos', 'Vacantes\\EtapaVacanteController@adjuntarArchivosPruebaTecnica');\n        $ruta->delete('etapas-vacantes/{etapa_vacante_id}/eliminar-etapa-prueba-tecnica', 'Vacantes\\EtapaVacanteController@eliminarEtapaPruebaTecnica');\n        $ruta->get('etapas-vacantes/{etapa_vacante_id}/obtener-configuraciones-prueba-tecnica', 'Vacantes\\EtapaVacanteController@obtenerConfiguracionesPruebaTecnica');\n        $ruta->post('generar-vacante', 'Vacantes\\VacanteController@generarConIA');\n        $ruta->post('generar-preguntas-prefiltro', 'Vacantes\\VacanteController@generarPreguntasPrefiltro');\n        $ruta->post('generar-preguntas-videoentrevista', 'Vacantes\\VacanteController@generarPreguntasVideoentrevista');\n        $ruta->post('generar-pruebas-psicometricas', 'Vacantes\\VacanteController@generarPruebasPsicometricas');\n        $ruta->post('vacantes-duplicar', 'Vacantes\\VacanteController@duplicar');\n        $ruta->post('vacantes-descartar-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@descartarAplicantesManual');\n        $ruta->post('vacantes-mover-etapa-aplicante/{id}', 'Vacantes\\EtapaVacanteUsuarioController@moverAplicanteEtapaManual');\n        $ruta->get('vacantes-competencias-mejorar/{id}', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCompetenciasPorMejorar');\n        $ruta->post('vacantes-revertir-descarte-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@revertirDescarteAplicantes');\n        $ruta->post('vacantes-comparativo-basico-aplicantes', 'Vacantes\\VacanteController@generarReporteComparativoVacantes');\n\n        // TODO: Estos dos endpoints no están completos, el primero funciona pero no es lo que se necesita, hay que hacer que el segundo funcione como el primero\n        $ruta->get('resultados-coincidencia-oferta-laboral/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\MovimientoController@resultadosCoincidenciaUsuario');\n        $ruta->get('resultados-coincidencia-oferta-laboral-test/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\CategoriaAdecuacionController@resultadosCoincidenciaUsuario');\n\n        // TODO: Falta definir la ruta. No se sabe si existirá una ruta genérica que cambie a un aplicante de una etapa a otra dentro de una oferta laboral o\n        // si habrán varios end-points para cada una de las etapas que existirán dentro del proceso de contratación en una oferta laboral...\n        $ruta->post('ofertas-laborales-cambiar-usuario-etapa', 'OfertasLaborales\\OfertaLaboralController@cambiarUsuarioEtapa');\n\n        // Etapas\n        $ruta->resource('etapas', 'OfertasLaborales\\EtapaController')->only(['show', 'store', 'update', 'destroy']);\n        $ruta->get('etapas-listado', 'OfertasLaborales\\EtapaController@listado');\n        $ruta->post('movimientos-configuraciones', 'OfertasLaborales\\EtapaMovimientoConfiguracionController@store');\n        $ruta->put('descartar-candidatos-etapa', 'OfertasLaborales\\EtapaController@descartarCandidatosEtapa');\n        $ruta->get('etapas-verificar-nombre-repetido/{oferta_laboral_id}/{nombre}', 'OfertasLaborales\\EtapaController@validarNombreRepetido');\n        $ruta->post('etapas-mover/{id}/{orden}', 'OfertasLaborales\\EtapaController@cambiarOrden');\n\n        // Movimientos\n        $ruta->get('movimientos-listado', 'OfertasLaborales\\MovimientoController@listado');\n        $ruta->get('movimientos-configuraciones-listado', 'OfertasLaborales\\MovimientoConfiguracionController@listado');\n        $ruta->get('movimientos-configuraciones/{id}', 'OfertasLaborales\\MovimientoConfiguracionController@show');\n        $ruta->post('movimientos-configuraciones-preguntas', 'OfertasLaborales\\MovimientoConfiguracionController@guardarPreguntasVideoEntrevista');\n\n        // Novedades\n        $ruta->get('novedades', 'Configuraciones\\NovedadController@index');\n\n        $ruta->get('feedback', 'DashboardController@enConstruccion');\n        $ruta->get('planes-accion', 'DashboardController@enConstruccion');\n\n        // Procesos\n        $ruta->resource('procesos', 'Procesos\\ProcesoController');\n        $ruta->get('procesos-listado', 'Procesos\\ProcesoController@listado');\n        $ruta->get('procesos-listado-tabla', 'Procesos\\ProcesoController@datosTabla');\n        $ruta->patch('procesos-actualizar/{id}', 'Procesos\\ProcesoController@actualizarInformacion');\n        $ruta->post('procesos-duplicar/{id}', 'Procesos\\ProcesoController@duplicar');\n        $ruta->post('procesos-suspender/{id}', 'Procesos\\ProcesoController@suspender');\n        $ruta->post('procesos-activar/{id}', 'Procesos\\ProcesoController@activar');\n        $ruta->put('procesos-archivar', 'Procesos\\ProcesoController@archivarProceso');\n        $ruta->post('procesos-exportar', 'Procesos\\ProcesoController@exportarExcel');\n        $ruta->post('procesos-compartir/{id}', 'Procesos\\ProcesoController@compartir');\n        $ruta->post('procesos-compartir-resultados-aplicante', 'Procesos\\ProcesoController@compartirResultadosAplicante');\n        $ruta->get('participantes-proceso/{id}', 'Usuarios\\UserController@participantesProceso');\n        $ruta->post('procesos-exportar-participantes', 'Usuarios\\UserController@exportarParticipantesProcesoExcel');\n        $ruta->post('participantes-descartar', 'Procesos\\ProcesoController@descartarParticipantes');\n        $ruta->post('participante-seleccionar', 'Procesos\\ProcesoController@seleccionarParticipante');\n        $ruta->post('participantes-cambiar-proceso', 'Procesos\\ProcesoController@moverDeProceso');\n        $ruta->delete('participantes-eliminar/{proceso_id}/{usuario_id}', 'Procesos\\ProcesoController@eliminarParticipante');\n        $ruta->post('procesos-participantes/{id}', 'Procesos\\ProcesoController@agregarParticipantes');\n        $ruta->post('participantes-reagendar', 'Procesos\\ProcesoController@reagendarParticipantes');\n        $ruta->get('participante/{id}', 'Usuarios\\UserController@obtenerParticipanteProceso');\n        $ruta->get('procesos-detalles-participante', 'Usuarios\\UserController@detallesParticipanteProceso');\n        $ruta->post('agendas-participante', 'Agendas\\AgendaController@agendasParticipante');\n        $ruta->delete('agendas/{id}', 'Agendas\\AgendaController@destroy');\n        $ruta->post('agendas-reprocesar/{id}', 'Agendas\\AgendaController@reprocesarAgenda');\n        $ruta->post('procesos-reporte-resultados-excel', 'Procesos\\ProcesoController@exportarReporteResultadosExcel');\n        $ruta->get('procesos-indice-talento/{proceso_id}/{aplicante_id}', 'Procesos\\ProcesoController@obtenerIndiceTalento');\n        $ruta->get('agendas-copiar-resultados', 'Agendas\\AgendaController@copiarAgenda');\n        $ruta->post('procesos-mejores-candidatos', 'Procesos\\ProcesoController@mejoresCandidatosIA');\n        $ruta->post('procesos-validar-agendas-expiradas/{id}', 'Procesos\\ProcesoController@validarAgendasExpiradas');\n        $ruta->get('plantilla-correo', 'Configuraciones\\PlantillaCorreoController@obtenerPlantilla');\n        $ruta->get('procesos-descargar-guia-agendamiento-masivo', 'Procesos\\ProcesoController@descargarGuiaAgendamientoMasivo');\n        $ruta->post('procesos-extraer-datos-participantes', 'Procesos\\ProcesoController@extraerDatosParticipantes');\n\n        // Firmas de rutas\n        $ruta->get('firmas-rutas-por-proceso/{proceso_id}', 'Accesos\\FirmaRutaController@porProceso');\n\n        // Perfiles pruebas\n        $ruta->get('perfiles-pruebas', 'Pruebas\\PerfilController@perfilesPruebas');\n\n        // Agendas\n        $ruta->get('pruebas-empresas/{id}', 'Pruebas\\PruebaController@obtenerPruebasEmpresa');\n        $ruta->get('candidatos', 'Agendas\\AgendaController@historialAgendamientos');\n        $ruta->get('listado-historial-agendamientos', 'Agendas\\AgendaController@listadoHistorialAgendamientos');\n        $ruta->post('exportar-excel-historial-agendamientos', 'Agendas\\AgendaController@exportarExcelHistorialAgendamientos');\n\n        // Comentarios\n        $ruta->resource('comentarios', 'OfertasLaborales\\ComentarioController')->only(['index', 'store']);\n\n        // Usuarios\n        $ruta->post('generar-acceso-usuario/{usuario_id}', 'Usuarios\\TokenAccesoController@generarAcceso');\n    });\n\n    $ruta->group(['middleware' => 'auth.es-superadmin'], function ($ruta) {\n        $ruta->get('empresa-sucursales', 'Empresas\\EmpresaController@empresaSucursales');\n\n        // Debug de calificaciones de agendas\n        $ruta->get('debug/calificacion/{agenda_id}', 'Debug\\DebugCalificacionController@mostrar')->name('debug.calificacion.mostrar');\n        $ruta->get('debug/calificacion/{agenda_id}/calcular', 'Debug\\DebugCalificacionController@obtenerCalificacion')->name('debug.calificacion.calcular');\n        $ruta->post('debug/calificacion/{agenda_id}/simular', 'Debug\\DebugCalificacionController@simularCalificacion')->name('debug.calificacion.simular');\n        $ruta->post('debug/calificacion/{agenda_id}/actualizar', 'Debug\\DebugCalificacionController@actualizarRespuestas')->name('debug.calificacion.actualizar');\n    });\n\n    // Suplantación de rol Administrador general\n    $ruta->group(['middleware' => 'auth.suplantar-admin-general'], function ($ruta) {\n        $ruta->post('suplantar-rol-admin-general', 'Auth\\RolController@suplantarRolAdministradorGeneral')->name('suplantar-rol-admin-general');\n    });\n\n    // Suplantación de rol Administrador sucursal\n    $ruta->group(['middleware' => 'auth.suplantar-admin-sucursal'], function ($ruta) {\n        $ruta->post('suplantar-rol-admin-sucursal', 'Auth\\RolController@suplantarRolAdministradorSucursal')->name('suplantar-rol-admin-sucursal');\n    });\n\n    // Restablecimiento de la sesión original que había antes de la suplantación\n    $ruta->group(['middleware' => 'auth.rol-suplantado'], function ($ruta) {\n        $ruta->post('restablecer-sesion-original', 'Auth\\RolController@restablecerSesionOriginal')->name('restablecer-sesion-original');\n    });\n\n    // Ruta para completar los datos de un usuario aplicante\n    $ruta->group(['middleware' => 'auth.rol-tipo-evaluado'], function ($ruta) {\n        $ruta->put('completar-datos-usuario/datos-generales/{id}', 'Usuarios\\UserController@completarDatosGenerales');\n        $ruta->put('completar-datos-usuario/datos-acceso/{id}', 'Usuarios\\UserController@completarDatosAcceso');\n        $ruta->get('completar-datos-usuario/{id}', 'Usuarios\\UserController@paginaCompletarDatos')->name('usuarios.completar-datos');\n        $ruta->get('recomendaciones', 'Usuarios\\UserController@vistaRecomendaciones');\n    });\n\n    // Rutas de usuario aplicante que requieren que este haya completados sus datos\n    $ruta->group(['middleware' => ['validar-datos-completados-usuario', 'auth.rol-tipo-evaluado']], function ($ruta) {\n        $ruta->get('ofertas-laborales-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantes')->name('ofertas-laborales-aplicantes');\n        $ruta->get('ofertas-guardadas-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantesGuardados');\n        $ruta->post('ofertas-laborales-postular-aplicante/{oferta_laboral_id}/{perfil_laboral_id?}', 'OfertasLaborales\\OfertaLaboralController@postularAplicante');\n        $ruta->post('ofertas-laborales-abandonar-postulacion-aplicante/{oferta_laboral_id}', 'OfertasLaborales\\OfertaLaboralController@abandonarPostulacionAplicante');\n        $ruta->get('ofertas-laborales-postular-aplicante-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@postularAplicanteSinAutenticar');\n        $ruta->post('ofertas-laborales-guardar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardar');\n        $ruta->get('ofertas-laborales-guardar-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardarSinAutenticar');\n        $ruta->post('ofertas-laborales-quitar-guardado/{id}', 'OfertasLaborales\\OfertaLaboralController@quitarGuardado');\n        $ruta->get('soportes-aplicante', 'DashboardController@enConstruccion');\n        $ruta->get('preguntas-frecuentes-aplicante', 'DashboardController@enConstruccion');\n        $ruta->get('completar-demograficas/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@formularioDemograficas');\n        $ruta->get('demograficas-ajax/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@obtenerDemograficasAjax');\n        $ruta->post('agendas-demograficas-opciones', 'Agendas\\AgendaController@guardarRespuestasDemograficas');\n        $ruta->get('realizar-prueba/{agenda_id}', 'Agendas\\AgendaController@paginaRealizarPrueba')->name('prueba.realizar');\n        $ruta->get('agendas-reactivos/{agenda_id}', 'Agendas\\AgendaReactivoController@listado');\n        $ruta->put('descontar-tiempo-agenda', 'Agendas\\AgendaTiempoController@descontarTiempo');\n        $ruta->post('agendas-reactivos-respuestas', 'Agendas\\AgendaReactivoController@guardarRespuestasReactivos');\n        $ruta->get('agendas-reactivos-respondidos/{agenda_id}', 'Agendas\\AgendaReactivoController@obtenerReactivosRespondidos');\n        $ruta->post('agendas-procesar-resultados', 'Agendas\\AgendaController@procesarResultados');\n        $ruta->post('agendas-guardar-foto', 'Agendas\\AgendaController@guardarArchivoAgenda');\n        $ruta->get('ofertas-laborales-detalles-aplicante/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesParaAplicante')\n            ->name('ofertas-laborales.detalles-aplicante');\n        $ruta->post('agendas-guardar-archivo', 'Agendas\\AgendaController@guardarArchivoAgenda');\n        $ruta->get('agendas_validar_pendientes/{agenda_id}', 'Agendas\\AgendaController@validarAgendasPendientes');\n\n        $ruta->resource('experiencias-laborales', 'Usuarios\\PerfilesLaborales\\ExperienciaLaboralController')->only(['store', 'update', 'destroy']);\n    });\n\n    // Ofertas laborales\n    $ruta->post('ofertas-laborales-descartar-aplicante/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\OfertaLaboralController@descartarAplicante');\n\n    // Perfiles - Rutas específicas primero para evitar conflictos con resource\n    $ruta->get('perfiles/prueba/{id}/factores-dimensiones', 'Pruebas\\PerfilController@getFactoresDimensiones');\n    $ruta->post('perfiles/generar-ia', 'Pruebas\\PerfilController@generarConIA');\n    $ruta->get('perfiles/datos-adicionales', 'Pruebas\\PerfilController@getDatosAdicionales');\n    $ruta->post('perfiles/crear-desde-ia', 'Pruebas\\PerfilController@crearDesdeIA');\n    $ruta->resource('perfiles', 'Pruebas\\PerfilController');\n    $ruta->get('factores-pruebas/{prueba_id}', 'Pruebas\\FactorController@obtenerTodoPorPrueba');\n\n    // Usuarios\n    $ruta->post('enviar-codigo-autorizacion', 'Usuarios\\UserController@enviarCodigoAutorizacion');\n    $ruta->post('verificar-codigo-autorizacion', 'Usuarios\\UserController@verificarCodigoAutorizacion');\n\n    // Perfiles\n    $ruta->get('perfiles-listado', 'Pruebas\\PerfilController@listado');\n    $ruta->get('perfiles-listado-empresa', 'Pruebas\\PerfilController@listadoEmpresa');\n    $ruta->post('perfiles-archivar/{id}', 'Pruebas\\PerfilController@archivar');\n    $ruta->post('perfiles-clonar', 'Pruebas\\PerfilController@clonar');\n    $ruta->post('perfiles-pdf/{id}', 'Pruebas\\PerfilController@descargarPDF');\n\n    // Archivos\n    $ruta->get('archivos', 'Configuraciones\\ArchivoController@listado');\n    $ruta->get('archivos-obtener-uno', 'Configuraciones\\ArchivoController@obtenerUno');\n    $ruta->delete('archivos/{id}', 'Configuraciones\\ArchivoController@destroy');\n\n    // Menú clientes\n    $ruta->get('psicoacademy-cliente', 'DashboardController@paginaPsycoAcademyCliente');\n    $ruta->get('uso-experiencia', 'DashboardController@paginaUsoExperiencia');\n    $ruta->get('mis-pruebas', 'DashboardController@paginaMisPruebas')->middleware('validar-datos-completados-usuario');\n\n    $ruta->get('tareas-pendientes-aplicantes', 'DashboardController@paginaMisPruebasAplicante')->name('tareas-pendientes-aplicantes');\n    $ruta->get('tareas-pendientes-aplicantes-data', 'DashboardController@tareasPendientesData');\n    $ruta->get('tareas-completadas-aplicantes', 'DashboardController@paginaMisPruebasAplicanteCompletadas')->name('tareas-completadas-aplicantes');\n    $ruta->get('resultados-evaluacion-aplicantes', 'DashboardController@paginaFeedbackAplicante');\n    $ruta->get('planes-accion-aplicantes', 'DashboardController@paginaPlanesAccionAplicante');\n\n    $ruta->get('vacantes-aplicante', 'Vacantes\\VacanteController@obtenerVacantesAplicante');\n    $ruta->resource('pruebas-tecnicas', 'Vacantes\\PruebaTecnicaController');\n    $ruta->post('vacantes-guardar-documentos-solicitados', 'Vacantes\\EtapaVacanteUsuarioController@guardarDocumentoSolicitado');\n    $ruta->get('vacantes-documentos-solicitados/{etapa_vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDocumentosContratacion');\n    $ruta->post('vacantes-exportar-archivos-etapa/{etapa_id}', 'Vacantes\\EtapaVacanteController@exportarArchivosZip');\n    $ruta->post('vacantes-notificar-documentos-solicitados/{id}', 'Vacantes\\EtapaVacanteUsuarioController@notificarDocumentosSolicitados');\n    $ruta->post('vacantes-abandonar-vacante', 'Vacantes\\EtapaVacanteUsuarioController@abandonarVacante');\n    $ruta->get('vacantes-listado-postulaciones-aplicante', 'Vacantes\\VacanteController@listadoPostulacionesAplicanteEspecifico');\n    $ruta->get('vacantes-postulaciones-aplicantes', 'Vacantes\\VacanteController@vistaPostulacionesAplicante');\n\n    // Agendas - Accesible para aplicantes y usuarios de empresa\n    $ruta->get('agendas-aplicante', 'Procesos\\ProcesoController@obtenerPruebasAplicante');\n\n    // Rutas para servir imágenes - accesibles para aplicantes Y Superadmin\n    $ruta->get('modulos-preguntas-imagen/{nombre_archivo}', 'Pruebas\\ModuloPreguntaController@getImagen');\n    $ruta->get('reactivos-imagen-por-id/{reactivo_id}', 'Pruebas\\ReactivoController@getImagenPorId');\n    $ruta->get('opciones-imagen-por-id/{opcion_id}', 'Pruebas\\OpcionController@getImagenPorId');\n    $ruta->get('preguntas-frecuentes-imagen/{nombre_archivo}', 'Soportes\\PreguntaFrecuenteController@getImagen');\n\n    $ruta->get('psicometricas', 'DashboardController@enConstruccion');\n    $ruta->get('ordenes', 'DashboardController@enConstruccion');\n\n    $ruta->get('consumo-clientes', 'DashboardController@paginaEmpresa');\n    $ruta->get('configuraciones-clientes', 'Configuraciones\\ConfiguracionController@paginaConfiguraciones');\n    $ruta->get('roles-permisos', 'Auth\\RolController@rolesPermisosMiEmpresa');\n\n    $ruta->get('propuestas', 'DashboardController@enConstruccion');\n    $ruta->get('novedades', 'DashboardController@enConstruccion');\n\n    // Áreas\n    $ruta->get('areas-listado', 'Empresas\\AreaController@listado');\n    $ruta->post('areas', 'Empresas\\AreaController@store');\n\n    // Cargos\n    $ruta->get('cargos-listado', 'Empresas\\CargoController@listado');\n    $ruta->post('cargos', 'Empresas\\CargoController@store');\n\n    // Niveles educativos\n    $ruta->get('niveles-educativos', 'OfertasLaborales\\NivelEducativoController@index');\n\n    // Áreas de estudio\n    $ruta->get('areas-estudios', 'Usuarios\\PerfilesLaborales\\AreaEstudioController@index');\n\n    // Idiomas\n    $ruta->get('idiomas', 'Usuarios\\PerfilesLaborales\\IdiomaController@index');\n\n    // Autenticación del websoket\n    $ruta->post('/broadcasting-auth', 'Broadcasting\\BroadcastingController@autenticar');\n\n    $ruta->get('/botones', function () {\n        return view('botones');\n    })->name('botones');\n\n    $ruta->get('pruebas-plantillas', 'DashboardController@plantillasPruebas');\n    $ruta->get('componentes/index', 'ComponenteController@index')->name('componentes');\n    $ruta->get('componentes/lista', 'ComponenteController@getLista')->name('componentes-lista');\n\n    // Rutas temporales (hay que eliminarlas cuando se desarrollen sus respectivos módulos)\n    $ruta->get('analiticas', 'DashboardController@index');\n    $ruta->get('en-construccion', 'DashboardController@enConstruccion');\n    $ruta->get('uso-panel-demografico', 'DashboardController@indexAnaliticaUsoPanelDemografico');\n    $ruta->get('panel-demografico', 'DashboardController@indexAnaliticaPanelDemografico');\n    $ruta->get('uso', 'DashboardController@indexAnaliticaUso');\n    $ruta->get('experiencia', 'DashboardController@indexAnaliticaExperiencia');\n\n    // Rutas de componentes de desarrollo\n    $ruta->get('/componentes/{menu}/{modulo}', 'ComponenteController@componentes');\n    $ruta->post('/componentes/prueba', 'ComponenteController@pruebaComponentes');\n\n    // TODO: ruta de prueba, eliminarla próximamente\n    $ruta->get('visualizar-reporte', 'DashboardController@enConstruccion');\n    $ruta->get('reportes-generar/{agenda_id}', 'Reportes\\ReporteController@generar');\n    $ruta->get('reporte-agenda/{agenda_id}', 'Reportes\\ReporteController@mostrarReporteAgenda');\n    $ruta->post('reportes-agendas-zip', 'Reportes\\ReporteController@descargarReportesZip');\n    $ruta->get('reportes-generar-comparativo', 'Reportes\\ReporteController@generarComparativo');\n\n    // Rutas para las encuestas\n    $ruta->get('validar-encuesta/{id}', 'Encuestas\\EncuestaController@obtenerUnoDeUsuario');\n    $ruta->post('encuestas-guardar-respuestas', 'Encuestas\\EncuestaController@guardarRespuestas');\n});\n\n// Rutas no protegidas por autenticación\nRoute::group([\n    'namespace' => 'App\\Http\\Controllers'\n], function ($ruta) {\n    // Contraseñas\n    $ruta->post('contrasenas/verificar-uso', 'Usuarios\\ContrasenaController@verificarUso');\n\n    // Empresas\n    $ruta->get('empresas-parametrizar/{hash}/{id?}', 'Empresas\\EmpresaEnlaceCreacionController@index');\n    $ruta->post('empresas-parametrizar', 'Empresas\\EmpresaEnlaceCreacionController@crearEmpresa');\n    $ruta->post('empresas-parametrizar-archivos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarArchivosEmpresa');\n    $ruta->post('empresas-parametrizar-contactos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarContactosEmpresa');\n    $ruta->get('empresas-logo/{id}', 'Empresas\\EmpresaController@getLogo');\n\n    // Ordenes de servicio\n    $ruta->group([\n        'middleware' => 'orden-servicio-enlace-publico'\n    ], function ($ruta) {\n        $ruta->get('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@crearPorEnlacePublico');\n        $ruta->post('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@guardarDesdeEnlacePublico');\n    });\n\n    $ruta->get('/ordenes-servicio-enlace-publico/error', 'OrdenesServicios\\OrdenServicioController@errorEnlacePublico');\n\n    // Países\n    $ruta->get('paises-listado', 'Configuraciones\\PaisController@listado');\n    $ruta->get('paises-listado-completo', 'Configuraciones\\PaisController@listadoCompleto');\n\n    // Departamentos\n    $ruta->get('departamentos-listado', 'Configuraciones\\DepartamentoController@listado');\n\n    // Ciudades\n    $ruta->get('ciudades-listado', 'Configuraciones\\CiudadController@listado');\n\n    // Portales de empleo\n    $ruta->get('portales-empleo', 'Empresas\\PortalEmpleoController@portalesEmpleo');\n    $ruta->get('portales-empleo/oferta-laboral/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesPortalEmpleo');\n    $ruta->get('portales-empleo/{portal_empleo_uuid}', 'Empresas\\PortalEmpleoController@portalEmpleoEmpresa');\n    $ruta->get('portales-empleo/crear/aplicante', 'Empresas\\PortalEmpleoController@crearAplicante');\n    $ruta->post('portales-empleo-enviar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@enviarCodigoAutorizacionCrearAplicante');\n    $ruta->post('portales-empleo-verificar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@verificarCodigoAutorizacionCrearAplicante');\n\n    // Firmas de rutas\n    $ruta->get('firmas-rutas-expirada', 'Accesos\\FirmaRutaController@firmaRutaExpirada')->name('firma-ruta-expirada');\n    $ruta->get('firmas-rutas-formulario-acceso/{id}', 'Accesos\\FirmaRutaController@formularioAcceso')->name('formulario-acceso-ruta-firmada');\n    $ruta->post('firmas-rutas-validar-formulario-acceso', 'Accesos\\FirmaRutaController@validarFormularioAcceso')->name('validar-formulario-acceso-ruta-firmada');\n    $ruta->post('firmas-rutas-revocar-acceso/{id}', 'Accesos\\FirmaRutaController@revocarAcceso');\n\n    // Archivos\n    $ruta->get('archivos-abrir/{id}', 'Configuraciones\\ArchivoController@abrir');\n\n    // Imagen de usuarios\n    $ruta->get('usuarios-imagen/{id}', 'Usuarios\\UserController@getImagen');\n\n    // Consultar reportes con firma\n    $ruta->get('reporte-agenda-firmado/{id}/{firma}', 'Reportes\\ReporteController@mostrarReporteAgendaValidacion');\n\n    $ruta->get('funcionalidades-activas-plan', 'Empresas\\EmpresaPlanController@funcionalidadesActivasPlan');\n});\n\n/**\n * Rutas protegidas por firma: El acceso a estas rutas está limitado por la vigencia de la firma con la que se accede a la ruta.\n *\n * @author Fahibram Cárcamo\n */\nRoute::group([\n    'prefix'     => 'rutas-firmadas',\n    'middleware' => ['ruta-firmada'],\n    'namespace'  => 'App\\Http\\Controllers'\n], function ($ruta) {\n    $ruta->get('procesos/{id}', 'Procesos\\ProcesoController@showFirmada');\n    $ruta->get('procesos-resultados-aplicante/{proceso_id}/{participante_id}', 'Procesos\\ProcesoController@showResultadosAplicanteFirmada');\n});\n\n/**\n * Genera un token SSO firmado y redirige a WordPress.\n *\n * Flujo:\n *  - Requiere un usuario autenticado (será el admin en WP).\n *  - Opcionalmente recibe un student_id para crear un estudiante en WP.\n *  - Crea un nonce de un solo uso y lo guarda en cache con expiración corta.\n *  - Firma un payload con los datos de ambos usuarios y la expiración del token.\n *  - Redirige al callback configurado en WordPress.\n *\n * @author Sergio Vargas\n */\nRoute::get('/sso/wordpress', function (Request $request) {\n    $user = $request->user();\n    $empresa = $user->empresa;\n\n    $studentId = $request->input('student_id');\n    $etapaVacanteUsuarioId = $request->input('etapa_vacante_usuario_id');\n    $studentData = null;\n\n    if ($studentId) {\n        $student = App\\Models\\Usuarios\\User::find($studentId);\n\n        if ($student && $student->id !== $user->id) {\n            $studentData = [\n                'id'    => (string) $student->id,\n                'email' => $student->email,\n                'name'  => $student->getNombreCompletoAttribute(),\n            ];\n\n            // Agregar competencias si se pasa etapa_vacante_usuario_id\n            if ($etapaVacanteUsuarioId) {\n                $studentData['competencias'] = sso_obtener_competencias((int) $etapaVacanteUsuarioId);\n            }\n        }\n    }\n\n    $nonce = (string) Str::uuid();\n    $exp   = now()->addSeconds(60)->timestamp;\n\n    Cache::put(\"sso_nonce:{$nonce}\", [\n        'user_id' => $user->id,\n        'exp'     => $exp,\n    ], now()->addMinutes(5));\n\n    $payload = [\n        'sub'              => (string) $user->id,\n        'email'            => $user->email,\n        'name'             => $user->getNombreCompletoAttribute(),\n        'nombre_comercial' => $empresa?->nombre_comercial ?? $empresa?->razon_social,\n        'documento'        => $empresa?->documento,\n        'nonce'            => $nonce,\n        'exp'              => $exp,\n        'student'          => $studentData,\n    ];\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));\n    $wp       = rtrim(config('services.sso.wp_url'), '/');\n    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n\n    return redirect()->away(\n        $wp . '/' . $cb . '?token=' . urlencode($token) . '&redirect=' . urlencode($redirect)\n    );\n})->middleware('auth');\n","structuredPatch":[{"oldStart":979,"oldLines":6,"newStart":979,"newLines":8,"lines":["         'student'          => $studentData,","     ];"," ","+    \\Log::info('SSO WordPress payload', $payload);","+","     $token    = sso_sign_token($payload, config('services.sso.secret'));","     $wp       = rtrim(config('services.sso.wp_url'), '/');","     $cb       = ltrim(config('services.sso.wp_callback'), '/');"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"51a70888-3686-4649-8123-f062f4dd6df1"}
{"parentUuid":"1f48044c-ece6-456b-a445-e3dcfadf61be","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.37","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_016nb2ZYpe95sehqr4GoTUCN","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Agregué `\\Log::info('SSO WordPress payload', $payload)` justo antes de firmar el token. El payload se registrará en `storage/logs/laravel.log` cada vez que se acceda a la ruta `/sso/wordpress`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":332,"cache_read_input_tokens":52988,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":332},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2HDz5VteaZWNn6SmbwU","type":"assistant","uuid":"4c8730c2-da9d-4891-8730-0807249bbcc9","timestamp":"2026-02-11T12:27:35.943Z"}
{"type":"file-history-snapshot","messageId":"3ea45450-3fda-4906-9400-b651cc097124","snapshot":{"messageId":"3ea45450-3fda-4906-9400-b651cc097124","trackedFileBackups":{"routes\\web.php":{"backupFileName":"8d4f24f72d6f32f1@v2","version":2,"backupTime":"2026-02-11T12:38:26.852Z"}},"timestamp":"2026-02-11T12:38:26.850Z"},"isSnapshotUpdate":false}
{"parentUuid":"4c8730c2-da9d-4891-8730-0807249bbcc9","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":"es posible hacer un dump apenas se tienen los datos para depurar? antes de que se llame al otro dominio"},"uuid":"3ea45450-3fda-4906-9400-b651cc097124","timestamp":"2026-02-11T12:38:26.849Z","thinkingMetadata":{"maxThinkingTokens":31999},"permissionMode":"default"}
{"parentUuid":"3ea45450-3fda-4906-9400-b651cc097124","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01KugRdsHEktoFa23U1ZgDAn","type":"message","role":"assistant","content":[{"type":"text","text":"\n\n"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25613,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25613},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J4EMaKrDjsRpAqamfd","type":"assistant","uuid":"0a057b91-84b2-4726-a9d4-725a019cec1e","timestamp":"2026-02-11T12:38:28.993Z"}
{"parentUuid":"0a057b91-84b2-4726-a9d4-725a019cec1e","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01KugRdsHEktoFa23U1ZgDAn","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to do a dump (dd() or dump()) of the data before the redirect to the other domain, so they can debug the payload. Let me read the route to understand the full context.","signature":"Et8CCkYICxgCKkBsVtdW3cy+TWPmkEA6/7jxo5i4yNsEwN8atTDHO9BsZe/2vFr9mWC7hgQFeq7bhVc2FQjry1SEsLuFSCYj0dgsEgx78zlvzcrVJ0VF+0IaDK04RGc9TqCLQWuj4CIwHu9X/3pNUYWeus8CWa4KNJXeQXvI18TIQS6GgS5R0sSL/bGnEEcqfYkW7OfqhHTMKsYBRHcQtuVWMbXNdy2aNnvnYBztbUyXoP0KlWjIGqnc24Ct4DykU0xXJqIn/UEMwXxV5afEPQqa88jFitowp4+M7EYRbfpIa13IutbDfgfqYb7lz1BvSt1azukkJ0tVbYif+JXDRdpfZ75+28fRhLGEghadpIr5FYSEtD4zHPnrY0p75+pcc/Z+uFs/2h2LfoPm+rqkYx/iLnw2+e1m/gMIHC2quPL+De2ig8SZjt/FvItk1AZIMqQMwuk+2a9V+qT9OrP2rqiCGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25613,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25613},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J4EMaKrDjsRpAqamfd","type":"assistant","uuid":"dc7ff888-c5fa-4bd0-aad5-bf11dc8bda15","timestamp":"2026-02-11T12:38:30.427Z"}
{"parentUuid":"dc7ff888-c5fa-4bd0-aad5-bf11dc8bda15","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01KugRdsHEktoFa23U1ZgDAn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017ofbkT9s8yFQSLLhdWai6R","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","offset":930,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25613,"cache_read_input_tokens":0,"output_tokens":168,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":25613,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[]}},"requestId":"req_011CY2J4EMaKrDjsRpAqamfd","type":"assistant","uuid":"16ee4b3a-9361-4f1f-8c2e-4dcfe1e59a3f","timestamp":"2026-02-11T12:38:31.165Z"}
{"parentUuid":"16ee4b3a-9361-4f1f-8c2e-4dcfe1e59a3f","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_017ofbkT9s8yFQSLLhdWai6R","toolUseID":"toolu_017ofbkT9s8yFQSLLhdWai6R","timestamp":"2026-02-11T12:38:31.535Z","uuid":"0feea2ae-670e-4a4e-9046-a5bc167cf9ba"}
{"parentUuid":"16ee4b3a-9361-4f1f-8c2e-4dcfe1e59a3f","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017ofbkT9s8yFQSLLhdWai6R","type":"tool_result","content":"   930→ *  - Requiere un usuario autenticado (será el admin en WP).\n   931→ *  - Opcionalmente recibe un student_id para crear un estudiante en WP.\n   932→ *  - Crea un nonce de un solo uso y lo guarda en cache con expiración corta.\n   933→ *  - Firma un payload con los datos de ambos usuarios y la expiración del token.\n   934→ *  - Redirige al callback configurado en WordPress.\n   935→ *\n   936→ * @author Sergio Vargas\n   937→ */\n   938→Route::get('/sso/wordpress', function (Request $request) {\n   939→    $user = $request->user();\n   940→    $empresa = $user->empresa;\n   941→\n   942→    $studentId = $request->input('student_id');\n   943→    $etapaVacanteUsuarioId = $request->input('etapa_vacante_usuario_id');\n   944→    $studentData = null;\n   945→\n   946→    if ($studentId) {\n   947→        $student = App\\Models\\Usuarios\\User::find($studentId);\n   948→\n   949→        if ($student && $student->id !== $user->id) {\n   950→            $studentData = [\n   951→                'id'    => (string) $student->id,\n   952→                'email' => $student->email,\n   953→                'name'  => $student->getNombreCompletoAttribute(),\n   954→            ];\n   955→\n   956→            // Agregar competencias si se pasa etapa_vacante_usuario_id\n   957→            if ($etapaVacanteUsuarioId) {\n   958→                $studentData['competencias'] = sso_obtener_competencias((int) $etapaVacanteUsuarioId);\n   959→            }"}]},"uuid":"65995d75-450c-4412-b9d5-3a7376ca0b9d","timestamp":"2026-02-11T12:38:31.532Z","toolUseResult":{"type":"text","file":{"filePath":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","content":" *  - Requiere un usuario autenticado (será el admin en WP).\n *  - Opcionalmente recibe un student_id para crear un estudiante en WP.\n *  - Crea un nonce de un solo uso y lo guarda en cache con expiración corta.\n *  - Firma un payload con los datos de ambos usuarios y la expiración del token.\n *  - Redirige al callback configurado en WordPress.\n *\n * @author Sergio Vargas\n */\nRoute::get('/sso/wordpress', function (Request $request) {\n    $user = $request->user();\n    $empresa = $user->empresa;\n\n    $studentId = $request->input('student_id');\n    $etapaVacanteUsuarioId = $request->input('etapa_vacante_usuario_id');\n    $studentData = null;\n\n    if ($studentId) {\n        $student = App\\Models\\Usuarios\\User::find($studentId);\n\n        if ($student && $student->id !== $user->id) {\n            $studentData = [\n                'id'    => (string) $student->id,\n                'email' => $student->email,\n                'name'  => $student->getNombreCompletoAttribute(),\n            ];\n\n            // Agregar competencias si se pasa etapa_vacante_usuario_id\n            if ($etapaVacanteUsuarioId) {\n                $studentData['competencias'] = sso_obtener_competencias((int) $etapaVacanteUsuarioId);\n            }","numLines":30,"startLine":930,"totalLines":993}},"sourceToolAssistantUUID":"16ee4b3a-9361-4f1f-8c2e-4dcfe1e59a3f"}
{"parentUuid":"65995d75-450c-4412-b9d5-3a7376ca0b9d","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01Hk88qFx5WaG2eMeatKbRGP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Rp7eP2NuKh1NBRD76xZ4eC","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","offset":960,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":665,"cache_read_input_tokens":25613,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":665},"output_tokens":21,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J4ZCQ8dsh2y2hjmJyQ","type":"assistant","uuid":"800de608-61f3-43e9-9137-3ded121db0a8","timestamp":"2026-02-11T12:38:34.882Z"}
{"parentUuid":"800de608-61f3-43e9-9137-3ded121db0a8","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Rp7eP2NuKh1NBRD76xZ4eC","toolUseID":"toolu_01Rp7eP2NuKh1NBRD76xZ4eC","timestamp":"2026-02-11T12:38:34.893Z","uuid":"2931b681-329f-4ff5-90d4-96434972e053"}
{"parentUuid":"800de608-61f3-43e9-9137-3ded121db0a8","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Rp7eP2NuKh1NBRD76xZ4eC","type":"tool_result","content":"   960→        }\n   961→    }\n   962→\n   963→    $nonce = (string) Str::uuid();\n   964→    $exp   = now()->addSeconds(60)->timestamp;\n   965→\n   966→    Cache::put(\"sso_nonce:{$nonce}\", [\n   967→        'user_id' => $user->id,\n   968→        'exp'     => $exp,\n   969→    ], now()->addMinutes(5));\n   970→\n   971→    $payload = [\n   972→        'sub'              => (string) $user->id,\n   973→        'email'            => $user->email,\n   974→        'name'             => $user->getNombreCompletoAttribute(),\n   975→        'nombre_comercial' => $empresa?->nombre_comercial ?? $empresa?->razon_social,\n   976→        'documento'        => $empresa?->documento,\n   977→        'nonce'            => $nonce,\n   978→        'exp'              => $exp,\n   979→        'student'          => $studentData,\n   980→    ];\n   981→\n   982→    \\Log::info('SSO WordPress payload', $payload);\n   983→\n   984→    $token    = sso_sign_token($payload, config('services.sso.secret'));\n   985→    $wp       = rtrim(config('services.sso.wp_url'), '/');\n   986→    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n   987→    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n   988→\n   989→    return redirect()->away("}]},"uuid":"510c6cdf-d87f-4525-8ee3-bb118d7659a7","timestamp":"2026-02-11T12:38:34.891Z","toolUseResult":{"type":"text","file":{"filePath":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","content":"        }\n    }\n\n    $nonce = (string) Str::uuid();\n    $exp   = now()->addSeconds(60)->timestamp;\n\n    Cache::put(\"sso_nonce:{$nonce}\", [\n        'user_id' => $user->id,\n        'exp'     => $exp,\n    ], now()->addMinutes(5));\n\n    $payload = [\n        'sub'              => (string) $user->id,\n        'email'            => $user->email,\n        'name'             => $user->getNombreCompletoAttribute(),\n        'nombre_comercial' => $empresa?->nombre_comercial ?? $empresa?->razon_social,\n        'documento'        => $empresa?->documento,\n        'nonce'            => $nonce,\n        'exp'              => $exp,\n        'student'          => $studentData,\n    ];\n\n    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));\n    $wp       = rtrim(config('services.sso.wp_url'), '/');\n    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n\n    return redirect()->away(","numLines":30,"startLine":960,"totalLines":993}},"sourceToolAssistantUUID":"800de608-61f3-43e9-9137-3ded121db0a8"}
{"parentUuid":"510c6cdf-d87f-4525-8ee3-bb118d7659a7","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01F6Kob7NsPZrSjQWdufzbnJ","type":"message","role":"assistant","content":[{"type":"text","text":"Sí, reemplaza el `Log::info` por un `dd()` para ver el payload directamente en el navegador antes del redirect:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":26278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J4oPRYrDRo3XXEQJW2","type":"assistant","uuid":"b1c1ec6c-8abf-41ba-9243-8976a63414ba","timestamp":"2026-02-11T12:38:39.530Z"}
{"parentUuid":"b1c1ec6c-8abf-41ba-9243-8976a63414ba","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01F6Kob7NsPZrSjQWdufzbnJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PWXU4CEAsWhkFgs6zPXNGB","name":"Edit","input":{"replace_all":false,"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","old_string":"    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));","new_string":"    dd($payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":26278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J4oPRYrDRo3XXEQJW2","type":"assistant","uuid":"ed9b173b-3e84-4bee-8a5c-6c202d3466e9","timestamp":"2026-02-11T12:38:40.981Z"}
{"parentUuid":"ed9b173b-3e84-4bee-8a5c-6c202d3466e9","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01PWXU4CEAsWhkFgs6zPXNGB","toolUseID":"toolu_01PWXU4CEAsWhkFgs6zPXNGB","timestamp":"2026-02-11T12:38:54.301Z","uuid":"c7a4e564-75f5-4887-8a09-3ceda2332035"}
{"parentUuid":"ed9b173b-3e84-4bee-8a5c-6c202d3466e9","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PWXU4CEAsWhkFgs6zPXNGB","type":"tool_result","content":"The file C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php has been updated successfully."}]},"uuid":"c845a2a6-713a-4a2f-a85f-e1eddf9631e4","timestamp":"2026-02-11T12:38:54.298Z","toolUseResult":{"filePath":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","oldString":"    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));","newString":"    dd($payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));","originalFile":"<?php\n\nuse Illuminate\\Support\\Str;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\{Auth, Cache, Route};\n\nRoute::get('/', function () {\n    return redirect()->route('login');\n});\n\nAuth::routes(['register' => false]);\n\n// Rutas de acceso para aplicante.\nRoute::group([\n    'prefix'    => 'control-acceso',\n    'namespace' => 'App\\Http\\Controllers\\Auth'\n], function ($ruta) {\n    $ruta->get('/acceso-expirado', 'LoginController@accesoExpirado')->name('control-acceso.token-expirado');\n    $ruta->get('/{token}', 'LoginController@controlarAcceso')->name('control-acceso');\n    $ruta->post('/login-automatico/{token}', 'LoginController@loginAutomatico')->name('control-acceso.login-automatico');\n});\n\n// Rutas de migración de usuarios desde la base de datos antigua.\nRoute::group([\n    'prefix'    => 'migrar-usuario-app-antigua',\n    'namespace' => 'App\\Http\\Controllers\\Usuarios'\n], function ($ruta) {\n    $ruta->get('/', 'UserController@migrarUsuario')->name('migrar-usuario-app-antigua')->middleware('validar-usuario-app-antigua');\n    $ruta->get('/error', 'UserController@migrarUsuarioError')->name('migrar-usuario-app-antigua.error');\n});\n\n// Rutas protegidas por autenticación y cambio de selección de rol y empresa.\nRoute::group([\n    'prefix'     => 'rol-empresa',\n    'namespace'  => 'App\\Http\\Controllers\\Auth',\n    'middleware' => ['auth', 'auth.cambio-rol-empresa']\n], function ($ruta) {\n    $ruta->get('/', 'RolController@formularioRolEmpresa')->name('rol-empresa');\n    $ruta->post('/sesion', 'RolController@guardarRolEmpresaSesion')->name('rol-empresa.guardar-en-sesion');\n});\n\n// Rutas protegidas por autenticación y selección de rol y empresa.\nRoute::group([\n    'middleware' => ['auth', 'auth.rol-empresa'],\n    'namespace'  => 'App\\Http\\Controllers'\n], function ($ruta) {\n    $ruta->get('usuario-validar-informacion-basica', 'Usuarios\\UserController@validarInformacionBasica');\n\n    $ruta->group(['middleware' => 'can:tablero'], function ($ruta) {\n        $ruta->get('inicio', 'DashboardController@index')->middleware('validar-datos-completados-usuario')->name('inicio');\n        $ruta->get('inicio-datos-panel', 'DashboardController@obtenerDatosPanel');\n\n        $ruta->group(['middleware' => 'can:tablero.usuarios'], function ($ruta) {\n            // Usuarios\n            $ruta->resource('usuarios', 'Usuarios\\UserController')->except(['index']);\n            $ruta->patch('usuarios-actualizar-multiples', 'Usuarios\\UserController@actualizarMultiples');\n            $ruta->post('usuarios-eliminar-multiples', 'Usuarios\\UserController@eliminarMultiples');\n            $ruta->post('usuarios-generar-acceso', 'Usuarios\\UserController@generarAcceso');\n            $ruta->get('usuarios-historial-cambios/{id}', 'Usuarios\\UserController@historialCambios');\n            $ruta->post('usuarios-historial-cambios-exportar/{id}', 'Usuarios\\UserController@exportarExcelHistorialCambios');\n            $ruta->get('usuarios-listado', 'Usuarios\\UserController@listado');\n            $ruta->get('usuarios-listado-empresa', 'Usuarios\\UserController@listadoAsociadosEmpresa');\n            $ruta->get('usuario', 'Usuarios\\UserController@obtenerUsuario');\n            $ruta->get('aplicante-informacion-personal/{id}', 'Usuarios\\UserController@informacionPersonalAplicante');\n            $ruta->post('usuario-actualizar-imagen', 'Usuarios\\UserController@actualizarImagenUsuario');\n            $ruta->get('usuario-notificaciones', 'Usuarios\\UserController@notificaciones');\n            $ruta->post('usuario-marcar-notificaciones-leidas', 'Usuarios\\UserController@marcarNotificacionesLeidas');\n            $ruta->post('exportar-excel-usuarios-empresa', 'Usuarios\\UserController@exportarExcelUsuariosEmpresa');\n\n            $ruta->post('usuarios-generar-qr-google', 'Usuarios\\UserController@obtenerQrGoogle');\n            $ruta->post('usuarios-validar-codigo-otp-google', 'Usuarios\\UserController@validarCodigoOtp');\n            $ruta->delete('usuarios-eliminar-clave-secreta-google/{id}', 'Usuarios\\UserController@eliminarClaveSecreta');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:pruebas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:pruebas.pruebas'], function ($ruta) {\n            // Pruebas\n            $ruta->get('pruebas/lista', 'Pruebas\\PruebaController@lista');\n            $ruta->resource('pruebas', 'Pruebas\\PruebaController');\n            $ruta->get('pruebas-listado', 'Pruebas\\PruebaController@listado');\n            $ruta->get('pruebas/{id}/factores', 'Pruebas\\PruebaController@getFactores');\n            $ruta->get('pruebas/{id}/reactivos', 'Pruebas\\PruebaController@getReactivos');\n            $ruta->post('pruebas-exportar', 'Pruebas\\PruebaController@exportarExcel');\n            $ruta->get('pruebas-conteo/{tipo_prueba_id}', 'Pruebas\\PruebaController@contarPruebasPorTipo');\n            $ruta->put('pruebas-archivar', 'Pruebas\\PruebaController@archivar');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.carga-masiva'], function ($ruta) {\n            // Carga masiva de pruebas\n            $ruta->get('carga-masiva', 'Pruebas\\PruebaController@cargaMasiva');\n            $ruta->post('carga-masiva-exportar', 'Pruebas\\PruebaController@exportarExcelCargaMasiva');\n            $ruta->post('carga-masiva-importar', 'Pruebas\\PruebaController@importarExcelCargaMasiva');\n            $ruta->post('pruebas-completas-exportar', 'Pruebas\\PruebaController@descargarPruebasCompletas');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.baremos'], function ($ruta) {\n            // Baremos\n            $ruta->get('baremos/lista', 'Pruebas\\BaremoController@lista');\n            $ruta->resource('baremos', 'Pruebas\\BaremoController');\n            $ruta->post('baremos-exportar', 'Pruebas\\BaremoController@exportarExcel');\n            $ruta->post('baremos-calcular', 'Pruebas\\BaremoController@calcularBaremos');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.dimensiones'], function ($ruta) {\n            // Dimensiones\n            $ruta->get('dimensiones/lista', 'Pruebas\\DimensionController@lista');\n            $ruta->get('dimensiones-listado', 'Pruebas\\DimensionController@listado');\n            $ruta->resource('dimensiones', 'Pruebas\\DimensionController');\n            $ruta->get('dimensiones-prueba/{id_prueba}', 'Pruebas\\DimensionController@getDimensionesPrueba');\n            $ruta->post('dimensiones-exportar', 'Pruebas\\DimensionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.factores'], function ($ruta) {\n            // Factores\n            $ruta->get('factores/lista', 'Pruebas\\FactorController@lista');\n            $ruta->get('factores-listado', 'Pruebas\\FactorController@listado');\n            $ruta->resource('factores', 'Pruebas\\FactorController');\n            $ruta->post('factores-exportar', 'Pruebas\\FactorController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.reactivos'], function ($ruta) {\n            // Reactivos\n            $ruta->get('reactivos-listado', 'Pruebas\\ReactivoController@listado');\n            $ruta->resource('reactivos', 'Pruebas\\ReactivoController');\n            $ruta->post('reactivos-exportar', 'Pruebas\\ReactivoController@exportarExcel');\n\n            // Opciones\n            $ruta->get('opciones-reactivo/{id_reactivo}', 'Pruebas\\OpcionController@getOpcionesReactivo');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.calificaciones'], function ($ruta) {\n            // Calificaciones\n            $ruta->get('calificaciones/lista', 'Pruebas\\CalificacionController@lista');\n            $ruta->resource('calificaciones', 'Pruebas\\CalificacionController');\n            $ruta->post('calificaciones-exportar', 'Pruebas\\CalificacionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.grupos-opciones'], function ($ruta) {\n            // Grupos de opciones\n            $ruta->get('grupos-opciones/lista', 'Pruebas\\GrupoOpcionController@lista');\n            $ruta->resource('grupos-opciones', 'Pruebas\\GrupoOpcionController');\n            $ruta->post('grupos-opciones-exportar', 'Pruebas\\GrupoOpcionController@exportarExcel');\n        });\n\n        $ruta->group(['middleware' => 'can:pruebas.secciones-textos'], function ($ruta) {\n            // Secciones de texto\n            $ruta->get('secciones-textos/lista', 'Reportes\\SeccionTextoController@lista');\n            $ruta->resource('secciones-textos', 'Reportes\\SeccionTextoController');\n            $ruta->post('secciones-textos-exportar', 'Reportes\\SeccionTextoController@exportarExcel');\n        });\n\n        $ruta->get('resultados-proceso-prueba-usuario', 'Pruebas\\PruebaController@obtenerResultadosProcesoPruebaUsuario');\n    });\n\n    $ruta->group(['middleware' => 'can:adicional-pruebas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:adicional-pruebas.perfiles'], function ($ruta) {\n            // Perfiles\n            $ruta->get('perfiles-listado-tabla', 'Pruebas\\PerfilController@getDatatable');\n            $ruta->post('perfiles-exportar', 'Pruebas\\PerfilController@exportarExcel');\n            $ruta->get('perfiles-agrupados-por-prueba', 'Pruebas\\PerfilController@agrupadosPorPrueba');\n        });\n\n        $ruta->group(['middleware' => 'can:adicional-pruebas.modulos-preguntas'], function ($ruta) {\n            // Módulos de preguntas\n            $ruta->resource('modulos-preguntas', 'Pruebas\\ModuloPreguntaController');\n            $ruta->get('modulos-preguntas-listado-tabla', 'Pruebas\\ModuloPreguntaController@getDatatable');\n            $ruta->get('modulos-preguntas-grupos/{prueba_id}', 'Pruebas\\ModuloPreguntaController@getGruposPorPrueba');\n            $ruta->post('modulos-preguntas-exportar', 'Pruebas\\ModuloPreguntaController@exportarExcel');\n            $ruta->post('ckeditor-upload-image', 'Pruebas\\ModuloPreguntaController@uploadImageCKEditor');\n        });\n\n        $ruta->group(['middleware' => 'can:adicional-pruebas.demograficas'], function ($ruta) {\n            // Demográficas\n            $ruta->resource('demograficas', 'Pruebas\\DemograficaController');\n            $ruta->get('demograficas-listado-tabla', 'Pruebas\\DemograficaController@getDatatable');\n            $ruta->post('demograficas-exportar', 'Pruebas\\DemograficaController@exportarExcel');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:empresas'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:empresas.listado-empresas'], function ($ruta) {\n            // Listado de empresas\n            $ruta->resource('empresas', 'Empresas\\EmpresaController');\n            $ruta->get('empresas-archivadas', 'Empresas\\EmpresaController@index');\n            $ruta->get('empresas-listado', 'Empresas\\EmpresaController@listado');\n            $ruta->get('empresas-listado-tabla', 'Empresas\\EmpresaController@getDatatable');\n            $ruta->get('empresas-listado-sucursales', 'Empresas\\EmpresaController@listadoSucursales');\n            $ruta->get('sucursales/create', 'Empresas\\EmpresaController@create')->name('crear.sucursal');\n            $ruta->get('sucursales/{id}/edit', 'Empresas\\EmpresaController@edit')->name('editar.sucursal');\n            $ruta->get('empresas-historial-cambios/{id}', 'Empresas\\EmpresaController@historialCambios');\n            $ruta->post('empresas-historial-cambios-exportar/{id}', 'Empresas\\EmpresaController@exportarExcelHistorialCambios');\n            $ruta->delete('empresas-eliminar-logo/{id}', 'Empresas\\EmpresaController@eliminarLogo');\n            $ruta->post('generar-enlace-creacion/{empresa_plan_id?}', 'Empresas\\EmpresaEnlaceCreacionController@generar');\n            $ruta->post('empresas-exportar', 'Empresas\\EmpresaController@exportarExcel');\n            $ruta->post('sucursales-exportar', 'Empresas\\EmpresaController@exportarExcelSucursales');\n            $ruta->get('empresas-propietario/{id}', 'Empresas\\EmpresaController@obtenerPropietario');\n            $ruta->get('sucursales', 'Empresas\\EmpresaController@sucursales');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.gestionar-empresas'], function ($ruta) {\n            // Gestionar empresas\n            $ruta->get('empresas-gestionar/{id?}/{submenu_vista?}', 'Empresas\\EmpresaController@gestionar');\n            $ruta->get('empresas-gestionar-datos/{id}', 'Empresas\\EmpresaController@datosGestionar');\n            $ruta->get('empresas-gestionar-sucursal/{id}', 'Empresas\\EmpresaController@gestionarSucursal');\n            $ruta->patch('empresas-contactos/{id}', 'Empresas\\EmpresaController@guardarContactos');\n\n            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.usuarios'], function ($ruta) {\n                // Usuarios\n                $ruta->get('usuarios-clientes', 'Usuarios\\UserController@index');\n                $ruta->get('usuarios-clientes-listado', 'Usuarios\\UserController@usuariosClientesListado');\n            });\n\n            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.planes'], function ($ruta) {\n                // Planes\n                $ruta->get('planes-clientes', 'Planes\\PlanController@planesClientes');\n                $ruta->get('listado-planes-cliente', 'Planes\\PlanController@listadoPlanesEmpresa');\n            });\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.archivo-empresas'], function ($ruta) {\n            // Archivo de empresas\n            $ruta->patch('empresas-archivos/{id}', 'Empresas\\EmpresaController@guardarArchivos');\n            $ruta->post('empresas-archivar/{id}', 'Empresas\\EmpresaController@archivar');\n            $ruta->get('empresas-detalle-archivado/{id}', 'Empresas\\EmpresaController@detalleArchivado');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.migracion-empresas'], function ($ruta) {\n            // Migración de empresas\n            $ruta->get('empresas-migracion', 'Empresas\\MigracionEmpresaController@index');\n            $ruta->post('empresas-migracion/buscar', 'Empresas\\MigracionEmpresaController@buscarEmpresa');\n            $ruta->post('empresas-migracion/validar-tamano', 'Empresas\\MigracionEmpresaController@validarTamanoEmpresa');\n            $ruta->post('empresas-migracion/iniciar', 'Empresas\\MigracionEmpresaController@iniciarMigracion');\n        });\n\n        $ruta->group(['middleware' => 'can:empresas.portales-empleo'], function ($ruta) {\n            // Portales de empleo\n            $ruta->get('portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n            $ruta->get('empresa-portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n            $ruta->post('portales-empleos', 'Empresas\\PortalEmpleoController@store')->name('portales-empleos.store');\n            $ruta->patch('portales-empleos/{id}', 'Empresas\\PortalEmpleoController@update')->name('portales-empleos.update');\n\n            // Premios destacados\n            $ruta->post('premios-destacados', 'Empresas\\PremioDestacadoController@store')->name('premios-destacados.store');\n            $ruta->delete('premios-destacados/{id}', 'Empresas\\PremioDestacadoController@destroy')->name('premios-destacados.destroy');\n\n            // Motivadores\n            $ruta->post('motivadores', 'Empresas\\MotivadorController@store');\n        });\n\n        $ruta->get('datos-empresa', 'Empresas\\EmpresaController@obtenerDatosEmpresa');\n        $ruta->get('empresa', 'DashboardController@paginaEmpresa');\n        $ruta->get('empresa-cambiar-logo', 'Empresas\\EmpresaController@paginaEmpresaCambiarImagen');\n    });\n\n    $ruta->group(['middleware' => 'can:ajustes-sistema.general.plantillas'], function ($ruta) {\n        $ruta->resource('plantillas-correos', 'Configuraciones\\PlantillaCorreoController')->except(['create', 'store', 'edit', 'destroy']);\n        $ruta->get('listado-plantillas-correos', 'Configuraciones\\PlantillaCorreoController@listado');\n        $ruta->put('plantillas-correos-restablecer/{id}', 'Configuraciones\\PlantillaCorreoController@restablecerPorDefecto');\n        $ruta->get('variables', 'Configuraciones\\VariableController@listado');\n    });\n\n    $ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n        // Planes\n        $ruta->resource('planes', 'Planes\\PlanController');\n        $ruta->get('planes-listado', 'Planes\\PlanController@listado');\n        $ruta->post('planes-exportar', 'Planes\\PlanController@exportarExcel');\n        $ruta->get('datos-empresas-planes', 'Empresas\\EmpresaPlanController@planesEmpresas');\n        $ruta->post('exportar-datos-empresas-planes', 'Empresas\\EmpresaPlanController@exportarExcelEmpresasPlanesEmpresas');\n        $ruta->get('empresas-planes-listado-tabla/{empresa_id}', 'Empresas\\EmpresaPlanController@datosTabla');\n        $ruta->resource('empresas-planes', 'Empresas\\EmpresaPlanController', ['only' => ['show', 'store', 'update', 'edit', 'destroy']]);\n        $ruta->get('asignar-plan/{empresa_id}', 'Empresas\\EmpresaPlanController@formularioAsignar');\n        $ruta->patch('empresas-planes-actualizar/{id}', 'Empresas\\EmpresaPlanController@actualizarInformacion');\n        $ruta->post('planes-clonar/{id}', 'Planes\\PlanController@clonar');\n        $ruta->get('planes-historial-cambios/{id}', 'Planes\\PlanController@historialCambios');\n        $ruta->get('funcionalidades-planes-historial-cambios/{plan_id}', 'Planes\\FuncionalidadPlanController@historialCambiosPorPlan');\n        $ruta->get('funcionalidades-listado', 'Planes\\FuncionalidadController@listado');\n        $ruta->get('empresas-planes-funcionalidades-listado', 'Empresas\\EmpresaPlanFuncionalidadController@listado');\n        $ruta->post('solicitud-renovacion-plan', 'Empresas\\EmpresaPlanController@solicitudRenovacionPlan');\n        $ruta->post('empresas-planes-descargar-factura/{archivo_id}', 'Empresas\\EmpresaPlanController@descargarFactura');\n\n        // Planes de Créditos - Vista de creación\n        $ruta->resource('planes-creditos', 'Planes\\PlanCreditoController');\n        $ruta->resource('servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n        $ruta->get('servicios-ia/{id}/creditos', 'IA\\ServicioIAController@creditos');\n        $ruta->post('servicios-ia/{id}/activar', 'IA\\ServicioIAController@activar');\n        $ruta->post('servicios-ia/{id}/desactivar', 'IA\\ServicioIAController@desactivar');\n        $ruta->get('empresas/{empresa_id}/creditos', 'Empresas\\EmpresaPlanController@obtenerPlanCreditos');\n        $ruta->get('creditos-disponibles-empresas/{id}', 'Empresas\\EmpresaPlanController@obtenerCreditosDisponiblesEmpresa');\n        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\n        $ruta->resource('categorias-servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n\n        $ruta->group(['middleware' => 'can:planes-consumo.consumo'], function ($ruta) {\n            // Consumos\n            $ruta->get('consumos', 'Empresas\\EmpresaPlanController@index');\n            $ruta->get('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@formularioFacturar');\n            $ruta->put('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@facturar');\n            $ruta->get('planes-historial-recompras/{empresa_id?}', 'Empresas\\EmpresaPlanController@historialRecompras');\n            $ruta->get('planes-historial-recompras-creditos/{empresa_id}', 'Empresas\\EmpresaPlanController@historialComprasCreditos');\n            $ruta->post('planes-historial-recompras-exportar', 'Empresas\\EmpresaPlanController@exportarExcelHistorialRecompras');\n            $ruta->post('planes-historial-creditos-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelHistorialCreditos');\n            $ruta->post('consumos-creditos-ia-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelConsumosCreditosIA');\n            $ruta->get('consumos-agendas-empresa-plan', 'Planes\\ConsumoController@consumosAgendasDeEmpresaPlan');\n            $ruta->get('consumos-ofertas-laborales-empresa-plan', 'Planes\\ConsumoController@consumosOfertasLaboralesDeEmpresaPlan');\n            $ruta->get('consumos-usuarios-empresa', 'Planes\\ConsumoController@consumosUsuariosEmpresa');\n            $ruta->post('consumos-plan-prueba-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanPrueba');\n            $ruta->post('consumos-plan-oferta-laboral-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanOfertaLaboral');\n            $ruta->post('consumos-plan-usuarios-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanUsuarios');\n        });\n\n        $ruta->group(['middleware' => 'can:planes-consumo.archivo-planes'], function ($ruta) {\n            // Archivo\n            $ruta->get('planes-archivados', 'Planes\\PlanController@index');\n            $ruta->post('planes-archivar/{id}', 'Planes\\PlanController@archivar');\n        });\n    });\n\n    // Perfiles laborales\n    $ruta->post('perfiles-laborales', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@store');\n    $ruta->post('perfiles-laborales-leer-hv-ia', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@obtenerInformacionHVConIA');\n    $ruta->get('perfiles-laborales-consultar-usuario/{usuario_id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@consultarPerfilLaboralUsuario');\n    $ruta->put('perfiles-laborales/{id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@update');\n\n    // Preguntas de ofertas laborales\n    $ruta->get('preguntas-ofertas-laborales', 'OfertasLaborales\\PreguntaOfertaLaboralController@index');\n    $ruta->get('bienvenida-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasPrefiltro');\n    $ruta->get('responder-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasPrefiltro');\n    $ruta->get('finalizacion-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasPrefiltro');\n    $ruta->post('respuestas-preguntas-ofertas-laborales', 'OfertasLaborales\\RespuestaPreguntaOfertaLaboralController@store');\n    $ruta->get('verificar-etapa-completada/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@verificarEtapaCompletada');\n\n    // Preguntas de videoentrevista\n    $ruta->get('bienvenida-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasVideoentrevista');\n    $ruta->get('responder-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasvideoentrevista');\n    $ruta->get('previsualizacion-prueba-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@previsualizacionPruebaVideoentrevista');\n    $ruta->get('finalizacion-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasVideoentrevista');\n\n    // Vacantes\n    $ruta->post('generar-adecuacion-hv/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionHV');\n    $ruta->post('generar-adecuacion-prefiltro/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPrefiltro');\n    $ruta->post('generar-adecuacion-pruebas-psicometricas/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPruebasPsicometricas');\n    $ruta->post('generar-adecuacion-videoentrevista/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionVideoentrevista');\n    $ruta->post('guardar-puntaje-adecuacion-reclutador', 'Vacantes\\EtapaVacanteUsuarioController@guardarPuntajeAdecuacionReclutador');\n    $ruta->post('guardar-puntaje-pregunta-reclutador', 'OfertasLaborales\\PuntajePreguntaOfertaLaboralController@guardarPuntajeReclutador');\n    $ruta->resource('etapas-usuarios-comentarios', 'Vacantes\\EtapaUsuarioComentarioController')->only(['index', 'store']);\n    $ruta->get('obtener-adecuacion-usuario', 'Vacantes\\EtapaVacanteUsuarioController@obtenerAdecuacionUsuario');\n    $ruta->get('obtener-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCandidatosRecomendadosIA');\n    $ruta->post('preguntar-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@preguntarSobreCandidatosRecomendados');\n    $ruta->post('vacantes-descargar-reporte-respuesta-ia', 'Vacantes\\VacanteController@descargarReporteRespuestaIA');\n    $ruta->post('vacantes-clonar-aplicante', 'Vacantes\\VacanteController@clonarAplicante');\n    $ruta->post('vacantes-exportar-archivos-aplicante/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@exportarArchivosZip');\n\n    $ruta->resource('formatos-entrevistas', 'Vacantes\\FormatoEntrevistaController')->except(['destroy']);\n\n    $ruta->patch('roles/actualizar-permisos/{rol}', 'Auth\\RolController@actualizarPermisos');\n    $ruta->patch('roles/restablecer-permisos/{rol}', 'Auth\\RolController@restablecerPermisos');\n\n    $ruta->group(['middleware' => 'can:ajustes-sistema'], function ($ruta) {\n        $ruta->group(['middleware' => 'can:ajustes-sistema.general'], function ($ruta) {\n            // Ajustes - General\n            $ruta->get('ajustes', 'Configuraciones\\ConfiguracionController@paginaAjustesGenerales');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.roles-permisos'], function ($ruta) {\n            // Ajustes - Roles y permisos\n            $ruta->get('roles', 'Auth\\RolController@index');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.deshacer-acciones'], function ($ruta) {\n            // Ajustes - Deshacer acciones\n            $ruta->post('agendas-restablecer/{id}', 'Agendas\\AgendaController@restablecerAgenda');\n            $ruta->post('agendas-validar-exportacion', 'Configuraciones\\ConfiguracionController@validarAgendaExportacion');\n            $ruta->post('agendas-exportar-respuestas', 'Configuraciones\\ConfiguracionController@exportarRespuestasAgenda');\n            $ruta->get('deshacer-acciones', 'Configuraciones\\ConfiguracionController@deshacerAcciones');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.anuncios-novedades'], function ($ruta) {\n            // Ajustes - Ofertas y anuncios\n            $ruta->resource('anuncios', 'Configuraciones\\AnuncioController');\n            $ruta->get('anuncios-listado-tabla', 'Configuraciones\\AnuncioController@datosTabla');\n            $ruta->get('anuncios-disponibilidad-fechas', 'Configuraciones\\AnuncioController@validarDisponibilidadFechas');\n            $ruta->delete('anuncios-eliminar-varios', 'Configuraciones\\AnuncioController@eliminarVarios');\n            $ruta->put('anuncios-cambiar-estado/{id}', 'Configuraciones\\AnuncioController@cambiarEstado');\n        });\n\n        $ruta->group(['middleware' => 'can:ajustes-sistema.psicoacademy'], function ($ruta) {\n            // Webinars\n            $ruta->resource('webinars', 'PsicoAcademy\\WebinarController')->except(['show']);\n            $ruta->get('webinars-listado-tabla', 'PsicoAcademy\\WebinarController@datosTabla');\n            $ruta->get('webinars-borrador/{tipo}', 'PsicoAcademy\\WebinarController@borrador');\n            $ruta->post('webinars-borrador', 'PsicoAcademy\\WebinarController@guardarBorrador');\n            $ruta->put('webinars-modificar-masivo/{tipo}', 'PsicoAcademy\\WebinarController@modificarMasivo');\n            $ruta->get('webinars-filtros', 'PsicoAcademy\\WebinarController@filtrosAplicados');\n\n            // Eventos\n            $ruta->resource('eventos', 'PsicoAcademy\\EventoController');\n            $ruta->get('eventos-listado-tabla', 'PsicoAcademy\\EventoController@datosTabla');\n            $ruta->get('eventos-borrador/{tipo}', 'PsicoAcademy\\EventoController@borrador');\n            $ruta->post('eventos-borrador', 'PsicoAcademy\\EventoController@guardarBorrador');\n            $ruta->get('eventos-filtros', 'PsicoAcademy\\EventoController@filtrosAplicados');\n            $ruta->get('eventos-listado', 'PsicoAcademy\\EventoController@listado');\n\n            // Guías\n            $ruta->resource('guias', 'PsicoAcademy\\GuiaController');\n            $ruta->get('guias-listado-tabla', 'PsicoAcademy\\GuiaController@datosTabla');\n            $ruta->get('guias-borrador/{tipo}', 'PsicoAcademy\\GuiaController@borrador');\n            $ruta->post('guias-borrador', 'PsicoAcademy\\GuiaController@guardarBorrador');\n            $ruta->delete('guias-borrar-archivo/{id}', 'PsicoAcademy\\GuiaController@borrarArchivo');\n            $ruta->get('guias-filtros', 'PsicoAcademy\\GuiaController@filtrosAplicados');\n\n            // Tutoriales\n            $ruta->resource('tutoriales', 'PsicoAcademy\\TutorialController');\n            $ruta->get('tutoriales-listado-tabla', 'PsicoAcademy\\TutorialController@datosTabla');\n            $ruta->get('tutoriales-borrador/{tipo}', 'PsicoAcademy\\TutorialController@borrador');\n            $ruta->post('tutoriales-borrador', 'PsicoAcademy\\TutorialController@guardarBorrador');\n            $ruta->get('tutoriales-filtros', 'PsicoAcademy\\TutorialController@filtrosAplicados');\n\n            // Podcast\n            $ruta->resource('podcast', 'PsicoAcademy\\PodcastController');\n            $ruta->get('podcast-listado-tabla', 'PsicoAcademy\\PodcastController@datosTabla');\n            $ruta->get('podcast-borrador/{tipo}', 'PsicoAcademy\\PodcastController@borrador');\n            $ruta->post('podcast-borrador', 'PsicoAcademy\\PodcastController@guardarBorrador');\n            $ruta->get('podcast-filtros', 'PsicoAcademy\\PodcastController@filtrosAplicados');\n\n            // Capacitación\n            $ruta->resource('capacitaciones', 'PsicoAcademy\\CapacitacionController');\n            $ruta->get('capacitaciones-listado-tabla', 'PsicoAcademy\\CapacitacionController@datosTabla');\n            $ruta->get('capacitaciones-borrador/{tipo}', 'PsicoAcademy\\CapacitacionController@borrador');\n            $ruta->post('capacitaciones-borrador', 'PsicoAcademy\\CapacitacionController@guardarBorrador');\n            $ruta->get('capacitaciones-filtros', 'PsicoAcademy\\CapacitacionController@filtrosAplicados');\n\n            // Certificación\n            $ruta->resource('certificaciones', 'PsicoAcademy\\CertificacionController');\n            $ruta->get('certificaciones-listado-tabla', 'PsicoAcademy\\CertificacionController@datosTabla');\n            $ruta->put('certificaciones-modificar-masivo/{tipo}', 'PsicoAcademy\\CertificacionController@modificarMasivo');\n            $ruta->get('certificaciones-borrador/{tipo}', 'PsicoAcademy\\CertificacionController@borrador');\n            $ruta->post('certificaciones-borrador', 'PsicoAcademy\\CertificacionController@guardarBorrador');\n            $ruta->get('certificaciones-filtros', 'PsicoAcademy\\CertificacionController@filtrosAplicados');\n        });\n    });\n\n    $ruta->group(['middleware' => 'can:soporte'], function ($ruta) {\n        // Soportes\n        $ruta->resource('soportes', 'Soportes\\SoporteController');\n        $ruta->post('soportes/subida-imagenes', 'Soportes\\SoporteController@subidaImagenes');\n        $ruta->get('soportes-listado-tabla', 'Soportes\\SoporteController@datosTabla');\n        $ruta->patch('soportes-actualizar/{id}', 'Soportes\\SoporteController@actualizarInformacion');\n        $ruta->get('soportes-contiguo/{id}', 'Soportes\\SoporteController@soporteContiguo');\n        $ruta->post('soportes-exportar', 'Soportes\\SoporteController@exportarExcel');\n        $ruta->resource('mensajes-soportes', 'Soportes\\MensajeSoporteController', ['only' => ['store', 'update', 'destroy']]);\n        $ruta->patch('mensajes-soportes-leidos/{id}', 'Soportes\\MensajeSoporteController@marcarMensajesLeidos');\n        $ruta->get('mensajes-soportes-listado-tabla', 'Soportes\\MensajeSoporteController@datosTabla');\n        $ruta->put('soportes-cambiar-estado', 'Soportes\\SoporteController@cambiarEstado');\n\n        // Manuales\n        $ruta->resource('manuales', 'Tutoriales\\ManualController');\n        $ruta->get('manuales-listado-tabla', 'Tutoriales\\ManualController@datosTabla');\n\n        $ruta->group(['middleware' => 'can:soporte.soporte-aplicantes'], function ($ruta) {\n            // Aplicantes\n            $ruta->get('soportes-aplicantes', 'Soportes\\SoporteController@index')->name('soportes.aplicantes');\n        });\n\n        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes'], function ($ruta) {\n            // Preguntas frecuentes\n            $ruta->resource('preguntas-frecuentes', 'Soportes\\PreguntaFrecuenteController');\n            $ruta->patch('preguntas-frecuentes-actualizar/{id}', 'Soportes\\PreguntaFrecuenteController@actualizarInformacion');\n            $ruta->patch('preguntas-frecuentes-ordenar/{id}/{orden}', 'Soportes\\PreguntaFrecuenteController@cambiarOrden');\n            $ruta->get('preguntas-frecuentes-listado-tabla', 'Soportes\\PreguntaFrecuenteController@listado');\n            $ruta->patch('preguntas-frecuentes-visualizaciones/{id}', 'Soportes\\PreguntaFrecuenteController@incrementarVisualizaciones');\n        });\n\n        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes.reaccionar'], function ($ruta) {\n            // Preguntas frecuentes reacciónes\n            $ruta->post('preguntas-frecuentes-reacciones', 'Soportes\\PreguntaFrecuenteReaccionController@guardarReaccion');\n        });\n    });\n\n    // Esta ruta debe ser asequible para los usuarios de todos los roles.\n    $ruta->post('configuraciones-modelos', 'Configuraciones\\ConfiguracionModeloController@store');\n    $ruta->get('configuraciones-obtener', 'Configuraciones\\ConfiguracionModeloController@obtenerConfiguracion');\n\n    $ruta->group(['middleware' => 'auth.rol-tipo-superadmin'], function ($ruta) {\n        // Módulos\n        $ruta->get('modulos/{id}', 'Planes\\ModuloController@show');\n        $ruta->get('modulos-listado', 'Planes\\ModuloController@listado');\n\n        // Auditorías\n        $ruta->get('auditorias-ultimo', 'Auditorias\\AuditController@obtenerUltimo');\n\n        // Accesos\n        $ruta->get('accesos-datos-mapa', 'Accesos\\AccesoController@datosMapa');\n\n        // Registros de actividad\n        $ruta->get('actividades-datos-mapa', 'Configuraciones\\ActividadController@datosMapa');\n\n        // Novedades\n        $ruta->resource('novedades', 'Configuraciones\\NovedadController')->except(['index', 'show', 'create', 'store', 'destroy']);\n        $ruta->post('novedades-restablecer/{id}', 'Configuraciones\\NovedadController@restablecer');\n        $ruta->post('novedades-pdf/{id}', 'Configuraciones\\NovedadController@descargarPDF');\n\n        // Países\n        $ruta->resource('paises', 'Configuraciones\\PaisController')->except(['show', 'destroy']);\n        $ruta->resource('departamentos', 'Configuraciones\\DepartamentoController')->except(['show', 'destroy']);\n        $ruta->get('departamentos-listado-tabla', 'Configuraciones\\DepartamentoController@datosTabla');\n        $ruta->resource('ciudades', 'Configuraciones\\CiudadController')->except(['show', 'destroy']);\n        $ruta->get('ciudades-listado-tabla', 'Configuraciones\\CiudadController@datosTabla');\n\n        // Reportes\n        $ruta->resource('reportes', 'Reportes\\ReporteController');\n        $ruta->resource('reportes-secciones', 'Reportes\\ReporteSeccionController')->only(['index']);\n        $ruta->resource('reportes-secciones-textos', 'Reportes\\ReporteSeccionTextoController')->only(['index']);\n\n        // Minería de datos.\n        $ruta->get('sesiones-listado', 'Auth\\SesionController@datosTabla');\n        $ruta->get('mineria-datos', 'DashboardController@indexAnaliticaMineriaDatos');\n\n        // Pruebas completas\n        $ruta->post('pruebas-completas-crear', 'Pruebas\\PruebaController@crearPruebaCompleta');\n        $ruta->get('pruebas-completas/{id}', 'Pruebas\\PruebaController@pruebaCompleta');\n        $ruta->get('pruebas-completas', 'Pruebas\\PruebaController@vistaPruebaCompleta');\n        $ruta->get('pruebas-completas-pagina-crear', 'Pruebas\\PruebaController@crearPrueba');\n        $ruta->get('pruebas-completas/{id}/editar', 'Pruebas\\PruebaController@editarPrueba');\n    });\n\n    $ruta->group(['middleware' => 'auth.rol-tipo-empresa'], function ($ruta) {\n        // Ordenes de servicio\n        // $ruta->resource('ordenes-servicio', 'OrdenesServicios\\OrdenServicioController'); // Se deja comentada temporalmente hasta que se retome ATS\n        $ruta->get('ordenes-servicio-generar-enlace-publico', 'OrdenesServicios\\OrdenServicioEnlaceCreacionController@generar');\n        $ruta->get('ordenes-servicio-listado-tabla', 'OrdenesServicios\\OrdenServicioController@datosTabla');\n\n        // Ofertas laborales\n        $ruta->get('ofertas-laborales/sin-disponibilidad', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles');\n        $ruta->get('ofertas-laborales/sin-plan-seleccion', 'OfertasLaborales\\OfertaLaboralController@sinPlanSeleccion');\n        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->only(['create', 'store'])->middleware('disponibilidad-ofertas-laborales');\n        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->except(['create', 'store']);\n        $ruta->post('exportar-excel-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@exportarExcelOfertasLaborales');\n        $ruta->get('ofertas-laborales-listado-tabla', 'OfertasLaborales\\OfertaLaboralController@datosTabla');\n        $ruta->get('ofertas-laborales-detalles/{id}', 'OfertasLaborales\\OfertaLaboralController@detalles');\n        $ruta->get('sin-disponibilidad-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles')\n        ->name('sin-disponibilidad-ofertas-laborales');\n        $ruta->put('ofertas-laborales-cambiar-tipo-publicacion', 'OfertasLaborales\\OfertaLaboralController@cambiarTipoPublicacion');\n        $ruta->post('ofertas-laborales-compartir', 'OfertasLaborales\\OfertaLaboralController@compartirPorCorreo');\n        $ruta->get('ofertas-laborales-generar-qr/{id}', 'OfertasLaborales\\OfertaLaboralController@generarQR');\n        $ruta->get('ofertas-laborales/{id}/aplicantes', 'OfertasLaborales\\OfertaLaboralController@aplicantes');\n        $ruta->get('ofertas-laborales/{id}/aplicantes/{aplicante_id}', 'OfertasLaborales\\OfertaLaboralController@detallesAplicante');\n        $ruta->post('ofertas-laborales/generar-informacion-ia', 'OfertasLaborales\\OfertaLaboralController@generarInformacionIA');\n        $ruta->post('ofertas-laborales/generar-pruebas-ia', 'OfertasLaborales\\OfertaLaboralController@generarPruebasConIA');\n\n        // Vacantes\n        $ruta->resource('vacantes', 'Vacantes\\VacanteController')->except(['show', 'edit', 'update']);\n        $ruta->get('vacantes-listado-tabla', 'Vacantes\\VacanteController@datosTabla');\n\n        $ruta->group(['middleware' => 'validar-acceso-vacante'], function ($ruta) {\n            $ruta->get('vacantes-detalle/{id}', 'Vacantes\\VacanteController@paginaDetalle');\n            $ruta->resource('vacantes', 'Vacantes\\VacanteController')->only(['show', 'edit', 'update']);\n            $ruta->post('vacantes-completar/{id}', 'Vacantes\\VacanteController@completar');\n            $ruta->put('vacantes-cambiar-estado', 'Vacantes\\VacanteController@cambiarEstado');\n            $ruta->put('vacantes-archivar', 'Vacantes\\VacanteController@archivarVacante');\n            $ruta->get('etapas-vacantes-aplicantes/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerEtapasAplicantes');\n            $ruta->get('vacantes-detalle-aplicante/{vacante_id}/{usuario_id}', 'Vacantes\\VacanteController@obtenerDetalleAplicante');\n            $ruta->get('vacantes-listado-aplicantes/{vacante_id}', 'Vacantes\\VacanteController@obtenerListadoAplicantes');\n            $ruta->get('vacantes-calcular-dias-duracion-proceso/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDiasDuracionProceso');\n        });\n\n        $ruta->get('configuraciones-etapa-movimiento/{id}', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@index');\n        $ruta->post('etapas-movimientos-vacantes-configuraciones', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@store');\n        $ruta->get('etapas-vacantes', 'Vacantes\\EtapaVacanteController@index');\n        $ruta->put('etapas-vacantes/{id}', 'Vacantes\\EtapaVacanteController@update');\n        $ruta->get('vacantes-habilidades-herramientas', 'Vacantes\\VacanteController@obtenerHabilidadesHerramientas');\n        $ruta->put('etapas-vacantes-cambiar-orden', 'Vacantes\\EtapaVacanteController@cambiarOrden');\n        $ruta->post('vacantes-postular-aplicantes', 'Vacantes\\VacanteController@postularAplicantes');\n        $ruta->resource('documentos-solicitables', 'Vacantes\\DocumentoSolicitableController');\n        $ruta->post('vacantes-preguntas', 'Vacantes\\VacanteController@guardarPreguntas');\n        $ruta->post('etapas-vacantes-adjuntar-archivos', 'Vacantes\\EtapaVacanteController@adjuntarArchivosPruebaTecnica');\n        $ruta->delete('etapas-vacantes/{etapa_vacante_id}/eliminar-etapa-prueba-tecnica', 'Vacantes\\EtapaVacanteController@eliminarEtapaPruebaTecnica');\n        $ruta->get('etapas-vacantes/{etapa_vacante_id}/obtener-configuraciones-prueba-tecnica', 'Vacantes\\EtapaVacanteController@obtenerConfiguracionesPruebaTecnica');\n        $ruta->post('generar-vacante', 'Vacantes\\VacanteController@generarConIA');\n        $ruta->post('generar-preguntas-prefiltro', 'Vacantes\\VacanteController@generarPreguntasPrefiltro');\n        $ruta->post('generar-preguntas-videoentrevista', 'Vacantes\\VacanteController@generarPreguntasVideoentrevista');\n        $ruta->post('generar-pruebas-psicometricas', 'Vacantes\\VacanteController@generarPruebasPsicometricas');\n        $ruta->post('vacantes-duplicar', 'Vacantes\\VacanteController@duplicar');\n        $ruta->post('vacantes-descartar-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@descartarAplicantesManual');\n        $ruta->post('vacantes-mover-etapa-aplicante/{id}', 'Vacantes\\EtapaVacanteUsuarioController@moverAplicanteEtapaManual');\n        $ruta->get('vacantes-competencias-mejorar/{id}', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCompetenciasPorMejorar');\n        $ruta->post('vacantes-revertir-descarte-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@revertirDescarteAplicantes');\n        $ruta->post('vacantes-comparativo-basico-aplicantes', 'Vacantes\\VacanteController@generarReporteComparativoVacantes');\n\n        // TODO: Estos dos endpoints no están completos, el primero funciona pero no es lo que se necesita, hay que hacer que el segundo funcione como el primero\n        $ruta->get('resultados-coincidencia-oferta-laboral/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\MovimientoController@resultadosCoincidenciaUsuario');\n        $ruta->get('resultados-coincidencia-oferta-laboral-test/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\CategoriaAdecuacionController@resultadosCoincidenciaUsuario');\n\n        // TODO: Falta definir la ruta. No se sabe si existirá una ruta genérica que cambie a un aplicante de una etapa a otra dentro de una oferta laboral o\n        // si habrán varios end-points para cada una de las etapas que existirán dentro del proceso de contratación en una oferta laboral...\n        $ruta->post('ofertas-laborales-cambiar-usuario-etapa', 'OfertasLaborales\\OfertaLaboralController@cambiarUsuarioEtapa');\n\n        // Etapas\n        $ruta->resource('etapas', 'OfertasLaborales\\EtapaController')->only(['show', 'store', 'update', 'destroy']);\n        $ruta->get('etapas-listado', 'OfertasLaborales\\EtapaController@listado');\n        $ruta->post('movimientos-configuraciones', 'OfertasLaborales\\EtapaMovimientoConfiguracionController@store');\n        $ruta->put('descartar-candidatos-etapa', 'OfertasLaborales\\EtapaController@descartarCandidatosEtapa');\n        $ruta->get('etapas-verificar-nombre-repetido/{oferta_laboral_id}/{nombre}', 'OfertasLaborales\\EtapaController@validarNombreRepetido');\n        $ruta->post('etapas-mover/{id}/{orden}', 'OfertasLaborales\\EtapaController@cambiarOrden');\n\n        // Movimientos\n        $ruta->get('movimientos-listado', 'OfertasLaborales\\MovimientoController@listado');\n        $ruta->get('movimientos-configuraciones-listado', 'OfertasLaborales\\MovimientoConfiguracionController@listado');\n        $ruta->get('movimientos-configuraciones/{id}', 'OfertasLaborales\\MovimientoConfiguracionController@show');\n        $ruta->post('movimientos-configuraciones-preguntas', 'OfertasLaborales\\MovimientoConfiguracionController@guardarPreguntasVideoEntrevista');\n\n        // Novedades\n        $ruta->get('novedades', 'Configuraciones\\NovedadController@index');\n\n        $ruta->get('feedback', 'DashboardController@enConstruccion');\n        $ruta->get('planes-accion', 'DashboardController@enConstruccion');\n\n        // Procesos\n        $ruta->resource('procesos', 'Procesos\\ProcesoController');\n        $ruta->get('procesos-listado', 'Procesos\\ProcesoController@listado');\n        $ruta->get('procesos-listado-tabla', 'Procesos\\ProcesoController@datosTabla');\n        $ruta->patch('procesos-actualizar/{id}', 'Procesos\\ProcesoController@actualizarInformacion');\n        $ruta->post('procesos-duplicar/{id}', 'Procesos\\ProcesoController@duplicar');\n        $ruta->post('procesos-suspender/{id}', 'Procesos\\ProcesoController@suspender');\n        $ruta->post('procesos-activar/{id}', 'Procesos\\ProcesoController@activar');\n        $ruta->put('procesos-archivar', 'Procesos\\ProcesoController@archivarProceso');\n        $ruta->post('procesos-exportar', 'Procesos\\ProcesoController@exportarExcel');\n        $ruta->post('procesos-compartir/{id}', 'Procesos\\ProcesoController@compartir');\n        $ruta->post('procesos-compartir-resultados-aplicante', 'Procesos\\ProcesoController@compartirResultadosAplicante');\n        $ruta->get('participantes-proceso/{id}', 'Usuarios\\UserController@participantesProceso');\n        $ruta->post('procesos-exportar-participantes', 'Usuarios\\UserController@exportarParticipantesProcesoExcel');\n        $ruta->post('participantes-descartar', 'Procesos\\ProcesoController@descartarParticipantes');\n        $ruta->post('participante-seleccionar', 'Procesos\\ProcesoController@seleccionarParticipante');\n        $ruta->post('participantes-cambiar-proceso', 'Procesos\\ProcesoController@moverDeProceso');\n        $ruta->delete('participantes-eliminar/{proceso_id}/{usuario_id}', 'Procesos\\ProcesoController@eliminarParticipante');\n        $ruta->post('procesos-participantes/{id}', 'Procesos\\ProcesoController@agregarParticipantes');\n        $ruta->post('participantes-reagendar', 'Procesos\\ProcesoController@reagendarParticipantes');\n        $ruta->get('participante/{id}', 'Usuarios\\UserController@obtenerParticipanteProceso');\n        $ruta->get('procesos-detalles-participante', 'Usuarios\\UserController@detallesParticipanteProceso');\n        $ruta->post('agendas-participante', 'Agendas\\AgendaController@agendasParticipante');\n        $ruta->delete('agendas/{id}', 'Agendas\\AgendaController@destroy');\n        $ruta->post('agendas-reprocesar/{id}', 'Agendas\\AgendaController@reprocesarAgenda');\n        $ruta->post('procesos-reporte-resultados-excel', 'Procesos\\ProcesoController@exportarReporteResultadosExcel');\n        $ruta->get('procesos-indice-talento/{proceso_id}/{aplicante_id}', 'Procesos\\ProcesoController@obtenerIndiceTalento');\n        $ruta->get('agendas-copiar-resultados', 'Agendas\\AgendaController@copiarAgenda');\n        $ruta->post('procesos-mejores-candidatos', 'Procesos\\ProcesoController@mejoresCandidatosIA');\n        $ruta->post('procesos-validar-agendas-expiradas/{id}', 'Procesos\\ProcesoController@validarAgendasExpiradas');\n        $ruta->get('plantilla-correo', 'Configuraciones\\PlantillaCorreoController@obtenerPlantilla');\n        $ruta->get('procesos-descargar-guia-agendamiento-masivo', 'Procesos\\ProcesoController@descargarGuiaAgendamientoMasivo');\n        $ruta->post('procesos-extraer-datos-participantes', 'Procesos\\ProcesoController@extraerDatosParticipantes');\n\n        // Firmas de rutas\n        $ruta->get('firmas-rutas-por-proceso/{proceso_id}', 'Accesos\\FirmaRutaController@porProceso');\n\n        // Perfiles pruebas\n        $ruta->get('perfiles-pruebas', 'Pruebas\\PerfilController@perfilesPruebas');\n\n        // Agendas\n        $ruta->get('pruebas-empresas/{id}', 'Pruebas\\PruebaController@obtenerPruebasEmpresa');\n        $ruta->get('candidatos', 'Agendas\\AgendaController@historialAgendamientos');\n        $ruta->get('listado-historial-agendamientos', 'Agendas\\AgendaController@listadoHistorialAgendamientos');\n        $ruta->post('exportar-excel-historial-agendamientos', 'Agendas\\AgendaController@exportarExcelHistorialAgendamientos');\n\n        // Comentarios\n        $ruta->resource('comentarios', 'OfertasLaborales\\ComentarioController')->only(['index', 'store']);\n\n        // Usuarios\n        $ruta->post('generar-acceso-usuario/{usuario_id}', 'Usuarios\\TokenAccesoController@generarAcceso');\n    });\n\n    $ruta->group(['middleware' => 'auth.es-superadmin'], function ($ruta) {\n        $ruta->get('empresa-sucursales', 'Empresas\\EmpresaController@empresaSucursales');\n\n        // Debug de calificaciones de agendas\n        $ruta->get('debug/calificacion/{agenda_id}', 'Debug\\DebugCalificacionController@mostrar')->name('debug.calificacion.mostrar');\n        $ruta->get('debug/calificacion/{agenda_id}/calcular', 'Debug\\DebugCalificacionController@obtenerCalificacion')->name('debug.calificacion.calcular');\n        $ruta->post('debug/calificacion/{agenda_id}/simular', 'Debug\\DebugCalificacionController@simularCalificacion')->name('debug.calificacion.simular');\n        $ruta->post('debug/calificacion/{agenda_id}/actualizar', 'Debug\\DebugCalificacionController@actualizarRespuestas')->name('debug.calificacion.actualizar');\n    });\n\n    // Suplantación de rol Administrador general\n    $ruta->group(['middleware' => 'auth.suplantar-admin-general'], function ($ruta) {\n        $ruta->post('suplantar-rol-admin-general', 'Auth\\RolController@suplantarRolAdministradorGeneral')->name('suplantar-rol-admin-general');\n    });\n\n    // Suplantación de rol Administrador sucursal\n    $ruta->group(['middleware' => 'auth.suplantar-admin-sucursal'], function ($ruta) {\n        $ruta->post('suplantar-rol-admin-sucursal', 'Auth\\RolController@suplantarRolAdministradorSucursal')->name('suplantar-rol-admin-sucursal');\n    });\n\n    // Restablecimiento de la sesión original que había antes de la suplantación\n    $ruta->group(['middleware' => 'auth.rol-suplantado'], function ($ruta) {\n        $ruta->post('restablecer-sesion-original', 'Auth\\RolController@restablecerSesionOriginal')->name('restablecer-sesion-original');\n    });\n\n    // Ruta para completar los datos de un usuario aplicante\n    $ruta->group(['middleware' => 'auth.rol-tipo-evaluado'], function ($ruta) {\n        $ruta->put('completar-datos-usuario/datos-generales/{id}', 'Usuarios\\UserController@completarDatosGenerales');\n        $ruta->put('completar-datos-usuario/datos-acceso/{id}', 'Usuarios\\UserController@completarDatosAcceso');\n        $ruta->get('completar-datos-usuario/{id}', 'Usuarios\\UserController@paginaCompletarDatos')->name('usuarios.completar-datos');\n        $ruta->get('recomendaciones', 'Usuarios\\UserController@vistaRecomendaciones');\n    });\n\n    // Rutas de usuario aplicante que requieren que este haya completados sus datos\n    $ruta->group(['middleware' => ['validar-datos-completados-usuario', 'auth.rol-tipo-evaluado']], function ($ruta) {\n        $ruta->get('ofertas-laborales-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantes')->name('ofertas-laborales-aplicantes');\n        $ruta->get('ofertas-guardadas-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantesGuardados');\n        $ruta->post('ofertas-laborales-postular-aplicante/{oferta_laboral_id}/{perfil_laboral_id?}', 'OfertasLaborales\\OfertaLaboralController@postularAplicante');\n        $ruta->post('ofertas-laborales-abandonar-postulacion-aplicante/{oferta_laboral_id}', 'OfertasLaborales\\OfertaLaboralController@abandonarPostulacionAplicante');\n        $ruta->get('ofertas-laborales-postular-aplicante-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@postularAplicanteSinAutenticar');\n        $ruta->post('ofertas-laborales-guardar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardar');\n        $ruta->get('ofertas-laborales-guardar-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardarSinAutenticar');\n        $ruta->post('ofertas-laborales-quitar-guardado/{id}', 'OfertasLaborales\\OfertaLaboralController@quitarGuardado');\n        $ruta->get('soportes-aplicante', 'DashboardController@enConstruccion');\n        $ruta->get('preguntas-frecuentes-aplicante', 'DashboardController@enConstruccion');\n        $ruta->get('completar-demograficas/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@formularioDemograficas');\n        $ruta->get('demograficas-ajax/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@obtenerDemograficasAjax');\n        $ruta->post('agendas-demograficas-opciones', 'Agendas\\AgendaController@guardarRespuestasDemograficas');\n        $ruta->get('realizar-prueba/{agenda_id}', 'Agendas\\AgendaController@paginaRealizarPrueba')->name('prueba.realizar');\n        $ruta->get('agendas-reactivos/{agenda_id}', 'Agendas\\AgendaReactivoController@listado');\n        $ruta->put('descontar-tiempo-agenda', 'Agendas\\AgendaTiempoController@descontarTiempo');\n        $ruta->post('agendas-reactivos-respuestas', 'Agendas\\AgendaReactivoController@guardarRespuestasReactivos');\n        $ruta->get('agendas-reactivos-respondidos/{agenda_id}', 'Agendas\\AgendaReactivoController@obtenerReactivosRespondidos');\n        $ruta->post('agendas-procesar-resultados', 'Agendas\\AgendaController@procesarResultados');\n        $ruta->post('agendas-guardar-foto', 'Agendas\\AgendaController@guardarArchivoAgenda');\n        $ruta->get('ofertas-laborales-detalles-aplicante/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesParaAplicante')\n            ->name('ofertas-laborales.detalles-aplicante');\n        $ruta->post('agendas-guardar-archivo', 'Agendas\\AgendaController@guardarArchivoAgenda');\n        $ruta->get('agendas_validar_pendientes/{agenda_id}', 'Agendas\\AgendaController@validarAgendasPendientes');\n\n        $ruta->resource('experiencias-laborales', 'Usuarios\\PerfilesLaborales\\ExperienciaLaboralController')->only(['store', 'update', 'destroy']);\n    });\n\n    // Ofertas laborales\n    $ruta->post('ofertas-laborales-descartar-aplicante/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\OfertaLaboralController@descartarAplicante');\n\n    // Perfiles - Rutas específicas primero para evitar conflictos con resource\n    $ruta->get('perfiles/prueba/{id}/factores-dimensiones', 'Pruebas\\PerfilController@getFactoresDimensiones');\n    $ruta->post('perfiles/generar-ia', 'Pruebas\\PerfilController@generarConIA');\n    $ruta->get('perfiles/datos-adicionales', 'Pruebas\\PerfilController@getDatosAdicionales');\n    $ruta->post('perfiles/crear-desde-ia', 'Pruebas\\PerfilController@crearDesdeIA');\n    $ruta->resource('perfiles', 'Pruebas\\PerfilController');\n    $ruta->get('factores-pruebas/{prueba_id}', 'Pruebas\\FactorController@obtenerTodoPorPrueba');\n\n    // Usuarios\n    $ruta->post('enviar-codigo-autorizacion', 'Usuarios\\UserController@enviarCodigoAutorizacion');\n    $ruta->post('verificar-codigo-autorizacion', 'Usuarios\\UserController@verificarCodigoAutorizacion');\n\n    // Perfiles\n    $ruta->get('perfiles-listado', 'Pruebas\\PerfilController@listado');\n    $ruta->get('perfiles-listado-empresa', 'Pruebas\\PerfilController@listadoEmpresa');\n    $ruta->post('perfiles-archivar/{id}', 'Pruebas\\PerfilController@archivar');\n    $ruta->post('perfiles-clonar', 'Pruebas\\PerfilController@clonar');\n    $ruta->post('perfiles-pdf/{id}', 'Pruebas\\PerfilController@descargarPDF');\n\n    // Archivos\n    $ruta->get('archivos', 'Configuraciones\\ArchivoController@listado');\n    $ruta->get('archivos-obtener-uno', 'Configuraciones\\ArchivoController@obtenerUno');\n    $ruta->delete('archivos/{id}', 'Configuraciones\\ArchivoController@destroy');\n\n    // Menú clientes\n    $ruta->get('psicoacademy-cliente', 'DashboardController@paginaPsycoAcademyCliente');\n    $ruta->get('uso-experiencia', 'DashboardController@paginaUsoExperiencia');\n    $ruta->get('mis-pruebas', 'DashboardController@paginaMisPruebas')->middleware('validar-datos-completados-usuario');\n\n    $ruta->get('tareas-pendientes-aplicantes', 'DashboardController@paginaMisPruebasAplicante')->name('tareas-pendientes-aplicantes');\n    $ruta->get('tareas-pendientes-aplicantes-data', 'DashboardController@tareasPendientesData');\n    $ruta->get('tareas-completadas-aplicantes', 'DashboardController@paginaMisPruebasAplicanteCompletadas')->name('tareas-completadas-aplicantes');\n    $ruta->get('resultados-evaluacion-aplicantes', 'DashboardController@paginaFeedbackAplicante');\n    $ruta->get('planes-accion-aplicantes', 'DashboardController@paginaPlanesAccionAplicante');\n\n    $ruta->get('vacantes-aplicante', 'Vacantes\\VacanteController@obtenerVacantesAplicante');\n    $ruta->resource('pruebas-tecnicas', 'Vacantes\\PruebaTecnicaController');\n    $ruta->post('vacantes-guardar-documentos-solicitados', 'Vacantes\\EtapaVacanteUsuarioController@guardarDocumentoSolicitado');\n    $ruta->get('vacantes-documentos-solicitados/{etapa_vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDocumentosContratacion');\n    $ruta->post('vacantes-exportar-archivos-etapa/{etapa_id}', 'Vacantes\\EtapaVacanteController@exportarArchivosZip');\n    $ruta->post('vacantes-notificar-documentos-solicitados/{id}', 'Vacantes\\EtapaVacanteUsuarioController@notificarDocumentosSolicitados');\n    $ruta->post('vacantes-abandonar-vacante', 'Vacantes\\EtapaVacanteUsuarioController@abandonarVacante');\n    $ruta->get('vacantes-listado-postulaciones-aplicante', 'Vacantes\\VacanteController@listadoPostulacionesAplicanteEspecifico');\n    $ruta->get('vacantes-postulaciones-aplicantes', 'Vacantes\\VacanteController@vistaPostulacionesAplicante');\n\n    // Agendas - Accesible para aplicantes y usuarios de empresa\n    $ruta->get('agendas-aplicante', 'Procesos\\ProcesoController@obtenerPruebasAplicante');\n\n    // Rutas para servir imágenes - accesibles para aplicantes Y Superadmin\n    $ruta->get('modulos-preguntas-imagen/{nombre_archivo}', 'Pruebas\\ModuloPreguntaController@getImagen');\n    $ruta->get('reactivos-imagen-por-id/{reactivo_id}', 'Pruebas\\ReactivoController@getImagenPorId');\n    $ruta->get('opciones-imagen-por-id/{opcion_id}', 'Pruebas\\OpcionController@getImagenPorId');\n    $ruta->get('preguntas-frecuentes-imagen/{nombre_archivo}', 'Soportes\\PreguntaFrecuenteController@getImagen');\n\n    $ruta->get('psicometricas', 'DashboardController@enConstruccion');\n    $ruta->get('ordenes', 'DashboardController@enConstruccion');\n\n    $ruta->get('consumo-clientes', 'DashboardController@paginaEmpresa');\n    $ruta->get('configuraciones-clientes', 'Configuraciones\\ConfiguracionController@paginaConfiguraciones');\n    $ruta->get('roles-permisos', 'Auth\\RolController@rolesPermisosMiEmpresa');\n\n    $ruta->get('propuestas', 'DashboardController@enConstruccion');\n    $ruta->get('novedades', 'DashboardController@enConstruccion');\n\n    // Áreas\n    $ruta->get('areas-listado', 'Empresas\\AreaController@listado');\n    $ruta->post('areas', 'Empresas\\AreaController@store');\n\n    // Cargos\n    $ruta->get('cargos-listado', 'Empresas\\CargoController@listado');\n    $ruta->post('cargos', 'Empresas\\CargoController@store');\n\n    // Niveles educativos\n    $ruta->get('niveles-educativos', 'OfertasLaborales\\NivelEducativoController@index');\n\n    // Áreas de estudio\n    $ruta->get('areas-estudios', 'Usuarios\\PerfilesLaborales\\AreaEstudioController@index');\n\n    // Idiomas\n    $ruta->get('idiomas', 'Usuarios\\PerfilesLaborales\\IdiomaController@index');\n\n    // Autenticación del websoket\n    $ruta->post('/broadcasting-auth', 'Broadcasting\\BroadcastingController@autenticar');\n\n    $ruta->get('/botones', function () {\n        return view('botones');\n    })->name('botones');\n\n    $ruta->get('pruebas-plantillas', 'DashboardController@plantillasPruebas');\n    $ruta->get('componentes/index', 'ComponenteController@index')->name('componentes');\n    $ruta->get('componentes/lista', 'ComponenteController@getLista')->name('componentes-lista');\n\n    // Rutas temporales (hay que eliminarlas cuando se desarrollen sus respectivos módulos)\n    $ruta->get('analiticas', 'DashboardController@index');\n    $ruta->get('en-construccion', 'DashboardController@enConstruccion');\n    $ruta->get('uso-panel-demografico', 'DashboardController@indexAnaliticaUsoPanelDemografico');\n    $ruta->get('panel-demografico', 'DashboardController@indexAnaliticaPanelDemografico');\n    $ruta->get('uso', 'DashboardController@indexAnaliticaUso');\n    $ruta->get('experiencia', 'DashboardController@indexAnaliticaExperiencia');\n\n    // Rutas de componentes de desarrollo\n    $ruta->get('/componentes/{menu}/{modulo}', 'ComponenteController@componentes');\n    $ruta->post('/componentes/prueba', 'ComponenteController@pruebaComponentes');\n\n    // TODO: ruta de prueba, eliminarla próximamente\n    $ruta->get('visualizar-reporte', 'DashboardController@enConstruccion');\n    $ruta->get('reportes-generar/{agenda_id}', 'Reportes\\ReporteController@generar');\n    $ruta->get('reporte-agenda/{agenda_id}', 'Reportes\\ReporteController@mostrarReporteAgenda');\n    $ruta->post('reportes-agendas-zip', 'Reportes\\ReporteController@descargarReportesZip');\n    $ruta->get('reportes-generar-comparativo', 'Reportes\\ReporteController@generarComparativo');\n\n    // Rutas para las encuestas\n    $ruta->get('validar-encuesta/{id}', 'Encuestas\\EncuestaController@obtenerUnoDeUsuario');\n    $ruta->post('encuestas-guardar-respuestas', 'Encuestas\\EncuestaController@guardarRespuestas');\n});\n\n// Rutas no protegidas por autenticación\nRoute::group([\n    'namespace' => 'App\\Http\\Controllers'\n], function ($ruta) {\n    // Contraseñas\n    $ruta->post('contrasenas/verificar-uso', 'Usuarios\\ContrasenaController@verificarUso');\n\n    // Empresas\n    $ruta->get('empresas-parametrizar/{hash}/{id?}', 'Empresas\\EmpresaEnlaceCreacionController@index');\n    $ruta->post('empresas-parametrizar', 'Empresas\\EmpresaEnlaceCreacionController@crearEmpresa');\n    $ruta->post('empresas-parametrizar-archivos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarArchivosEmpresa');\n    $ruta->post('empresas-parametrizar-contactos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarContactosEmpresa');\n    $ruta->get('empresas-logo/{id}', 'Empresas\\EmpresaController@getLogo');\n\n    // Ordenes de servicio\n    $ruta->group([\n        'middleware' => 'orden-servicio-enlace-publico'\n    ], function ($ruta) {\n        $ruta->get('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@crearPorEnlacePublico');\n        $ruta->post('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@guardarDesdeEnlacePublico');\n    });\n\n    $ruta->get('/ordenes-servicio-enlace-publico/error', 'OrdenesServicios\\OrdenServicioController@errorEnlacePublico');\n\n    // Países\n    $ruta->get('paises-listado', 'Configuraciones\\PaisController@listado');\n    $ruta->get('paises-listado-completo', 'Configuraciones\\PaisController@listadoCompleto');\n\n    // Departamentos\n    $ruta->get('departamentos-listado', 'Configuraciones\\DepartamentoController@listado');\n\n    // Ciudades\n    $ruta->get('ciudades-listado', 'Configuraciones\\CiudadController@listado');\n\n    // Portales de empleo\n    $ruta->get('portales-empleo', 'Empresas\\PortalEmpleoController@portalesEmpleo');\n    $ruta->get('portales-empleo/oferta-laboral/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesPortalEmpleo');\n    $ruta->get('portales-empleo/{portal_empleo_uuid}', 'Empresas\\PortalEmpleoController@portalEmpleoEmpresa');\n    $ruta->get('portales-empleo/crear/aplicante', 'Empresas\\PortalEmpleoController@crearAplicante');\n    $ruta->post('portales-empleo-enviar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@enviarCodigoAutorizacionCrearAplicante');\n    $ruta->post('portales-empleo-verificar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@verificarCodigoAutorizacionCrearAplicante');\n\n    // Firmas de rutas\n    $ruta->get('firmas-rutas-expirada', 'Accesos\\FirmaRutaController@firmaRutaExpirada')->name('firma-ruta-expirada');\n    $ruta->get('firmas-rutas-formulario-acceso/{id}', 'Accesos\\FirmaRutaController@formularioAcceso')->name('formulario-acceso-ruta-firmada');\n    $ruta->post('firmas-rutas-validar-formulario-acceso', 'Accesos\\FirmaRutaController@validarFormularioAcceso')->name('validar-formulario-acceso-ruta-firmada');\n    $ruta->post('firmas-rutas-revocar-acceso/{id}', 'Accesos\\FirmaRutaController@revocarAcceso');\n\n    // Archivos\n    $ruta->get('archivos-abrir/{id}', 'Configuraciones\\ArchivoController@abrir');\n\n    // Imagen de usuarios\n    $ruta->get('usuarios-imagen/{id}', 'Usuarios\\UserController@getImagen');\n\n    // Consultar reportes con firma\n    $ruta->get('reporte-agenda-firmado/{id}/{firma}', 'Reportes\\ReporteController@mostrarReporteAgendaValidacion');\n\n    $ruta->get('funcionalidades-activas-plan', 'Empresas\\EmpresaPlanController@funcionalidadesActivasPlan');\n});\n\n/**\n * Rutas protegidas por firma: El acceso a estas rutas está limitado por la vigencia de la firma con la que se accede a la ruta.\n *\n * @author Fahibram Cárcamo\n */\nRoute::group([\n    'prefix'     => 'rutas-firmadas',\n    'middleware' => ['ruta-firmada'],\n    'namespace'  => 'App\\Http\\Controllers'\n], function ($ruta) {\n    $ruta->get('procesos/{id}', 'Procesos\\ProcesoController@showFirmada');\n    $ruta->get('procesos-resultados-aplicante/{proceso_id}/{participante_id}', 'Procesos\\ProcesoController@showResultadosAplicanteFirmada');\n});\n\n/**\n * Genera un token SSO firmado y redirige a WordPress.\n *\n * Flujo:\n *  - Requiere un usuario autenticado (será el admin en WP).\n *  - Opcionalmente recibe un student_id para crear un estudiante en WP.\n *  - Crea un nonce de un solo uso y lo guarda en cache con expiración corta.\n *  - Firma un payload con los datos de ambos usuarios y la expiración del token.\n *  - Redirige al callback configurado en WordPress.\n *\n * @author Sergio Vargas\n */\nRoute::get('/sso/wordpress', function (Request $request) {\n    $user = $request->user();\n    $empresa = $user->empresa;\n\n    $studentId = $request->input('student_id');\n    $etapaVacanteUsuarioId = $request->input('etapa_vacante_usuario_id');\n    $studentData = null;\n\n    if ($studentId) {\n        $student = App\\Models\\Usuarios\\User::find($studentId);\n\n        if ($student && $student->id !== $user->id) {\n            $studentData = [\n                'id'    => (string) $student->id,\n                'email' => $student->email,\n                'name'  => $student->getNombreCompletoAttribute(),\n            ];\n\n            // Agregar competencias si se pasa etapa_vacante_usuario_id\n            if ($etapaVacanteUsuarioId) {\n                $studentData['competencias'] = sso_obtener_competencias((int) $etapaVacanteUsuarioId);\n            }\n        }\n    }\n\n    $nonce = (string) Str::uuid();\n    $exp   = now()->addSeconds(60)->timestamp;\n\n    Cache::put(\"sso_nonce:{$nonce}\", [\n        'user_id' => $user->id,\n        'exp'     => $exp,\n    ], now()->addMinutes(5));\n\n    $payload = [\n        'sub'              => (string) $user->id,\n        'email'            => $user->email,\n        'name'             => $user->getNombreCompletoAttribute(),\n        'nombre_comercial' => $empresa?->nombre_comercial ?? $empresa?->razon_social,\n        'documento'        => $empresa?->documento,\n        'nonce'            => $nonce,\n        'exp'              => $exp,\n        'student'          => $studentData,\n    ];\n\n    \\Log::info('SSO WordPress payload', $payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));\n    $wp       = rtrim(config('services.sso.wp_url'), '/');\n    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n\n    return redirect()->away(\n        $wp . '/' . $cb . '?token=' . urlencode($token) . '&redirect=' . urlencode($redirect)\n    );\n})->middleware('auth');\n","structuredPatch":[{"oldStart":979,"oldLines":7,"newStart":979,"newLines":7,"lines":["         'student'          => $studentData,","     ];"," ","-    \\Log::info('SSO WordPress payload', $payload);","+    dd($payload);"," ","     $token    = sso_sign_token($payload, config('services.sso.secret'));","     $wp       = rtrim(config('services.sso.wp_url'), '/');"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ed9b173b-3e84-4bee-8a5c-6c202d3466e9"}
{"parentUuid":"c845a2a6-713a-4a2f-a85f-e1eddf9631e4","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01JgjtV1rCBSZWLVpcD9z87m","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. El `dd($payload)` en la línea 982 detendrá la ejecución y mostrará el contenido del payload en el navegador antes de que se firme el token o se haga el redirect a WordPress. Cuando termines de depurar, recuérdame quitarlo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":274,"cache_read_input_tokens":26821,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":274},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2J6EJu66HkVMQ8WHZBs","type":"assistant","uuid":"dd214948-e863-4e89-985b-19b3fb3953bd","timestamp":"2026-02-11T12:38:57.856Z"}
{"type":"file-history-snapshot","messageId":"cb60005a-27d5-4556-aa9d-4faab9b85ff0","snapshot":{"messageId":"cb60005a-27d5-4556-aa9d-4faab9b85ff0","trackedFileBackups":{"routes\\web.php":{"backupFileName":"8d4f24f72d6f32f1@v3","version":3,"backupTime":"2026-02-11T12:40:15.107Z"}},"timestamp":"2026-02-11T12:40:15.105Z"},"isSnapshotUpdate":false}
{"parentUuid":"dd214948-e863-4e89-985b-19b3fb3953bd","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":"Se sigue llamando a la ruta externa, si es en ese o es en @routes/api.php  sso/validate? no quiero que me saque de mi sitio sino solo mostrar el payload"},"uuid":"cb60005a-27d5-4556-aa9d-4faab9b85ff0","timestamp":"2026-02-11T12:40:15.104Z","thinkingMetadata":{"maxThinkingTokens":31999},"permissionMode":"default"}
{"parentUuid":"cb60005a-27d5-4556-aa9d-4faab9b85ff0","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01QL6VXTWt97JTnk6ppuvMac","type":"message","role":"assistant","content":[{"type":"text","text":"\n\n"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2792,"cache_read_input_tokens":27170,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2792},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JCChahxWUKbKvfCW9p","type":"assistant","uuid":"2e1faabb-3508-4ca1-87db-1283d597b2ef","timestamp":"2026-02-11T12:40:17.312Z"}
{"parentUuid":"2e1faabb-3508-4ca1-87db-1283d597b2ef","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01QL6VXTWt97JTnk6ppuvMac","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying that when they hit `/sso/wordpress`, it still redirects to the external site instead of showing the `dd()`. Let me re-read the current state of the file to verify the `dd()` is actually in place.","signature":"Ev8CCkYICxgCKkCFuGhtTIO6wMydyX7kNjFrRShiTlx0nJ9SF7N+phaRicREz40sJs9yv0c3qE2PAnClWrZdfqjpK3OeFCwrlRWAEgyuwcJ/saT/uKlcUykaDE2uctAywScj37C+4SIw58NUNX6pRLKPQdsTCtcZmypOhC7x8IudGvVSTIcxPq49UNMAXZBPoH1CYxKdqm1FKuYBASWTuLoYrsNUJ98B0mv90RjWcXbGdDrR0gi573p6CcpltkzW7A+soxjObyUIlGMUuLI/05Gp/ni2uODTk2UzIlyjmn7Qg4j+H4xic7K31YytMzLqdJx92kynUGiUQepKe4AkU2UU/B9lEhdRur8nwlgT17ZJ1werC857972xHWVt2gH+sR4AV/rBvapdgVsi9Q4D47NnVPIyPzxYQjE6Nm5f+OjYptQNxredDzxpOD9uAI+srKT7evJetEIkEWCCp/wWTl9kUUQX43jeWVsdLe8ljhV1/as5oiej2muMG4oYXsXYcU0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2792,"cache_read_input_tokens":27170,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2792},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JCChahxWUKbKvfCW9p","type":"assistant","uuid":"d6a1734d-2ae0-4623-a7dd-127f7629572e","timestamp":"2026-02-11T12:40:19.004Z"}
{"parentUuid":"d6a1734d-2ae0-4623-a7dd-127f7629572e","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01QL6VXTWt97JTnk6ppuvMac","type":"message","role":"assistant","content":[{"type":"text","text":"Déjame verificar el estado actual de la ruta."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2792,"cache_read_input_tokens":27170,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2792},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JCChahxWUKbKvfCW9p","type":"assistant","uuid":"a541f590-5a6d-45ee-9c74-7b0432c178c5","timestamp":"2026-02-11T12:40:19.345Z"}
{"parentUuid":"a541f590-5a6d-45ee-9c74-7b0432c178c5","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01QL6VXTWt97JTnk6ppuvMac","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MqexAuzUp2L2AuweLyCAWT","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","offset":978,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2792,"cache_read_input_tokens":27170,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2792},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JCChahxWUKbKvfCW9p","type":"assistant","uuid":"59c2bf85-9abb-4a1e-9713-e8287c6ab9dd","timestamp":"2026-02-11T12:40:20.388Z"}
{"parentUuid":"59c2bf85-9abb-4a1e-9713-e8287c6ab9dd","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01MqexAuzUp2L2AuweLyCAWT","toolUseID":"toolu_01MqexAuzUp2L2AuweLyCAWT","timestamp":"2026-02-11T12:40:20.394Z","uuid":"a9efc87d-a7b6-46ad-ad0c-3091d9b61326"}
{"parentUuid":"59c2bf85-9abb-4a1e-9713-e8287c6ab9dd","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MqexAuzUp2L2AuweLyCAWT","type":"tool_result","content":"   978→        'exp'              => $exp,\n   979→        'student'          => $studentData,\n   980→    ];\n   981→\n   982→    dd($payload);\n   983→\n   984→    $token    = sso_sign_token($payload, config('services.sso.secret'));\n   985→    $wp       = rtrim(config('services.sso.wp_url'), '/');\n   986→    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n   987→    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n   988→\n   989→    return redirect()->away(\n   990→        $wp . '/' . $cb . '?token=' . urlencode($token) . '&redirect=' . urlencode($redirect)\n   991→    );\n   992→})->middleware('auth');"}]},"uuid":"8450eab3-9e8d-4e80-88f9-9f5c4cb9b359","timestamp":"2026-02-11T12:40:20.393Z","toolUseResult":{"type":"text","file":{"filePath":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","content":"        'exp'              => $exp,\n        'student'          => $studentData,\n    ];\n\n    dd($payload);\n\n    $token    = sso_sign_token($payload, config('services.sso.secret'));\n    $wp       = rtrim(config('services.sso.wp_url'), '/');\n    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n\n    return redirect()->away(\n        $wp . '/' . $cb . '?token=' . urlencode($token) . '&redirect=' . urlencode($redirect)\n    );\n})->middleware('auth');","numLines":15,"startLine":978,"totalLines":993}},"sourceToolAssistantUUID":"59c2bf85-9abb-4a1e-9713-e8287c6ab9dd"}
{"parentUuid":"8450eab3-9e8d-4e80-88f9-9f5c4cb9b359","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01TGctJL3JGhEvf7KZQZrtRZ","type":"message","role":"assistant","content":[{"type":"text","text":"El `dd($payload)` está correctamente ubicado en la línea 982, **antes** del redirect. Debería detener la ejecución y mostrar el payload en pantalla sin redirigir.\n\nSi aún te está redirigiendo, puede ser por caché. Intenta:\n\n1. Limpiar la caché de rutas:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":536,"cache_read_input_tokens":29962,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":536},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JCaRHoFSWfUhjPpMhZ","type":"assistant","uuid":"7f5473a9-89c6-43e1-b0b3-31af7ea93be2","timestamp":"2026-02-11T12:40:24.300Z"}
{"parentUuid":"7f5473a9-89c6-43e1-b0b3-31af7ea93be2","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01TGctJL3JGhEvf7KZQZrtRZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VXqoEANXoinWV5vmxq2rrq","name":"Bash","input":{"command":"cd /c/Users/sergio/proyectos/Psicoalianza-2 && php artisan route:clear","description":"Clear route cache"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":536,"cache_read_input_tokens":29962,"output_tokens":182,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":536,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[]}},"requestId":"req_011CY2JCaRHoFSWfUhjPpMhZ","type":"assistant","uuid":"29e3d6c2-f97d-434e-95a0-efeef54e3d66","timestamp":"2026-02-11T12:40:24.931Z"}
{"parentUuid":"29e3d6c2-f97d-434e-95a0-efeef54e3d66","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VXqoEANXoinWV5vmxq2rrq","type":"tool_result","content":"  \u001b[37;44m INFO \u001b[39;49m Route cache cleared successfully.","is_error":false}]},"uuid":"9f5c56ed-0fbe-4e35-8f93-6635d49fe878","timestamp":"2026-02-11T12:40:26.836Z","toolUseResult":{"stdout":"  \u001b[37;44m INFO \u001b[39;49m Route cache cleared successfully.\r","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"29e3d6c2-f97d-434e-95a0-efeef54e3d66"}
{"parentUuid":"9f5c56ed-0fbe-4e35-8f93-6635d49fe878","isSidechain":false,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"6cd8dc86-8f0d-4c79-af45-b403228b52d7","version":"2.1.39","gitBranch":"main","slug":"curious-greeting-mccarthy","message":{"model":"claude-opus-4-6","id":"msg_01PrvhL9kgzKAdigDQ3sd9zD","type":"message","role":"assistant","content":[{"type":"text","text":"La caché de rutas fue limpiada. Intenta acceder de nuevo a `/sso/wordpress` — ahora debería mostrarte el `dd()` con el payload sin redirigirte."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":210,"cache_read_input_tokens":30498,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":210},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CY2JD3icBuRVAvSHYLbxE","type":"assistant","uuid":"eae7d867-841f-4798-bd43-614ae1f21fba","timestamp":"2026-02-11T12:40:29.370Z"}
