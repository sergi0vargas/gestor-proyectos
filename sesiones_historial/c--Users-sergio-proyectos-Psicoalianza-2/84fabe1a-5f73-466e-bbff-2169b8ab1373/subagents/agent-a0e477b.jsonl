{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":"I need to understand a routing issue. The error is: `PlanController::show(): Argument #1 ($id) must be of type int, string given` when accessing the route `planes/consumo`. This suggests \"consumo\" is being matched as the `{id}` parameter of a resource/show route.\n\nPlease find:\n1. The PlanController file at `app/Http/Controllers/Planes/PlanController.php` - read it fully\n2. The route definitions for \"planes\" - search in `routes/web.php` or any route files for \"planes\" related routes\n3. Any route that defines `planes/consumo`\n\nBe thorough in searching route files."},"uuid":"16086a97-bf57-496a-95c3-af0a5df56ae7","timestamp":"2026-01-22T21:23:49.840Z"}
{"parentUuid":"16086a97-bf57-496a-95c3-af0a5df56ae7","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P9sHeFmAYJJ71XDzpR6SEn","type":"message","role":"assistant","content":[{"type":"text","text":"I'll help you understand this routing issue. Let me search for the PlanController and route definitions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":14694,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":14694,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXP7wY99NFWJyjccqokry","type":"assistant","uuid":"dbaf716d-275e-48fa-acbf-69e89a2b9fe2","timestamp":"2026-01-22T21:23:51.961Z"}
{"parentUuid":"dbaf716d-275e-48fa-acbf-69e89a2b9fe2","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P9sHeFmAYJJ71XDzpR6SEn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KUgQii42KiQ94SnWfGBsqU","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\Planes\\PlanController.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":14694,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":14694,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXP7wY99NFWJyjccqokry","type":"assistant","uuid":"c9861168-12fd-4b57-ae6a-5a8deaa5c529","timestamp":"2026-01-22T21:23:52.562Z"}
{"parentUuid":"c9861168-12fd-4b57-ae6a-5a8deaa5c529","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P9sHeFmAYJJ71XDzpR6SEn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017aPvpPevjvFVVXgb6FYUb8","name":"Glob","input":{"pattern":"routes/*.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":14694,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":14694,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXP7wY99NFWJyjccqokry","type":"assistant","uuid":"bb961623-2223-461e-9f0c-ee413fc71e68","timestamp":"2026-01-22T21:23:52.703Z"}
{"parentUuid":"bb961623-2223-461e-9f0c-ee413fc71e68","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P9sHeFmAYJJ71XDzpR6SEn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0156Tf8tkyMrQHLHD1XovjuP","name":"Grep","input":{"pattern":"planes|consumo","path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes","type":"php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":14694,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":14694,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXP7wY99NFWJyjccqokry","type":"assistant","uuid":"34307804-5a54-4ae0-96ec-6aabf5fe333b","timestamp":"2026-01-22T21:23:53.055Z"}
{"parentUuid":"c9861168-12fd-4b57-ae6a-5a8deaa5c529","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KUgQii42KiQ94SnWfGBsqU","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Http\\Controllers\\Planes;\n     4→\n     5→use Exception;\n     6→use Illuminate\\View\\View;\n     7→use App\\Traits\\SesionTrait;\n     8→use Illuminate\\Http\\Request;\n     9→use App\\Exports\\GlobalExport;\n    10→use Illuminate\\Http\\JsonResponse;\n    11→use Illuminate\\Support\\Facades\\DB;\n    12→use App\\Http\\Controllers\\Controller;\n    13→use Illuminate\\Support\\Facades\\Auth;\n    14→use Maatwebsite\\Excel\\Facades\\Excel;\n    15→use App\\Http\\Services\\Planes\\PlanService;\n    16→use App\\Http\\Services\\Empresas\\CargoService;\n    17→use App\\Http\\Requests\\Planes\\CrearPlanRequest;\n    18→use App\\Http\\Repositories\\Planes\\PlanRepository;\n    19→use App\\Http\\Repositories\\Permisos\\RolRepository;\n    20→use App\\Http\\Repositories\\IA\\ServicioIARepository;\n    21→use App\\Http\\Repositories\\Usuarios\\UserRepository;\n    22→use App\\Http\\Services\\Empresas\\EmpresaPlanService;\n    23→use App\\Http\\Repositories\\Pruebas\\PerfilRepository;\n    24→use App\\Http\\Repositories\\Pruebas\\PruebaRepository;\n    25→use App\\Http\\Repositories\\Empresas\\EmpresaRepository;\n    26→use App\\Http\\Repositories\\Pruebas\\TipoPruebaRepository;\n    27→use Symfony\\Component\\HttpFoundation\\BinaryFileResponse;\n    28→use App\\Http\\Repositories\\Configuraciones\\RutaRepository;\n    29→\n    30→class PlanController extends Controller\n    31→{\n    32→    use SesionTrait;\n    33→\n    34→    /**\n    35→     * Constructor.\n    36→     *\n    37→     * @param PlanService $servicio Servicio de planes.\n    38→     * @param PlanRepository $repositorio Repositorio de planes.\n    39→     * @param TipoPruebaRepository $tipo_prueba_repositorio Repositorio de tipos de prueba.\n    40→     * @param RutaRepository $ruta_repositorio Repositorio de rutas.\n    41→     * @param PerfilRepository $perfil_repositorio Repositorio de perfiles.\n    42→     * @param PruebaRepository $prueba_repositorio Repositorio de pruebas.\n    43→     * @param EmpresaRepository $empresa_repositorio Repositorio de empresas.\n    44→     * @param RolRepository $rol_repositorio Repositorio de roles.\n    45→     * @param CargoService $cargo_servicio Servicio de cargos.\n    46→     * @param UserRepository $usuario_repositorio Repositorio de usuarios.\n    47→     * @param EmpresaPlanService $empresa_plan_servicio Servicio de planes de empresas.\n    48→     * @param ServicioIARepository $servicio_ia_repositorio Repositorio de servicios IA.\n    49→     * @return void\n    50→     * @author Daniel Beltrán\n    51→     * @author Fahibram Cárcamo\n    52→     * @author Jair Carvajal\n    53→     */\n    54→    public function __construct(\n    55→        private PlanService $servicio,\n    56→        private PlanRepository $repositorio,\n    57→        private TipoPruebaRepository $tipo_prueba_repositorio,\n    58→        private RutaRepository $ruta_repositorio,\n    59→        private PerfilRepository $perfil_repositorio,\n    60→        private PruebaRepository $prueba_repositorio,\n    61→        private EmpresaRepository $empresa_repositorio,\n    62→        private RolRepository $rol_repositorio,\n    63→        private CargoService $cargo_servicio,\n    64→        private UserRepository $usuario_repositorio,\n    65→        private EmpresaPlanService $empresa_plan_servicio,\n    66→        private ServicioIARepository $servicio_ia_repositorio\n    67→    ) {}\n    68→\n    69→    /**\n    70→     * Obtener el listado de planes.\n    71→     *\n    72→     * @param Request $request Contenido de la petición.\n    73→     * @return JsonResponse\n    74→     * @author Daniel Beltrán\n    75→     */\n    76→    public function listado(Request $request): JsonResponse {\n    77→        return new JsonResponse([\n    78→            'data' => $this->repositorio->getTodo($request)\n    79→        ], 200);\n    80→    }\n    81→\n    82→    /**\n    83→     * Cargar la página principal.\n    84→     *\n    85→     * @return View\n    86→     * @author Daniel Beltrán\n    87→     */\n    88→    public function index(): View {\n    89→        return view('planes.index')->with([\n    90→            'tipos_pruebas' => $this->tipo_prueba_repositorio->getTodo(new Request()),\n    91→            'rutas_menu'    => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true]))\n    92→        ]);\n    93→    }\n    94→\n    95→    /**\n    96→     * Cargar la página para crear.\n    97→     *\n    98→     * @return View\n    99→     * @author Sol Espitia\n   100→     */\n   101→    public function paginaConsumos(): View {\n   102→        return view('planes.paginas.consumos')->with([\n   103→            'rutas_menu' => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true]))\n   104→        ]);\n   105→    }\n   106→\n   107→    /**\n   108→     * Cargar la página para crear.\n   109→     *\n   110→     * @return View\n   111→     * @author Daniel Beltrán\n   112→     */\n   113→    public function create(): View {\n   114→        return view('planes.paginas.crear')->with([\n   115→            'tipos_pruebas' => $this->tipo_prueba_repositorio->getTodo(new Request()),\n   116→            'rutas_menu'    => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true]))\n   117→        ]);\n   118→    }\n   119→\n   120→    /**\n   121→     * Obtener un plan.\n   122→     *\n   123→     * @param int $id ID del plan.\n   124→     * @return JsonResponse\n   125→     * @author Daniel Beltrán\n   126→     */\n   127→    public function show(int $id): JsonResponse {\n   128→        return new JsonResponse([\n   129→            'data' => $this->repositorio->getUno($id)\n   130→        ], 200);\n   131→    }\n   132→\n   133→    /**\n   134→     * Cargar la página para editar.\n   135→     *\n   136→     * @param int $id ID del plan.\n   137→     * @return View\n   138→     * @author Daniel Beltrán\n   139→     */\n   140→    public function edit(int $id): View {\n   141→        return view('planes.paginas.crear')->with([\n   142→            'plan'          => $this->repositorio->getUno($id),\n   143→            'tipos_pruebas' => $this->tipo_prueba_repositorio->getTodo(new Request()),\n   144→            'rutas_menu'    => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true]))\n   145→        ]);\n   146→    }\n   147→\n   148→    /**\n   149→     * Crear plan.\n   150→     *\n   151→     * @param CrearPlanRequest $request Contenido de la petición.\n   152→     * @return JsonResponse\n   153→     * @author Daniel Beltrán\n   154→     */\n   155→    public function store(CrearPlanRequest $request): JsonResponse {\n   156→        $codigo    = 201;\n   157→        $respuesta = [\n   158→            'message' => 'Plan creado correctamente'\n   159→        ];\n   160→\n   161→        try {\n   162→            DB::beginTransaction();\n   163→            $this->servicio->guardar($request);\n   164→            DB::commit();\n   165→        } catch (Exception $error) {\n   166→            DB::rollBack();\n   167→\n   168→            $codigo    = 400;\n   169→            $respuesta = [\n   170→                'message' => 'Ocurrió un error',\n   171→                'errors'  => $error->getMessage()\n   172→            ];\n   173→        }\n   174→\n   175→        return new JsonResponse($respuesta, $codigo);\n   176→    }\n   177→\n   178→    /**\n   179→     * Actualizar plan.\n   180→     *\n   181→     * @param int $id ID del plan.\n   182→     * @param CrearPlanRequest $request Contenido de la petición.\n   183→     * @return JsonResponse\n   184→     * @author Daniel Beltrán\n   185→     */\n   186→    public function update(int $id, CrearPlanRequest $request): JsonResponse {\n   187→        $codigo    = 200;\n   188→        $respuesta = [\n   189→            'message' => 'Plan actualizado correctamente'\n   190→        ];\n   191→\n   192→        try {\n   193→            DB::beginTransaction();\n   194→            $request->merge(['id' => $id]);\n   195→            $this->servicio->guardar($request);\n   196→            DB::commit();\n   197→        } catch (Exception $error) {\n   198→            DB::rollBack();\n   199→\n   200→            $codigo    = 400;\n   201→            $respuesta = [\n   202→                'message' => 'Ocurrió un error',\n   203→                'errors'  => $error->getMessage()\n   204→            ];\n   205→        }\n   206→\n   207→        return new JsonResponse($respuesta, $codigo);\n   208→    }\n   209→\n   210→    /**\n   211→     * Eliminar plan.\n   212→     *\n   213→     * @param int $id ID del plan.\n   214→     * @return JsonResponse\n   215→     * @author Daniel Beltrán\n   216→     */\n   217→    public function destroy(int $id): JsonResponse {\n   218→        $codigo    = 200;\n   219→        $respuesta = [\n   220→            'tipo'    => 'success',\n   221→            'mensaje' => 'Plan eliminado correctamente'\n   222→        ];\n   223→\n   224→        try {\n   225→            DB::beginTransaction();\n   226→            $this->servicio->eliminar($id);\n   227→            DB::commit();\n   228→        } catch (Exception $error) {\n   229→            DB::rollBack();\n   230→\n   231→            $codigo    = 400;\n   232→            $respuesta = [\n   233→                'message' => 'Ocurrió un error',\n   234→                'errors'  => $error->getMessage()\n   235→            ];\n   236→        }\n   237→\n   238→        return new JsonResponse($respuesta, $codigo);\n   239→    }\n   240→\n   241→    /**\n   242→     * Archivar o desarchivar plan.\n   243→     *\n   244→     * @param int $id ID del plan.\n   245→     * @param Request $request Contenido de la petición.\n   246→     * @return JsonResponse\n   247→     * @author Daniel Beltrán\n   248→     */\n   249→    public function archivar(int $id, Request $request): JsonResponse {\n   250→        $codigo    = 200;\n   251→        $activo    = $request->filled('activo') ? filter_var($request->activo, FILTER_VALIDATE_BOOLEAN) : false;\n   252→        $accion    = $activo ? 'desarchivado' : 'archivado';\n   253→        $respuesta = [\n   254→            'tipo'    => 'success',\n   255→            'mensaje' => \"Plan {$accion} correctamente\"\n   256→        ];\n   257→\n   258→        $request->merge([\n   259→            'id'         => $id,\n   260→            'activo'     => $activo,\n   261→            'comentario' => $request->filled('comentario') ? $request->comentario : null\n   262→        ]);\n   263→\n   264→        try {\n   265→            DB::beginTransaction();\n   266→            $this->servicio->guardar($request);\n   267→            DB::commit();\n   268→        } catch (Exception $error) {\n   269→            DB::rollBack();\n   270→\n   271→            $codigo    = 400;\n   272→            $respuesta = [\n   273→                'message' => 'Ocurrió un error',\n   274→                'errors'  => $error->getMessage()\n   275→            ];\n   276→        }\n   277→\n   278→        return new JsonResponse($respuesta, $codigo);\n   279→    }\n   280→\n   281→    /**\n   282→     * Clonar plan.\n   283→     *\n   284→     * @param int $id ID del plan.\n   285→     * @return JsonResponse\n   286→     * @author Daniel Beltrán\n   287→     */\n   288→    public function clonar(int $id): JsonResponse {\n   289→        $codigo    = 201;\n   290→        $respuesta = [\n   291→            'message' => 'Plan clonado correctamente'\n   292→        ];\n   293→\n   294→        try {\n   295→            DB::beginTransaction();\n   296→            $respuesta['data'] = $this->servicio->clonar($id);\n   297→            DB::commit();\n   298→        } catch (Exception $error) {\n   299→            DB::rollBack();\n   300→\n   301→            $codigo    = 400;\n   302→            $respuesta = [\n   303→                'message' => 'Ocurrió un error',\n   304→                'errors'  => $error->getMessage()\n   305→            ];\n   306→        }\n   307→\n   308→        return new JsonResponse($respuesta, $codigo);\n   309→    }\n   310→\n   311→    /**\n   312→     * Obtener el historial de cambios.\n   313→     *\n   314→     * @param int $id ID del plan.\n   315→     * @return JsonResponse\n   316→     * @author Daniel Beltrán\n   317→     */\n   318→    public function historialCambios(int $id): JsonResponse {\n   319→        return new JsonResponse([\n   320→            'data' => $this->servicio->historialCambios($id)\n   321→        ], 200);\n   322→    }\n   323→\n   324→    /**\n   325→     * Exportar Excel.\n   326→     *\n   327→     * @param Request $request Contenido de la petición.\n   328→     * @return BinaryFileResponse\n   329→     * @author Daniel Beltrán\n   330→     */\n   331→    public function exportarExcel(Request $request): BinaryFileResponse {\n   332→        return Excel::download(new GlobalExport([\n   333→            'ID',\n   334→            'Nombre del plan',\n   335→            'Tipo de prueba',\n   336→            'Pruebas disponibles',\n   337→            'Tiempo',\n   338→            'Unidades',\n   339→            'Ofertas laborales',\n   340→            'Beneficios predeterminados',\n   341→            'Beneficios adicionales',\n   342→            'Usuarios',\n   343→            'Costo',\n   344→            'Fecha de creación',\n   345→            'Empresas con plan activo'\n   346→        ], $this->servicio->datosExcel($request), 'Planes', 'excel.planes.planes'), 'planes.xlsx');\n   347→    }\n   348→\n   349→    /**\n   350→     * Carga la vista que muestra los planes de una empresa dada.\n   351→     *\n   352→     * @return View\n   353→     * @author Fahibram Cárcamo\n   354→     * @author Jair Carvajal\n   355→     */\n   356→    public function planesClientes(): View {\n   357→        $empresa_id = $this->existeEnSesion('empresa_id') ? $this->obtenerDeSesion('empresa_id') : null;\n   358→        $empresa    = $this->empresa_repositorio->getUnoBasico($empresa_id, new Request(['con_usuarios' => true]));\n   359→        $sucursales = $this->empresa_repositorio->obtenerSucursales($empresa_id, new Request(['con_usuarios' => true]));\n   360→        $empresas   = clone $sucursales;\n   361→        $empresas->push($empresa);\n   362→        $empresas_ids = array_column($empresas->toArray(), 'id');\n   363→\n   364→        $planes        = [];\n   365→        $tipos_pruebas = $this->tipo_prueba_repositorio->getTodo(new Request());\n   366→\n   367→        foreach ($tipos_pruebas as $tipo_prueba) {\n   368→            $plan = $this->empresa_plan_servicio->obtenerPlanActivo($empresa_id, $tipo_prueba->id)\n   369→                ?? $this->empresa_plan_servicio->obtenerUltimoPorTipo($empresa_id, $tipo_prueba->id);\n   370→\n   371→            if (!is_null($plan)) {\n   372→                array_push($planes, $plan);\n   373→            }\n   374→        }\n   375→\n   376→        $usuarios = $this->usuario_repositorio->obtenerUsuariosSucursalesEmpresa(\n   377→            new Request(['con_rol_tipo_empresa' => true, 'con_relaciones' => true]),\n   378→            $empresa\n   379→        );\n   380→\n   381→        return view('empresa.paginas.planes.planes')->with([\n   382→            'empresa'          => $empresa,\n   383→            'usuario_id'       => Auth::id(),\n   384→            'sucursales'       => $empresas,\n   385→            'planes'           => $planes,\n   386→            'rutas_menu'       => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true])),\n   387→            'perfiles'         => $this->perfil_repositorio->obtenerPerfilesEmpresas($empresas_ids),\n   388→            'pruebas'          => $this->prueba_repositorio->getTodo(new Request()),\n   389→            'roles'            => $this->rol_repositorio->getTodo(new Request()),\n   390→            'cargos'           => $this->cargo_servicio->obtenerCargosEmpresaSucursales($empresa),\n   391→            'usuarios'         => $usuarios,\n   392→            'servicios_ia'     => $this->servicio_ia_repositorio->getTodo(new Request(['activo' => true])),\n   393→            'usuarios_empresa' => $usuarios\n   394→        ]);\n   395→    }\n   396→}\n   397→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"49efb63e-1db2-4a30-b762-a1bc0e161a63","timestamp":"2026-01-22T21:24:00.232Z","sourceToolAssistantUUID":"c9861168-12fd-4b57-ae6a-5a8deaa5c529"}
{"parentUuid":"34307804-5a54-4ae0-96ec-6aabf5fe333b","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0156Tf8tkyMrQHLHD1XovjuP","type":"tool_result","content":"Found 1 file\nroutes\\web.php"}]},"uuid":"bed09402-ca75-40ed-940c-7bcba7238d26","timestamp":"2026-01-22T21:24:00.948Z","sourceToolAssistantUUID":"34307804-5a54-4ae0-96ec-6aabf5fe333b"}
{"parentUuid":"bb961623-2223-461e-9f0c-ee413fc71e68","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017aPvpPevjvFVVXgb6FYUb8","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\channels.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\console.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\api.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php"}]},"uuid":"03e0e5f6-0d67-46e7-9561-d0165f67a45c","timestamp":"2026-01-22T21:24:02.117Z","sourceToolAssistantUUID":"bb961623-2223-461e-9f0c-ee413fc71e68"}
{"parentUuid":"03e0e5f6-0d67-46e7-9561-d0165f67a45c","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01SNuruVXfxmJY56W8kMPddy","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the web.php file to see the route definitions:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":42,"cache_creation_input_tokens":5862,"cache_read_input_tokens":14694,"cache_creation":{"ephemeral_5m_input_tokens":5862,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7xTJiL6jgSMTkwJBML","type":"assistant","uuid":"5c2e8c9f-717a-4a43-9361-8cfe4a8d6b2e","timestamp":"2026-01-22T21:24:03.832Z"}
{"parentUuid":"5c2e8c9f-717a-4a43-9361-8cfe4a8d6b2e","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01SNuruVXfxmJY56W8kMPddy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013MFvRHDwM8TB7iobMzEr8g","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":42,"cache_creation_input_tokens":5862,"cache_read_input_tokens":14694,"cache_creation":{"ephemeral_5m_input_tokens":5862,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7xTJiL6jgSMTkwJBML","type":"assistant","uuid":"77eed9db-6d09-4fc5-b43b-bbe57f5ba88c","timestamp":"2026-01-22T21:24:04.026Z"}
{"parentUuid":"77eed9db-6d09-4fc5-b43b-bbe57f5ba88c","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013MFvRHDwM8TB7iobMzEr8g","type":"tool_result","content":"     1→<?php\n     2→\n     3→use Illuminate\\Support\\Str;\n     4→use Illuminate\\Http\\Request;\n     5→use Illuminate\\Support\\Facades\\{Auth, Cache, Route};\n     6→\n     7→Route::get('/', function () {\n     8→    return redirect()->route('login');\n     9→});\n    10→\n    11→Auth::routes(['register' => false]);\n    12→\n    13→// Rutas de acceso para aplicante.\n    14→Route::group([\n    15→    'prefix'    => 'control-acceso',\n    16→    'namespace' => 'App\\Http\\Controllers\\Auth'\n    17→], function ($ruta) {\n    18→    $ruta->get('/acceso-expirado', 'LoginController@accesoExpirado')->name('control-acceso.token-expirado');\n    19→    $ruta->get('/{token}', 'LoginController@controlarAcceso')->name('control-acceso');\n    20→    $ruta->post('/login-automatico/{token}', 'LoginController@loginAutomatico')->name('control-acceso.login-automatico');\n    21→});\n    22→\n    23→// Rutas de migración de usuarios desde la base de datos antigua.\n    24→Route::group([\n    25→    'prefix'    => 'migrar-usuario-app-antigua',\n    26→    'namespace' => 'App\\Http\\Controllers\\Usuarios'\n    27→], function ($ruta) {\n    28→    $ruta->get('/', 'UserController@migrarUsuario')->name('migrar-usuario-app-antigua')->middleware('validar-usuario-app-antigua');\n    29→    $ruta->get('/error', 'UserController@migrarUsuarioError')->name('migrar-usuario-app-antigua.error');\n    30→});\n    31→\n    32→// Rutas protegidas por autenticación y cambio de selección de rol y empresa.\n    33→Route::group([\n    34→    'prefix'     => 'rol-empresa',\n    35→    'namespace'  => 'App\\Http\\Controllers\\Auth',\n    36→    'middleware' => ['auth', 'auth.cambio-rol-empresa']\n    37→], function ($ruta) {\n    38→    $ruta->get('/', 'RolController@formularioRolEmpresa')->name('rol-empresa');\n    39→    $ruta->post('/sesion', 'RolController@guardarRolEmpresaSesion')->name('rol-empresa.guardar-en-sesion');\n    40→});\n    41→\n    42→// Rutas protegidas por autenticación y selección de rol y empresa.\n    43→Route::group([\n    44→    'middleware' => ['auth', 'auth.rol-empresa'],\n    45→    'namespace'  => 'App\\Http\\Controllers'\n    46→], function ($ruta) {\n    47→    $ruta->get('usuario-validar-informacion-basica', 'Usuarios\\UserController@validarInformacionBasica');\n    48→\n    49→    $ruta->group(['middleware' => 'can:tablero'], function ($ruta) {\n    50→        $ruta->get('inicio', 'DashboardController@index')->middleware('validar-datos-completados-usuario')->name('inicio');\n    51→        $ruta->get('inicio-datos-panel', 'DashboardController@obtenerDatosPanel');\n    52→\n    53→        $ruta->group(['middleware' => 'can:tablero.usuarios'], function ($ruta) {\n    54→            // Usuarios\n    55→            $ruta->resource('usuarios', 'Usuarios\\UserController')->except(['index']);\n    56→            $ruta->patch('usuarios-actualizar-multiples', 'Usuarios\\UserController@actualizarMultiples');\n    57→            $ruta->post('usuarios-eliminar-multiples', 'Usuarios\\UserController@eliminarMultiples');\n    58→            $ruta->post('usuarios-generar-acceso', 'Usuarios\\UserController@generarAcceso');\n    59→            $ruta->get('usuarios-historial-cambios/{id}', 'Usuarios\\UserController@historialCambios');\n    60→            $ruta->post('usuarios-historial-cambios-exportar/{id}', 'Usuarios\\UserController@exportarExcelHistorialCambios');\n    61→            $ruta->get('usuarios-listado', 'Usuarios\\UserController@listado');\n    62→            $ruta->get('usuarios-listado-empresa', 'Usuarios\\UserController@listadoAsociadosEmpresa');\n    63→            $ruta->get('usuario', 'Usuarios\\UserController@obtenerUsuario');\n    64→            $ruta->get('aplicante-informacion-personal/{id}', 'Usuarios\\UserController@informacionPersonalAplicante');\n    65→            $ruta->post('usuario-actualizar-imagen', 'Usuarios\\UserController@actualizarImagenUsuario');\n    66→            $ruta->get('usuario-notificaciones', 'Usuarios\\UserController@notificaciones');\n    67→            $ruta->post('usuario-marcar-notificaciones-leidas', 'Usuarios\\UserController@marcarNotificacionesLeidas');\n    68→            $ruta->post('exportar-excel-usuarios-empresa', 'Usuarios\\UserController@exportarExcelUsuariosEmpresa');\n    69→\n    70→            $ruta->post('usuarios-generar-qr-google', 'Usuarios\\UserController@obtenerQrGoogle');\n    71→            $ruta->post('usuarios-validar-codigo-otp-google', 'Usuarios\\UserController@validarCodigoOtp');\n    72→            $ruta->delete('usuarios-eliminar-clave-secreta-google/{id}', 'Usuarios\\UserController@eliminarClaveSecreta');\n    73→        });\n    74→    });\n    75→\n    76→    $ruta->group(['middleware' => 'can:pruebas'], function ($ruta) {\n    77→        $ruta->group(['middleware' => 'can:pruebas.pruebas'], function ($ruta) {\n    78→            // Pruebas\n    79→            $ruta->get('pruebas/lista', 'Pruebas\\PruebaController@lista');\n    80→            $ruta->resource('pruebas', 'Pruebas\\PruebaController');\n    81→            $ruta->get('pruebas-listado', 'Pruebas\\PruebaController@listado');\n    82→            $ruta->get('pruebas/{id}/factores', 'Pruebas\\PruebaController@getFactores');\n    83→            $ruta->get('pruebas/{id}/reactivos', 'Pruebas\\PruebaController@getReactivos');\n    84→            $ruta->post('pruebas-exportar', 'Pruebas\\PruebaController@exportarExcel');\n    85→            $ruta->get('pruebas-conteo/{tipo_prueba_id}', 'Pruebas\\PruebaController@contarPruebasPorTipo');\n    86→            $ruta->put('pruebas-archivar', 'Pruebas\\PruebaController@archivar');\n    87→        });\n    88→\n    89→        $ruta->group(['middleware' => 'can:pruebas.carga-masiva'], function ($ruta) {\n    90→            // Carga masiva de pruebas\n    91→            $ruta->get('carga-masiva', 'Pruebas\\PruebaController@cargaMasiva');\n    92→            $ruta->post('carga-masiva-exportar', 'Pruebas\\PruebaController@exportarExcelCargaMasiva');\n    93→            $ruta->post('carga-masiva-importar', 'Pruebas\\PruebaController@importarExcelCargaMasiva');\n    94→            $ruta->post('pruebas-completas-exportar', 'Pruebas\\PruebaController@descargarPruebasCompletas');\n    95→        });\n    96→\n    97→        $ruta->group(['middleware' => 'can:pruebas.baremos'], function ($ruta) {\n    98→            // Baremos\n    99→            $ruta->get('baremos/lista', 'Pruebas\\BaremoController@lista');\n   100→            $ruta->resource('baremos', 'Pruebas\\BaremoController');\n   101→            $ruta->post('baremos-exportar', 'Pruebas\\BaremoController@exportarExcel');\n   102→            $ruta->post('baremos-calcular', 'Pruebas\\BaremoController@calcularBaremos');\n   103→        });\n   104→\n   105→        $ruta->group(['middleware' => 'can:pruebas.dimensiones'], function ($ruta) {\n   106→            // Dimensiones\n   107→            $ruta->get('dimensiones/lista', 'Pruebas\\DimensionController@lista');\n   108→            $ruta->get('dimensiones-listado', 'Pruebas\\DimensionController@listado');\n   109→            $ruta->resource('dimensiones', 'Pruebas\\DimensionController');\n   110→            $ruta->get('dimensiones-prueba/{id_prueba}', 'Pruebas\\DimensionController@getDimensionesPrueba');\n   111→            $ruta->post('dimensiones-exportar', 'Pruebas\\DimensionController@exportarExcel');\n   112→        });\n   113→\n   114→        $ruta->group(['middleware' => 'can:pruebas.factores'], function ($ruta) {\n   115→            // Factores\n   116→            $ruta->get('factores/lista', 'Pruebas\\FactorController@lista');\n   117→            $ruta->get('factores-listado', 'Pruebas\\FactorController@listado');\n   118→            $ruta->resource('factores', 'Pruebas\\FactorController');\n   119→            $ruta->post('factores-exportar', 'Pruebas\\FactorController@exportarExcel');\n   120→        });\n   121→\n   122→        $ruta->group(['middleware' => 'can:pruebas.reactivos'], function ($ruta) {\n   123→            // Reactivos\n   124→            $ruta->get('reactivos-listado', 'Pruebas\\ReactivoController@listado');\n   125→            $ruta->resource('reactivos', 'Pruebas\\ReactivoController');\n   126→            $ruta->post('reactivos-exportar', 'Pruebas\\ReactivoController@exportarExcel');\n   127→\n   128→            // Opciones\n   129→            $ruta->get('opciones-reactivo/{id_reactivo}', 'Pruebas\\OpcionController@getOpcionesReactivo');\n   130→        });\n   131→\n   132→        $ruta->group(['middleware' => 'can:pruebas.calificaciones'], function ($ruta) {\n   133→            // Calificaciones\n   134→            $ruta->get('calificaciones/lista', 'Pruebas\\CalificacionController@lista');\n   135→            $ruta->resource('calificaciones', 'Pruebas\\CalificacionController');\n   136→            $ruta->post('calificaciones-exportar', 'Pruebas\\CalificacionController@exportarExcel');\n   137→        });\n   138→\n   139→        $ruta->group(['middleware' => 'can:pruebas.grupos-opciones'], function ($ruta) {\n   140→            // Grupos de opciones\n   141→            $ruta->get('grupos-opciones/lista', 'Pruebas\\GrupoOpcionController@lista');\n   142→            $ruta->resource('grupos-opciones', 'Pruebas\\GrupoOpcionController');\n   143→            $ruta->post('grupos-opciones-exportar', 'Pruebas\\GrupoOpcionController@exportarExcel');\n   144→        });\n   145→\n   146→        $ruta->group(['middleware' => 'can:pruebas.secciones-textos'], function ($ruta) {\n   147→            // Secciones de texto\n   148→            $ruta->get('secciones-textos/lista', 'Reportes\\SeccionTextoController@lista');\n   149→            $ruta->resource('secciones-textos', 'Reportes\\SeccionTextoController');\n   150→            $ruta->post('secciones-textos-exportar', 'Reportes\\SeccionTextoController@exportarExcel');\n   151→        });\n   152→\n   153→        $ruta->get('resultados-proceso-prueba-usuario', 'Pruebas\\PruebaController@obtenerResultadosProcesoPruebaUsuario');\n   154→    });\n   155→\n   156→    $ruta->group(['middleware' => 'can:adicional-pruebas'], function ($ruta) {\n   157→        $ruta->group(['middleware' => 'can:adicional-pruebas.perfiles'], function ($ruta) {\n   158→            // Perfiles\n   159→            $ruta->get('perfiles-listado-tabla', 'Pruebas\\PerfilController@getDatatable');\n   160→            $ruta->post('perfiles-exportar', 'Pruebas\\PerfilController@exportarExcel');\n   161→            $ruta->get('perfiles-agrupados-por-prueba', 'Pruebas\\PerfilController@agrupadosPorPrueba');\n   162→        });\n   163→\n   164→        $ruta->group(['middleware' => 'can:adicional-pruebas.modulos-preguntas'], function ($ruta) {\n   165→            // Módulos de preguntas\n   166→            $ruta->resource('modulos-preguntas', 'Pruebas\\ModuloPreguntaController');\n   167→            $ruta->get('modulos-preguntas-listado-tabla', 'Pruebas\\ModuloPreguntaController@getDatatable');\n   168→            $ruta->get('modulos-preguntas-grupos/{prueba_id}', 'Pruebas\\ModuloPreguntaController@getGruposPorPrueba');\n   169→            $ruta->post('modulos-preguntas-exportar', 'Pruebas\\ModuloPreguntaController@exportarExcel');\n   170→            $ruta->post('ckeditor-upload-image', 'Pruebas\\ModuloPreguntaController@uploadImageCKEditor');\n   171→        });\n   172→\n   173→        $ruta->group(['middleware' => 'can:adicional-pruebas.demograficas'], function ($ruta) {\n   174→            // Demográficas\n   175→            $ruta->resource('demograficas', 'Pruebas\\DemograficaController');\n   176→            $ruta->get('demograficas-listado-tabla', 'Pruebas\\DemograficaController@getDatatable');\n   177→            $ruta->post('demograficas-exportar', 'Pruebas\\DemograficaController@exportarExcel');\n   178→        });\n   179→    });\n   180→\n   181→    $ruta->group(['middleware' => 'can:empresas'], function ($ruta) {\n   182→        $ruta->group(['middleware' => 'can:empresas.listado-empresas'], function ($ruta) {\n   183→            // Listado de empresas\n   184→            $ruta->resource('empresas', 'Empresas\\EmpresaController');\n   185→            $ruta->get('empresas-archivadas', 'Empresas\\EmpresaController@index');\n   186→            $ruta->get('empresas-listado', 'Empresas\\EmpresaController@listado');\n   187→            $ruta->get('empresas-listado-tabla', 'Empresas\\EmpresaController@getDatatable');\n   188→            $ruta->get('empresas-listado-sucursales', 'Empresas\\EmpresaController@listadoSucursales');\n   189→            $ruta->get('sucursales/create', 'Empresas\\EmpresaController@create')->name('crear.sucursal');\n   190→            $ruta->get('sucursales/{id}/edit', 'Empresas\\EmpresaController@edit')->name('editar.sucursal');\n   191→            $ruta->get('empresas-historial-cambios/{id}', 'Empresas\\EmpresaController@historialCambios');\n   192→            $ruta->post('empresas-historial-cambios-exportar/{id}', 'Empresas\\EmpresaController@exportarExcelHistorialCambios');\n   193→            $ruta->delete('empresas-eliminar-logo/{id}', 'Empresas\\EmpresaController@eliminarLogo');\n   194→            $ruta->post('generar-enlace-creacion/{empresa_plan_id?}', 'Empresas\\EmpresaEnlaceCreacionController@generar');\n   195→            $ruta->post('empresas-exportar', 'Empresas\\EmpresaController@exportarExcel');\n   196→            $ruta->post('sucursales-exportar', 'Empresas\\EmpresaController@exportarExcelSucursales');\n   197→            $ruta->get('empresas-propietario/{id}', 'Empresas\\EmpresaController@obtenerPropietario');\n   198→            $ruta->get('sucursales', 'Empresas\\EmpresaController@sucursales');\n   199→        });\n   200→\n   201→        $ruta->group(['middleware' => 'can:empresas.gestionar-empresas'], function ($ruta) {\n   202→            // Gestionar empresas\n   203→            $ruta->get('empresas-gestionar/{id?}/{submenu_vista?}', 'Empresas\\EmpresaController@gestionar');\n   204→            $ruta->get('empresas-gestionar-datos/{id}', 'Empresas\\EmpresaController@datosGestionar');\n   205→            $ruta->get('empresas-gestionar-sucursal/{id}', 'Empresas\\EmpresaController@gestionarSucursal');\n   206→            $ruta->patch('empresas-contactos/{id}', 'Empresas\\EmpresaController@guardarContactos');\n   207→\n   208→            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.usuarios'], function ($ruta) {\n   209→                // Usuarios\n   210→                $ruta->get('usuarios-clientes', 'Usuarios\\UserController@index');\n   211→                $ruta->get('usuarios-clientes-listado', 'Usuarios\\UserController@usuariosClientesListado');\n   212→            });\n   213→\n   214→            $ruta->group(['middleware' => 'can:empresas.gestionar-empresas.planes'], function ($ruta) {\n   215→                // Planes\n   216→                $ruta->get('planes-clientes', 'Planes\\PlanController@planesClientes');\n   217→                $ruta->get('listado-planes-cliente', 'Planes\\PlanController@listadoPlanesEmpresa');\n   218→            });\n   219→        });\n   220→\n   221→        $ruta->group(['middleware' => 'can:empresas.archivo-empresas'], function ($ruta) {\n   222→            // Archivo de empresas\n   223→            $ruta->patch('empresas-archivos/{id}', 'Empresas\\EmpresaController@guardarArchivos');\n   224→            $ruta->post('empresas-archivar/{id}', 'Empresas\\EmpresaController@archivar');\n   225→            $ruta->get('empresas-detalle-archivado/{id}', 'Empresas\\EmpresaController@detalleArchivado');\n   226→        });\n   227→\n   228→        $ruta->group(['middleware' => 'can:empresas.migracion-empresas'], function ($ruta) {\n   229→            // Migración de empresas\n   230→            $ruta->get('empresas-migracion', 'Empresas\\MigracionEmpresaController@index');\n   231→            $ruta->post('empresas-migracion/buscar', 'Empresas\\MigracionEmpresaController@buscarEmpresa');\n   232→            $ruta->post('empresas-migracion/validar-tamano', 'Empresas\\MigracionEmpresaController@validarTamanoEmpresa');\n   233→            $ruta->post('empresas-migracion/iniciar', 'Empresas\\MigracionEmpresaController@iniciarMigracion');\n   234→        });\n   235→\n   236→        $ruta->group(['middleware' => 'can:empresas.portales-empleo'], function ($ruta) {\n   237→            // Portales de empleo\n   238→            $ruta->get('portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n   239→            $ruta->get('empresa-portales-empleos', 'Empresas\\PortalEmpleoController@crearEditar');\n   240→            $ruta->post('portales-empleos', 'Empresas\\PortalEmpleoController@store')->name('portales-empleos.store');\n   241→            $ruta->patch('portales-empleos/{id}', 'Empresas\\PortalEmpleoController@update')->name('portales-empleos.update');\n   242→\n   243→            // Premios destacados\n   244→            $ruta->post('premios-destacados', 'Empresas\\PremioDestacadoController@store')->name('premios-destacados.store');\n   245→            $ruta->delete('premios-destacados/{id}', 'Empresas\\PremioDestacadoController@destroy')->name('premios-destacados.destroy');\n   246→\n   247→            // Motivadores\n   248→            $ruta->post('motivadores', 'Empresas\\MotivadorController@store');\n   249→        });\n   250→\n   251→        $ruta->get('datos-empresa', 'Empresas\\EmpresaController@obtenerDatosEmpresa');\n   252→        $ruta->get('empresa', 'DashboardController@paginaEmpresa');\n   253→        $ruta->get('empresa-cambiar-logo', 'Empresas\\EmpresaController@paginaEmpresaCambiarImagen');\n   254→    });\n   255→\n   256→    $ruta->group(['middleware' => 'can:ajustes-sistema.general.plantillas'], function ($ruta) {\n   257→        $ruta->resource('plantillas-correos', 'Configuraciones\\PlantillaCorreoController')->except(['create', 'store', 'edit', 'destroy']);\n   258→        $ruta->get('listado-plantillas-correos', 'Configuraciones\\PlantillaCorreoController@listado');\n   259→        $ruta->put('plantillas-correos-restablecer/{id}', 'Configuraciones\\PlantillaCorreoController@restablecerPorDefecto');\n   260→        $ruta->get('variables', 'Configuraciones\\VariableController@listado');\n   261→    });\n   262→\n   263→    $ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n   264→        // Planes\n   265→        $ruta->resource('planes', 'Planes\\PlanController');\n   266→        $ruta->get('planes-listado', 'Planes\\PlanController@listado');\n   267→        $ruta->post('planes-exportar', 'Planes\\PlanController@exportarExcel');\n   268→        $ruta->get('datos-empresas-planes', 'Empresas\\EmpresaPlanController@planesEmpresas');\n   269→        $ruta->post('exportar-datos-empresas-planes', 'Empresas\\EmpresaPlanController@exportarExcelEmpresasPlanesEmpresas');\n   270→        $ruta->get('empresas-planes-listado-tabla/{empresa_id}', 'Empresas\\EmpresaPlanController@datosTabla');\n   271→        $ruta->resource('empresas-planes', 'Empresas\\EmpresaPlanController', ['only' => ['show', 'store', 'update', 'edit']]);\n   272→        $ruta->get('asignar-plan/{empresa_id}', 'Empresas\\EmpresaPlanController@formularioAsignar');\n   273→        $ruta->patch('empresas-planes-actualizar/{id}', 'Empresas\\EmpresaPlanController@actualizarInformacion');\n   274→        $ruta->post('planes-clonar/{id}', 'Planes\\PlanController@clonar');\n   275→        $ruta->get('planes-historial-cambios/{id}', 'Planes\\PlanController@historialCambios');\n   276→        $ruta->get('funcionalidades-planes-historial-cambios/{plan_id}', 'Planes\\FuncionalidadPlanController@historialCambiosPorPlan');\n   277→        $ruta->get('funcionalidades-listado', 'Planes\\FuncionalidadController@listado');\n   278→        $ruta->get('empresas-planes-funcionalidades-listado', 'Empresas\\EmpresaPlanFuncionalidadController@listado');\n   279→        $ruta->post('solicitud-renovacion-plan', 'Empresas\\EmpresaPlanController@solicitudRenovacionPlan');\n   280→        $ruta->post('empresas-planes-descargar-factura/{archivo_id}', 'Empresas\\EmpresaPlanController@descargarFactura');\n   281→\n   282→        // Planes de Créditos - Vista de creación\n   283→        $ruta->resource('planes-creditos', 'Planes\\PlanCreditoController');\n   284→        $ruta->resource('servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n   285→        $ruta->get('servicios-ia/{id}/creditos', 'IA\\ServicioIAController@creditos');\n   286→        $ruta->post('servicios-ia/{id}/activar', 'IA\\ServicioIAController@activar');\n   287→        $ruta->post('servicios-ia/{id}/desactivar', 'IA\\ServicioIAController@desactivar');\n   288→        $ruta->get('empresas/{empresa_id}/creditos', 'Empresas\\EmpresaPlanController@creditosDisponiblesEmpresa');\n   289→        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\n   290→        $ruta->resource('categorias-servicios-ia', 'IA\\ServicioIAController')->only(['index', 'store', 'update']);\n   291→\n   292→        $ruta->group(['middleware' => 'can:planes-consumo.consumo'], function ($ruta) {\n   293→            // Consumos\n   294→            $ruta->get('consumos', 'Empresas\\EmpresaPlanController@index');\n   295→            $ruta->get('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@formularioFacturar');\n   296→            $ruta->put('facturar-plan/{id}', 'Empresas\\EmpresaPlanController@facturar');\n   297→            $ruta->get('planes-historial-recompras/{empresa_id?}', 'Empresas\\EmpresaPlanController@historialRecompras');\n   298→            $ruta->get('planes-historial-recompras-creditos/{empresa_id}', 'Empresas\\EmpresaPlanController@historialComprasCreditos');\n   299→            $ruta->post('planes-historial-recompras-exportar', 'Empresas\\EmpresaPlanController@exportarExcelHistorialRecompras');\n   300→            $ruta->post('planes-historial-creditos-exportar/{empresa_id}', 'Empresas\\EmpresaPlanController@exportarExcelHistorialCreditos');\n   301→            $ruta->get('consumos-agendas-empresa-plan', 'Planes\\ConsumoController@consumosAgendasDeEmpresaPlan');\n   302→            $ruta->get('consumos-ofertas-laborales-empresa-plan', 'Planes\\ConsumoController@consumosOfertasLaboralesDeEmpresaPlan');\n   303→            $ruta->get('consumos-usuarios-empresa', 'Planes\\ConsumoController@consumosUsuariosEmpresa');\n   304→            $ruta->post('consumos-plan-prueba-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanPrueba');\n   305→            $ruta->post('consumos-plan-oferta-laboral-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanOfertaLaboral');\n   306→            $ruta->post('consumos-plan-usuarios-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanUsuarios');\n   307→        });\n   308→\n   309→        $ruta->group(['middleware' => 'can:planes-consumo.archivo-planes'], function ($ruta) {\n   310→            // Archivo\n   311→            $ruta->get('planes-archivados', 'Planes\\PlanController@index');\n   312→            $ruta->post('planes-archivar/{id}', 'Planes\\PlanController@archivar');\n   313→        });\n   314→    });\n   315→\n   316→    // Perfiles laborales\n   317→    $ruta->post('perfiles-laborales', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@store');\n   318→    $ruta->post('perfiles-laborales-leer-hv-ia', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@obtenerInformacionHVConIA');\n   319→    $ruta->get('perfiles-laborales-consultar-usuario/{usuario_id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@consultarPerfilLaboralUsuario');\n   320→    $ruta->put('perfiles-laborales/{id}', 'Usuarios\\PerfilesLaborales\\PerfilLaboralController@update');\n   321→\n   322→    // Preguntas de ofertas laborales\n   323→    $ruta->get('preguntas-ofertas-laborales', 'OfertasLaborales\\PreguntaOfertaLaboralController@index');\n   324→    $ruta->get('bienvenida-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasPrefiltro');\n   325→    $ruta->get('responder-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasPrefiltro');\n   326→    $ruta->get('finalizacion-preguntas-prefiltro', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasPrefiltro');\n   327→    $ruta->post('respuestas-preguntas-ofertas-laborales', 'OfertasLaborales\\RespuestaPreguntaOfertaLaboralController@store');\n   328→    $ruta->get('verificar-etapa-completada/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@verificarEtapaCompletada');\n   329→\n   330→    // Preguntas de videoentrevista\n   331→    $ruta->get('bienvenida-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@bienvenidaPreguntasVideoentrevista');\n   332→    $ruta->get('responder-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@responderPreguntasvideoentrevista');\n   333→    $ruta->get('previsualizacion-prueba-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@previsualizacionPruebaVideoentrevista');\n   334→    $ruta->get('finalizacion-preguntas-videoentrevista', 'OfertasLaborales\\PreguntaOfertaLaboralController@finalizacionPreguntasVideoentrevista');\n   335→\n   336→    // Vacantes\n   337→    $ruta->post('generar-adecuacion-hv/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionHV');\n   338→    $ruta->post('generar-adecuacion-prefiltro/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPrefiltro');\n   339→    $ruta->post('generar-adecuacion-pruebas-psicometricas/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionPruebasPsicometricas');\n   340→    $ruta->post('generar-adecuacion-videoentrevista/{etapa_vacante_usuario_id}', 'Vacantes\\EtapaVacanteUsuarioController@generarAdecuacionVideoentrevista');\n   341→    $ruta->post('guardar-puntaje-adecuacion-reclutador', 'Vacantes\\EtapaVacanteUsuarioController@guardarPuntajeAdecuacionReclutador');\n   342→    $ruta->post('guardar-puntaje-pregunta-reclutador', 'OfertasLaborales\\PuntajePreguntaOfertaLaboralController@guardarPuntajeReclutador');\n   343→    $ruta->resource('etapas-usuarios-comentarios', 'Vacantes\\EtapaUsuarioComentarioController')->only(['index', 'store']);\n   344→    $ruta->get('obtener-adecuacion-usuario', 'Vacantes\\EtapaVacanteUsuarioController@obtenerAdecuacionUsuario');\n   345→    $ruta->get('obtener-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCandidatosRecomendadosIA');\n   346→    $ruta->post('preguntar-candidatos-recomendados', 'Vacantes\\EtapaVacanteUsuarioController@preguntarSobreCandidatosRecomendados');\n   347→    $ruta->post('vacantes-descargar-reporte-respuesta-ia', 'Vacantes\\VacanteController@descargarReporteRespuestaIA');\n   348→    $ruta->post('vacantes-clonar-aplicante', 'Vacantes\\VacanteController@clonarAplicante');\n   349→\n   350→    $ruta->resource('formatos-entrevistas', 'Vacantes\\FormatoEntrevistaController')->except(['destroy']);\n   351→\n   352→    $ruta->patch('roles/actualizar-permisos/{rol}', 'Auth\\RolController@actualizarPermisos');\n   353→    $ruta->patch('roles/restablecer-permisos/{rol}', 'Auth\\RolController@restablecerPermisos');\n   354→\n   355→    $ruta->group(['middleware' => 'can:ajustes-sistema'], function ($ruta) {\n   356→        $ruta->group(['middleware' => 'can:ajustes-sistema.general'], function ($ruta) {\n   357→            // Ajustes - General\n   358→            $ruta->get('ajustes', 'Configuraciones\\ConfiguracionController@paginaAjustesGenerales');\n   359→        });\n   360→\n   361→        $ruta->group(['middleware' => 'can:ajustes-sistema.roles-permisos'], function ($ruta) {\n   362→            // Ajustes - Roles y permisos\n   363→            $ruta->get('roles', 'Auth\\RolController@index');\n   364→        });\n   365→\n   366→        $ruta->group(['middleware' => 'can:ajustes-sistema.deshacer-acciones'], function ($ruta) {\n   367→            // Ajustes - Deshacer acciones\n   368→            $ruta->post('agendas-restablecer/{id}', 'Agendas\\AgendaController@restablecerAgenda');\n   369→            $ruta->post('agendas-validar-exportacion', 'Configuraciones\\ConfiguracionController@validarAgendaExportacion');\n   370→            $ruta->post('agendas-exportar-respuestas', 'Configuraciones\\ConfiguracionController@exportarRespuestasAgenda');\n   371→            $ruta->get('deshacer-acciones', 'Configuraciones\\ConfiguracionController@deshacerAcciones');\n   372→        });\n   373→\n   374→        $ruta->group(['middleware' => 'can:ajustes-sistema.anuncios-novedades'], function ($ruta) {\n   375→            // Ajustes - Ofertas y anuncios\n   376→            $ruta->resource('anuncios', 'Configuraciones\\AnuncioController');\n   377→            $ruta->get('anuncios-listado-tabla', 'Configuraciones\\AnuncioController@datosTabla');\n   378→            $ruta->get('anuncios-disponibilidad-fechas', 'Configuraciones\\AnuncioController@validarDisponibilidadFechas');\n   379→            $ruta->delete('anuncios-eliminar-varios', 'Configuraciones\\AnuncioController@eliminarVarios');\n   380→            $ruta->put('anuncios-cambiar-estado/{id}', 'Configuraciones\\AnuncioController@cambiarEstado');\n   381→        });\n   382→\n   383→        $ruta->group(['middleware' => 'can:ajustes-sistema.psicoacademy'], function ($ruta) {\n   384→            // Webinars\n   385→            $ruta->resource('webinars', 'PsicoAcademy\\WebinarController')->except(['show']);\n   386→            $ruta->get('webinars-listado-tabla', 'PsicoAcademy\\WebinarController@datosTabla');\n   387→            $ruta->get('webinars-borrador/{tipo}', 'PsicoAcademy\\WebinarController@borrador');\n   388→            $ruta->post('webinars-borrador', 'PsicoAcademy\\WebinarController@guardarBorrador');\n   389→            $ruta->put('webinars-modificar-masivo/{tipo}', 'PsicoAcademy\\WebinarController@modificarMasivo');\n   390→            $ruta->get('webinars-filtros', 'PsicoAcademy\\WebinarController@filtrosAplicados');\n   391→\n   392→            // Eventos\n   393→            $ruta->resource('eventos', 'PsicoAcademy\\EventoController');\n   394→            $ruta->get('eventos-listado-tabla', 'PsicoAcademy\\EventoController@datosTabla');\n   395→            $ruta->get('eventos-borrador/{tipo}', 'PsicoAcademy\\EventoController@borrador');\n   396→            $ruta->post('eventos-borrador', 'PsicoAcademy\\EventoController@guardarBorrador');\n   397→            $ruta->get('eventos-filtros', 'PsicoAcademy\\EventoController@filtrosAplicados');\n   398→            $ruta->get('eventos-listado', 'PsicoAcademy\\EventoController@listado');\n   399→\n   400→            // Guías\n   401→            $ruta->resource('guias', 'PsicoAcademy\\GuiaController');\n   402→            $ruta->get('guias-listado-tabla', 'PsicoAcademy\\GuiaController@datosTabla');\n   403→            $ruta->get('guias-borrador/{tipo}', 'PsicoAcademy\\GuiaController@borrador');\n   404→            $ruta->post('guias-borrador', 'PsicoAcademy\\GuiaController@guardarBorrador');\n   405→            $ruta->delete('guias-borrar-archivo/{id}', 'PsicoAcademy\\GuiaController@borrarArchivo');\n   406→            $ruta->get('guias-filtros', 'PsicoAcademy\\GuiaController@filtrosAplicados');\n   407→\n   408→            // Tutoriales\n   409→            $ruta->resource('tutoriales', 'PsicoAcademy\\TutorialController');\n   410→            $ruta->get('tutoriales-listado-tabla', 'PsicoAcademy\\TutorialController@datosTabla');\n   411→            $ruta->get('tutoriales-borrador/{tipo}', 'PsicoAcademy\\TutorialController@borrador');\n   412→            $ruta->post('tutoriales-borrador', 'PsicoAcademy\\TutorialController@guardarBorrador');\n   413→            $ruta->get('tutoriales-filtros', 'PsicoAcademy\\TutorialController@filtrosAplicados');\n   414→\n   415→            // Podcast\n   416→            $ruta->resource('podcast', 'PsicoAcademy\\PodcastController');\n   417→            $ruta->get('podcast-listado-tabla', 'PsicoAcademy\\PodcastController@datosTabla');\n   418→            $ruta->get('podcast-borrador/{tipo}', 'PsicoAcademy\\PodcastController@borrador');\n   419→            $ruta->post('podcast-borrador', 'PsicoAcademy\\PodcastController@guardarBorrador');\n   420→            $ruta->get('podcast-filtros', 'PsicoAcademy\\PodcastController@filtrosAplicados');\n   421→\n   422→            // Capacitación\n   423→            $ruta->resource('capacitaciones', 'PsicoAcademy\\CapacitacionController');\n   424→            $ruta->get('capacitaciones-listado-tabla', 'PsicoAcademy\\CapacitacionController@datosTabla');\n   425→            $ruta->get('capacitaciones-borrador/{tipo}', 'PsicoAcademy\\CapacitacionController@borrador');\n   426→            $ruta->post('capacitaciones-borrador', 'PsicoAcademy\\CapacitacionController@guardarBorrador');\n   427→            $ruta->get('capacitaciones-filtros', 'PsicoAcademy\\CapacitacionController@filtrosAplicados');\n   428→\n   429→            // Certificación\n   430→            $ruta->resource('certificaciones', 'PsicoAcademy\\CertificacionController');\n   431→            $ruta->get('certificaciones-listado-tabla', 'PsicoAcademy\\CertificacionController@datosTabla');\n   432→            $ruta->put('certificaciones-modificar-masivo/{tipo}', 'PsicoAcademy\\CertificacionController@modificarMasivo');\n   433→            $ruta->get('certificaciones-borrador/{tipo}', 'PsicoAcademy\\CertificacionController@borrador');\n   434→            $ruta->post('certificaciones-borrador', 'PsicoAcademy\\CertificacionController@guardarBorrador');\n   435→            $ruta->get('certificaciones-filtros', 'PsicoAcademy\\CertificacionController@filtrosAplicados');\n   436→        });\n   437→    });\n   438→\n   439→    $ruta->group(['middleware' => 'can:soporte'], function ($ruta) {\n   440→        // Soportes\n   441→        $ruta->resource('soportes', 'Soportes\\SoporteController');\n   442→        $ruta->post('soportes/subida-imagenes', 'Soportes\\SoporteController@subidaImagenes');\n   443→        $ruta->get('soportes-listado-tabla', 'Soportes\\SoporteController@datosTabla');\n   444→        $ruta->patch('soportes-actualizar/{id}', 'Soportes\\SoporteController@actualizarInformacion');\n   445→        $ruta->get('soportes-contiguo/{id}', 'Soportes\\SoporteController@soporteContiguo');\n   446→        $ruta->post('soportes-exportar', 'Soportes\\SoporteController@exportarExcel');\n   447→        $ruta->resource('mensajes-soportes', 'Soportes\\MensajeSoporteController', ['only' => ['store', 'update', 'destroy']]);\n   448→        $ruta->patch('mensajes-soportes-leidos/{id}', 'Soportes\\MensajeSoporteController@marcarMensajesLeidos');\n   449→        $ruta->get('mensajes-soportes-listado-tabla', 'Soportes\\MensajeSoporteController@datosTabla');\n   450→        $ruta->put('soportes-cambiar-estado', 'Soportes\\SoporteController@cambiarEstado');\n   451→\n   452→        // Manuales\n   453→        $ruta->resource('manuales', 'Tutoriales\\ManualController');\n   454→        $ruta->get('manuales-listado-tabla', 'Tutoriales\\ManualController@datosTabla');\n   455→\n   456→        $ruta->group(['middleware' => 'can:soporte.soporte-aplicantes'], function ($ruta) {\n   457→            // Aplicantes\n   458→            $ruta->get('soportes-aplicantes', 'Soportes\\SoporteController@index')->name('soportes.aplicantes');\n   459→        });\n   460→\n   461→        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes'], function ($ruta) {\n   462→            // Preguntas frecuentes\n   463→            $ruta->resource('preguntas-frecuentes', 'Soportes\\PreguntaFrecuenteController');\n   464→            $ruta->patch('preguntas-frecuentes-actualizar/{id}', 'Soportes\\PreguntaFrecuenteController@actualizarInformacion');\n   465→            $ruta->patch('preguntas-frecuentes-ordenar/{id}/{orden}', 'Soportes\\PreguntaFrecuenteController@cambiarOrden');\n   466→            $ruta->get('preguntas-frecuentes-listado-tabla', 'Soportes\\PreguntaFrecuenteController@listado');\n   467→            $ruta->patch('preguntas-frecuentes-visualizaciones/{id}', 'Soportes\\PreguntaFrecuenteController@incrementarVisualizaciones');\n   468→        });\n   469→\n   470→        $ruta->group(['middleware' => 'can:soporte.preguntas-frecuentes.reaccionar'], function ($ruta) {\n   471→            // Preguntas frecuentes reacciónes\n   472→            $ruta->post('preguntas-frecuentes-reacciones', 'Soportes\\PreguntaFrecuenteReaccionController@guardarReaccion');\n   473→        });\n   474→    });\n   475→\n   476→    // Esta ruta debe ser asequible para los usuarios de todos los roles.\n   477→    $ruta->post('configuraciones-modelos', 'Configuraciones\\ConfiguracionModeloController@store');\n   478→    $ruta->get('configuraciones-obtener', 'Configuraciones\\ConfiguracionModeloController@obtenerConfiguracion');\n   479→\n   480→    $ruta->group(['middleware' => 'auth.rol-tipo-superadmin'], function ($ruta) {\n   481→        // Módulos\n   482→        $ruta->get('modulos/{id}', 'Planes\\ModuloController@show');\n   483→        $ruta->get('modulos-listado', 'Planes\\ModuloController@listado');\n   484→\n   485→        // Auditorías\n   486→        $ruta->get('auditorias-ultimo', 'Auditorias\\AuditController@obtenerUltimo');\n   487→\n   488→        // Accesos\n   489→        $ruta->get('accesos-datos-mapa', 'Accesos\\AccesoController@datosMapa');\n   490→\n   491→        // Registros de actividad\n   492→        $ruta->get('actividades-datos-mapa', 'Configuraciones\\ActividadController@datosMapa');\n   493→\n   494→        // Novedades\n   495→        $ruta->resource('novedades', 'Configuraciones\\NovedadController')->except(['index', 'show', 'create', 'store', 'destroy']);\n   496→        $ruta->post('novedades-restablecer/{id}', 'Configuraciones\\NovedadController@restablecer');\n   497→        $ruta->post('novedades-pdf/{id}', 'Configuraciones\\NovedadController@descargarPDF');\n   498→\n   499→        // Países\n   500→        $ruta->resource('paises', 'Configuraciones\\PaisController')->except(['show', 'destroy']);\n   501→        $ruta->resource('departamentos', 'Configuraciones\\DepartamentoController')->except(['show', 'destroy']);\n   502→        $ruta->get('departamentos-listado-tabla', 'Configuraciones\\DepartamentoController@datosTabla');\n   503→        $ruta->resource('ciudades', 'Configuraciones\\CiudadController')->except(['show', 'destroy']);\n   504→        $ruta->get('ciudades-listado-tabla', 'Configuraciones\\CiudadController@datosTabla');\n   505→\n   506→        // Reportes\n   507→        $ruta->resource('reportes', 'Reportes\\ReporteController');\n   508→        $ruta->resource('reportes-secciones', 'Reportes\\ReporteSeccionController')->only(['index']);\n   509→        $ruta->resource('reportes-secciones-textos', 'Reportes\\ReporteSeccionTextoController')->only(['index']);\n   510→\n   511→        // Minería de datos.\n   512→        $ruta->get('sesiones-listado', 'Auth\\SesionController@datosTabla');\n   513→        $ruta->get('mineria-datos', 'DashboardController@indexAnaliticaMineriaDatos');\n   514→\n   515→        // Pruebas completas\n   516→        $ruta->post('pruebas-completas-crear', 'Pruebas\\PruebaController@crearPruebaCompleta');\n   517→        $ruta->get('pruebas-completas/{id}', 'Pruebas\\PruebaController@pruebaCompleta');\n   518→        $ruta->get('pruebas-completas', 'Pruebas\\PruebaController@vistaPruebaCompleta');\n   519→        $ruta->get('pruebas-completas-pagina-crear', 'Pruebas\\PruebaController@crearPrueba');\n   520→        $ruta->get('pruebas-completas/{id}/editar', 'Pruebas\\PruebaController@editarPrueba');\n   521→    });\n   522→\n   523→    $ruta->group(['middleware' => 'auth.rol-tipo-empresa'], function ($ruta) {\n   524→        // Ordenes de servicio\n   525→        // $ruta->resource('ordenes-servicio', 'OrdenesServicios\\OrdenServicioController'); // Se deja comentada temporalmente hasta que se retome ATS\n   526→        $ruta->get('ordenes-servicio-generar-enlace-publico', 'OrdenesServicios\\OrdenServicioEnlaceCreacionController@generar');\n   527→        $ruta->get('ordenes-servicio-listado-tabla', 'OrdenesServicios\\OrdenServicioController@datosTabla');\n   528→\n   529→        // Ofertas laborales\n   530→        $ruta->get('ofertas-laborales/sin-disponibilidad', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles');\n   531→        $ruta->get('ofertas-laborales/sin-plan-seleccion', 'OfertasLaborales\\OfertaLaboralController@sinPlanSeleccion');\n   532→        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->only(['create', 'store'])->middleware('disponibilidad-ofertas-laborales');\n   533→        $ruta->resource('ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController')->except(['create', 'store']);\n   534→        $ruta->post('exportar-excel-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@exportarExcelOfertasLaborales');\n   535→        $ruta->get('ofertas-laborales-listado-tabla', 'OfertasLaborales\\OfertaLaboralController@datosTabla');\n   536→        $ruta->get('ofertas-laborales-detalles/{id}', 'OfertasLaborales\\OfertaLaboralController@detalles');\n   537→        $ruta->get('sin-disponibilidad-ofertas-laborales', 'OfertasLaborales\\OfertaLaboralController@sinOfertasLaboralesDisponibles')\n   538→        ->name('sin-disponibilidad-ofertas-laborales');\n   539→        $ruta->put('ofertas-laborales-cambiar-tipo-publicacion', 'OfertasLaborales\\OfertaLaboralController@cambiarTipoPublicacion');\n   540→        $ruta->post('ofertas-laborales-compartir', 'OfertasLaborales\\OfertaLaboralController@compartirPorCorreo');\n   541→        $ruta->get('ofertas-laborales-generar-qr/{id}', 'OfertasLaborales\\OfertaLaboralController@generarQR');\n   542→        $ruta->get('ofertas-laborales/{id}/aplicantes', 'OfertasLaborales\\OfertaLaboralController@aplicantes');\n   543→        $ruta->get('ofertas-laborales/{id}/aplicantes/{aplicante_id}', 'OfertasLaborales\\OfertaLaboralController@detallesAplicante');\n   544→        $ruta->post('ofertas-laborales/generar-informacion-ia', 'OfertasLaborales\\OfertaLaboralController@generarInformacionIA');\n   545→        $ruta->post('ofertas-laborales/generar-pruebas-ia', 'OfertasLaborales\\OfertaLaboralController@generarPruebasConIA');\n   546→\n   547→        // Vacantes\n   548→        $ruta->resource('vacantes', 'Vacantes\\VacanteController')->except(['show', 'edit', 'update']);\n   549→        $ruta->get('vacantes-listado-tabla', 'Vacantes\\VacanteController@datosTabla');\n   550→\n   551→        $ruta->group(['middleware' => 'validar-acceso-vacante'], function ($ruta) {\n   552→            $ruta->get('vacantes-detalle/{id}', 'Vacantes\\VacanteController@paginaDetalle');\n   553→            $ruta->resource('vacantes', 'Vacantes\\VacanteController')->only(['show', 'edit', 'update']);\n   554→            $ruta->post('vacantes-completar/{id}', 'Vacantes\\VacanteController@completar');\n   555→            $ruta->put('vacantes-cambiar-estado', 'Vacantes\\VacanteController@cambiarEstado');\n   556→            $ruta->put('vacantes-archivar', 'Vacantes\\VacanteController@archivarVacante');\n   557→            $ruta->get('etapas-vacantes-aplicantes/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerEtapasAplicantes');\n   558→            $ruta->get('vacantes-detalle-aplicante/{vacante_id}/{usuario_id}', 'Vacantes\\VacanteController@obtenerDetalleAplicante');\n   559→            $ruta->get('vacantes-listado-aplicantes/{vacante_id}', 'Vacantes\\VacanteController@obtenerListadoAplicantes');\n   560→            $ruta->get('vacantes-calcular-dias-duracion-proceso/{vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDiasDuracionProceso');\n   561→        });\n   562→\n   563→        $ruta->get('configuraciones-etapa-movimiento/{id}', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@index');\n   564→        $ruta->post('etapas-movimientos-vacantes-configuraciones', 'Vacantes\\EtapaMovimientoVacanteConfiguracionController@store');\n   565→        $ruta->get('etapas-vacantes', 'Vacantes\\EtapaVacanteController@index');\n   566→        $ruta->put('etapas-vacantes/{id}', 'Vacantes\\EtapaVacanteController@update');\n   567→        $ruta->get('vacantes-habilidades-herramientas', 'Vacantes\\VacanteController@obtenerHabilidadesHerramientas');\n   568→        $ruta->put('etapas-vacantes-cambiar-orden', 'Vacantes\\EtapaVacanteController@cambiarOrden');\n   569→        $ruta->post('vacantes-postular-aplicantes', 'Vacantes\\VacanteController@postularAplicantes');\n   570→        $ruta->resource('documentos-solicitables', 'Vacantes\\DocumentoSolicitableController');\n   571→        $ruta->post('vacantes-preguntas', 'Vacantes\\VacanteController@guardarPreguntas');\n   572→        $ruta->post('etapas-vacantes-adjuntar-archivos', 'Vacantes\\EtapaVacanteController@adjuntarArchivosPruebaTecnica');\n   573→        $ruta->delete('etapas-vacantes/{etapa_vacante_id}/eliminar-etapa-prueba-tecnica', 'Vacantes\\EtapaVacanteController@eliminarEtapaPruebaTecnica');\n   574→        $ruta->get('etapas-vacantes/{etapa_vacante_id}/obtener-configuraciones-prueba-tecnica', 'Vacantes\\EtapaVacanteController@obtenerConfiguracionesPruebaTecnica');\n   575→        $ruta->post('generar-vacante', 'Vacantes\\VacanteController@generarConIA');\n   576→        $ruta->post('generar-preguntas-prefiltro', 'Vacantes\\VacanteController@generarPreguntasPrefiltro');\n   577→        $ruta->post('generar-preguntas-videoentrevista', 'Vacantes\\VacanteController@generarPreguntasVideoentrevista');\n   578→        $ruta->post('generar-pruebas-psicometricas', 'Vacantes\\VacanteController@generarPruebasPsicometricas');\n   579→        $ruta->post('vacantes-duplicar', 'Vacantes\\VacanteController@duplicar');\n   580→        $ruta->post('vacantes-descartar-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@descartarAplicantesManual');\n   581→        $ruta->post('vacantes-mover-etapa-aplicante/{id}', 'Vacantes\\EtapaVacanteUsuarioController@moverAplicanteEtapaManual');\n   582→        $ruta->get('vacantes-competencias-mejorar/{id}', 'Vacantes\\EtapaVacanteUsuarioController@obtenerCompetenciasPorMejorar');\n   583→        $ruta->post('vacantes-revertir-descarte-aplicantes', 'Vacantes\\EtapaVacanteUsuarioController@revertirDescarteAplicantes');\n   584→        $ruta->post('vacantes-comparativo-basico-aplicantes', 'Vacantes\\VacanteController@generarReporteComparativoVacantes');\n   585→\n   586→        // TODO: Estos dos endpoints no están completos, el primero funciona pero no es lo que se necesita, hay que hacer que el segundo funcione como el primero\n   587→        $ruta->get('resultados-coincidencia-oferta-laboral/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\MovimientoController@resultadosCoincidenciaUsuario');\n   588→        $ruta->get('resultados-coincidencia-oferta-laboral-test/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\CategoriaAdecuacionController@resultadosCoincidenciaUsuario');\n   589→\n   590→        // TODO: Falta definir la ruta. No se sabe si existirá una ruta genérica que cambie a un aplicante de una etapa a otra dentro de una oferta laboral o\n   591→        // si habrán varios end-points para cada una de las etapas que existirán dentro del proceso de contratación en una oferta laboral...\n   592→        $ruta->post('ofertas-laborales-cambiar-usuario-etapa', 'OfertasLaborales\\OfertaLaboralController@cambiarUsuarioEtapa');\n   593→\n   594→        // Etapas\n   595→        $ruta->resource('etapas', 'OfertasLaborales\\EtapaController')->only(['show', 'store', 'update', 'destroy']);\n   596→        $ruta->get('etapas-listado', 'OfertasLaborales\\EtapaController@listado');\n   597→        $ruta->post('movimientos-configuraciones', 'OfertasLaborales\\EtapaMovimientoConfiguracionController@store');\n   598→        $ruta->put('descartar-candidatos-etapa', 'OfertasLaborales\\EtapaController@descartarCandidatosEtapa');\n   599→        $ruta->get('etapas-verificar-nombre-repetido/{oferta_laboral_id}/{nombre}', 'OfertasLaborales\\EtapaController@validarNombreRepetido');\n   600→        $ruta->post('etapas-mover/{id}/{orden}', 'OfertasLaborales\\EtapaController@cambiarOrden');\n   601→\n   602→        // Movimientos\n   603→        $ruta->get('movimientos-listado', 'OfertasLaborales\\MovimientoController@listado');\n   604→        $ruta->get('movimientos-configuraciones-listado', 'OfertasLaborales\\MovimientoConfiguracionController@listado');\n   605→        $ruta->get('movimientos-configuraciones/{id}', 'OfertasLaborales\\MovimientoConfiguracionController@show');\n   606→        $ruta->post('movimientos-configuraciones-preguntas', 'OfertasLaborales\\MovimientoConfiguracionController@guardarPreguntasVideoEntrevista');\n   607→\n   608→        // Novedades\n   609→        $ruta->get('novedades', 'Configuraciones\\NovedadController@index');\n   610→\n   611→        $ruta->get('feedback', 'DashboardController@enConstruccion');\n   612→        $ruta->get('planes-accion', 'DashboardController@enConstruccion');\n   613→\n   614→        // Procesos\n   615→        $ruta->resource('procesos', 'Procesos\\ProcesoController');\n   616→        $ruta->get('procesos-listado', 'Procesos\\ProcesoController@listado');\n   617→        $ruta->get('procesos-listado-tabla', 'Procesos\\ProcesoController@datosTabla');\n   618→        $ruta->patch('procesos-actualizar/{id}', 'Procesos\\ProcesoController@actualizarInformacion');\n   619→        $ruta->post('procesos-duplicar/{id}', 'Procesos\\ProcesoController@duplicar');\n   620→        $ruta->post('procesos-suspender/{id}', 'Procesos\\ProcesoController@suspender');\n   621→        $ruta->post('procesos-activar/{id}', 'Procesos\\ProcesoController@activar');\n   622→        $ruta->put('procesos-archivar', 'Procesos\\ProcesoController@archivarProceso');\n   623→        $ruta->post('procesos-exportar', 'Procesos\\ProcesoController@exportarExcel');\n   624→        $ruta->post('procesos-compartir/{id}', 'Procesos\\ProcesoController@compartir');\n   625→        $ruta->post('procesos-compartir-resultados-aplicante', 'Procesos\\ProcesoController@compartirResultadosAplicante');\n   626→        $ruta->get('participantes-proceso/{id}', 'Usuarios\\UserController@participantesProceso');\n   627→        $ruta->post('procesos-exportar-participantes', 'Usuarios\\UserController@exportarParticipantesProcesoExcel');\n   628→        $ruta->post('participantes-descartar', 'Procesos\\ProcesoController@descartarParticipantes');\n   629→        $ruta->post('participante-seleccionar', 'Procesos\\ProcesoController@seleccionarParticipante');\n   630→        $ruta->post('participantes-cambiar-proceso', 'Procesos\\ProcesoController@moverDeProceso');\n   631→        $ruta->delete('participantes-eliminar/{proceso_id}/{usuario_id}', 'Procesos\\ProcesoController@eliminarParticipante');\n   632→        $ruta->post('procesos-participantes/{id}', 'Procesos\\ProcesoController@agregarParticipantes');\n   633→        $ruta->post('participantes-reagendar', 'Procesos\\ProcesoController@reagendarParticipantes');\n   634→        $ruta->get('participante/{id}', 'Usuarios\\UserController@obtenerParticipanteProceso');\n   635→        $ruta->get('procesos-detalles-participante', 'Usuarios\\UserController@detallesParticipanteProceso');\n   636→        $ruta->post('agendas-participante', 'Agendas\\AgendaController@agendasParticipante');\n   637→        $ruta->delete('agendas/{id}', 'Agendas\\AgendaController@destroy');\n   638→        $ruta->post('agendas-reprocesar/{id}', 'Agendas\\AgendaController@reprocesarAgenda');\n   639→        $ruta->post('procesos-reporte-resultados-excel', 'Procesos\\ProcesoController@exportarReporteResultadosExcel');\n   640→        $ruta->get('procesos-indice-talento/{proceso_id}/{aplicante_id}', 'Procesos\\ProcesoController@obtenerIndiceTalento');\n   641→        $ruta->get('agendas-copiar-resultados', 'Agendas\\AgendaController@copiarAgenda');\n   642→        $ruta->post('procesos-mejores-candidatos', 'Procesos\\ProcesoController@mejoresCandidatosIA');\n   643→        $ruta->post('procesos-validar-agendas-expiradas/{id}', 'Procesos\\ProcesoController@validarAgendasExpiradas');\n   644→        $ruta->get('plantilla-correo', 'Configuraciones\\PlantillaCorreoController@obtenerPlantilla');\n   645→        $ruta->get('procesos-descargar-guia-agendamiento-masivo', 'Procesos\\ProcesoController@descargarGuiaAgendamientoMasivo');\n   646→        $ruta->post('procesos-extraer-datos-participantes', 'Procesos\\ProcesoController@extraerDatosParticipantes');\n   647→\n   648→        // Firmas de rutas\n   649→        $ruta->get('firmas-rutas-por-proceso/{proceso_id}', 'Accesos\\FirmaRutaController@porProceso');\n   650→\n   651→        // Perfiles pruebas\n   652→        $ruta->get('perfiles-pruebas', 'Pruebas\\PerfilController@perfilesPruebas');\n   653→\n   654→        // Agendas\n   655→        $ruta->get('pruebas-empresas/{id}', 'Pruebas\\PruebaController@obtenerPruebasEmpresa');\n   656→        $ruta->get('candidatos', 'Agendas\\AgendaController@historialAgendamientos');\n   657→        $ruta->get('listado-historial-agendamientos', 'Agendas\\AgendaController@listadoHistorialAgendamientos');\n   658→        $ruta->post('exportar-excel-historial-agendamientos', 'Agendas\\AgendaController@exportarExcelHistorialAgendamientos');\n   659→\n   660→        // Comentarios\n   661→        $ruta->resource('comentarios', 'OfertasLaborales\\ComentarioController')->only(['store']);\n   662→\n   663→        // Usuarios\n   664→        $ruta->post('generar-acceso-usuario/{usuario_id}', 'Usuarios\\TokenAccesoController@generarAcceso');\n   665→    });\n   666→\n   667→    $ruta->group(['middleware' => 'auth.es-superadmin'], function ($ruta) {\n   668→        $ruta->get('empresa-sucursales', 'Empresas\\EmpresaController@empresaSucursales');\n   669→\n   670→        // Debug de calificaciones de agendas\n   671→        $ruta->get('debug/calificacion/{agenda_id}', 'Debug\\DebugCalificacionController@mostrar')->name('debug.calificacion.mostrar');\n   672→        $ruta->get('debug/calificacion/{agenda_id}/calcular', 'Debug\\DebugCalificacionController@obtenerCalificacion')->name('debug.calificacion.calcular');\n   673→        $ruta->post('debug/calificacion/{agenda_id}/simular', 'Debug\\DebugCalificacionController@simularCalificacion')->name('debug.calificacion.simular');\n   674→        $ruta->post('debug/calificacion/{agenda_id}/actualizar', 'Debug\\DebugCalificacionController@actualizarRespuestas')->name('debug.calificacion.actualizar');\n   675→    });\n   676→\n   677→    // Suplantación de rol Administrador general\n   678→    $ruta->group(['middleware' => 'auth.suplantar-admin-general'], function ($ruta) {\n   679→        $ruta->post('suplantar-rol-admin-general', 'Auth\\RolController@suplantarRolAdministradorGeneral')->name('suplantar-rol-admin-general');\n   680→    });\n   681→\n   682→    // Suplantación de rol Administrador sucursal\n   683→    $ruta->group(['middleware' => 'auth.suplantar-admin-sucursal'], function ($ruta) {\n   684→        $ruta->post('suplantar-rol-admin-sucursal', 'Auth\\RolController@suplantarRolAdministradorSucursal')->name('suplantar-rol-admin-sucursal');\n   685→    });\n   686→\n   687→    // Restablecimiento de la sesión original que había antes de la suplantación\n   688→    $ruta->group(['middleware' => 'auth.rol-suplantado'], function ($ruta) {\n   689→        $ruta->post('restablecer-sesion-original', 'Auth\\RolController@restablecerSesionOriginal')->name('restablecer-sesion-original');\n   690→    });\n   691→\n   692→    // Ruta para completar los datos de un usuario aplicante\n   693→    $ruta->group(['middleware' => 'auth.rol-tipo-evaluado'], function ($ruta) {\n   694→        $ruta->put('completar-datos-usuario/datos-generales/{id}', 'Usuarios\\UserController@completarDatosGenerales');\n   695→        $ruta->put('completar-datos-usuario/datos-acceso/{id}', 'Usuarios\\UserController@completarDatosAcceso');\n   696→        $ruta->get('completar-datos-usuario/{id}', 'Usuarios\\UserController@paginaCompletarDatos')->name('usuarios.completar-datos');\n   697→        $ruta->get('recomendaciones', 'Usuarios\\UserController@vistaRecomendaciones');\n   698→    });\n   699→\n   700→    // Rutas de usuario aplicante que requieren que este haya completados sus datos\n   701→    $ruta->group(['middleware' => ['validar-datos-completados-usuario', 'auth.rol-tipo-evaluado']], function ($ruta) {\n   702→        $ruta->get('ofertas-laborales-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantes')->name('ofertas-laborales-aplicantes');\n   703→        $ruta->get('ofertas-guardadas-aplicantes', 'OfertasLaborales\\OfertaLaboralController@paginaAplicantesGuardados');\n   704→        $ruta->post('ofertas-laborales-postular-aplicante/{oferta_laboral_id}/{perfil_laboral_id?}', 'OfertasLaborales\\OfertaLaboralController@postularAplicante');\n   705→        $ruta->post('ofertas-laborales-abandonar-postulacion-aplicante/{oferta_laboral_id}', 'OfertasLaborales\\OfertaLaboralController@abandonarPostulacionAplicante');\n   706→        $ruta->get('ofertas-laborales-postular-aplicante-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@postularAplicanteSinAutenticar');\n   707→        $ruta->post('ofertas-laborales-guardar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardar');\n   708→        $ruta->get('ofertas-laborales-guardar-sin-autenticar/{id}', 'OfertasLaborales\\OfertaLaboralController@guardarSinAutenticar');\n   709→        $ruta->post('ofertas-laborales-quitar-guardado/{id}', 'OfertasLaborales\\OfertaLaboralController@quitarGuardado');\n   710→        $ruta->get('soportes-aplicante', 'DashboardController@enConstruccion');\n   711→        $ruta->get('preguntas-frecuentes-aplicante', 'DashboardController@enConstruccion');\n   712→        $ruta->get('completar-demograficas/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@formularioDemograficas');\n   713→        $ruta->get('demograficas-ajax/{agenda_id}/{prueba_id}', 'Pruebas\\DemograficaController@obtenerDemograficasAjax');\n   714→        $ruta->post('agendas-demograficas-opciones', 'Agendas\\AgendaController@guardarRespuestasDemograficas');\n   715→        $ruta->get('realizar-prueba/{agenda_id}', 'Agendas\\AgendaController@paginaRealizarPrueba')->name('prueba.realizar');\n   716→        $ruta->get('agendas-reactivos/{agenda_id}', 'Agendas\\AgendaReactivoController@listado');\n   717→        $ruta->put('descontar-tiempo-agenda', 'Agendas\\AgendaTiempoController@descontarTiempo');\n   718→        $ruta->post('agendas-reactivos-respuestas', 'Agendas\\AgendaReactivoController@guardarRespuestasReactivos');\n   719→        $ruta->get('agendas-reactivos-respondidos/{agenda_id}', 'Agendas\\AgendaReactivoController@obtenerReactivosRespondidos');\n   720→        $ruta->post('agendas-procesar-resultados', 'Agendas\\AgendaController@procesarResultados');\n   721→        $ruta->post('agendas-guardar-foto', 'Agendas\\AgendaController@guardarArchivoAgenda');\n   722→        $ruta->get('ofertas-laborales-detalles-aplicante/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesParaAplicante')\n   723→            ->name('ofertas-laborales.detalles-aplicante');\n   724→        $ruta->post('agendas-guardar-archivo', 'Agendas\\AgendaController@guardarArchivoAgenda');\n   725→        $ruta->get('agendas_validar_pendientes/{agenda_id}', 'Agendas\\AgendaController@validarAgendasPendientes');\n   726→\n   727→        $ruta->resource('experiencias-laborales', 'Usuarios\\PerfilesLaborales\\ExperienciaLaboralController')->only(['store', 'update', 'destroy']);\n   728→    });\n   729→\n   730→    // Ofertas laborales\n   731→    $ruta->post('ofertas-laborales-descartar-aplicante/{oferta_laboral_id}/{usuario_id}', 'OfertasLaborales\\OfertaLaboralController@descartarAplicante');\n   732→\n   733→    // Perfiles - Rutas específicas primero para evitar conflictos con resource\n   734→    $ruta->get('perfiles/prueba/{id}/factores-dimensiones', 'Pruebas\\PerfilController@getFactoresDimensiones');\n   735→    $ruta->post('perfiles/generar-ia', 'Pruebas\\PerfilController@generarConIA');\n   736→    $ruta->get('perfiles/datos-adicionales', 'Pruebas\\PerfilController@getDatosAdicionales');\n   737→    $ruta->post('perfiles/crear-desde-ia', 'Pruebas\\PerfilController@crearDesdeIA');\n   738→    $ruta->resource('perfiles', 'Pruebas\\PerfilController');\n   739→    $ruta->get('factores-pruebas/{prueba_id}', 'Pruebas\\FactorController@obtenerTodoPorPrueba');\n   740→\n   741→    // Usuarios\n   742→    $ruta->post('enviar-codigo-autorizacion', 'Usuarios\\UserController@enviarCodigoAutorizacion');\n   743→    $ruta->post('verificar-codigo-autorizacion', 'Usuarios\\UserController@verificarCodigoAutorizacion');\n   744→\n   745→    // Perfiles\n   746→    $ruta->get('perfiles-listado', 'Pruebas\\PerfilController@listado');\n   747→    $ruta->get('perfiles-listado-empresa', 'Pruebas\\PerfilController@listadoEmpresa');\n   748→    $ruta->post('perfiles-archivar/{id}', 'Pruebas\\PerfilController@archivar');\n   749→    $ruta->post('perfiles-clonar', 'Pruebas\\PerfilController@clonar');\n   750→    $ruta->post('perfiles-pdf/{id}', 'Pruebas\\PerfilController@descargarPDF');\n   751→\n   752→    // Archivos\n   753→    $ruta->get('archivos', 'Configuraciones\\ArchivoController@listado');\n   754→    $ruta->get('archivos-obtener-uno', 'Configuraciones\\ArchivoController@obtenerUno');\n   755→    $ruta->delete('archivos/{id}', 'Configuraciones\\ArchivoController@destroy');\n   756→\n   757→    // Menú clientes\n   758→    $ruta->get('psicoacademy-cliente', 'DashboardController@paginaPsycoAcademyCliente');\n   759→    $ruta->get('uso-experiencia', 'DashboardController@paginaUsoExperiencia');\n   760→    $ruta->get('mis-pruebas', 'DashboardController@paginaMisPruebas')->middleware('validar-datos-completados-usuario');\n   761→\n   762→    $ruta->get('tareas-pendientes-aplicantes', 'DashboardController@paginaMisPruebasAplicante')->name('tareas-pendientes-aplicantes');\n   763→    $ruta->get('tareas-pendientes-aplicantes-data', 'DashboardController@tareasPendientesData');\n   764→    $ruta->get('tareas-completadas-aplicantes', 'DashboardController@paginaMisPruebasAplicanteCompletadas')->name('tareas-completadas-aplicantes');\n   765→    $ruta->get('resultados-evaluacion-aplicantes', 'DashboardController@paginaFeedbackAplicante');\n   766→    $ruta->get('planes-accion-aplicantes', 'DashboardController@paginaPlanesAccionAplicante');\n   767→\n   768→    $ruta->get('vacantes-aplicante', 'Vacantes\\VacanteController@obtenerVacantesAplicante');\n   769→    $ruta->resource('pruebas-tecnicas', 'Vacantes\\PruebaTecnicaController');\n   770→    $ruta->post('vacantes-guardar-documentos-solicitados', 'Vacantes\\EtapaVacanteUsuarioController@guardarDocumentoSolicitado');\n   771→    $ruta->get('vacantes-documentos-solicitados/{etapa_vacante_id}', 'Vacantes\\EtapaVacanteController@obtenerDocumentosContratacion');\n   772→    $ruta->post('vacantes-exportar-archivos-etapa/{etapa_id}', 'Vacantes\\EtapaVacanteController@exportarArchivosZip');\n   773→    $ruta->post('vacantes-notificar-documentos-solicitados/{id}', 'Vacantes\\EtapaVacanteUsuarioController@notificarDocumentosSolicitados');\n   774→    $ruta->post('vacantes-abandonar-vacante', 'Vacantes\\EtapaVacanteUsuarioController@abandonarVacante');\n   775→    $ruta->get('vacantes-listado-postulaciones-aplicante', 'Vacantes\\VacanteController@listadoPostulacionesAplicanteEspecifico');\n   776→    $ruta->get('vacantes-postulaciones-aplicantes', 'Vacantes\\VacanteController@vistaPostulacionesAplicante');\n   777→\n   778→    // Agendas - Accesible para aplicantes y usuarios de empresa\n   779→    $ruta->get('agendas-aplicante', 'Procesos\\ProcesoController@obtenerPruebasAplicante');\n   780→\n   781→    // Rutas para servir imágenes - accesibles para aplicantes Y Superadmin\n   782→    $ruta->get('modulos-preguntas-imagen/{nombre_archivo}', 'Pruebas\\ModuloPreguntaController@getImagen');\n   783→    $ruta->get('reactivos-imagen-por-id/{reactivo_id}', 'Pruebas\\ReactivoController@getImagenPorId');\n   784→    $ruta->get('opciones-imagen-por-id/{opcion_id}', 'Pruebas\\OpcionController@getImagenPorId');\n   785→    $ruta->get('preguntas-frecuentes-imagen/{nombre_archivo}', 'Soportes\\PreguntaFrecuenteController@getImagen');\n   786→\n   787→    $ruta->get('psicometricas', 'DashboardController@enConstruccion');\n   788→    $ruta->get('ordenes', 'DashboardController@enConstruccion');\n   789→\n   790→    $ruta->get('consumo-clientes', 'DashboardController@paginaEmpresa');\n   791→    $ruta->get('configuraciones-clientes', 'Configuraciones\\ConfiguracionController@paginaConfiguraciones');\n   792→    $ruta->get('roles-permisos', 'Auth\\RolController@rolesPermisosMiEmpresa');\n   793→\n   794→    $ruta->get('propuestas', 'DashboardController@enConstruccion');\n   795→    $ruta->get('novedades', 'DashboardController@enConstruccion');\n   796→\n   797→    // Áreas\n   798→    $ruta->get('areas-listado', 'Empresas\\AreaController@listado');\n   799→    $ruta->post('areas', 'Empresas\\AreaController@store');\n   800→\n   801→    // Cargos\n   802→    $ruta->get('cargos-listado', 'Empresas\\CargoController@listado');\n   803→    $ruta->post('cargos', 'Empresas\\CargoController@store');\n   804→\n   805→    // Niveles educativos\n   806→    $ruta->get('niveles-educativos', 'OfertasLaborales\\NivelEducativoController@index');\n   807→\n   808→    // Áreas de estudio\n   809→    $ruta->get('areas-estudios', 'Usuarios\\PerfilesLaborales\\AreaEstudioController@index');\n   810→\n   811→    // Idiomas\n   812→    $ruta->get('idiomas', 'Usuarios\\PerfilesLaborales\\IdiomaController@index');\n   813→\n   814→    // Autenticación del websoket\n   815→    $ruta->post('/broadcasting-auth', 'Broadcasting\\BroadcastingController@autenticar');\n   816→\n   817→    $ruta->get('/botones', function () {\n   818→        return view('botones');\n   819→    })->name('botones');\n   820→\n   821→    $ruta->get('pruebas-plantillas', 'DashboardController@plantillasPruebas');\n   822→    $ruta->get('componentes/index', 'ComponenteController@index')->name('componentes');\n   823→    $ruta->get('componentes/lista', 'ComponenteController@getLista')->name('componentes-lista');\n   824→\n   825→    // Rutas temporales (hay que eliminarlas cuando se desarrollen sus respectivos módulos)\n   826→    $ruta->get('analiticas', 'DashboardController@index');\n   827→    $ruta->get('en-construccion', 'DashboardController@enConstruccion');\n   828→    $ruta->get('uso-panel-demografico', 'DashboardController@indexAnaliticaUsoPanelDemografico');\n   829→    $ruta->get('panel-demografico', 'DashboardController@indexAnaliticaPanelDemografico');\n   830→    $ruta->get('uso', 'DashboardController@indexAnaliticaUso');\n   831→    $ruta->get('experiencia', 'DashboardController@indexAnaliticaExperiencia');\n   832→\n   833→    // Rutas de componentes de desarrollo\n   834→    $ruta->get('/componentes/{menu}/{modulo}', 'ComponenteController@componentes');\n   835→    $ruta->post('/componentes/prueba', 'ComponenteController@pruebaComponentes');\n   836→\n   837→    // TODO: ruta de prueba, eliminarla próximamente\n   838→    $ruta->get('visualizar-reporte', 'DashboardController@enConstruccion');\n   839→    $ruta->get('reportes-generar/{agenda_id}', 'Reportes\\ReporteController@generar');\n   840→    $ruta->get('reporte-agenda/{agenda_id}', 'Reportes\\ReporteController@mostrarReporteAgenda');\n   841→    $ruta->post('reportes-agendas-zip', 'Reportes\\ReporteController@descargarReportesZip');\n   842→    $ruta->get('reportes-generar-comparativo', 'Reportes\\ReporteController@generarComparativo');\n   843→\n   844→    // Rutas para las encuestas\n   845→    $ruta->get('validar-encuesta/{id}', 'Encuestas\\EncuestaController@obtenerUnoDeUsuario');\n   846→    $ruta->post('encuestas-guardar-respuestas', 'Encuestas\\EncuestaController@guardarRespuestas');\n   847→});\n   848→\n   849→// Rutas no protegidas por autenticación\n   850→Route::group([\n   851→    'namespace' => 'App\\Http\\Controllers'\n   852→], function ($ruta) {\n   853→    // Contraseñas\n   854→    $ruta->post('contrasenas/verificar-uso', 'Usuarios\\ContrasenaController@verificarUso');\n   855→\n   856→    // Empresas\n   857→    $ruta->get('empresas-parametrizar/{hash}/{id?}', 'Empresas\\EmpresaEnlaceCreacionController@index');\n   858→    $ruta->post('empresas-parametrizar', 'Empresas\\EmpresaEnlaceCreacionController@crearEmpresa');\n   859→    $ruta->post('empresas-parametrizar-archivos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarArchivosEmpresa');\n   860→    $ruta->post('empresas-parametrizar-contactos/{empresa_id}', 'Empresas\\EmpresaEnlaceCreacionController@guardarContactosEmpresa');\n   861→    $ruta->get('empresas-logo/{id}', 'Empresas\\EmpresaController@getLogo');\n   862→\n   863→    // Ordenes de servicio\n   864→    $ruta->group([\n   865→        'middleware' => 'orden-servicio-enlace-publico'\n   866→    ], function ($ruta) {\n   867→        $ruta->get('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@crearPorEnlacePublico');\n   868→        $ruta->post('/ordenes-servicio-enlace-publico', 'OrdenesServicios\\OrdenServicioController@guardarDesdeEnlacePublico');\n   869→    });\n   870→\n   871→    $ruta->get('/ordenes-servicio-enlace-publico/error', 'OrdenesServicios\\OrdenServicioController@errorEnlacePublico');\n   872→\n   873→    // Países\n   874→    $ruta->get('paises-listado', 'Configuraciones\\PaisController@listado');\n   875→    $ruta->get('paises-listado-completo', 'Configuraciones\\PaisController@listadoCompleto');\n   876→\n   877→    // Departamentos\n   878→    $ruta->get('departamentos-listado', 'Configuraciones\\DepartamentoController@listado');\n   879→\n   880→    // Ciudades\n   881→    $ruta->get('ciudades-listado', 'Configuraciones\\CiudadController@listado');\n   882→\n   883→    // Portales de empleo\n   884→    $ruta->get('portales-empleo', 'Empresas\\PortalEmpleoController@portalesEmpleo');\n   885→    $ruta->get('portales-empleo/oferta-laboral/{id}', 'OfertasLaborales\\OfertaLaboralController@detallesPortalEmpleo');\n   886→    $ruta->get('portales-empleo/{portal_empleo_uuid}', 'Empresas\\PortalEmpleoController@portalEmpleoEmpresa');\n   887→    $ruta->get('portales-empleo/crear/aplicante', 'Empresas\\PortalEmpleoController@crearAplicante');\n   888→    $ruta->post('portales-empleo/crear/aplicante', 'Empresas\\PortalEmpleoController@guardarUsuarioAplicante');\n   889→    $ruta->post('portales-empleo-enviar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@enviarCodigoAutorizacionCrearAplicante');\n   890→    $ruta->post('portales-empleo-verificar-codigo-autorizacion', 'Empresas\\PortalEmpleoController@verificarCodigoAutorizacionCrearAplicante');\n   891→\n   892→    // Firmas de rutas\n   893→    $ruta->get('firmas-rutas-expirada', 'Accesos\\FirmaRutaController@firmaRutaExpirada')->name('firma-ruta-expirada');\n   894→    $ruta->get('firmas-rutas-formulario-acceso/{id}', 'Accesos\\FirmaRutaController@formularioAcceso')->name('formulario-acceso-ruta-firmada');\n   895→    $ruta->post('firmas-rutas-validar-formulario-acceso', 'Accesos\\FirmaRutaController@validarFormularioAcceso')->name('validar-formulario-acceso-ruta-firmada');\n   896→    $ruta->post('firmas-rutas-revocar-acceso/{id}', 'Accesos\\FirmaRutaController@revocarAcceso');\n   897→\n   898→    // Archivos\n   899→    $ruta->get('archivos-abrir/{id}', 'Configuraciones\\ArchivoController@abrir');\n   900→\n   901→    // Imagen de usuarios\n   902→    $ruta->get('usuarios-imagen/{id}', 'Usuarios\\UserController@getImagen');\n   903→\n   904→    // Consultar reportes con firma\n   905→    $ruta->get('reporte-agenda-firmado/{id}/{firma}', 'Reportes\\ReporteController@mostrarReporteAgendaValidacion');\n   906→});\n   907→\n   908→/**\n   909→ * Rutas protegidas por firma: El acceso a estas rutas está limitado por la vigencia de la firma con la que se accede a la ruta.\n   910→ *\n   911→ * @author Fahibram Cárcamo\n   912→ */\n   913→Route::group([\n   914→    'prefix'     => 'rutas-firmadas',\n   915→    'middleware' => ['ruta-firmada'],\n   916→    'namespace'  => 'App\\Http\\Controllers'\n   917→], function ($ruta) {\n   918→    $ruta->get('procesos/{id}', 'Procesos\\ProcesoController@showFirmada');\n   919→    $ruta->get('procesos-resultados-aplicante/{proceso_id}/{participante_id}', 'Procesos\\ProcesoController@showResultadosAplicanteFirmada');\n   920→});\n   921→\n   922→/**\n   923→ * Genera un token SSO firmado y redirige a WordPress.\n   924→ *\n   925→ * Flujo:\n   926→ *  - Requiere un usuario autenticado (será el admin en WP).\n   927→ *  - Opcionalmente recibe un student_id para crear un estudiante en WP.\n   928→ *  - Crea un nonce de un solo uso y lo guarda en cache con expiración corta.\n   929→ *  - Firma un payload con los datos de ambos usuarios y la expiración del token.\n   930→ *  - Redirige al callback configurado en WordPress.\n   931→ *\n   932→ * @author Sergio Vargas\n   933→ */\n   934→Route::get('/sso/wordpress', function (Request $request) {\n   935→    $user = $request->user();\n   936→\n   937→    $studentId   = $request->input('student_id');\n   938→    $studentData = null;\n   939→\n   940→    if ($studentId) {\n   941→        $student = App\\Models\\Usuarios\\User::find($studentId);\n   942→\n   943→        if ($student && $student->id !== $user->id) {\n   944→            $studentData = [\n   945→                'id'    => (string) $student->id,\n   946→                'email' => $student->email,\n   947→                'name'  => $student->getNombreCompletoAttribute(),\n   948→            ];\n   949→        }\n   950→    }\n   951→\n   952→    $nonce = (string) Str::uuid();\n   953→    $exp   = now()->addSeconds(60)->timestamp;\n   954→\n   955→    Cache::put(\"sso_nonce:{$nonce}\", [\n   956→        'user_id' => $user->id,\n   957→        'exp'     => $exp,\n   958→    ], now()->addMinutes(5));\n   959→\n   960→    $payload = [\n   961→        'sub'     => (string) $user->id,\n   962→        'email'   => $user->email,\n   963→        'name'    => $user->getNombreCompletoAttribute(),\n   964→        'nonce'   => $nonce,\n   965→        'exp'     => $exp,\n   966→        'student' => $studentData,\n   967→    ];\n   968→\n   969→    $token    = sso_sign_token($payload, config('services.sso.secret'));\n   970→    $wp       = rtrim(config('services.sso.wp_url'), '/');\n   971→    $cb       = ltrim(config('services.sso.wp_callback'), '/');\n   972→    $redirect = $request->input('redirect', '/course-filter-sidebar-left/');\n   973→\n   974→    return redirect()->away(\n   975→        $wp . '/' . $cb . '?token=' . urlencode($token) . '&redirect=' . urlencode($redirect)\n   976→    );\n   977→})->middleware('auth');\n   978→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0d63123c-dd15-46dd-92b9-7e3cd5adfee3","timestamp":"2026-01-22T21:24:05.464Z","sourceToolAssistantUUID":"77eed9db-6d09-4fc5-b43b-bbe57f5ba88c"}
{"parentUuid":"0d63123c-dd15-46dd-92b9-7e3cd5adfee3","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01SA2xTvsNGQ23frcfK7XrXY","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I found the issue. Let me search for the specific route that defines \"consumo\" to get the complete picture:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":26989,"cache_read_input_tokens":20556,"cache_creation":{"ephemeral_5m_input_tokens":26989,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7xhjdgDtXxm22f61pY","type":"assistant","uuid":"b44d95cc-38e0-487b-8b3a-27bed60f9c4d","timestamp":"2026-01-22T21:24:09.346Z"}
{"parentUuid":"b44d95cc-38e0-487b-8b3a-27bed60f9c4d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01SA2xTvsNGQ23frcfK7XrXY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016g2xruZ8G5Dys2yYXu7i26","name":"Grep","input":{"pattern":"consumo|paginaConsumos","path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":26989,"cache_read_input_tokens":20556,"cache_creation":{"ephemeral_5m_input_tokens":26989,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7xhjdgDtXxm22f61pY","type":"assistant","uuid":"7eebb30e-4213-4d4d-a287-365923b81b56","timestamp":"2026-01-22T21:24:09.976Z"}
{"parentUuid":"7eebb30e-4213-4d4d-a287-365923b81b56","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016g2xruZ8G5Dys2yYXu7i26","type":"tool_result","content":"263:    $ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n289:        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\n292:        $ruta->group(['middleware' => 'can:planes-consumo.consumo'], function ($ruta) {\n294:            $ruta->get('consumos', 'Empresas\\EmpresaPlanController@index');\n301:            $ruta->get('consumos-agendas-empresa-plan', 'Planes\\ConsumoController@consumosAgendasDeEmpresaPlan');\n302:            $ruta->get('consumos-ofertas-laborales-empresa-plan', 'Planes\\ConsumoController@consumosOfertasLaboralesDeEmpresaPlan');\n303:            $ruta->get('consumos-usuarios-empresa', 'Planes\\ConsumoController@consumosUsuariosEmpresa');\n304:            $ruta->post('consumos-plan-prueba-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanPrueba');\n305:            $ruta->post('consumos-plan-oferta-laboral-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanOfertaLaboral');\n306:            $ruta->post('consumos-plan-usuarios-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanUsuarios');\n309:        $ruta->group(['middleware' => 'can:planes-consumo.archivo-planes'], function ($ruta) {\n790:    $ruta->get('consumo-clientes', 'DashboardController@paginaEmpresa');"}]},"uuid":"d3d1bfc1-4909-4741-925b-8cab40aca188","timestamp":"2026-01-22T21:24:11.814Z","sourceToolAssistantUUID":"7eebb30e-4213-4d4d-a287-365923b81b56"}
{"parentUuid":"d3d1bfc1-4909-4741-925b-8cab40aca188","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01V1NcYL3qEMX8XcXWmfrVdL","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check if there's a specific route for \"planes/consumo\" by looking more carefully at the resource routes:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":666,"cache_read_input_tokens":47545,"cache_creation":{"ephemeral_5m_input_tokens":666,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7yAEaN1LLkXjF54HAd","type":"assistant","uuid":"4ea86469-a7f7-4826-9474-8466918ed7db","timestamp":"2026-01-22T21:24:13.649Z"}
{"parentUuid":"4ea86469-a7f7-4826-9474-8466918ed7db","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01V1NcYL3qEMX8XcXWmfrVdL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015khCdCsSmUe5cZu22Hpnje","name":"Bash","input":{"command":"grep -n \"resource.*planes\\|get.*planes.*consumo\\|consumo\" \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php\" | head -30"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":666,"cache_read_input_tokens":47545,"cache_creation":{"ephemeral_5m_input_tokens":666,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7yAEaN1LLkXjF54HAd","type":"assistant","uuid":"336baa12-25b9-42bb-9a95-2d1c1a23fb73","timestamp":"2026-01-22T21:24:14.305Z"}
{"parentUuid":"336baa12-25b9-42bb-9a95-2d1c1a23fb73","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015khCdCsSmUe5cZu22Hpnje","type":"tool_result","content":"263:    $ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n265:        $ruta->resource('planes', 'Planes\\PlanController');\n271:        $ruta->resource('empresas-planes', 'Empresas\\EmpresaPlanController', ['only' => ['show', 'store', 'update', 'edit']]);\n283:        $ruta->resource('planes-creditos', 'Planes\\PlanCreditoController');\n289:        $ruta->get('empresas/{empresa_id}/consumos-creditos', 'Empresas\\EmpresaPlanController@historialConsumosCreditos');\n292:        $ruta->group(['middleware' => 'can:planes-consumo.consumo'], function ($ruta) {\n294:            $ruta->get('consumos', 'Empresas\\EmpresaPlanController@index');\n301:            $ruta->get('consumos-agendas-empresa-plan', 'Planes\\ConsumoController@consumosAgendasDeEmpresaPlan');\n302:            $ruta->get('consumos-ofertas-laborales-empresa-plan', 'Planes\\ConsumoController@consumosOfertasLaboralesDeEmpresaPlan');\n303:            $ruta->get('consumos-usuarios-empresa', 'Planes\\ConsumoController@consumosUsuariosEmpresa');\n304:            $ruta->post('consumos-plan-prueba-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanPrueba');\n305:            $ruta->post('consumos-plan-oferta-laboral-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanOfertaLaboral');\n306:            $ruta->post('consumos-plan-usuarios-exportar', 'Planes\\ConsumoController@exportarExcelConsumosPlanUsuarios');\n309:        $ruta->group(['middleware' => 'can:planes-consumo.archivo-planes'], function ($ruta) {\n790:    $ruta->get('consumo-clientes', 'DashboardController@paginaEmpresa');","is_error":false}]},"uuid":"8e2c9aaa-dd09-4773-b2c5-fca69fe3ee23","timestamp":"2026-01-22T21:24:15.585Z","sourceToolAssistantUUID":"336baa12-25b9-42bb-9a95-2d1c1a23fb73"}
{"parentUuid":"8e2c9aaa-dd09-4773-b2c5-fca69fe3ee23","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"84fabe1a-5f73-466e-bbff-2169b8ab1373","version":"2.1.14","gitBranch":"pre-main","agentId":"a0e477b","slug":"atomic-coalescing-meadow","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01JTymgNHKf1w9vkkxCJggn6","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now I have all the information needed. Let me provide a comprehensive analysis of the routing issue.\n\n## Summary of the Routing Issue\n\nThe problem is clear: you're trying to access `/planes/consumo` but Laravel's route resolution is interpreting \"consumo\" as the `{id}` parameter of the resource route, then passing it to the `show()` method which expects an integer.\n\n### The Root Cause\n\n**File**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\routes\\web.php` (line 265)\n\n```php\n$ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n    // ... other routes ...\n    $ruta->resource('planes', 'Planes\\PlanController');  // Line 265 - This creates RESTful routes\n    // ... other routes ...\n});\n```\n\nWhen you use `$ruta->resource('planes', 'Planes\\PlanController')`, Laravel automatically generates these routes:\n\n- `GET /planes` → `index()`\n- `GET /planes/create` → `create()`\n- `POST /planes` → `store()`\n- `GET /planes/{id}` → `show(int $id)` ← **This is the problem**\n- `GET /planes/{id}/edit` → `edit(int $id)`\n- `PUT/PATCH /planes/{id}` → `update(int $id, ...)`\n- `DELETE /planes/{id}` → `destroy(int $id)`\n\n### Why `/planes/consumo` Fails\n\nWhen you access `/planes/consumo`, Laravel's router:\n1. Matches the resource route `GET /planes/{id}`\n2. Treats \"consumo\" as the `{id}` parameter\n3. Passes the string \"consumo\" to `PlanController::show(int $id)`\n4. PHP's strict typing throws an error because a string cannot be cast to int\n\n### The PlanController::show() Method\n\n**File**: `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\app\\Http\\Controllers\\Planes\\PlanController.php` (lines 127-131)\n\n```php\n/**\n * Obtener un plan.\n *\n * @param int $id ID del plan.\n * @return JsonResponse\n * @author Daniel Beltrán\n */\npublic function show(int $id): JsonResponse {\n    return new JsonResponse([\n        'data' => $this->repositorio->getUno($id)\n    ], 200);\n}\n```\n\nThe strict `int $id` type hint causes the failure.\n\n### What You Need\n\nI notice the `PlanController` has a `paginaConsumos()` method (lines 101-105) but it's **not registered as a route**:\n\n```php\npublic function paginaConsumos(): View {\n    return view('planes.paginas.consumos')->with([\n        'rutas_menu' => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true]))\n    ]);\n}\n```\n\n### Solution\n\nYou need to add a **named route** BEFORE the resource route (named routes must come first to avoid being matched by the resource wildcard):\n\n```php\n$ruta->group(['middleware' => 'can:planes-consumo'], function ($ruta) {\n    // Named route MUST come before resource route\n    $ruta->get('planes/consumo', 'Planes\\PlanController@paginaConsumos')->name('planes.consumo');\n    \n    // ... other routes ...\n    $ruta->resource('planes', 'Planes\\PlanController');\n    // ... rest of routes ...\n});\n```\n\nThis ensures that requests to `/planes/consumo` are matched by the explicit named route before Laravel's router tries to match the resource pattern `planes/{id}`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1076,"cache_read_input_tokens":48211,"cache_creation":{"ephemeral_5m_input_tokens":1076,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXP7ySHUiQ9VWaeLz243u","type":"assistant","uuid":"b40d8bfd-8473-48d9-9765-c6e795fab2b8","timestamp":"2026-01-22T21:24:25.024Z"}
