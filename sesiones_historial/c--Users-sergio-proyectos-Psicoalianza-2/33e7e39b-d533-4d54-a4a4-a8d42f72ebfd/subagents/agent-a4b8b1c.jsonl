{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":"Busca archivos relacionados con:\n1. La vista de /planes-clientes (probablemente en resources/views)\n2. Un modal o pestaña con id=\"pestana-compras-creditos\" \n3. Funcionalidad de búsqueda, filtros y tags en ese modal\n4. JavaScript relacionado con \"BUSQUEDAS RECIENTES\" o búsquedas guardadas\n\nNecesito encontrar:\n- El archivo Blade de la vista principal\n- El modal de \"Historial de compras\"\n- El JavaScript que maneja la búsqueda, los tags y los filtros\n- La funcionalidad de limpiar filtros\n\nProporciona las rutas completas de los archivos relevantes y analiza la lógica del filtrado."},"uuid":"2e2a5451-44f8-4b47-bf95-45dda4520f97","timestamp":"2026-01-29T18:02:04.855Z"}
{"parentUuid":"2e2a5451-44f8-4b47-bf95-45dda4520f97","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01XLxT9s723igdpeEX3kVvfp","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a buscar los archivos relacionados con planes-clientes, el modal de compras de créditos y la funcionalidad de búsqueda y filtros."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20667,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20667},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXc7DejevbbM2q2FUFwFb","type":"assistant","uuid":"33c74f93-01b1-470b-b2ce-5d44463e33bd","timestamp":"2026-01-29T18:02:07.497Z"}
{"parentUuid":"33c74f93-01b1-470b-b2ce-5d44463e33bd","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01XLxT9s723igdpeEX3kVvfp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WN42yVKb5GYv2Cx5YGxGoF","name":"Glob","input":{"pattern":"**/planes-clientes*"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20667,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20667},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXc7DejevbbM2q2FUFwFb","type":"assistant","uuid":"9c1aac01-fb0f-4f6d-86d7-613d5aa2deb8","timestamp":"2026-01-29T18:02:07.663Z"}
{"parentUuid":"9c1aac01-fb0f-4f6d-86d7-613d5aa2deb8","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01XLxT9s723igdpeEX3kVvfp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KULU1wuXdaip9kM4U3uYhd","name":"Grep","input":{"pattern":"pestana-compras-creditos","glob":"**/*.{blade.php,js,html}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20667,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20667},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXc7DejevbbM2q2FUFwFb","type":"assistant","uuid":"3c137937-18df-4e96-8868-3ee805832ffb","timestamp":"2026-01-29T18:02:08.060Z"}
{"parentUuid":"3c137937-18df-4e96-8868-3ee805832ffb","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01XLxT9s723igdpeEX3kVvfp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01X1Tg3S5KndF8kBbwaCsB8r","name":"Grep","input":{"pattern":"BUSQUEDAS RECIENTES","glob":"**/*.{blade.php,js,html}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20667,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20667},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXc7DejevbbM2q2FUFwFb","type":"assistant","uuid":"47ce7279-960a-4829-9262-94e28cb20947","timestamp":"2026-01-29T18:02:08.333Z"}
{"parentUuid":"47ce7279-960a-4829-9262-94e28cb20947","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01XLxT9s723igdpeEX3kVvfp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Hf7USptXGt3cozmfNwMmNV","name":"Glob","input":{"pattern":"**/resources/views/**/planes*"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":20667,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20667},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXc7DejevbbM2q2FUFwFb","type":"assistant","uuid":"58ecd73e-cd95-4c4e-9a0b-5247fe421f2e","timestamp":"2026-01-29T18:02:08.584Z"}
{"parentUuid":"3c137937-18df-4e96-8868-3ee805832ffb","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KULU1wuXdaip9kM4U3uYhd","type":"tool_result","content":"Found 2 files\npublic\\js\\empresa\\planes\\modal-recompras.js\nresources\\views\\empresa\\paginas\\planes\\modal-recompras.blade.php"}]},"uuid":"397b551b-96c6-4264-8653-5a4ed41b0d51","timestamp":"2026-01-29T18:02:13.384Z","sourceToolAssistantUUID":"3c137937-18df-4e96-8868-3ee805832ffb"}
{"parentUuid":"47ce7279-960a-4829-9262-94e28cb20947","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01X1Tg3S5KndF8kBbwaCsB8r","type":"tool_result","content":"Found 1 file\npublic\\componentes\\componentes\\filtros.js"}]},"uuid":"86b8e96a-d1f8-494b-872d-4048aaf3d9a1","timestamp":"2026-01-29T18:02:13.410Z","sourceToolAssistantUUID":"47ce7279-960a-4829-9262-94e28cb20947"}
{"parentUuid":"86b8e96a-d1f8-494b-872d-4048aaf3d9a1","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01KULU1wuXdaip9kM4U3uYhd","toolUseID":"toolu_01KULU1wuXdaip9kM4U3uYhd","timestamp":"2026-01-29T18:02:13.387Z","uuid":"ab496640-0f16-41d8-a596-6c00e2c2d564"}
{"parentUuid":"ab496640-0f16-41d8-a596-6c00e2c2d564","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01X1Tg3S5KndF8kBbwaCsB8r","toolUseID":"toolu_01X1Tg3S5KndF8kBbwaCsB8r","timestamp":"2026-01-29T18:02:13.411Z","uuid":"d0b88494-4c92-4bfd-aeb6-c7c474469453"}
{"parentUuid":"58ecd73e-cd95-4c4e-9a0b-5247fe421f2e","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Hf7USptXGt3cozmfNwMmNV","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresas\\paginas\\formularios-gestionar\\planes.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\excel\\planes\\planes.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\mis-pruebas\\aplicantes\\planes-accion.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\planes.blade.php"}]},"uuid":"4d1347b1-6f5a-40eb-886b-180833cf66cd","timestamp":"2026-01-29T18:02:14.129Z","sourceToolAssistantUUID":"58ecd73e-cd95-4c4e-9a0b-5247fe421f2e"}
{"parentUuid":"9c1aac01-fb0f-4f6d-86d7-613d5aa2deb8","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WN42yVKb5GYv2Cx5YGxGoF","type":"tool_result","content":"No files found"}]},"uuid":"a24cd9d3-14a0-42a0-97bc-0d0635e00cf2","timestamp":"2026-01-29T18:02:14.151Z","sourceToolAssistantUUID":"9c1aac01-fb0f-4f6d-86d7-613d5aa2deb8"}
{"parentUuid":"a24cd9d3-14a0-42a0-97bc-0d0635e00cf2","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_01Hf7USptXGt3cozmfNwMmNV","toolUseID":"toolu_01Hf7USptXGt3cozmfNwMmNV","timestamp":"2026-01-29T18:02:14.131Z","uuid":"727a25b1-1c11-41de-a41b-4224e816cb69"}
{"parentUuid":"727a25b1-1c11-41de-a41b-4224e816cb69","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_01WN42yVKb5GYv2Cx5YGxGoF","toolUseID":"toolu_01WN42yVKb5GYv2Cx5YGxGoF","timestamp":"2026-01-29T18:02:14.152Z","uuid":"682bf4bc-b43f-45a1-bfc2-760e78e3e8f5"}
{"parentUuid":"682bf4bc-b43f-45a1-bfc2-760e78e3e8f5","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0165dYsySR6zRmyJYKW1gY8e","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, encontré los archivos. Ahora voy a examinar el modal de recompras y el JavaScript asociado:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":289,"cache_creation_input_tokens":597,"cache_read_input_tokens":20667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":597},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7ELiDSkdzCcNVEw8JH","type":"assistant","uuid":"f9303dee-b6c4-4532-97e5-cf8e0b9937ca","timestamp":"2026-01-29T18:02:15.930Z"}
{"parentUuid":"f9303dee-b6c4-4532-97e5-cf8e0b9937ca","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0165dYsySR6zRmyJYKW1gY8e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MgChFkqR4gj7QAQhUecWbr","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-recompras.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":289,"cache_creation_input_tokens":597,"cache_read_input_tokens":20667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":597},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7ELiDSkdzCcNVEw8JH","type":"assistant","uuid":"e3c96f3b-8271-449e-9614-49abf75eff72","timestamp":"2026-01-29T18:02:16.190Z"}
{"parentUuid":"e3c96f3b-8271-449e-9614-49abf75eff72","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0165dYsySR6zRmyJYKW1gY8e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ScgFeAq1jemkcyCPrVdLon","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\empresa\\planes\\modal-recompras.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":289,"cache_creation_input_tokens":597,"cache_read_input_tokens":20667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":597},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7ELiDSkdzCcNVEw8JH","type":"assistant","uuid":"056ff758-95d3-4378-ba27-af13da93b23a","timestamp":"2026-01-29T18:02:16.430Z"}
{"parentUuid":"056ff758-95d3-4378-ba27-af13da93b23a","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0165dYsySR6zRmyJYKW1gY8e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XeAju2jtxwg4UPARCGNN7D","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\planes.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":289,"cache_creation_input_tokens":597,"cache_read_input_tokens":20667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":597},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7ELiDSkdzCcNVEw8JH","type":"assistant","uuid":"456c19e1-2648-4750-9ec3-7b189b9a053d","timestamp":"2026-01-29T18:02:16.794Z"}
{"parentUuid":"456c19e1-2648-4750-9ec3-7b189b9a053d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0165dYsySR6zRmyJYKW1gY8e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016NSwSDhVy5FTzGtLUqFQxk","name":"Read","input":{"file_path":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\componentes\\componentes\\filtros.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":289,"cache_creation_input_tokens":597,"cache_read_input_tokens":20667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":597},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7ELiDSkdzCcNVEw8JH","type":"assistant","uuid":"b33afa8b-32a8-4980-b5ef-964e38029ae5","timestamp":"2026-01-29T18:02:16.932Z"}
{"parentUuid":"456c19e1-2648-4750-9ec3-7b189b9a053d","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XeAju2jtxwg4UPARCGNN7D","type":"tool_result","content":"     1→@extends('layouts.app')\n     2→\n     3→@section('titulo', 'Mi empresa')\n     4→\n     5→@section('estilos')\n     6→    <link href=\"{{ asset('css/empresa/planes.css') }}\" rel=\"stylesheet\">\n     7→@endsection\n     8→\n     9→@section('contenido')\n    10→    <input type=\"hidden\" id=\"input_empresa_id\" value=\"{{ $empresa->id ?? '' }}\">\n    11→    <input type=\"hidden\" id=\"input_usuario_id\" value=\"{{ $usuario_id ?? '' }}\">\n    12→    <input type=\"hidden\" id=\"input_usuarios\" value=\"{{ json_encode($usuarios) }}\">\n    13→    <input type=\"hidden\" id=\"input_sucursales\" value=\"{{ json_encode($sucursales) }}\">\n    14→    <input type=\"hidden\" id=\"input_empresa\" value=\"{{ json_encode($empresa) }}\">\n    15→    <input type=\"hidden\" id=\"input_planes\" value=\"{{ json_encode($planes) }}\">\n    16→    @php\n    17→        $empresa_sesion = obtenerEmpresaSesion();\n    18→        $empresa_padre = obtenerEmpresaPadre($empresa_sesion);\n    19→    @endphp\n    20→    ${contenedorPrincipal({\n    21→        cabecera: `\n    22→            <div class=\"col-12\">\n    23→                <h1 class=\"text-headline-1\">Mi empresa</h1>\n    24→            </div>\n    25→            <div class=\"col-auto\">\n    26→                <table>\n    27→                    <tr>\n    28→                        <td>\n    29→                            @if(auth()->user()->hasAnyRole(['Administrador general', 'Propietario']))\n    30→                                ${crearBotonImagenIcono({\n    31→                                    id: 'btn_editar_icono_empresa',\n    32→                                    clase: 'clase-personalizada',\n    33→                                    imagen: '{{ asset('/empresas-logo') }}/{{ Session::get('empresa_id') }}',\n    34→                                    claseicon: 'bg-primary text-white',\n    35→                                    icon: 'bi bi-pencil-square text-white',\n    36→                                    size: 48,\n    37→                                    url: '/empresa-cambiar-logo'\n    38→                                })}\n    39→                            @else\n    40→                                ${crearBotonImagenIcono({\n    41→                                    id: 'btn_editar_icono_empresa',\n    42→                                    clase: 'clase-personalizada',\n    43→                                    imagen: '{{ asset('/empresas-logo') }}/{{ Session::get('empresa_id') }}',\n    44→                                    size: 48,\n    45→                                })}\n    46→                            @endif\n    47→                        </td>\n    48→                        <td>\n    49→                            <span class=\"mx-3 text-headline-2\" id=\"nombre-comercial-empresa-cabecera\">{{$empresa_sesion->nombre_comercial}}</span>\n    50→                        </td>\n    51→                        <td>\n    52→                            @if ($empresa_sesion->empresa_id != null)\n    53→                                <span class=\"mx-3 text-body-3\">Sucursal de {{$empresa_padre->nombre_comercial}}</span>\n    54→                            @else\n    55→                                <span class=\"mx-3 text-body-3\">Sucursales: {{ $empresa_sesion->sucursales->count() }}</span>\n    56→                            @endif\n    57→                        </td>\n    58→                    </tr>\n    59→                </table>\n    60→            </div>\n    61→        `,\n    62→        contenido: `\n    63→            <div class=\"card\">\n    64→                @include('componentes.menu-superior', [\n    65→                    'rutas' => $rutas_menu->where('slug', 'empresa')->first()?->rutas,\n    66→                    'activo' => 'planes-clientes',\n    67→                ])\n    68→                <div class=\"card-body\">\n    69→                    <div class=\"d-flex justify-content-end\">\n    70→                        <button class=\"btn btn-outline-primary btn-lg mb-4 text-label-1\" type=\"button\" id=\"boton-modal-recompras\"><i class=\"bi bi-cart-fill text-headline-4 me-3\"></i> Historial de compras</button>\n    71→                    </div>\n    72→                    <div id=\"listado-planes\"></div>\n    73→                </div>\n    74→            </div>\n    75→        `\n    76→    })}\n    77→@endsection\n    78→\n    79→@section('modals')\n    80→    ${crearModal({\n    81→        id: 'modal-solicitar-renovacion',\n    82→        dialog_class: 'modal-dialog-centered',\n    83→        titulo_header: 'Solicitar renovación',\n    84→        subtitulo_header: `¿Desea enviar una solicitud de renovación para el plan \"<span class=\"fw-bolder\" id=\"nombre-plan-solicitar-renovacion\"></span>\"?`,\n    85→        boton_footer1: {\n    86→            type: 'button',\n    87→            texto: 'Cancelar',\n    88→            class: 'btn-outline-primary',\n    89→            cerrar_modal: true,\n    90→        },\n    91→        boton_footer2: {\n    92→            type: 'submit',\n    93→            texto: 'Si, solicitar',\n    94→            class: 'btn-primary',\n    95→            cerrar_modal: false,\n    96→            onclick: 'solicitarRenovacionPlan()',\n    97→        },\n    98→        modal_body: `\n    99→            <input type=\"hidden\" id=\"id-plan-solicitar-renovacion\">\n   100→            <input type=\"hidden\" id=\"tipo-plan-solicitar-renovacion\">\n   101→        `\n   102→    })}\n   103→    @include('empresa.paginas.planes.modal-recompras')\n   104→    @include('empresa.paginas.planes.modal-consumos')\n   105→    @include('empresa.paginas.planes.modal-consumos-creditos')\n   106→@endsection\n   107→\n   108→@section('scripts')\n   109→    <script>\n   110→        const configuracion_tablas = {\n   111→            autoWidth: false,\n   112→            responsive: true,\n   113→            processing: false,\n   114→            serverSide: false,\n   115→            searching: true,\n   116→            deferRender: true,\n   117→            paging: true,\n   118→            aaSorting: [],\n   119→            language: lenguaje_componente_datatables,\n   120→            lengthMenu: [\n   121→                [5, 10, 25, 50, 100, 200],\n   122→                [5, 10, 25, 50, 100, 200]\n   123→            ],\n   124→            scrollX: true,\n   125→            scrollY: 'calc(100vh - 400px)',\n   126→            scrollCollapse: true,\n   127→        };\n   128→\n   129→    </script>\n   130→    <script src=\"{{ asset('js/empresa/planes/planes.js') }}\" type=\"text/javascript\"></script>\n   131→    <script src=\"{{ asset('js/empresa/planes/modal-recompras.js') }}\" type=\"text/javascript\"></script>\n   132→    <script src=\"{{ asset('js/empresa/planes/modal-consumos.js') }}\" type=\"text/javascript\"></script>\n   133→    <script src=\"{{ asset('js/empresa/planes/modal-consumos-creditos.js') }}\" type=\"text/javascript\"></script>\n   134→@endsection\n   135→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6744c996-00da-4a89-bb57-7dd2a55acdef","timestamp":"2026-01-29T18:02:20.829Z","sourceToolAssistantUUID":"456c19e1-2648-4750-9ec3-7b189b9a053d"}
{"parentUuid":"b33afa8b-32a8-4980-b5ef-964e38029ae5","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016NSwSDhVy5FTzGtLUqFQxk","type":"tool_result","content":"     1→/**\n     2→ * Crear componente de filtro dropdown.\n     3→ *\n     4→ * @param {object} componente Componente de filtro dropdown.\n     5→ * @returns {string} Componente de filtro dropdown.\n     6→ * @author José Manuel Jiménez\n     7→ * @author Andres Morales\n     8→ */\n     9→function crearFiltroDropdown(componente) {\n    10→    return `\n    11→        <div class=\"w-100 dropend filtro-dropdown\" id=\"filtro-dropdown-${componente.id}\">\n    12→            ${componente.buscador_datatable != true ? crearInput(componente) : `\n    13→                    <i class=\"bi bi-filter input-icono3 pointer icono-filtros-avanzados-buscador\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-bs-auto-close=\"outside\"></i>\n    14→            `}\n    15→            ${componente.dropdown ? `\n    16→                <div class=\"dropdown-menu dropdown-filtro\">\n    17→                    <div class=\"col-12\">\n    18→                        <div class=\"row justify-content-between align-items-center\">\n    19→                            <div class=\"col-auto text-headline-4 text-gray-10 mb-0\">${componente.dropdown.titulo}</div>\n    20→                            <div class=\"col-auto text-headline-4 pointer dropdown-close\">\n    21→                                <i class=\"bi bi-x text-gray-10 dropdown-close\"></i>\n    22→                            </div>\n    23→                        </div>\n    24→                    </div>\n    25→                    ${componente.dropdown.contenido}\n    26→                    <div class=\"row justify-content-center\">\n    27→                        <div class=\"${componente.dropdown.contenedor_botones_class ? componente.dropdown.contenedor_botones_class : 'col-5'} mt-4\">\n    28→                            ${crearBoton({\n    29→                                clases: 'w-100 justify-content-center btn-outline-primary dropdown-close',\n    30→                                texto: 'Borrar filtros',\n    31→                                onclick: `restablecerFiltrosComponente('${componente.id}');`,\n    32→                            })}\n    33→                        </div>\n    34→                        <div class=\"${componente.dropdown.contenedor_botones_class ? componente.dropdown.contenedor_botones_class : 'col-5'} mt-4\">\n    35→                            ${crearBoton({\n    36→                                clases: 'w-100 justify-content-center btn-primary dropdown-close aplicar-filtro-enter',\n    37→                                texto: 'Aplicar filtros',\n    38→                                onclick: `mostrarFiltrosComponente('${componente.id}');`,\n    39→                            })}\n    40→                        </div>\n    41→                    </div>\n    42→                </div>\n    43→            ` : ''}\n    44→        </div>\n    45→    `;\n    46→}\n    47→\n    48→/**\n    49→ * Aplicar filtros de componente.\n    50→ *\n    51→ * @param {object} id_input Id de filtro.\n    52→ * @returns {void} No retorna nada.\n    53→ * @author José Manuel Jiménez\n    54→ * @author Andres Morales\n    55→ */\n    56→function mostrarFiltrosComponente(id_input) {\n    57→    $(`#contenedor-chips-${id_input}`).empty();\n    58→    let cantidad_chips_storage = 0;\n    59→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n    60→    if (componentes_chips_storage != null) {\n    61→        componentes_chips_storage = JSON.parse(componentes_chips_storage);\n    62→        if (componentes_chips_storage[window.location.pathname] != null && componentes_chips_storage[window.location.pathname][id_input] != null) {\n    63→            cantidad_chips_storage = componentes_chips_storage[window.location.pathname][id_input].chips.length;\n    64→            for (let i = 0; i < componentes_chips_storage[window.location.pathname][id_input].chips.length; i++) {\n    65→                $('#contenedor-chips-'+id_input).append(`\n    66→                    <div class=\"col-auto bg-gray-80 rounded-4 text-label-1 py-1 px-3 me-3 chip\">\n    67→                        <div class=\"row\">\n    68→                            <div class=\"col-auto\">\n    69→                                ${componentes_chips_storage[window.location.pathname][id_input].chips[i]}\n    70→                            </div>\n    71→                            <div class=\"col-auto\" onclick=\"quitarChipStorage('${id_input}', '${componentes_chips_storage[window.location.pathname][id_input].chips[i]}');\">\n    72→                                <i class=\"bi bi-x\"></i>\n    73→                            </div>\n    74→                        </div>\n    75→                    </div>\n    76→                `);\n    77→            }\n    78→        }\n    79→    }\n    80→    let filtros = [];\n    81→    $('#filtro-dropdown-' + id_input).find('input.filtro').each(function () {\n    82→        let valor = $(this).val();\n    83→        if (valor !== '') {\n    84→            filtros.push({\n    85→                label: $(this).data('filtro'),\n    86→                value: valor,\n    87→                text_value: valor,\n    88→                id: $(this).attr('id'),\n    89→                tipo: 'input'\n    90→            });\n    91→        }\n    92→    });\n    93→    $('#filtro-dropdown-' + id_input).find('.dropdown-menu').find('.select2.filtro').each(function () {\n    94→        let valor = $(this).val();\n    95→        if (valor !== '') {\n    96→            filtros.push({\n    97→                label: $(this).data('filtro'),\n    98→                value: valor,\n    99→                text_value: $(this).find('option:selected').text(),\n   100→                id: $(this).attr('id'),\n   101→                tipo: 'select'\n   102→            });\n   103→        }\n   104→    });\n   105→    for (let filtro of filtros) {\n   106→        $(`#contenedor-chips-${id_input}`).append(`\n   107→            <div class=\"col-auto bg-gray-80 rounded-4 text-label-1 py-1 px-3 me-3 chip\">\n   108→                <div class=\"row\">\n   109→                    <div class=\"col-auto\">\n   110→                        ${filtro.label}: ${filtro.text_value}\n   111→                    </div>\n   112→                    <div class=\"col-auto\" onclick=\"eliminarFiltroChip('${filtro.id}', '${filtro.tipo}', '${id_input}')\">\n   113→                        <i class=\"bi bi-x\"></i>\n   114→                    </div>\n   115→                </div>\n   116→            </div>\n   117→        `);\n   118→    }\n   119→    let cantidad_chips = $($(`#contenedor-chips-${id_input}`)).find('.chip').length + cantidad_chips_storage;\n   120→    if (cantidad_chips > 0 && !$(`#${id_input}`).hasClass('filtro-unico')) {\n   121→        $(`#contenedor-chips-${id_input}`).append(`\n   122→            <div class=\"col-auto chip-restablecer\">\n   123→                ${crearBoton({\n   124→                    clases: 'w-100 justify-content-center btn-text-primary',\n   125→                    texto: 'Restablecer filtros',\n   126→                    onclick: `restablecerFiltrosComponente('${id_input}');`,\n   127→                })}\n   128→            </div>\n   129→        `);\n   130→    } else {\n   131→        $(`#${id_input}`).blur();\n   132→    }\n   133→    if (window.aplicarFiltrosDropdown) {\n   134→        let json_filtros = [];\n   135→        let filtros = $(`#filtro-dropdown-${id_input}`).find('.dropdown-menu').find('.filtro');\n   136→        filtros.each(function () {\n   137→            let valor = $(this).val();\n   138→            if (valor !== '') {\n   139→                json_filtros[$(this).attr('id')] = valor;\n   140→            }\n   141→        });\n   142→        let chips_filtros = [];\n   143→        let chips_storage = localStorage.getItem('componentes_chips_storage');\n   144→        if (chips_storage != null) {\n   145→            chips_storage = JSON.parse(chips_storage);\n   146→            if (chips_storage[window.location.pathname] != null && chips_storage[window.location.pathname][id_input] != null) {\n   147→                let chips = chips_storage[window.location.pathname][id_input].chips;\n   148→                for (let i = 0; i < chips.length; i++) {\n   149→                    chips_filtros.push(chips[i]);\n   150→                }\n   151→            }\n   152→        }\n   153→        json_filtros['chips'] = chips_filtros;\n   154→\n   155→        if (id_input === 'listado_tabla_soportes') { \n   156→            aplicarFiltrosSoportes(json_filtros);\n   157→        } else {\n   158→            aplicarFiltrosDropdown(id_input, json_filtros);\n   159→        }\n   160→    }\n   161→}\n   162→\n   163→/**\n   164→ * Eliminar filtro de chip.\n   165→ *\n   166→ * @param {string} id Id de filtro.\n   167→ * @param {string} tipo Tipo de filtro.\n   168→ * @param {string} id_input Id de filtro.\n   169→ * @returns {void} No retorna nada.\n   170→ * @author José Manuel Jiménez\n   171→ */\n   172→function eliminarFiltroChip(id, tipo, id_input) {\n   173→    if (tipo == 'input') {\n   174→        $(`#${id}`).val('').trigger('input').trigger('change');\n   175→        if ($(`#${id}`).hasClass('flatpickr-input')) {\n   176→            $(`#${id}_alt`).val('').trigger('input').trigger('change');\n   177→        }\n   178→    } else if (tipo == 'select') {\n   179→        $(`#${id}`).val('').trigger('change.select2');\n   180→    }\n   181→    mostrarFiltrosComponente(id_input);\n   182→}\n   183→\n   184→/**\n   185→ * Restablecer filtros de componente.\n   186→ *\n   187→ * @param {object} input_id ID del filtro.\n   188→ * @returns {void}\n   189→ * @author José Manuel Jiménez\n   190→ * @author Daniel Beltrán\n   191→ */\n   192→function restablecerFiltrosComponente(input_id) {\n   193→    // Limpiar inputs regulares (no flatpickr-range)\n   194→    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('input:not(.flatpickr-range)').val('').trigger('input');\n   195→\n   196→    // Limpiar flatpickr-range usando su método específico\n   197→    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('input.flatpickr-range').each(function() {\n   198→        if (this._flatpickr) {\n   199→            this._flatpickr.clear();\n   200→        } else {\n   201→            $(this).val('');\n   202→        }\n   203→    });\n   204→\n   205→    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('.select2').val('').trigger('change.select2');\n   206→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   207→    if (componentes_chips_storage != null) {\n   208→        componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   209→        if (componentes_chips_storage[window.location.pathname] != null && componentes_chips_storage[window.location.pathname][input_id] != null) {\n   210→            componentes_chips_storage[window.location.pathname][input_id].chips = [];\n   211→            localStorage.setItem('componentes_chips_storage', JSON.stringify(componentes_chips_storage));\n   212→        }\n   213→    }\n   214→    if (window.restablecerFiltrosDropdownAdicional) {\n   215→        restablecerFiltrosDropdownAdicional(input_id)\n   216→    }\n   217→    mostrarFiltrosComponente(input_id);\n   218→}\n   219→\n   220→/**\n   221→ * Agregar chip de storage y aplicarlos en busqueda y front.\n   222→ *\n   223→ * @param {string} id_input Id de filtro.\n   224→ * @param {string} chip Chip de filtro.\n   225→ * @returns {void} No retorna nada.\n   226→ * @author José Manuel Jiménez\n   227→ */\n   228→function agregarChipStorage(id_input, chip) {\n   229→    $('.busqueda-reciente-filtro').remove();\n   230→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   231→    if (componentes_chips_storage == null) {\n   232→        let chip_url = {};\n   233→        chip_url[window.location.pathname] = {};\n   234→        chip_url[window.location.pathname][id_input] = {\n   235→            chips: [chip],\n   236→            cinco_recientes: [chip]\n   237→        };\n   238→        componentes_chips_storage = chip_url;\n   239→    } else {\n   240→        componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   241→        if (componentes_chips_storage[window.location.pathname] == null) {\n   242→            componentes_chips_storage[window.location.pathname] = {};\n   243→        }\n   244→        if (componentes_chips_storage[window.location.pathname][id_input] == null) {\n   245→            componentes_chips_storage[window.location.pathname][id_input] = {\n   246→                chips: [chip],\n   247→                cinco_recientes: [chip]\n   248→            };\n   249→        }\n   250→    }\n   251→    let chips = componentes_chips_storage[window.location.pathname][id_input].chips;\n   252→    let repetido = false;\n   253→    for (let i = 0; i < chips.length; i++) {\n   254→        if (chips[i] == chip) {\n   255→            repetido = true;\n   256→            break;\n   257→        }\n   258→    }\n   259→    if (!repetido) {\n   260→        componentes_chips_storage[window.location.pathname][id_input].chips.unshift(chip);\n   261→    }\n   262→    let cinco_recientes = componentes_chips_storage[window.location.pathname][id_input].cinco_recientes;\n   263→    let repetido_recientes = false;\n   264→    for (let i = 0; i < cinco_recientes.length; i++) {\n   265→        if (cinco_recientes[i] == chip) {\n   266→            repetido_recientes = true;\n   267→            break;\n   268→        }\n   269→    }\n   270→    if (!repetido_recientes) {\n   271→        componentes_chips_storage[window.location.pathname][id_input].cinco_recientes.unshift(chip);\n   272→    }\n   273→    if (componentes_chips_storage[window.location.pathname][id_input].cinco_recientes.length > 5) {\n   274→        componentes_chips_storage[window.location.pathname][id_input].cinco_recientes.pop();\n   275→    }\n   276→    localStorage.setItem('componentes_chips_storage', JSON.stringify(componentes_chips_storage));\n   277→    $(`#${id_input}`).val('');\n   278→    mostrarFiltrosComponente(id_input);\n   279→}\n   280→\n   281→/**\n   282→ * Quitar chip de storage y aplicarlos en busqueda y front.\n   283→ *\n   284→ * @param {string} id_input Id de filtro.\n   285→ * @param {string} chip Chip de filtro.\n   286→ * @returns {void} No retorna nada.\n   287→ * @author José Manuel Jiménez\n   288→ */\n   289→function quitarChipStorage(id_input, chip) {\n   290→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   291→    componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   292→    let index = componentes_chips_storage[window.location.pathname][id_input].chips.indexOf(chip);\n   293→    if (index > -1) {\n   294→        componentes_chips_storage[window.location.pathname][id_input].chips.splice(index, 1);\n   295→    }\n   296→    localStorage.setItem('componentes_chips_storage', JSON.stringify(componentes_chips_storage));\n   297→    mostrarFiltrosComponente(id_input);\n   298→}\n   299→\n   300→/**\n   301→ * Mostrar recientes de chip storage.\n   302→ *\n   303→ * @param {string} id_input Id de filtro.\n   304→ * @returns {void} No retorna nada.\n   305→ * @author José Manuel Jiménez\n   306→ */\n   307→function mostrarRecientesChipStorage(id_input) {\n   308→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   309→    let recientes_html = '';\n   310→    if (componentes_chips_storage != null) {\n   311→        componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   312→        if (componentes_chips_storage[window.location.pathname] != null && componentes_chips_storage[window.location.pathname][id_input] != null) {\n   313→            let opciones = localStorage.getItem('componentes_chips_storage');\n   314→            opciones = JSON.parse(opciones);\n   315→            let recientes = opciones[window.location.pathname][id_input].cinco_recientes;\n   316→            if (recientes.length > 0) {\n   317→                for (let i = 0; i < recientes.length; i++) {\n   318→                    recientes_html += `\n   319→                        <div class=\"col-12 text-body-2 pointer reciente\">\n   320→                            <div class=\"row align-items-center\">\n   321→                                <div class=\"col ps-10 pt-2\" onclick=\"agregarChipStorage('${id_input}', '${recientes[i]}')\">\n   322→                                    ${recientes[i]}\n   323→                                </div>\n   324→                                <div class=\"col-auto pt-2 pe-2\">\n   325→                                    <i class=\"bi bi-x text-headline-5 text-gray-10\" onclick=\"quitarChipRecienteStorage('${id_input}', '${recientes[i]}');\"></i>\n   326→                                </div>\n   327→                            </div>\n   328→                        </div>\n   329→                    `;\n   330→                }\n   331→            } else {\n   332→                recientes_html = `<div class=\"col-12 ps-10 mt-3 text-body-2 pointer\">Sin búsquedas recientes</div>`;\n   333→            }\n   334→        } else {\n   335→            recientes_html = `<div class=\"col-12 ps-10 mt-3 text-body-2 pointer\">Sin búsquedas recientes</div>`;\n   336→        }\n   337→    } else {\n   338→        recientes_html = `<div class=\"col-12 ps-10 mt-3 text-body-2 pointer\">Sin búsquedas recientes</div>`;\n   339→    }\n   340→    $(`#${id_input}`).closest('.filtro-dropdown').find('.busqueda-reciente-filtro').remove();\n   341→        $(`#${id_input}`).closest('.filtro-dropdown').append(`\n   342→            <div class=\"position-absolute bg-white rounded-2 shadow-1 p-4 busqueda-reciente-filtro\">\n   343→                <div class=\"row\">\n   344→                    <div class=\"col-12\">Inicia la búsqueda con 3 caracteres</div>\n   345→                    <div class=\"col-12 input-container mb-0\">\n   346→                        <div class=\"row align-items-center mt-4\">\n   347→                            <div class=\"col-auto\">\n   348→                                <i class=\"bi bi-search text-gray-40\"></i>\n   349→                            </div>\n   350→                            <div class=\"col px-0 text-body-2 text-gray-40\">\n   351→                                BUSQUEDAS RECIENTES\n   352→                            </div>\n   353→                        </div>\n   354→                    </div>\n   355→                    <div class=\"col-12 mt-2\">\n   356→                        <div class=\"row contenedor-recientes\">\n   357→                            ${recientes_html}\n   358→                        </div>\n   359→                    </div>\n   360→                </div>\n   361→            </div>\n   362→        `);\n   363→}\n   364→\n   365→/**\n   366→ * Quitar chip reciente de storage.\n   367→ *\n   368→ * @param {string} id_input Id de filtro.\n   369→ * @param {string} chip Chip de filtro.\n   370→ * @returns {void} No retorna nada.\n   371→ * @author José Manuel Jiménez\n   372→ */\n   373→function quitarChipRecienteStorage(id_input, chip) {\n   374→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   375→    componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   376→    let index = componentes_chips_storage[window.location.pathname][id_input].cinco_recientes.indexOf(chip);\n   377→    if (index > -1) {\n   378→        componentes_chips_storage[window.location.pathname][id_input].cinco_recientes.splice(index, 1);\n   379→    }\n   380→    localStorage.setItem('componentes_chips_storage', JSON.stringify(componentes_chips_storage));\n   381→    mostrarRecientesChipStorage(id_input);\n   382→}\n   383→\n   384→/**\n   385→ * Agregar funcionalidad de cerrar dropdown al hacer clic en el botón de cerrar.\n   386→ *\n   387→ * @param {object} e Evento.\n   388→ * @returns {void} No retorna nada.\n   389→ * @author José Manuel Jiménez\n   390→ */\n   391→document.addEventListener('click', function (e) {\n   392→    if (e.target.closest('.dropdown-close')) {\n   393→        const dropend = e.target.closest('.dropend');\n   394→        if (dropend) {\n   395→            const dropdownToggle = dropend.querySelector('[data-bs-toggle=\"dropdown\"]');\n   396→            if (dropdownToggle) {\n   397→                const dropdown = bootstrap.Dropdown.getInstance(dropdownToggle);\n   398→                if (dropdown) {\n   399→                    dropdown.hide();\n   400→                }\n   401→            }\n   402→        }\n   403→    }\n   404→});\n   405→\n   406→/**\n   407→ * Agregar accion al dar enter en input de filtro.\n   408→ *\n   409→ * @param {object} e Evento.\n   410→ * @returns {void} No retorna nada.\n   411→ * @author José Manuel Jiménez\n   412→ */\n   413→$(document).on('keydown', '.filtro-chips', function(e) {\n   414→    if (e.key === 'Enter' || e.which === 13) {\n   415→        if (this.value != '') {\n   416→            agregarChipStorage(this.id, this.value);\n   417→        }\n   418→    }\n   419→});\n   420→\n   421→/**\n   422→ * Simular clic en botón aplicar filtros al presionar Enter cuando el dropdown está visible.\n   423→ *\n   424→ * @param {object} e Evento.\n   425→ * @returns {void} No retorna nada.\n   426→ * @author Andres Gonzalez\n   427→ */\n   428→$(document).on('keydown', function(e) {\n   429→    if (e.key === 'Enter' || e.which === 13) {\n   430→        let dropdown_visible = $('.dropdown-menu.dropdown-filtro.show');\n   431→        if (dropdown_visible.length > 0) {\n   432→            let boton_aplicar = dropdown_visible.find('.aplicar-filtro-enter');\n   433→            if (boton_aplicar.length > 0) {\n   434→                boton_aplicar[0].click();\n   435→            }\n   436→        }\n   437→    }\n   438→});\n   439→\n   440→/**\n   441→ * Mostrar recientes de chip storage al hacer clic en input de filtro.\n   442→ *\n   443→ * @param {object} e Evento.\n   444→ * @returns {void} No retorna nada.\n   445→ * @author José Manuel Jiménez\n   446→ */\n   447→$(document).on('click', '.filtro-chips', function(e) {\n   448→    mostrarRecientesChipStorage(this.id);\n   449→});\n   450→\n   451→/**\n   452→ * Cerrar busqueda reciente al hacer clic fuera de la busqueda reciente.\n   453→ *\n   454→ * @param {object} e Evento.\n   455→ * @returns {void} No retorna nada.\n   456→ * @author José Manuel Jiménez\n   457→ */\n   458→$(document).on('click', function(e) {\n   459→    if (!$(e.target).closest('.busqueda-reciente-filtro, .filtro-chips').length) {\n   460→        $('.busqueda-reciente-filtro').remove();\n   461→    }\n   462→});\n   463→\n   464→/**\n   465→ * Limpiar filtros de chips escritos anteriores al cargar la pagina\n   466→ *\n   467→ * @returns {void} No retorna nada.\n   468→ * @author José Manuel Jiménez\n   469→ */\n   470→$(document).ready(function() {\n   471→    let componentes_chips_storage = localStorage.getItem('componentes_chips_storage');\n   472→    if (componentes_chips_storage != null) {\n   473→        componentes_chips_storage = JSON.parse(componentes_chips_storage);\n   474→        $.each(componentes_chips_storage[window.location.pathname] ? componentes_chips_storage[window.location.pathname] : {}, function(id, filtro) {\n   475→            componentes_chips_storage[window.location.pathname][id].chips = [];\n   476→        });\n   477→        localStorage.setItem('componentes_chips_storage', JSON.stringify(componentes_chips_storage));\n   478→    }\n   479→});\n   480→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f9242d54-b9ce-484f-9a08-294d36712a43","timestamp":"2026-01-29T18:02:20.830Z","sourceToolAssistantUUID":"b33afa8b-32a8-4980-b5ef-964e38029ae5"}
{"parentUuid":"f9242d54-b9ce-484f-9a08-294d36712a43","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01XeAju2jtxwg4UPARCGNN7D","toolUseID":"toolu_01XeAju2jtxwg4UPARCGNN7D","timestamp":"2026-01-29T18:02:20.832Z","uuid":"65dc659c-b3f8-4873-8c48-8747135860a6"}
{"parentUuid":"65dc659c-b3f8-4873-8c48-8747135860a6","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_016NSwSDhVy5FTzGtLUqFQxk","toolUseID":"toolu_016NSwSDhVy5FTzGtLUqFQxk","timestamp":"2026-01-29T18:02:20.832Z","uuid":"5f9f52f7-6506-4584-aa35-034610b20757"}
{"parentUuid":"e3c96f3b-8271-449e-9614-49abf75eff72","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MgChFkqR4gj7QAQhUecWbr","type":"tool_result","content":"     1→${crearModal({\n     2→    id: 'modal-historial-recompras',\n     3→    dialog_class: 'modal-dialog-centered modal-xl modal-dialog-scrollable',\n     4→    titulo_header: `\n     5→        @php\n     6→            $migasDePan = [\n     7→                ['nombre' => 'Mi empresa', 'url' => '', 'active' => true],\n     8→                ['nombre' => 'Planes y consumo', 'url' => '', 'active' => true],\n     9→                ['nombre' => 'Historial de compras', 'url' => '', 'active' => true],\n    10→            ];\n    11→        @endphp\n    12→        ${crearMigaDePan({migas:@json($migasDePan), volver:false})}\n    13→    `,\n    14→    modal_body: `\n    15→        <h3 class=\"text-headline-4 fw-bolder mt-5\"><i class=\"bi bi-cart-fill text-headline-2 me-3\"></i> Historial de compras</h3>\n    16→        <div class=\"col-12 mb-5 text-body-2 fw-normal\">Aquí puedes ver un registro detallado de las recompras realizadas.</div>\n    17→        ${crearTabsHorizontal({\n    18→            id: 'tabs-modal-consumos',\n    19→            tabs: [\n    20→                {\n    21→                    id: 'pestana-compras-seleccion',\n    22→                    icono: `<i class=\"bi bi-box-fill text-headline-4 me-3\"></i>`,\n    23→                    titulo: `Selección`,\n    24→                    contenido: `\n    25→                        <div class=\"col-12 mt-5\">\n    26→                            ${crearTabla({\n    27→                                id: 'tabla-compras-seleccion',\n    28→                                registros_paginas: true,\n    29→                                issubtabla: '.desplegarSubRow',\n    30→                                chips: `\n    31→                                    <div class=\"col-12\">\n    32→                                        <div class=\"row align-items-center w-100 mx-0 contenedor-chips my-2\" id=\"contenedor-chips-filtro_dropdown_seleccion\"></div>\n    33→                                    </div>\n    34→                                `,\n    35→                                botones: `\n    36→                                    <div class=\"col-auto\">\n    37→                                        ${crearFiltroDropdown({\n    38→                                            id: 'filtro_dropdown_seleccion',\n    39→                                            name: 'filtro_dropdown_seleccion',\n    40→                                            type: 'text',\n    41→                                            value: '',\n    42→                                            class: 'filtro-chips',\n    43→                                            placeholder: 'Buscar',\n    44→                                            icono: '<i class=\"bi bi-search input-icono1\"></i>',\n    45→                                            icono3: '<i class=\"bi bi-filter input-icono3 pointer icono-filtro-avanzado\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-bs-auto-close=\"outside\"></i>',\n    46→                                            dropdown: {\n    47→                                                titulo: 'Filtros avanzados',\n    48→                                                contenido: `\n    49→                                                    <div class=\"row mt-4\">\n    50→                                                        <div class=\"col-5 pt-2\">Duración</div>\n    51→                                                        <div class=\"col-7\">\n    52→                                                            ${crearSelect2({\n    53→                                                                opciones: [\n    54→                                                                    { nombre: 'Todos', id: '' },\n    55→                                                                    { nombre: 'Con tiempo', id: 'con_tiempo' },\n    56→                                                                    { nombre: 'Sin tiempo', id: 'sin_tiempo' },\n    57→                                                                ],\n    58→                                                                opcion_vacia: false,\n    59→                                                                id: 'duracion_filtro_seleccion',\n    60→                                                                class: 'select2-filtro filtro',\n    61→                                                                input_container_class: 'mb-0',\n    62→                                                                data: [\n    63→                                                                    { texto: 'filtro', value: 'Duración'}\n    64→                                                                ]\n    65→                                                            })}\n    66→                                                        </div>\n    67→                                                    </div>\n    68→                                                    <div class=\"row mt-4\">\n    69→                                                        <div class=\"col-5 pt-2\">Fecha de activación</div>\n    70→                                                        <div class=\"col-7\">\n    71→                                                            ${crearDatePicker({\n    72→                                                                id: 'fecha_activacion_filtro_seleccion',\n    73→                                                                class: 'flatpickr-range filtro',\n    74→                                                                input_container_class: 'mb-1',\n    75→                                                                placeholder: 'Desde - hasta',\n    76→                                                                disabled: false,\n    77→                                                                icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n    78→                                                                data: [\n    79→                                                                    { texto: 'filtro', value: 'Fecha de activación'}\n    80→                                                                ]\n    81→                                                            })}\n    82→                                                        </div>\n    83→                                                    </div>\n    84→                                                    <div class=\"row mt-4\">\n    85→                                                        <div class=\"col-5 pt-2\">Fecha de vencimiento</div>\n    86→                                                        <div class=\"col-7\">\n    87→                                                            ${crearDatePicker({\n    88→                                                                id: 'fecha_vencimiento_filtro_seleccion',\n    89→                                                                class: 'flatpickr-range filtro',\n    90→                                                                input_container_class: 'mb-1',\n    91→                                                                placeholder: 'Desde - hasta',\n    92→                                                                disabled: false,\n    93→                                                                icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n    94→                                                                data: [\n    95→                                                                    { texto: 'filtro', value: 'Fecha de vencimiento'}\n    96→                                                                ]\n    97→                                                            })}\n    98→                                                        </div>\n    99→                                                    </div>\n   100→                                                    <div class=\"row mt-4\">\n   101→                                                        <div class=\"col-5 pt-2\">Estado del plan</div>\n   102→                                                        <div class=\"col-7\">\n   103→                                                            ${crearSelect2({\n   104→                                                                opciones: [\n   105→                                                                    { nombre: 'Todos', id: '' },\n   106→                                                                    { nombre: 'Activo', id: '1' },\n   107→                                                                    { nombre: 'Inactivo', id: '2' },\n   108→                                                                    { nombre: 'Próximo', id: '3' },\n   109→                                                                    { nombre: 'Por vencer', id: '4' },\n   110→                                                                    { nombre: 'Vencido', id: '5' },\n   111→                                                                    { nombre: 'Renovando', id: '6' },\n   112→                                                                ],\n   113→                                                                opcion_vacia: false,\n   114→                                                                id: 'estado_plan_filtro_seleccion',\n   115→                                                                class: 'select2-filtro filtro',\n   116→                                                                input_container_class: 'mb-0',\n   117→                                                                data: [\n   118→                                                                    { texto: 'filtro', value: 'Estado del plan'}\n   119→                                                                ]\n   120→                                                            })}\n   121→                                                        </div>\n   122→                                                    </div>\n   123→                                                `,\n   124→                                            }\n   125→                                        })}\n   126→                                    </div>\n   127→                                    <div class=\"col-auto\" id=\"seleccion-totales-unidades\">\n   128→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-box-fill text-headline-5 me-2\"></i>Unidades totales</p>\n   129→                                    </div>\n   130→                                    <div class=\"col-auto\" id=\"seleccion-totales-ofertas\">\n   131→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-briefcase-fill text-headline-5 me-2\"></i>Ofertar totales</p>\n   132→\n   133→                                    </div>\n   134→                                    <div class=\"col-auto ms-auto\">\n   135→                                        ${crearBoton({ id: 'boton-descargar-historial-compras-seleccion', clases: 'btn-outline-success', texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/excel_icon.svg') }}\"> Exportar todo' })}\n   136→                                    </div>\n   137→                                `,\n   138→                            })}\n   139→                        </div>\n   140→                    `,\n   141→                    activo: true\n   142→                },\n   143→                {\n   144→                    id: 'pestana-compras-organizacional',\n   145→                    icono: `<i class=\"bi bi-briefcase-fill text-headline-4 me-3\"></i>`,\n   146→                    titulo: `Organizacional`,\n   147→                    contenido: `\n   148→                        <div class=\"col-12 mt-5\">\n   149→                            ${crearTabla({\n   150→                                id: 'tabla-compras-organizacional',\n   151→                                registros_paginas: true,\n   152→                                input_container_class: 'mb-0',\n   153→                                filtro: crearFiltroDropdown({\n   154→                                    id: 'filtro_dropdown_organizacional',\n   155→                                    name: 'filtro_dropdown_organizacional',\n   156→                                    type: 'text',\n   157→                                    value: '',\n   158→                                    class: 'filtro-chips',\n   159→                                    input_container_class: 'mb-0',\n   160→                                    placeholder: 'Buscar',\n   161→                                    icono: '<i class=\"bi bi-search input-icono1\"></i>',\n   162→                                    icono3: '<i class=\"bi bi-filter input-icono3 pointer icono-filtro-avanzado\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-bs-auto-close=\"outside\"></i>',\n   163→                                    dropdown: {\n   164→                                        titulo: 'Filtros avanzados',\n   165→                                        contenido: `\n   166→                                            <div class=\"row mt-4\">\n   167→                                                <div class=\"col-5 pt-2\">Duración</div>\n   168→                                                <div class=\"col-7\">\n   169→                                                    ${crearSelect2({\n   170→                                                        opciones: [\n   171→                                                            { nombre: 'Todos', id: '' },\n   172→                                                            { nombre: 'Con tiempo', id: 'con-tiempo' },\n   173→                                                            { nombre: 'Sin tiempo', id: 'sin-tiempo' },\n   174→                                                        ],\n   175→                                                        opcion_vacia: false,\n   176→                                                        id: 'duracion_filtro_organizacional',\n   177→                                                        class: 'select2-filtro filtro',\n   178→                                                        input_container_class: 'mb-0',\n   179→                                                        data: [\n   180→                                                            { texto: 'filtro', value: 'Duración'}\n   181→                                                        ]\n   182→                                                    })}\n   183→                                                </div>\n   184→                                            </div>\n   185→                                            <div class=\"row mt-4\">\n   186→                                                <div class=\"col-5 pt-2\">Fecha de compra</div>\n   187→                                                <div class=\"col-7\">\n   188→                                                    ${crearDatePicker({\n   189→                                                        id: 'fecha_activacion_filtro_organizacional',\n   190→                                                        class: 'flatpickr-range filtro',\n   191→                                                        input_container_class: 'mb-1',\n   192→                                                        placeholder: 'Desde - hasta',\n   193→                                                        disabled: false,\n   194→                                                        icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n   195→                                                        data: [\n   196→                                                            { texto: 'filtro', value: 'Fecha de activación'}\n   197→                                                        ]\n   198→                                                    })}\n   199→                                                </div>\n   200→                                            </div>\n   201→                                            <div class=\"row mt-4\">\n   202→                                                <div class=\"col-5 pt-2\">Fecha de vencimiento</div>\n   203→                                                <div class=\"col-7\">\n   204→                                                    ${crearDatePicker({\n   205→                                                        id: 'fecha_vencimiento_filtro_organizacional',\n   206→                                                        class: 'flatpickr-range filtro',\n   207→                                                        input_container_class: 'mb-1',\n   208→                                                        placeholder: 'Desde - hasta',\n   209→                                                        disabled: false,\n   210→                                                        icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n   211→                                                        data: [\n   212→                                                            { texto: 'filtro', value: 'Fecha de vencimiento'}\n   213→                                                        ]\n   214→                                                    })}\n   215→                                                </div>\n   216→                                            </div>\n   217→                                            <div class=\"row mt-4\">\n   218→                                                <div class=\"col-5 pt-2\">Estado del plan</div>\n   219→                                                <div class=\"col-7\">\n   220→                                                    ${crearSelect2({\n   221→                                                        opciones: [\n   222→                                                            { nombre: 'Todos', id: '' },\n   223→                                                            { nombre: 'Activo', id: '1' },\n   224→                                                            { nombre: 'Inactivo', id: '2' },\n   225→                                                            { nombre: 'Próximo', id: '3' },\n   226→                                                            { nombre: 'Por vencer', id: '4' },\n   227→                                                            { nombre: 'Vencido', id: '5' },\n   228→                                                            { nombre: 'Renovando', id: '6' },\n   229→                                                        ],\n   230→                                                        opcion_vacia: false,\n   231→                                                        id: 'estado_plan_filtro_organizacional',\n   232→                                                        class: 'select2-filtro filtro',\n   233→                                                        input_container_class: 'mb-0',\n   234→                                                        data: [\n   235→                                                            { texto: 'filtro', value: 'Estado del plan'}\n   236→                                                        ]\n   237→                                                    })}\n   238→                                                </div>\n   239→                                            </div>\n   240→                                        `,\n   241→                                    }\n   242→                                }),\n   243→                                issubtabla: '.desplegarSubRow',\n   244→                                botones: `\n   245→                                    <div class=\"col-auto\" id=\"organizacional-totales-unidades\">\n   246→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-box-fill text-headline-5 me-2\"></i>Unidades totales</p>\n   247→                                    </div>\n   248→                                    <div class=\"col-auto\" id=\"organizacional-totales-ofertas\">\n   249→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-briefcase-fill text-headline-5 me-2\"></i>Ofertar totales</p>\n   250→                                    </div>\n   251→                                    <div class=\"col-auto ms-auto\">\n   252→                                        ${crearBoton({ id: 'boton-descargar-historial-compras-organizacional', clases: 'btn-outline-success', texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/excel_icon.svg') }}\"> Exportar todo' })}\n   253→                                    </div>\n   254→                                `,\n   255→                                chips: `\n   256→                                    <div class=\"col-12\">\n   257→                                        <div class=\"row align-items-center w-100 mx-0 contenedor-chips my-2\" id=\"contenedor-chips-filtro_dropdown_organizacional\"></div>\n   258→                                    </div>\n   259→                                `\n   260→                            })}\n   261→                        </div>\n   262→                    `,\n   263→                },\n   264→                {\n   265→                    id: 'pestana-compras-vocacional',\n   266→                    icono: `<i class=\"bi bi-person-fill text-headline-4 me-3\"></i>`,\n   267→                    titulo: `Vocacional`,\n   268→                    contenido: `\n   269→                        <div class=\"col-12 mt-5\">\n   270→                            ${crearTabla({\n   271→                                id: 'tabla-compras-vocacional',\n   272→                                registros_paginas: true,\n   273→                                input_container_class: 'mb-0',\n   274→                                filtro: crearFiltroDropdown({\n   275→                                    id: 'filtro_dropdown_vocacional',\n   276→                                    name: 'filtro_dropdown_vocacional',\n   277→                                    type: 'text',\n   278→                                    value: '',\n   279→                                    class: 'filtro-chips',\n   280→                                    input_container_class: 'mb-0',\n   281→                                    placeholder: 'Buscar',\n   282→                                    icono: '<i class=\"bi bi-search input-icono1\"></i>',\n   283→                                    icono3: '<i class=\"bi bi-filter input-icono3 pointer icono-filtro-avanzado\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-bs-auto-close=\"outside\"></i>',\n   284→                                    dropdown: {\n   285→                                        titulo: 'Filtros avanzados',\n   286→                                        contenido: `\n   287→                                            <div class=\"row mt-4\">\n   288→                                                <div class=\"col-5 pt-2\">Duración</div>\n   289→                                                <div class=\"col-7\">\n   290→                                                    ${crearSelect2({\n   291→                                                        opciones: [\n   292→                                                            { nombre: 'Todos', id: '' },\n   293→                                                            { nombre: 'Con tiempo', id: 'con-tiempo' },\n   294→                                                            { nombre: 'Sin tiempo', id: 'sin-tiempo' },\n   295→                                                        ],\n   296→                                                        opcion_vacia: false,\n   297→                                                        id: 'duracion_filtro_vocacional',\n   298→                                                        class: 'select2-filtro filtro',\n   299→                                                        input_container_class: 'mb-0',\n   300→                                                        data: [\n   301→                                                            { texto: 'filtro', value: 'Duración'}\n   302→                                                        ]\n   303→                                                    })}\n   304→                                                </div>\n   305→                                            </div>\n   306→                                            <div class=\"row mt-4\">\n   307→                                                <div class=\"col-5 pt-2\">Fecha de activación</div>\n   308→                                                <div class=\"col-7\">\n   309→                                                    ${crearDatePicker({\n   310→                                                        id: 'fecha_activacion_filtro_vocacional',\n   311→                                                        class: 'flatpickr-range filtro',\n   312→                                                        input_container_class: 'mb-1',\n   313→                                                        placeholder: 'Desde - hasta',\n   314→                                                        disabled: false,\n   315→                                                        icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n   316→                                                        data: [\n   317→                                                            { texto: 'filtro', value: 'Fecha de activación'}\n   318→                                                        ]\n   319→                                                    })}\n   320→                                                </div>\n   321→                                            </div>\n   322→                                            <div class=\"row mt-4\">\n   323→                                                <div class=\"col-5 pt-2\">Fecha de vencimiento</div>\n   324→                                                <div class=\"col-7\">\n   325→                                                    ${crearDatePicker({\n   326→                                                        id: 'fecha_vencimiento_filtro_vocacional',\n   327→                                                        class: 'flatpickr-range filtro',\n   328→                                                        input_container_class: 'mb-1',\n   329→                                                        placeholder: 'Desde - hasta',\n   330→                                                        disabled: false,\n   331→                                                        icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n   332→                                                        data: [\n   333→                                                            { texto: 'filtro', value: 'Fecha de vencimiento'}\n   334→                                                        ]\n   335→                                                    })}\n   336→                                                </div>\n   337→                                            </div>\n   338→                                            <div class=\"row mt-4\">\n   339→                                                <div class=\"col-5 pt-2\">Estado del plan</div>\n   340→                                                <div class=\"col-7\">\n   341→                                                    ${crearSelect2({\n   342→                                                        opciones: [\n   343→                                                            { nombre: 'Todos', id: '' },\n   344→                                                            { nombre: 'Activo', id: '1' },\n   345→                                                            { nombre: 'Inactivo', id: '2' },\n   346→                                                            { nombre: 'Próximo', id: '3' },\n   347→                                                            { nombre: 'Por vencer', id: '4' },\n   348→                                                            { nombre: 'Vencido', id: '5' },\n   349→                                                            { nombre: 'Renovando', id: '6' },\n   350→                                                        ],\n   351→                                                        opcion_vacia: false,\n   352→                                                        id: 'estado_plan_filtro_vocacional',\n   353→                                                        class: 'select2-filtro filtro',\n   354→                                                        input_container_class: 'mb-0',\n   355→                                                        data: [\n   356→                                                            { texto: 'filtro', value: 'Estado del plan'}\n   357→                                                        ]\n   358→                                                    })}\n   359→                                                </div>\n   360→                                            </div>\n   361→                                        `,\n   362→                                    }\n   363→                                }),\n   364→                                issubtabla: '.desplegarSubRow',\n   365→                                botones: `\n   366→                                    <div class=\"col-auto\" id=\"vocacional-totales-unidades\">\n   367→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-box-fill text-headline-5 me-2\"></i>Unidades totales</p>\n   368→                                    </div>\n   369→                                    <div class=\"col-auto\" id=\"vocacional-totales-ofertas\">\n   370→                                        <p class=\"text-label-2 mb-1\"><i class=\"bi bi-briefcase-fill text-headline-5 me-2\"></i>Ofertar totales</p>\n   371→                                    </div>\n   372→                                    <div class=\"col-auto ms-auto\">\n   373→                                        ${crearBoton({ id: 'boton-descargar-historial-compras-vocacional', clases: 'btn-outline-success', texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/excel_icon.svg') }}\"> Exportar todo' })}\n   374→                                    </div>\n   375→                                `,\n   376→                                chips: `\n   377→                                    <div class=\"col-12\">\n   378→                                        <div class=\"row align-items-center w-100 mx-0 contenedor-chips my-2\" id=\"contenedor-chips-filtro_dropdown_vocacional\"></div>\n   379→                                    </div>\n   380→                                `\n   381→                            })}\n   382→                        </div>  \n   383→                    `,\n   384→                },\n   385→                {\n   386→                    id: 'pestana-compras-creditos',\n   387→                    icono: `<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\" width=\"20\" height=\"20\" alt=\"Icono IA\">`,\n   388→                    titulo: `Créditos IA`,\n   389→                    contenido: `\n   390→                        <div class=\"col-12 mt-5\">\n   391→                            ${crearTabla({\n   392→                                id: 'tabla-compras-creditos',\n   393→                                registros_paginas: true,\n   394→                                input_container_class: 'mb-0',\n   395→                                filtro: crearFiltroDropdown({\n   396→                                    id: 'filtro_dropdown_creditos',\n   397→                                    name: 'filtro_dropdown_creditos',\n   398→                                    type: 'text',\n   399→                                    value: '',\n   400→                                    class: 'filtro-chips',\n   401→                                    input_container_class: 'mb-0',\n   402→                                    placeholder: 'Buscar',\n   403→                                    icono: '<i class=\"bi bi-search input-icono1\"></i>',\n   404→                                    icono3: '<i class=\"bi bi-filter input-icono3 pointer icono-filtro-avanzado\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-bs-auto-close=\"outside\"></i>',\n   405→                                    dropdown: {\n   406→                                        titulo: 'Filtros avanzados',\n   407→                                        contenido: `\n   408→                                            <div class=\"row mt-4\">\n   409→                                                <div class=\"col-5 pt-2\">Fecha de activación</div>\n   410→                                                <div class=\"col-7\">\n   411→                                                    ${crearDatePicker({\n   412→                                                        id: 'fecha_activacion_filtro_creditos',\n   413→                                                        class: 'flatpickr-range filtro',\n   414→                                                        input_container_class: 'mb-1',\n   415→                                                        placeholder: 'Desde - hasta',\n   416→                                                        disabled: false,\n   417→                                                        icono: '<i class=\"bi bi-calendar4 input-icono1 text-gray-30 pointer\"></i>',\n   418→                                                        data: [\n   419→                                                            { texto: 'filtro', value: 'Fecha de compra'}\n   420→                                                        ]\n   421→                                                    })}\n   422→                                                </div>\n   423→                                            </div>\n   424→                                            <div class=\"row mt-4\">\n   425→                                                <div class=\"col-5 pt-2\">Estado del plan</div>\n   426→                                                <div class=\"col-7\">\n   427→                                                    ${crearSelect2({\n   428→                                                        opciones: [\n   429→                                                            { nombre: 'Todos', id: '' },\n   430→                                                            { nombre: 'Activo', id: '1' },\n   431→                                                            { nombre: 'Inactivo', id: '2' },\n   432→                                                            { nombre: 'Próximo', id: '3' },\n   433→                                                            { nombre: 'Por vencer', id: '4' },\n   434→                                                            { nombre: 'Vencido', id: '5' },\n   435→                                                            { nombre: 'Renovando', id: '6' },\n   436→                                                        ],\n   437→                                                        opcion_vacia: false,\n   438→                                                        id: 'estado_plan_filtro_creditos',\n   439→                                                        class: 'select2-filtro filtro',\n   440→                                                        input_container_class: 'mb-0',\n   441→                                                        data: [\n   442→                                                            { texto: 'filtro', value: 'Estado del plan'}\n   443→                                                        ]\n   444→                                                    })}\n   445→                                                </div>\n   446→                                            </div>\n   447→                                        `,\n   448→                                    }\n   449→                                }),\n   450→                                issubtabla: '.desplegarSubRow',\n   451→                                botones: `\n   452→                                    <div class=\"col-auto\" id=\"creditos-totales\">\n   453→                                        <p class=\"text-label-2 mb-1\"><img class=\"me-2\" src=\"{{ asset('/iconos/icono_ia.svg') }}\" width=\"16\" height=\"16\" alt=\"Icono IA\">Créditos totales</p>\n   454→                                    </div>\n   455→                                    <div class=\"col-auto ms-auto\">\n   456→                                        ${crearBoton({ id: 'boton-descargar-historial-compras-creditos', clases: 'btn-outline-success', texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/excel_icon.svg') }}\"> Exportar todo' })}\n   457→                                    </div>\n   458→                                `,\n   459→                                chips: `\n   460→                                    <div class=\"col-12\">\n   461→                                        <div class=\"row align-items-center w-100 mx-0 contenedor-chips my-2\" id=\"contenedor-chips-filtro_dropdown_creditos\"></div>\n   462→                                    </div>\n   463→                                `\n   464→                            })}\n   465→                        </div>\n   466→                    `,\n   467→                },\n   468→            ]\n   469→        })}\n   470→    `\n   471→})}\n   472→<div class=\"modal fade\" id=\"modal-filtros-avanzados-compras\" data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-filtros-avanzados-comprasLabel\" aria-hidden=\"true\">\n   473→    <div class=\"modal-dialog modal-dialog-centered modal-md\">\n   474→        <div class=\"modal-content rounded-4\">\n   475→            <div class=\"modal-header border-0\">\n   476→                <div class=\"row justify-content-between align-items-center m-0 w-100\">\n   477→                    <div class=\"col-auto text-headline-4 mb-0\" id=\"modal-filtros-avanzados-comprasLabel\">Filtros avanzados</div>\n   478→                    <div class=\"col-auto px-3 py-2 pointer\" data-bs-dismiss=\"modal\" aria-label=\"Close\">\n   479→                        <i class=\"bi bi-x-lg\"></i>\n   480→                    </div>\n   481→                </div>\n   482→            </div>\n   483→            <div class=\"modal-body pt-0\">\n   484→                <div class=\"row w-100 mx-0\">\n   485→                    <div class=\"col-4 pt-2\">Duración:</div>\n   486→                    <div class=\"col-8\">\n   487→                        <div class=\"row\">\n   488→                            <div class=\"col-12\">\n   489→                                <div class=\"input-container mb-2\">\n   490→                                    <select id=\"filtro-duracion\">\n   491→                                        <option value=\"\">Seleccionar duración...</option>\n   492→                                        <option value=\"con-tiempo\">Con tiempo</option>\n   493→                                        <option value=\"sin-tiempo\">Sin tiempo</option>\n   494→                                    </select>\n   495→                                </div>\n   496→                            </div>\n   497→                        </div>\n   498→                    </div>\n   499→                </div>\n   500→                <div class=\"row w-100 mx-0\">\n   501→                    <div class=\"col-4 pt-2\">Fecha de activación:</div>\n   502→                    <div class=\"col-8\">\n   503→                        <div class=\"input-container mb-5\">\n   504→                            <input class=\"rounded-2 text-body-2 flatpickr-range bg-transparent\" id=\"filtro-fecha-activacion\" placeholder=\"dd/mm/aaaa\">\n   505→                        </div>\n   506→                    </div>\n   507→                </div>\n   508→                <div class=\"row w-100 mx-0\">\n   509→                    <div class=\"col-4 pt-2\">Fecha de vencimiento:</div>\n   510→                    <div class=\"col-8\">\n   511→                        <div class=\"input-container mb-5\">\n   512→                            <input class=\"rounded-2 text-body-2 flatpickr-range bg-transparent\" id=\"filtro-fecha-vencimiento\" placeholder=\"dd/mm/aaaa\">\n   513→                        </div>\n   514→                    </div>\n   515→                </div>\n   516→                <div class=\"row w-100 mx-0\">\n   517→                    <div class=\"col-4 pt-2\">Estado del plan:</div>\n   518→                    <div class=\"col-8\">\n   519→                        <div class=\"row\">\n   520→                            <div class=\"col-12\">\n   521→                                <div class=\"input-container mb-2\">\n   522→                                    <select id=\"filtro-estado-plan\">\n   523→                                        <option value=\"\">Seleccionar estado del plan...</option>\n   524→                                        <option value=\"1\">Activo</option>\n   525→                                        <option value=\"2\">Inactivo</option>\n   526→                                        <option value=\"3\">Próximo</option>\n   527→                                        <option value=\"4\">Por vencer</option>\n   528→                                        <option value=\"5\">Vencido</option>\n   529→                                        <option value=\"6\">Renovando</option>\n   530→                                    </select>\n   531→                                </div>\n   532→                            </div>\n   533→                        </div>\n   534→                    </div>\n   535→                </div>\n   536→                <div class=\"row m-0 w-100\">\n   537→                    <button type=\"button\" class=\"col btn btn-outline-primary me-1 pt-2 text-center d-block\" data-bs-dismiss=\"modal\" aria-label=\"Close\" onclick=\"borrarFiltrosAvanzadosCompras()\">\n   538→                        Borrar filtros\n   539→                    </button>\n   540→                    <button type=\"button\" class=\"col btn btn-primary ms-1 pt-2 text-center d-block\" onclick=\"aplicarFiltrosAvanzadosCompras()\">\n   541→                        Aplicar filtros\n   542→                    </button>\n   543→                </div>\n   544→            </div>\n   545→        </div>\n   546→    </div>\n   547→</div>\n   548→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2e020bb6-2a91-4378-a894-33865b609f6c","timestamp":"2026-01-29T18:02:21.018Z","sourceToolAssistantUUID":"e3c96f3b-8271-449e-9614-49abf75eff72"}
{"parentUuid":"056ff758-95d3-4378-ba27-af13da93b23a","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ScgFeAq1jemkcyCPrVdLon","type":"tool_result","content":"     1→\n     2→const MODAL_FILTROS_AVANZADOS_COMPRAS_ID = 'modal-filtros-avanzados-compras';\n     3→const MODAL_HISTORIAL_COMPRAS_ID = 'modal-historial-recompras';\n     4→\n     5→const FILTRO_DURACION_ID = 'filtro-duracion';\n     6→const FILTRO_FECHA_ACTIVACION_ID = 'filtro-fecha-activacion';\n     7→const FILTRO_FECHA_VENCIMIENTO_ID = 'filtro-fecha-vencimiento';\n     8→const FILTRO_ESTADO_PLAN_ID = 'filtro-estado-plan';\n     9→\n    10→const normalizarFechaFiltro = fecha => {\n    11→    if (!fecha || typeof fecha !== 'string') return fecha;\n    12→    const limpio = fecha.trim();\n    13→    if (!limpio) return limpio;\n    14→    const separador = limpio.includes('/') ? '/' : (limpio.includes('-') ? '-' : null);\n    15→    if (!separador) return limpio;\n    16→    const partes = limpio.split(separador);\n    17→    if (partes.length < 3) return limpio;\n    18→    let dia = '';\n    19→    let mes = '';\n    20→    let anio = '';\n    21→    if (partes[0].length === 4) {\n    22→        anio = partes[0];\n    23→        mes = partes[1];\n    24→        dia = partes[2];\n    25→    } else if (partes[2].length === 4) {\n    26→        dia = partes[0];\n    27→        mes = partes[1];\n    28→        anio = partes[2];\n    29→    } else {\n    30→        return limpio;\n    31→    }\n    32→    return `${anio}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;\n    33→};\n    34→\n    35→let compras_seleccionadas_ids = { seleccion: [], organizacional: [], vocacional: [], creditos: [] };\n    36→\n    37→let compras_ids = { seleccion: [], organizacional: [], vocacional: [], creditos: [] }\n    38→\n    39→let compras = [];\n    40→\n    41→// Variables globales para filtros de cada tabla\n    42→let filtros_seleccion = {};\n    43→let filtros_organizacional = {};\n    44→let filtros_vocacional = {};\n    45→let filtros_creditos = {};\n    46→\n    47→let filtro_html_seleccion = '';\n    48→let filtro_html_organizacional = '';\n    49→let filtro_html_vocacional = '';\n    50→let filtro_html_creditos = '';\n    51→let busqueda_tablas = { seleccion: '', organizacional: '', vocacional: '', creditos: '' };\n    52→\n    53→$(document).ready(() => {\n    54→    $('#boton-modal-recompras').on('click', () => modalHistorialCompras(empresa_id));\n    55→    $(document).on('click', '#pestana-compras-seleccion', async () => { ajustarRenderDataTable('tabla-compras-seleccion') });\n    56→    $(document).on('click', '#pestana-compras-organizacional', async () => { ajustarRenderDataTable('tabla-compras-organizacional') });\n    57→    $(document).on('click', '#pestana-compras-vocacional', async () => { ajustarRenderDataTable('tabla-compras-vocacional') });\n    58→    $(document).on('click', '#pestana-compras-creditos', async () => { ajustarRenderDataTable('tabla-compras-creditos') });\n    59→    $(document).on('input', '#filtro_dropdown_seleccion', function () { busqueda_tablas.seleccion = this.value; aplicarBusquedaTabla('seleccion', this.value); });\n    60→    $(document).on('input', '#filtro_dropdown_organizacional', function () { busqueda_tablas.organizacional = this.value; aplicarBusquedaTabla('organizacional', this.value); });\n    61→    $(document).on('input', '#filtro_dropdown_vocacional', function () { busqueda_tablas.vocacional = this.value; aplicarBusquedaTabla('vocacional', this.value); });\n    62→    $(document).on('input', '#filtro_dropdown_creditos', function () { busqueda_tablas.creditos = this.value; aplicarBusquedaTabla('creditos', this.value); });\n    63→    $(document).on('keydown', '#filtro_dropdown_seleccion, #filtro_dropdown_organizacional, #filtro_dropdown_vocacional, #filtro_dropdown_creditos', function (event) {\n    64→        if (event.key === 'Enter') {\n    65→            event.preventDefault();\n    66→            event.stopPropagation();\n    67→        }\n    68→    });\n    69→\n    70→});\n    71→\n    72→/**\n    73→ * Renderiza la modal de historial de compras de planes de empresa.\n    74→ *\n    75→ * @param {number} empresa_id ID de la empresa.\n    76→ * @param {boolean} recarga verifica si tiene que recargar.\n    77→ * @param {string} tabla nombre de la tabla.\n    78→ * @param {string} filtro filtros para la busqueda.\n    79→ * @returns {void}\n    80→ * @author Andres Morales\n    81→ * @author Jair Carvajal\n    82→ */\n    83→async function modalHistorialCompras(id_empresa, recarga = false, tabla = '', filtro = {}) {\n    84→    let historial_compras = await getHistorialCompras(id_empresa, filtro);\n    85→\n    86→    if (tabla === '' || tabla === 'seleccion') {\n    87→        await renderizarTablas(historial_compras[1], 'seleccion');\n    88→        establecerEventoDescargarComprasExcel('seleccion');\n    89→    }\n    90→\n    91→    if (tabla === '' || tabla === 'organizacional') {\n    92→        await renderizarTablas(historial_compras[2], 'organizacional');\n    93→        establecerEventoDescargarComprasExcel('organizacional');\n    94→    }\n    95→\n    96→    if (tabla === '' || tabla === 'vocacional') {\n    97→        await renderizarTablas(historial_compras[3], 'vocacional');\n    98→        establecerEventoDescargarComprasExcel('vocacional');\n    99→    }\n   100→\n   101→    if (tabla === '' || tabla === 'creditos') {\n   102→        let historial_creditos = await getHistorialComprasCreditos(id_empresa, filtro);\n   103→        await renderizarTablaCreditos(historial_creditos, 'creditos');\n   104→        establecerEventoDescargarComprasExcel('creditos');\n   105→    }\n   106→\n   107→    if (!recarga) {\n   108→        $(`#${MODAL_HISTORIAL_COMPRAS_ID}`).modal('show');\n   109→    }\n   110→\n   111→    cargarDataTablas();\n   112→    inicializarTooltips();\n   113→}\n   114→\n   115→\n   116→/**\n   117→ * Obtener historial de recompras de planes de empresa.\n   118→ *\n   119→ * @param {number} empresa_id ID de la empresa.\n   120→ * @returns {array}\n   121→ * @author Daniel Beltrán\n   122→ * @author Andres Morales\n   123→ */\n   124→async function getHistorialCompras(empresa_id, filtros = {}) {\n   125→    let datos = [];\n   126→    let agrupadosPorTipoPrueba = {\n   127→        1: [],\n   128→        2: [],\n   129→        3: [],\n   130→    };\n   131→    await $.ajax({\n   132→        type: 'GET',\n   133→        url : `/planes-historial-recompras/${empresa_id}`,\n   134→        data: filtros\n   135→    }).then(respuesta => {\n   136→        datos = respuesta.data || [];\n   137→        datos.forEach(item => {\n   138→            let tipoPruebaNombre = item.plan.tipo_prueba.id;\n   139→            agrupadosPorTipoPrueba[tipoPruebaNombre].push(item);\n   140→        });\n   141→    }).catch((error) => {\n   142→        console.error(error);\n   143→    });\n   144→    return agrupadosPorTipoPrueba;\n   145→}\n   146→\n   147→/**\n   148→ * Obtener historial de compras de planes con creditos.\n   149→ *\n   150→ * @param {number} empresa_id ID de la empresa.\n   151→ * @param {Object} filtros Filtros aplicados.\n   152→ * @returns {array}\n   153→ * @author Sergio Vargas\n   154→ * @author Jair Carvajal\n   155→ */\n   156→async function getHistorialComprasCreditos(empresa_id, filtros = {}) {\n   157→    let datos = [];\n   158→\n   159→    await $.ajax({\n   160→        type: 'GET',\n   161→        url: `/planes-historial-recompras-creditos/${empresa_id}`,\n   162→        data: filtros\n   163→    }).then(respuesta => {\n   164→        datos = respuesta.data || [];\n   165→    }).catch((error) => {\n   166→        console.error(error);\n   167→    });\n   168→\n   169→    return datos;\n   170→}\n   171→\n   172→/**\n   173→ * Renderiza las distintas tablas de compras.\n   174→ *\n   175→ * @param {array} datos_entrada Array de datos a renderizar.\n   176→ * @param {string} nombre_tabla Nombre de la tabla.\n   177→ * @returns {void}\n   178→ * @author Andres Morales\n   179→ * @author Jair Carvajal\n   180→ */\n   181→async function renderizarTablas(datos_entrada, nombre_tabla) {\n   182→    destruirTablaExistente(`tabla-compras-${nombre_tabla}`);\n   183→    compras_ids[nombre_tabla] = [];\n   184→    compras_ids[nombre_tabla] = datos_entrada.map(dato => dato.id);\n   185→    let totalUnidades = datos_entrada.reduce((total, dato) => total + (dato.conteo_consumos_agendas || 0), 0);\n   186→    let totalOfertas =  datos_entrada.reduce((total, dato) => total + (dato.conteo_consumos_ofertas_laborales || 0), 0);\n   187→    let baseTotalUnidades =  datos_entrada.reduce((total, dato) => total + (dato.unidades || 0), 0);\n   188→    let baseTotalOfertas =  datos_entrada.reduce((total, dato) => total + (dato.cantidad_ofertas_laborales || 0), 0);\n   189→    $(`#${nombre_tabla}-totales-unidades`).empty().append(`<p class=\"text-label-2 mb-1\"><i class=\"bi bi-box-fill text-headline-5 me-2\"></i>Unidades totales</p>${crearProgressBar({ label: `${totalUnidades}/${baseTotalUnidades}`,height: '8px', porcentaje: {porcentaje: (totalUnidades / (baseTotalUnidades ?? 1)) * 100, texto:false }})}`);\n   190→    $(`#${nombre_tabla}-totales-ofertas`).empty().append(`<p class=\"text-label-2 mb-1\"><i class=\"bi bi-briefcase-fill text-headline-5 me-2\"></i>Ofertar totales</p>${crearProgressBar({ label: `${totalOfertas}/${baseTotalOfertas}`,height: '8px', porcentaje: {porcentaje: (totalOfertas / (baseTotalOfertas ?? 1)) * 100, texto:false }})}`);\n   191→    await $(`#tabla-compras-${nombre_tabla}`).DataTable({\n   192→        ...configuracion_tablas,\n   193→        data: datos_entrada,\n   194→        columns: [\n   195→            {\n   196→                title: `${crearCheckbox({ id: `checkbox-seleccionar-todos-tabla-compras-${nombre_tabla}`, name: `checkbox-seleccionar-todos-tabla-compras-${nombre_tabla}`, onclick: `seleccionarTodasCompras(this.checked, '${nombre_tabla}')`, })}`,\n   197→                data: null,\n   198→                orderable: false,\n   199→                searchable: false,\n   200→                render: (dato) => `\n   201→                    ${crearCheckbox({\n   202→                        id: `${dato.id}`,\n   203→                        class: 'checkbox-compra',\n   204→                        name: 'checkbox',\n   205→                        onclick: `seleccionarCompra(this.checked, ${dato.id}, 'tabla-compras-${nombre_tabla}', '${nombre_tabla}')`,\n   206→                    })}\n   207→                `,\n   208→             },\n   209→            {\n   210→                title: '<span class=\"text-body-3\">Nombre del plan</span>',\n   211→                data: null,\n   212→                className: 'nombre-plan-columna',\n   213→                orderable: false,\n   214→                render: (dato) => `\n   215→                    <div class=\"row\">\n   216→                        <div class=\"col-auto ps-0 d-flex align-items-center\">\n   217→                            ${crearBoton({\n   218→                                clases: 'btn-text-primary text-dark p-2 desplegarSubRow my-auto',\n   219→                                texto: '<i class=\"bi bi-chevron-down\"></i>',\n   220→                                data: [{ texto: 'id', value: dato.id }],\n   221→                            })}\n   222→                        </div>\n   223→                        <div class=\"col pe-0\">\n   224→                            <span class=\"text-body-3\">${dato.plan.nombre}</span>\n   225→                        </div>\n   226→                    </div>\n   227→                `,\n   228→            },\n   229→            {\n   230→                title: '<span class=\"text-body-3\">Vigencia</span>',\n   231→                data: null,\n   232→                className: 'vigencia-columna',\n   233→                orderable: false,\n   234→                render:  (dato) => `\n   235→                    <p class=\"text-label-1 p-0 m-0\"><i class=\"bi bi-circle-fill small text-green-cta me-2\"></i>${dato.fecha_inicio ? convertirFecha(dato.fecha_inicio) : 'Ilimitado'}</p>\n   236→                    ${dato.fecha_inicio ? `\n   237→                        <p class=\"text-label-1 p-0 m-0\"><i class=\"bi bi-circle-fill small text-danger me-2\"></i>${dato.fecha_vencimiento ? convertirFecha(dato.fecha_vencimiento) : 'Ilimitado'}</p>\n   238→                    `: ''}\n   239→                `,\n   240→            },\n   241→            {\n   242→                title: '<span class=\"text-body-3\">Duración</span>',\n   243→                data: null,\n   244→                orderable: false,\n   245→                render: (dato) => `<span class=\"text-body-3\">${dato.vigencia_dias} dias</span>`\n   246→            },\n   247→            {\n   248→                title: `<span class=\"text-body-3\"><i class=\"text-headline-5 bi bi-box\"></i> Consumo unidades</span>`,\n   249→                data: null,\n   250→                orderable: false,\n   251→                render: (dato) => `<div ${tooltipConsumoUnidades(dato.consumos)}>${crearProgressBarTemplate('', false, dato.conteo_consumos_agendas, dato.unidades ?? 0, false)}</div>`,\n   252→            },\n   253→            {\n   254→                title: `<span class=\"text-body-3\"><i class=\"text-headline-5 bi bi-briefcase\"></i> Consumo vacantes</span>`,\n   255→                data: null,\n   256→                orderable: false,\n   257→                render: (dato) => `<div ${tooltipConsumoOfertas(dato.consumos)}>${crearProgressBarTemplate('', false, dato.conteo_consumos_ofertas_laborales, dato.cantidad_ofertas_laborales ?? 0, false)}</div>`,\n   258→            },\n   259→            {\n   260→                title: `<span class=\"text-body-3\"><i class=\"text-headline-5 bi bi-person\"></i> Consumo usuarios</span>`,\n   261→                data: null,\n   262→                orderable: false,\n   263→                render: (dato) => `<div ${tooltipConsumoUsuarios(usuarios)}>${crearProgressBarTemplate('', false, total_usuarios, dato.cantidad_usuarios ?? 0, false)}</div>`,\n   264→            },\n   265→            {\n   266→                title: '<span class=\"text-body-3\">Ver factura</span>',\n   267→                data: null,\n   268→                orderable: false,\n   269→                searchable: false,\n   270→                render: (dato) => `\n   271→                    ${crearBoton({\n   272→                        clases: 'btn-text-primary btn-circle p-2',\n   273→                        texto: '<i class=\"bi bi-paperclip text-headline-5\"></i>',\n   274→                        onclick: `abrirFacturaPlan(${dato?.archivos?.[0]?.id ?? 0})`,\n   275→                    })}\n   276→                `,\n   277→            },\n   278→            {\n   279→                title: '<span class=\"text-body-3\">Acciones</span>',\n   280→                data: null,\n   281→                orderable: false,\n   282→                searchable: false,\n   283→                render: (dato) => `\n   284→                    ${crearBoton({\n   285→                        clases: 'btn-text-primary btn-circle p-2',\n   286→                        texto: '<i class=\"bi bi-eye text-headline-5\"></i>',\n   287→                        onclick: `abrirModalConsumos(${dato.id}, '${dato.plan.nombre}', '${dato.plan.tipo_prueba.nombre}')`,\n   288→                        tooltip: ` ${crearTooltip({placement: `top`,content: `Ver detalle consumo`,toggle: `popover`,})}`,\n   289→                    })}\n   290→                `,\n   291→            }\n   292→        ],\n   293→        drawCallback: function(settings) {\n   294→            inicializarTooltips();\n   295→        },\n   296→    });\n   297→    aplicarBusquedaTabla(nombre_tabla, busqueda_tablas[nombre_tabla]);\n   298→}\n   299→\n   300→/**\n   301→ * Renderiza la tabla de compras de creditos.\n   302→ *\n   303→ * @param {array} datos_entrada Array de datos a renderizar.\n   304→ * @param {string} nombre_tabla Nombre de la tabla.\n   305→ * @returns {void}\n   306→ * @author Sergio Vargas\n   307→ */\n   308→async function renderizarTablaCreditos(datos_entrada, nombre_tabla) {\n   309→    destruirTablaExistente(`tabla-compras-${nombre_tabla}`);\n   310→    compras_ids[nombre_tabla] = datos_entrada.map(dato => dato.id);\n   311→\n   312→    let total_consumidos = datos_entrada.reduce((total, dato) => total + (dato.creditos_consumidos || 0), 0);\n   313→    let total_creditos = datos_entrada.reduce((total, dato) => total + (dato.creditos_totales || 0), 0);\n   314→    let porcentaje_total = total_creditos > 0 ? (total_consumidos / total_creditos) * 100 : 0;\n   315→\n   316→    $('#creditos-totales')\n   317→        .empty()\n   318→        .append(`\n   319→            <p class=\"text-label-2 mb-1\"><img class=\"me-2\" src=\"/iconos/icono_ia.svg\" width=\"16\" height=\"16\" alt=\"Icono IA\">Créditos totales</p>\n   320→            ${crearProgressBar({ label: `${formatearNumero(total_consumidos)}/${formatearNumero(total_creditos)}`, height: '8px', porcentaje: { porcentaje: porcentaje_total, texto: false }})}\n   321→        `);\n   322→\n   323→    await $(`#tabla-compras-${nombre_tabla}`).DataTable({\n   324→        ...configuracion_tablas,\n   325→        data: datos_entrada,\n   326→        columns: [\n   327→            {\n   328→                title: `${crearCheckbox({ id: `checkbox-seleccionar-todos-tabla-compras-${nombre_tabla}`, name: `checkbox-seleccionar-todos-tabla-compras-${nombre_tabla}`, onclick: `seleccionarTodasCompras(this.checked, '${nombre_tabla}')`, })}`,\n   329→                data: null,\n   330→                orderable: false,\n   331→                searchable: false,\n   332→                render: (dato) => `\n   333→                    ${crearCheckbox({\n   334→                        id: `${dato.id}`,\n   335→                        class: 'checkbox-compra',\n   336→                        name: 'checkbox',\n   337→                        onclick: `seleccionarCompra(this.checked, ${dato.id}, 'tabla-compras-${nombre_tabla}', '${nombre_tabla}')`,\n   338→                    })}\n   339→                `,\n   340→            },\n   341→            {\n   342→                title: '<span class=\"text-body-3\">Nombre del plan</span>',\n   343→                data: null,\n   344→                className: 'nombre-plan-columna',\n   345→                orderable: false,\n   346→                render: (dato) => `\n   347→                    <div class=\"row\">\n   348→                        <div class=\"col pe-0\">\n   349→                            <span class=\"text-body-3\">${dato.plan_credito?.nombre ?? '---'}</span>\n   350→                        </div>\n   351→                    </div>\n   352→                `,\n   353→            },\n   354→            {\n   355→                title: '<span class=\"text-body-3\">Vigencia</span>',\n   356→                data: null,\n   357→                className: 'vigencia-columna',\n   358→                orderable: false,\n   359→                render:  (dato) => `\n   360→                    <p class=\"text-label-1 p-0 m-0\"><i class=\"bi bi-circle-fill small text-green-cta me-2\"></i>${dato.fecha_inicio ? convertirFecha(dato.fecha_inicio) : 'Ilimitado'}</p>\n   361→                    ${dato.fecha_inicio ? `\n   362→                        <p class=\"text-label-1 p-0 m-0\"><i class=\"bi bi-circle-fill small text-danger me-2\"></i>${dato.fecha_vencimiento ? convertirFecha(dato.fecha_vencimiento) : 'Ilimitado'}</p>\n   363→                    `: ''}\n   364→                `,\n   365→            },\n   366→            {\n   367→                title: '<span class=\"text-body-3\">Duración</span>',\n   368→                data: null,\n   369→                orderable: false,\n   370→                render: (dato) => `<span class=\"text-body-3\">${dato.vigencia_dias ? `${dato.vigencia_dias} dias` : 'Sin tiempo'}</span>`\n   371→            },\n   372→            {\n   373→                title: `<span class=\"text-body-3\"><img class=\"me-1\" src=\"/iconos/icono_ia.svg\" width=\"16\" height=\"16\" alt=\"Icono IA\"> Consumo créditos</span>`,\n   374→                data: null,\n   375→                orderable: false,\n   376→                render: (dato) => {\n   377→                    let total = dato.creditos_totales ?? 0;\n   378→                    let consumidos = dato.creditos_consumidos ?? 0;\n   379→                    return `${crearProgressBarTemplate('', false, consumidos, total, false)}`;\n   380→                },\n   381→            },\n   382→            {\n   383→                title: '<span class=\"text-body-3\">Ver factura</span>',\n   384→                data: null,\n   385→                orderable: false,\n   386→                searchable: false,\n   387→                render: (dato) => `\n   388→                    ${crearBoton({\n   389→                        clases: 'btn-text-primary btn-circle p-2',\n   390→                        texto: '<i class=\"bi bi-paperclip text-headline-5\"></i>',\n   391→                        onclick: `abrirFacturaPlan(${dato?.archivos?.[0]?.id ?? 0})`,\n   392→                    })}\n   393→                `,\n   394→            },\n   395→            {\n   396→                title: '<span class=\"text-body-3\">Acciones</span>',\n   397→                data: null,\n   398→                orderable: false,\n   399→                searchable: false,\n   400→                render: (dato) => `\n   401→                    ${crearBoton({\n   402→                        clases: 'btn-text-primary btn-circle p-2',\n   403→                        texto: '<i class=\"bi bi-eye text-headline-5\"></i>',\n   404→                        onclick: `abrirModalConsumosCreditos(${dato.empresa_id}, ${dato.id}, '${dato.plan_credito?.nombre ?? ''}')`,\n   405→                        tooltip: ` ${crearTooltip({placement: `top`,content: `Ver detalle consumo`,toggle: `popover`,})}`,\n   406→                    })}\n   407→                `,\n   408→            }\n   409→        ],\n   410→        drawCallback: function(settings) {\n   411→            inicializarTooltips();\n   412→        },\n   413→    });\n   414→    aplicarBusquedaTabla(nombre_tabla, busqueda_tablas[nombre_tabla]);\n   415→}\n   416→\n   417→function aplicarBusquedaTabla(nombre_tabla, valor) {\n   418→    const selector = `#tabla-compras-${nombre_tabla}`;\n   419→    if (!$.fn.DataTable.isDataTable(selector)) return;\n   420→    $(selector).DataTable().search(valor || '').draw();\n   421→}\n   422→\n   423→/**\n   424→ * Renderiza el contenido de las subtablas.\n   425→ *\n   426→ * @param {array} data Array de datos a renderizar.\n   427→ * @returns {string} HTML de la subtabla.\n   428→ * @author Andres Morales\n   429→ */\n   430→function crearContenidoSubTabla(data) {\n   431→    let pruebas_html = \"\";\n   432→    data.pruebas.forEach(prueba => {\n   433→        pruebas_html += `\n   434→            <div class=\"col-12 my-2 col-md-6 d-flex justify-content-start align-items-center gap-3\">\n   435→                <img src=\"/imagenes/logos/pruebas/${slugify(prueba.nombre)}.png\" width=\"32px\" height=\"32px\" class=\"object-fit-cover\" alt=\"Logo prueba\">\n   436→                <p class=\"mb-0 text-label-2\">${prueba.nombre}</p>\n   437→            </div>\n   438→        `;\n   439→    });\n   440→\n   441→    let funcionalidades_predeterminadas_html = \"\";\n   442→    data.funcionalidades.forEach(funcionalidad => {\n   443→        if (funcionalidad.predeterminado) funcionalidades_predeterminadas_html += `<span class=\"fw-bolder\">∙</span> ${funcionalidad.nombre}<br>`;\n   444→    });\n   445→\n   446→    let funcionalidades_html = \"\";\n   447→    data.funcionalidades.forEach(funcionalidad => {\n   448→        if (!funcionalidad.predeterminado) funcionalidades_html += `<span class=\"fw-bolder\">∙</span> ${funcionalidad.nombre}<br>`;\n   449→    });\n   450→\n   451→    return `\n   452→        <div class=\"row w-100 my-3 ps-8\">\n   453→            <div class=\"col-4\">\n   454→                <p class=\"text-body-3 fw-bolder\">Pruebas</p>\n   455→                <div class=\"row\">\n   456→                    ${pruebas_html}\n   457→                </div>\n   458→            </div>\n   459→            <div class=\"col-8\">\n   460→                <div class=\"container-fluid\">\n   461→                    <div class=\"row border-bottom pb-2\">\n   462→                        <div class=\"col-4\">\n   463→                            <p class=\"mb-0\"><span class=\"fw-bolder\">Costo:</span> <br> $ ${formatearNumero(data.precio)}</p>\n   464→                        </div>\n   465→                        <div class=\"col-4\">\n   466→                            <p class=\"mb-0\"><span class=\"fw-bolder\">Descuento:</span> <br> ${data.porcentaje_descuento !== 0 ? data.porcentaje_descuento + '%' : `Sin descuento`}</p>\n   467→                        </div>\n   468→                         <div class=\"col-4\">\n   469→                            <p class=\"mb-0\"><span class=\"fw-bolder\">Valor de venta:</span> <br> $ ${data.porcentaje_descuento !== 0 ? formatearNumero(data.precio * (1 - (data.porcentaje_descuento / 100))) : formatearNumero(data.precio) }</p>\n   470→                        </div>\n   471→                    </div>\n   472→                    <div class=\"row\">\n   473→                        <div class=\"col-6 text-label-1 border-bottom\">\n   474→                            <p class=\"my-3\">Beneficios adicionales</p>\n   475→                        </div>\n   476→                        <div class=\"col-6 text-label-1 border-bottom\">\n   477→                            <p class=\"my-3\">Beneficios predefinidos</p>\n   478→                        </div>\n   479→                        <div class=\"col-6 text-label-1\">\n   480→                            <p>${funcionalidades_html}</p>\n   481→                        </div>\n   482→                        <div class=\"col-6 text-label-1\">\n   483→                            <p>${funcionalidades_predeterminadas_html}</p>\n   484→                        </div>\n   485→                    </div>\n   486→                </div>\n   487→            </div>\n   488→        </div>\n   489→    `;\n   490→}\n   491→\n   492→/**\n   493→ * Generar el tooltip de consumo de unidades.\n   494→ *\n   495→ * @param {array} consumos Array de datos.\n   496→ * @returns {string} componente tooltip.\n   497→ * @author Andres Morales\n   498→ */\n   499→function tooltipConsumoUnidades(consumos) {\n   500→    var agrupado = consumos.reduce((acc, item) => {\n   501→        if(item.agenda && item.agenda.prueba) {\n   502→          var { id, nombre } = item.agenda.prueba;\n   503→          var key = `${id}-${nombre}`;\n   504→          if(!acc[key]) {\n   505→            acc[key] = { prueba_id: id, prueba_nombre: nombre, cantidad: 0 };\n   506→          }\n   507→          acc[key].cantidad++;\n   508→        }\n   509→        return acc;\n   510→    }, {});\n   511→\n   512→    var resultado = Object.values(agrupado);\n   513→    let tooltip = '';\n   514→    if (resultado.length > 0) {\n   515→        let total = resultado.reduce((acc, item) => acc + item.cantidad, 0);\n   516→        tooltip = `\n   517→        <div class='row text-white'>\n   518→            <div class='col-12 d-flex justify-content-between mb-3'>\n   519→                <span class='text-body-3 text-white'>Cantidad consumida</span>\n   520→                <span class='text-body-3 text-white'>${total}</span>\n   521→            </div>\n   522→            ${resultado.map(item => `\n   523→                <div class='col-12 d-flex justify-content-between mb-3'>\n   524→                    <span class='text-body-3 text-white'>\n   525→                        <img src='/imagenes/logos/pruebas/${slugify(item.prueba_nombre)}.png' width='22px' height='22px' class='object-fit-cover me-2' alt='>\n   526→                    </span>\n   527→                    <span class='text-body-3 text-white'>\n   528→                        ${item.prueba_nombre}\n   529→                    </span>\n   530→                    <span class='text-body-3 text-white'>${item.cantidad}</span>\n   531→                </div>\n   532→            `).join('')}\n   533→        </div>\n   534→    `;\n   535→    } else {\n   536→        tooltip = `\n   537→            <div class='row text-white'>\n   538→                <div class='col-12 d-flex justify-content-between'>\n   539→                    <span class='text-body-3 text-white me-3'>Cantidad consumida</span>\n   540→                    <span class='text-body-3 text-white'>0</span>\n   541→                </div>\n   542→            </div>\n   543→        `;\n   544→    }\n   545→\n   546→    return crearTooltip({ placement: `bottom`, content: tooltip, toggle: `popover`,});\n   547→}\n   548→\n   549→/**\n   550→ * Generar el tooltip de consumo de ofertas.\n   551→ *\n   552→ * @param {array} consumos Array de datos.\n   553→ * @returns {string} componente tooltip.\n   554→ * @author Andres Morales\n   555→ */\n   556→function tooltipConsumoOfertas(consumos) {\n   557→    const resultado = Object.values(\n   558→        consumos.filter(item => item.oferta_laboral_id !== null).reduce((acc, item) => {\n   559→            const key = `${item.empresa.id}-${item.empresa.nombre_comercial}`;\n   560→            if (!acc[key]) {\n   561→              acc[key] = {\n   562→                empresa_id: item.empresa.id,\n   563→                empresa_nombre_comercial: item.empresa.nombre_comercial,\n   564→                cantidad: 0\n   565→              };\n   566→            }\n   567→            acc[key].cantidad++;\n   568→            return acc;\n   569→        }, {})\n   570→    );\n   571→    let tooltip = '';\n   572→    if (resultado.length > 0) {\n   573→        let total = resultado.reduce((acc, item) => acc + item.cantidad, 0);\n   574→        tooltip = `\n   575→        <div class='row text-white'>\n   576→            <div class='col-12 d-flex justify-content-between mb-3'>\n   577→                <span class='text-body-3 text-white text-start'><img class='me-2' src='/iconos/briefcase-search.svg'>Cantidad de vacantes consumidas</span>\n   578→                <span class='text-body-3 text-white'>${total}</span>\n   579→            </div>\n   580→            ${resultado.map(item => `\n   581→                <div class='col-12 d-flex justify-content-between mb-3'>\n   582→                    <span class='text-body-3 text-white text-start'>\n   583→                        ${item.empresa_nombre_comercial}\n   584→                    </span>\n   585→                    <span class='text-body-3 text-white'>${item.cantidad}</span>\n   586→                </div>\n   587→            `).join('')}\n   588→        </div>\n   589→    `;\n   590→    } else {\n   591→        tooltip = `\n   592→            <div class='row text-white'>\n   593→                <div class='col-12 d-flex justify-content-between'>\n   594→                    <span class='text-body-3 text-white text-start me-3'><img class='me-2' src='/iconos/briefcase-search.svg'>Cantidad de vacantes consumidas</span>\n   595→                    <span class='text-body-3 text-white'>0</span>\n   596→                </div>\n   597→            </div>\n   598→        `;\n   599→    }\n   600→\n   601→    return crearTooltip({ placement: `bottom`, content: tooltip, toggle: `popover`,});\n   602→}\n   603→\n   604→/**\n   605→ * Generar el tooltip de consumo de usuarios.\n   606→ *\n   607→ * @param {array} usuarios Array de datos.\n   608→ * @returns {string} componente tooltip.\n   609→ * @author Andres Morales\n   610→ */\n   611→function tooltipConsumoUsuarios(usuarios) {\n   612→    const agrupado = usuarios.reduce((acc, usuario) => {\n   613→        if (Array.isArray(usuario.empresas_usuarios)) {\n   614→          // Recorremos las empresas del usuario y contamos sólo la primera que no tenga id 1\n   615→          for (let i = 0; i < usuario.empresas_usuarios.length; i++) {\n   616→            const { id, nombre_comercial } = usuario.empresas_usuarios[i].empresa;\n   617→            if (id === 1) continue; // omitir la empresa con id 1\n   618→            const key = `${id}-${nombre_comercial}`;\n   619→            if (!acc[key]) {\n   620→              acc[key] = {\n   621→                empresa_id: id,\n   622→                nombre_comercial,\n   623→                cantidad: 0\n   624→              };\n   625→            }\n   626→            acc[key].cantidad++;\n   627→            // Una vez que se cuenta el usuario para una empresa, salimos del ciclo\n   628→            break;\n   629→          }\n   630→        }\n   631→        return acc;\n   632→      }, {});\n   633→\n   634→      const resultado = Object.values(agrupado);\n   635→\n   636→    let tooltip = '';\n   637→    if (resultado.length > 0) {\n   638→        let total = resultado.reduce((acc, item) => acc + item.cantidad, 0);\n   639→        tooltip = `\n   640→        <div class='row text-white'>\n   641→            <div class='col-12 d-flex justify-content-between mb-3'>\n   642→                <span class='text-body-3 text-white text-start'><i class='bi bi-person me-1'></i>Cantidad usuarios consumida</span>\n   643→                <span class='text-body-3 text-white'>${total}</span>\n   644→            </div>\n   645→            ${resultado.map(item => `\n   646→                <div class='col-12 d-flex justify-content-between mb-3'>\n   647→                    <span class='text-body-3 text-white text-start'>\n   648→                        ${item.nombre_comercial}\n   649→                    </span>\n   650→                    <span class='text-body-3 text-white'>${item.cantidad}</span>\n   651→                </div>\n   652→            `).join('')}\n   653→        </div>\n   654→    `;\n   655→    } else {\n   656→        tooltip = `\n   657→            <div class='row text-white'>\n   658→                <div class='col-12 d-flex justify-content-between'>\n   659→                    <span class='text-body-3 text-white text-start me-3'><i class='bi bi-person me-1'></i>Cantidad usuarios consumida</span>\n   660→                    <span class='text-body-3 text-white'>0</span>\n   661→                </div>\n   662→            </div>\n   663→        `;\n   664→    }\n   665→\n   666→    return crearTooltip({ placement: `bottom`, content: tooltip, toggle: `popover`,});\n   667→}\n   668→\n   669→/**\n   670→ * Aplicar los filtros a las compras.\n   671→ *\n   672→ * @returns {void}\n   673→ * @author Fahibram Cárcamo\n   674→ */\n   675→function aplicarFiltrosAvanzadosCompras() {\n   676→    $(`#${MODAL_FILTROS_AVANZADOS_COMPRAS_ID}`).modal('hide');\n   677→    $(`#${MODAL_HISTORIAL_COMPRAS_ID}`).modal('show');\n   678→}\n   679→\n   680→/**\n   681→ * Abrir el modal de filtros de compras.\n   682→ *\n   683→ * @returns {void}\n   684→ * @author Fahibram Cárcamo\n   685→ */\n   686→function abrirModalFiltrosAvanzadosCompras() {\n   687→    $(`#${MODAL_HISTORIAL_COMPRAS_ID}`).modal('hide');\n   688→    $(`#${MODAL_FILTROS_AVANZADOS_COMPRAS_ID}`).modal('show');\n   689→}\n   690→\n   691→/**\n   692→ * Seleccionar una compra.\n   693→ *\n   694→ * @param {boolean} seleccion Selección.\n   695→ * @param {number} compra_id Id de la compra seleccionada.\n   696→ * @param {string} tabla_compras_id Id del elemento html de la tabla de compras.\n   697→ * @param {string} nombre_tabla Nombre de la tabla.\n   698→ * @returns {void}\n   699→ * @author Fahibram Cárcamo\n   700→ */\n   701→function seleccionarCompra(seleccion, compra_id, tabla_compras_id, nombre_tabla) {\n   702→    if (seleccion) {\n   703→        compras_seleccionadas_ids[nombre_tabla].push(parseInt(compra_id));\n   704→    } else {\n   705→        let indice = compras_seleccionadas_ids[nombre_tabla].indexOf(compra_id);\n   706→        if (indice !== -1) compras_seleccionadas_ids[nombre_tabla].splice(indice, 1);\n   707→    }\n   708→\n   709→    let checkbox_seleccionar_todos = $(`#checkbox-seleccionar-todos-${tabla_compras_id}`);\n   710→    if (compras_seleccionadas_ids[nombre_tabla].length === compras_ids[nombre_tabla].length) {\n   711→        checkbox_seleccionar_todos.prop('indeterminate', false);\n   712→        checkbox_seleccionar_todos.prop('checked', true);\n   713→    } else if (compras_seleccionadas_ids[nombre_tabla].length === 0) {\n   714→        checkbox_seleccionar_todos.prop('indeterminate', false);\n   715→        checkbox_seleccionar_todos.prop('checked', false);\n   716→    } else {\n   717→        checkbox_seleccionar_todos.prop('indeterminate', true);\n   718→    }\n   719→}\n   720→\n   721→/**\n   722→ * Seleccionar todas las compras.\n   723→ *\n   724→ * @param {boolean} seleccion Selección\n   725→ * @param {string} nombre_tabla Nombre de la tabla\n   726→ * @returns {void}\n   727→ * @author Fahibram Cárcamo\n   728→ * @author Andres Morales\n   729→ */\n   730→function seleccionarTodasCompras(seleccion, nombre_tabla) {\n   731→    if (!seleccion) compras_seleccionadas_ids[nombre_tabla] = [];\n   732→    let checkboxes_compras = $(`#tabla-compras-${nombre_tabla}`).find(\".checkbox-compra\").toArray();\n   733→    checkboxes_compras.forEach(checkbox => {\n   734→        checkbox.checked = seleccion;\n   735→        if (seleccion && !compras_seleccionadas_ids[nombre_tabla].includes(checkbox.id)) {\n   736→            compras_seleccionadas_ids[nombre_tabla].push(parseInt(checkbox.id));\n   737→        }\n   738→    });\n   739→}\n   740→\n   741→/**\n   742→ * Establecer el evento para el botón de descarga del archivo Excel.\n   743→ *\n   744→ * @param {string} nombre_tabla Nombre de la tabla\n   745→ * @returns {void}\n   746→ * @author Fahibram Cárcamo\n   747→ */\n   748→function establecerEventoDescargarComprasExcel(nombre_tabla) {\n   749→    $(`#boton-descargar-historial-compras-${nombre_tabla}`).off('click');\n   750→    $(`#boton-descargar-historial-compras-${nombre_tabla}`).on('click', () => {\n   751→        if (nombre_tabla === 'creditos') {\n   752→            descargarExcelCreditos();\n   753→            return;\n   754→        }\n   755→        let empresas_planes_ids = compras_seleccionadas_ids[nombre_tabla].length ? [...compras_seleccionadas_ids[nombre_tabla]] : [...compras_ids[nombre_tabla]];\n   756→        descargarExcel(\n   757→            'planes-historial-recompras-exportar',\n   758→            `compras_${nombre_tabla}`,\n   759→            true,\n   760→            empresas_planes_ids.length ? { empresas_planes_ids, empresa_id } : { empresa_id }\n   761→        );\n   762→    });\n   763→}\n   764→\n   765→/**\n   766→ * Descargar Excel del historial de créditos de IA.\n   767→ *\n   768→ * @returns {void}\n   769→ * @author Jair Carvajal\n   770→ */\n   771→function descargarExcelCreditos() {\n   772→    descargarExcel(\n   773→        `planes-historial-creditos-exportar/${empresa_id}`,\n   774→        'historial_creditos_ia',\n   775→        true,\n   776→        {}\n   777→    );\n   778→}\n   779→\n   780→/**\n   781→ * Procesar los filtros de las tablas de compras.\n   782→ *\n   783→ * @param {Object} json_filtros Filtros aplicados del dropdown\n   784→ * @param {string} tabla Nombre de la tabla\n   785→ * @returns {Object} Datos procesados para enviar al backend\n   786→ * @author Andres Morales\n   787→ */\n   788→function procesarFiltrosTabla(json_filtros, tabla) {\n   789→    let datos = {};\n   790→\n   791→    if (json_filtros[`estado_plan_filtro_${tabla}`]) {\n   792→        datos.estado_id = json_filtros[`estado_plan_filtro_${tabla}`];\n   793→    }\n   794→\n   795→    if (json_filtros[`duracion_filtro_${tabla}`]) {\n   796→        datos.duracion = json_filtros[`duracion_filtro_${tabla}`];\n   797→    }\n   798→\n   799→    if (tabla === 'creditos') {\n   800→        if (json_filtros[`fecha_activacion_filtro_${tabla}`] && typeof json_filtros[`fecha_activacion_filtro_${tabla}`] === 'string') {\n   801→            const partesFechaCompra = json_filtros[`fecha_activacion_filtro_${tabla}`].split(' a ');\n   802→            if (partesFechaCompra[0]) {\n   803→                datos.created_at_desde = normalizarFechaFiltro(partesFechaCompra[0]);\n   804→            }\n   805→            if (partesFechaCompra[1]) {\n   806→                datos.created_at_hasta = normalizarFechaFiltro(partesFechaCompra[1]);\n   807→            }\n   808→        }\n   809→    } else {\n   810→        if (json_filtros[`fecha_vencimiento_filtro_${tabla}`] && typeof json_filtros[`fecha_vencimiento_filtro_${tabla}`] === 'string') {\n   811→            const partesFechaVencimiento = json_filtros[`fecha_vencimiento_filtro_${tabla}`].split(' a ');\n   812→            if (partesFechaVencimiento[0]) {\n   813→                datos.fecha_vencimiento_desde = normalizarFechaFiltro(partesFechaVencimiento[0]);\n   814→            }\n   815→            if (partesFechaVencimiento[1]) {\n   816→                datos.fecha_vencimiento_hasta = normalizarFechaFiltro(partesFechaVencimiento[1]);\n   817→            }\n   818→        }\n   819→\n   820→        if (json_filtros[`fecha_activacion_filtro_${tabla}`] && typeof json_filtros[`fecha_activacion_filtro_${tabla}`] === 'string') {\n   821→            const partesFechaActivacion = json_filtros[`fecha_activacion_filtro_${tabla}`].split(' a ');\n   822→            if (partesFechaActivacion[0]) {\n   823→                datos.fecha_inicio_desde = normalizarFechaFiltro(partesFechaActivacion[0]);\n   824→            }\n   825→            if (partesFechaActivacion[1]) {\n   826→                datos.fecha_inicio_hasta = normalizarFechaFiltro(partesFechaActivacion[1]);\n   827→            }\n   828→        }\n   829→    }\n   830→\n   831→    return datos;\n   832→}\n   833→\n   834→/**\n   835→ * Función global para aplicar filtros dropdown - redirige a la función específica de cada tabla.\n   836→ *\n   837→ * @param {string} filtro ID del elemento html del filtro\n   838→ * @param {Object} filtros Filtros aplicados\n   839→ * @returns {void}\n   840→ * @author Andres Morales\n   841→ */\n   842→function aplicarFiltrosDropdownRecompras(filtro, filtros) {\n   843→    let filtros_generados = {};\n   844→\n   845→    if (filtro === 'filtro_unidades_pruebas') {\n   846→        filtro_html = filtro;\n   847→        json_filtros = filtros;\n   848→        actualizarDatatables('tabla-consumos-unidades-pruebas');\n   849→    } else if (filtro === 'filtro_dropdown_seleccion') {\n   850→        filtro_html_seleccion = filtro;\n   851→        filtros_seleccion = filtros;\n   852→        filtros_generados = procesarFiltrosTabla(filtros, 'seleccion');\n   853→        modalHistorialCompras(empresa_id, true, 'seleccion', filtros_generados);\n   854→    } else if (filtro === 'filtro_dropdown_organizacional') {\n   855→        filtro_html_organizacional = filtro;\n   856→        filtros_organizacional = filtros;\n   857→        filtros_generados = procesarFiltrosTabla(filtros, 'organizacional');\n   858→        modalHistorialCompras(empresa_id, true, 'organizacional', filtros_generados);\n   859→    } else if (filtro === 'filtro_dropdown_vocacional') {\n   860→        filtro_html_vocacional = filtro;\n   861→        filtros_vocacional = filtros;\n   862→        filtros_generados = procesarFiltrosTabla(filtros, 'vocacional');\n   863→        modalHistorialCompras(empresa_id, true, 'vocacional', filtros_generados);\n   864→    } else if (filtro === 'filtro_dropdown_creditos') {\n   865→        filtro_html_creditos = filtro;\n   866→        filtros_creditos = filtros;\n   867→        filtros_generados = procesarFiltrosTabla(filtros, 'creditos');\n   868→        modalHistorialCompras(empresa_id, true, 'creditos', filtros_generados);\n   869→    }\n   870→}\n   871→\n   872→window.__aplicarFiltrosDropdownHandlers = window.__aplicarFiltrosDropdownHandlers || [];\n   873→window.__aplicarFiltrosDropdownHandlers.push(aplicarFiltrosDropdownRecompras);\n   874→\n   875→if (!window.aplicarFiltrosDropdown || !window.aplicarFiltrosDropdown.__esDispatcher) {\n   876→    window.aplicarFiltrosDropdown = function (filtro, filtros) {\n   877→        (window.__aplicarFiltrosDropdownHandlers || []).forEach(handler => handler(filtro, filtros));\n   878→    };\n   879→    window.aplicarFiltrosDropdown.__esDispatcher = true;\n   880→}\n   881→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"238e155b-c1fc-4355-ad39-effb79a03617","timestamp":"2026-01-29T18:02:21.029Z","sourceToolAssistantUUID":"056ff758-95d3-4378-ba27-af13da93b23a"}
{"parentUuid":"238e155b-c1fc-4355-ad39-effb79a03617","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01MgChFkqR4gj7QAQhUecWbr","toolUseID":"toolu_01MgChFkqR4gj7QAQhUecWbr","timestamp":"2026-01-29T18:02:21.020Z","uuid":"ecaba732-08e1-4d28-aca0-680423372e75"}
{"parentUuid":"ecaba732-08e1-4d28-aca0-680423372e75","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01ScgFeAq1jemkcyCPrVdLon","toolUseID":"toolu_01ScgFeAq1jemkcyCPrVdLon","timestamp":"2026-01-29T18:02:21.030Z","uuid":"0b766f00-2b9a-4d68-b915-430939f6de8c"}
{"parentUuid":"0b766f00-2b9a-4d68-b915-430939f6de8c","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01LxDmvjJWrKfNKSdMcPn6MY","type":"message","role":"assistant","content":[{"type":"text","text":"Excelente, ahora voy a buscar archivos adicionales para obtener una vista más completa:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9738,"cache_creation_input_tokens":25463,"cache_read_input_tokens":21264,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25463},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7EsTuFWdGoqGMyYqsn","type":"assistant","uuid":"712559db-8ebf-40dc-bb64-93bb1052ecb5","timestamp":"2026-01-29T18:02:24.846Z"}
{"parentUuid":"712559db-8ebf-40dc-bb64-93bb1052ecb5","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01LxDmvjJWrKfNKSdMcPn6MY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GpVHCJK26UmZBLfobdPEL2","name":"Bash","input":{"command":"find \"C:\\Users\\sergio\\proyectos\\Psicoalianza-2\" -type f -name \"*modal-consumos*\" 2>/dev/null | head -10"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9738,"cache_creation_input_tokens":25463,"cache_read_input_tokens":21264,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25463},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7EsTuFWdGoqGMyYqsn","type":"assistant","uuid":"6a2d93cd-4ba1-4d6b-a1f0-f7b5c6e958d5","timestamp":"2026-01-29T18:02:25.477Z"}
{"parentUuid":"6a2d93cd-4ba1-4d6b-a1f0-f7b5c6e958d5","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01LxDmvjJWrKfNKSdMcPn6MY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017e82kk69ojoJHeTS5cMqXR","name":"Grep","input":{"pattern":"aplicarFiltrosDropdownRecompras|borrarFiltrosAvanzadosCompras","glob":"**/*.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9738,"cache_creation_input_tokens":25463,"cache_read_input_tokens":21264,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25463},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7EsTuFWdGoqGMyYqsn","type":"assistant","uuid":"37c2c0db-a847-4054-bddd-2b1ddc567a75","timestamp":"2026-01-29T18:02:26.164Z"}
{"parentUuid":"37c2c0db-a847-4054-bddd-2b1ddc567a75","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017e82kk69ojoJHeTS5cMqXR","type":"tool_result","content":"Found 1 file\npublic\\js\\empresa\\planes\\modal-recompras.js"}]},"uuid":"03fd12cb-cfa1-4095-be9e-7fc6d4bac5af","timestamp":"2026-01-29T18:02:28.028Z","sourceToolAssistantUUID":"37c2c0db-a847-4054-bddd-2b1ddc567a75"}
{"parentUuid":"03fd12cb-cfa1-4095-be9e-7fc6d4bac5af","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_017e82kk69ojoJHeTS5cMqXR","toolUseID":"toolu_017e82kk69ojoJHeTS5cMqXR","timestamp":"2026-01-29T18:02:28.031Z","uuid":"c8eab54c-47a4-4a58-96b8-472aa2b61cc7"}
{"parentUuid":"6a2d93cd-4ba1-4d6b-a1f0-f7b5c6e958d5","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GpVHCJK26UmZBLfobdPEL2","type":"tool_result","content":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2/public/js/consumos/modal-consumos-empresa-plan.js\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2/public/js/empresa/planes/modal-consumos-creditos.js\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2/public/js/empresa/planes/modal-consumos.js\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2/resources/views/consumos/modal-consumos-empresa-plan.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2/resources/views/empresa/paginas/planes/modal-consumos-creditos.blade.php\nC:\\Users\\sergio\\proyectos\\Psicoalianza-2/resources/views/empresa/paginas/planes/modal-consumos.blade.php","is_error":false}]},"uuid":"8dcc4902-15c5-4e05-8980-89a54c210068","timestamp":"2026-01-29T18:02:29.174Z","sourceToolAssistantUUID":"6a2d93cd-4ba1-4d6b-a1f0-f7b5c6e958d5"}
{"parentUuid":"8dcc4902-15c5-4e05-8980-89a54c210068","isSidechain":true,"userType":"external","cwd":"C:\\Users\\sergio\\proyectos\\Psicoalianza-2","sessionId":"33e7e39b-d533-4d54-a4a4-a8d42f72ebfd","version":"2.1.23","gitBranch":"pre-main","agentId":"a4b8b1c","slug":"snug-baking-hearth","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01ARcvmkeMCvackPYxBSfUXe","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora tengo toda la información. Voy a compilar un análisis completo:\n\n## Resumen de Búsqueda - Archivos Encontrados\n\nHe localizado todos los archivos relacionados con planes-clientes, el modal de historial de compras y la funcionalidad de búsqueda con filtros y tags. Aquí está el análisis completo:\n\n---\n\n### **1. VISTA PRINCIPAL - `/planes-clientes`**\n\n**Ruta completa:** `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\planes.blade.php`\n\nEsta es la vista principal de planes-clientes que:\n- Importa el componente helper `contenedorPrincipal`\n- Renderiza un botón \"Historial de compras\" (id: `boton-modal-recompras`) en línea 70\n- Carga múltiples scripts de planes y modales\n- Incluye el modal de recompras mediante `@include('empresa.paginas.planes.modal-recompras')`\n\n---\n\n### **2. MODAL PRINCIPAL - \"Historial de Compras\"**\n\n**Ruta completa:** `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-recompras.blade.php`\n\n**Estructura del modal:**\n- ID del modal: `modal-historial-recompras` (línea 2)\n- Contiene 4 pestañas principales usando `crearTabsHorizontal`:\n  - **Pestana 1:** `pestana-compras-seleccion` (Selección)\n  - **Pestana 2:** `pestana-compras-organizacional` (Organizacional)\n  - **Pestana 3:** `pestana-compras-vocacional` (Vocacional)\n  - **Pestana 4:** `pestana-compras-creditos` (Créditos IA) - **LA QUE BUSCABAS** (línea 386)\n\n**Pestaña de Créditos IA (línea 386-467):**\n```blade\n{\n    id: 'pestana-compras-creditos',\n    icono: `<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\" ...>`,\n    titulo: `Créditos IA`,\n    contenido: `\n        <div class=\"col-12 mt-5\">\n            ${crearTabla({\n                id: 'tabla-compras-creditos',\n                filtro: crearFiltroDropdown({\n                    id: 'filtro_dropdown_creditos',\n                    placeholder: 'Buscar',\n                    dropdown: {\n                        titulo: 'Filtros avanzados',\n                        contenido: `\n                            <!-- Filtros: Fecha de activación y Estado del plan -->\n                        `\n                    }\n                }),\n                chips: `\n                    <div class=\"row align-items-center w-100 mx-0 contenedor-chips my-2\" \n                         id=\"contenedor-chips-filtro_dropdown_creditos\"></div>\n                `\n            })}\n        </div>\n    `,\n},\n```\n\n**Características de cada pestaña:**\n- Campo de búsqueda con icono de búsqueda\n- Icono de filtro avanzado (hamburguesa)\n- Contenedor de chips (tags) en `id=\"contenedor-chips-filtro_dropdown_creditos\"`\n- Tabla con datos paginados\n- Botón de exportar Excel\n\n---\n\n### **3. JAVASCRIPT PRINCIPAL**\n\n**Ruta completa:** `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\empresa\\planes\\modal-recompras.js`\n\n**Estructura de variables globales (líneas 35-51):**\n```javascript\nlet compras_seleccionadas_ids = { seleccion: [], organizacional: [], vocacional: [], creditos: [] };\nlet compras_ids = { seleccion: [], organizacional: [], vocacional: [], creditos: [] }\nlet busqueda_tablas = { seleccion: '', organizacional: '', vocacional: '', creditos: '' };\n\n// Filtros específicos por tabla\nlet filtros_seleccion = {};\nlet filtros_organizacional = {};\nlet filtros_vocacional = {};\nlet filtros_creditos = {};\n```\n\n**Funciones principales:**\n\n| Función | Línea | Propósito |\n|---------|-------|----------|\n| `modalHistorialCompras()` | 83 | Renderiza el modal completo con todos los datos |\n| `getHistorialCompras()` | 124 | Obtiene datos del backend vía AJAX |\n| `getHistorialComprasCreditos()` | 156 | Obtiene datos específicos de créditos |\n| `renderizarTablas()` | 181 | Renderiza tablas con DataTables |\n| `renderizarTablaCreditos()` | 308 | Renderiza tabla específica de créditos |\n| `aplicarBusquedaTabla()` | 417 | Aplica búsqueda en DataTables |\n| `procesarFiltrosTabla()` | 788 | Procesa y normaliza filtros del dropdown |\n| `aplicarFiltrosDropdownRecompras()` | 842 | **Aplica filtros por tabla** |\n| `restablecerFiltrosComponente()` | 192 (filtros.js) | **Limpia todos los filtros** |\n\n**Lógica de filtrado de créditos (líneas 799-808):**\n```javascript\nif (tabla === 'creditos') {\n    if (json_filtros[`fecha_activacion_filtro_${tabla}`] && typeof ... === 'string') {\n        const partesFechaCompra = json_filtros[`fecha_activacion_filtro_${tabla}`].split(' a ');\n        if (partesFechaCompra[0]) {\n            datos.created_at_desde = normalizarFechaFiltro(partesFechaCompra[0]);\n        }\n        if (partesFechaCompra[1]) {\n            datos.created_at_hasta = normalizarFechaFiltro(partesFechaCompra[1]);\n        }\n    }\n}\n```\n\n**Eventos inicializados (líneas 53-70):**\n```javascript\n$(document).ready(() => {\n    $('#boton-modal-recompras').on('click', () => modalHistorialCompras(empresa_id));\n    $(document).on('click', '#pestana-compras-creditos', async () => { \n        ajustarRenderDataTable('tabla-compras-creditos') \n    });\n    $(document).on('input', '#filtro_dropdown_creditos', function () { \n        busqueda_tablas.creditos = this.value; \n        aplicarBusquedaTabla('creditos', this.value); \n    });\n});\n```\n\n---\n\n### **4. COMPONENTE DE FILTROS CON CHIPS Y BÚSQUEDAS RECIENTES**\n\n**Ruta completa:** `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\componentes\\componentes\\filtros.js`\n\n**Funciones clave:**\n\n| Función | Línea | Propósito |\n|---------|-------|----------|\n| `crearFiltroDropdown()` | 9 | Crea el componente dropdown de filtros |\n| `mostrarFiltrosComponente()` | 56 | **Renderiza chips y gestiona filtros** |\n| `eliminarFiltroChip()` | 172 | **Elimina un chip individual** |\n| `restablecerFiltrosComponente()` | 192 | **Limpia TODOS los filtros** |\n| `mostrarRecientesChipStorage()` | 307 | Muestra \"BUSQUEDAS RECIENTES\" |\n\n**Gestión de localStorage (líneas 228-279):**\n- `agregarChipStorage()`: Guarda búsquedas en localStorage con estructura:\n```javascript\ncomponentes_chips_storage[pathname][filter_id] = {\n    chips: [...],           // Todos los chips guardados\n    cinco_recientes: [...]  // Últimas 5 búsquedas\n}\n```\n\n**Sección \"BUSQUEDAS RECIENTES\" (líneas 307-363):**\n```javascript\n// Línea 351: Texto \"BUSQUEDAS RECIENTES\"\n<div class=\"col-auto text-body-2 text-gray-40\">\n    BUSQUEDAS RECIENTES\n</div>\n\n// Se muestra cuando el usuario hace clic en el input de búsqueda\n// Estructura: máximo 5 búsquedas recientes del localStorage\n```\n\n**Limpieza de filtros (líneas 192-218):**\n```javascript\nfunction restablecerFiltrosComponente(input_id) {\n    // Limpiar inputs regulares\n    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('input:not(.flatpickr-range)').val('').trigger('input');\n    \n    // Limpiar flatpickr-range\n    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('input.flatpickr-range').each(function() {\n        if (this._flatpickr) {\n            this._flatpickr.clear();\n        } else {\n            $(this).val('');\n        }\n    });\n    \n    // Limpiar select2\n    $('#filtro-dropdown-' + input_id).find('.dropdown-menu').find('.select2').val('').trigger('change.select2');\n    \n    // Limpiar localStorage\n    // ... código para vaciar chips ...\n}\n```\n\n---\n\n### **5. FLUJO COMPLETO DE FILTRADO PARA CRÉDITOS**\n\n```\n1. Usuario hace clic en pestana-compras-creditos\n   ↓\n2. Se activa evento de clic → ajustarRenderDataTable('tabla-compras-creditos')\n   ↓\n3. Usuario escribe en #filtro_dropdown_creditos\n   ↓\n4. Evento 'input' → busqueda_tablas.creditos = valor → aplicarBusquedaTabla('creditos', valor)\n   ↓\n5. DataTable.search().draw() busca en los datos locales\n   ↓\n6. Usuario abre filtros avanzados (icono de hamburguesa)\n   ↓\n7. Selecciona valores:\n   - Fecha de activación (flatpickr-range)\n   - Estado del plan (select2)\n   ↓\n8. Click \"Aplicar filtros\"\n   ↓\n9. aplicarFiltrosDropdownRecompras('filtro_dropdown_creditos', filtros)\n   ↓\n10. procesarFiltrosTabla(filtros, 'creditos') normaliza fechas\n   ↓\n11. modalHistorialCompras(empresa_id, true, 'creditos', filtros_generados)\n   ↓\n12. getHistorialComprasCreditos(empresa_id, filtros) → AJAX al backend\n   ↓\n13. renderizarTablaCreditos() re-renderiza la tabla con nuevos datos\n   ↓\n14. Mostrar chips de filtros activos en #contenedor-chips-filtro_dropdown_creditos\n```\n\n---\n\n### **6. RESUMEN DE RUTAS DE ARCHIVOS**\n\n| Archivo | Ruta Completa |\n|---------|--------------|\n| **Vista Principal** | `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\planes.blade.php` |\n| **Modal Historial** | `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\views\\empresa\\paginas\\planes\\modal-recompras.blade.php` |\n| **JS Modal** | `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\js\\empresa\\planes\\modal-recompras.js` |\n| **JS Filtros** | `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\public\\componentes\\componentes\\filtros.js` |\n| **CSS Planes** | `C:\\Users\\sergio\\proyectos\\Psicoalianza-2\\resources\\css\\empresa\\planes.css` |\n\n---\n\n### **7. IDs Y SELECTORES CLAVE**\n\nPara la pestaña de Créditos IA:\n\n```\nModal principal:          #modal-historial-recompras\nPestaña créditos:         #pestana-compras-creditos\nTabla créditos:           #tabla-compras-creditos\nFiltro dropdown:          #filtro_dropdown_creditos\nContenedor chips:         #contenedor-chips-filtro_dropdown_creditos\nInput búsqueda:           #filtro_dropdown_creditos (mismo que dropdown)\nCampos filtro avanzado:\n  - Fecha activación:     #fecha_activacion_filtro_creditos\n  - Estado plan:          #estado_plan_filtro_creditos\n```\n\n---\n\n### **8. FUNCIONALIDAD DE LIMPIAR FILTROS**\n\n**Botón \"Borrar filtros\"** (línea 30-32 en filtros.js):\n```javascript\n${crearBoton({\n    clases: 'w-100 justify-content-center btn-outline-primary dropdown-close',\n    texto: 'Borrar filtros',\n    onclick: `restablecerFiltrosComponente('${componente.id}');`,\n})}\n```\n\n**Qué limpia:**\n1. Todos los inputs de texto (excepto flatpickr-range)\n2. Todos los date pickers (flatpickr)\n3. Todos los select2\n4. Borra el localStorage de chips\n5. Vuelve a llamar a `mostrarFiltrosComponente()` para actualizar la UI"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":52,"cache_creation_input_tokens":10225,"cache_read_input_tokens":46727,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10225},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXc7FSaDruZDKXpiZGF19","type":"assistant","uuid":"f426792a-a35f-49df-beaf-1685c1cd2af8","timestamp":"2026-01-29T18:02:58.078Z"}
